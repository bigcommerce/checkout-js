"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[3450],{27494:(e,t,n)=>{n.d(t,{PaypalExpressPaymentMethod:()=>x});var i,a,s,r,o,c,d,u,l,h=n(31635),p=n(80315),m=n(69440),y=n(58686),g={};function I(e,t){return Object.assign(e,{resolveIds:t})}g.d=(e,t)=>{for(var n in t)g.o(t,n)&&!g.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);class f extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}(l=i||(i={}))[l.MissingBillingAddress=0]="MissingBillingAddress",l[l.MissingCart=1]="MissingCart",l[l.MissingCheckout=2]="MissingCheckout",l[l.MissingConsignments=3]="MissingConsignments",l[l.MissingCustomer=4]="MissingCustomer",l[l.MissingCheckoutConfig=5]="MissingCheckoutConfig",l[l.MissingOrder=6]="MissingOrder",l[l.MissingOrderConfig=7]="MissingOrderConfig",l[l.MissingOrderId=8]="MissingOrderId",l[l.MissingPayment=9]="MissingPayment",l[l.MissingPaymentId=10]="MissingPaymentId",l[l.MissingPaymentInstrument=11]="MissingPaymentInstrument",l[l.MissingPaymentMethod=12]="MissingPaymentMethod",l[l.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",l[l.MissingPaymentStatus=14]="MissingPaymentStatus",l[l.MissingPaymentToken=15]="MissingPaymentToken",l[l.MissingShippingAddress=16]="MissingShippingAddress";class b extends f{constructor(e){super(function(e){switch(e){case i.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case i.MissingCart:return"Unable to proceed because cart data is unavailable.";case i.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case i.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case i.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case i.MissingCheckoutConfig:case i.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case i.MissingOrder:return"Unable to proceed because order data is unavailable.";case i.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case i.MissingPayment:return"Unable to proceed because payment data is unavailable.";case i.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case i.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case i.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(a||(a={}));class w extends f{constructor(e){super(function(e){switch(e){case a.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case a.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case a.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case a.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}class v extends f{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}!function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(s||(s={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.RESPONSIVE="responsive"}(r||(r={})),function(e){e.GOLD="gold",e.BLUE="blue",e.SIlVER="silver",e.BLACK="black"}(o||(o={})),function(e){e.CHECKOUT="checkout",e.PAY="pay",e.BUYNOW="buynow",e.PAYPAL="paypal",e.CREDIT="credit"}(c||(c={})),function(e){e.PILL="pill",e.RECT="rect"}(d||(d={})),function(e){e.ACKNOWLEDGE="ACKNOWLEDGE",e.FINALIZE="FINALIZE",e.INITIALIZE="INITIALIZE"}(u||(u={}));var P=function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((i=i.apply(e,t||[])).next())}))};class M{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t,this.useRedirectFlow=!1,this.window=window}initialize(e){return P(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState();this.paymentMethod=t.getPaymentMethodOrThrow(e.methodId),this.useRedirectFlow=!0===(e.paypalexpress&&e.paypalexpress.useRedirectFlow);const n=this.paymentMethod.config.merchantId;if(!this.isInContextEnabled()||!n)throw new b(i.MissingPaymentMethod);const a=yield this.scriptLoader.loadPaypalSDK();this.paypalSdk=a,this.paypalSdk.checkout.setup(n,{button:"paypal-button",environment:this.paymentMethod.config.testMode?"sandbox":"production"})}))}deinitialize(){return this.isInContextEnabled()&&this.paypalSdk&&(this.paypalSdk.checkout.closeFlow(),this.paypalSdk=void 0),Promise.resolve()}execute(e,t){return P(this,void 0,void 0,(function*(){let n,i;const s=this.paypalSdk;if(!this.isAcknowledgedOrFinalized()){if(!this.isInContextEnabled()||this.useRedirectFlow)return n=yield this.paymentIntegrationService.submitOrder(e,t),i=n.getPaymentRedirectUrl(),i&&this.window.top&&(this.window.top.location.href=i),new Promise(m.noop);if(!s)throw new w(a.PaymentNotInitialized);s.checkout.initXO();try{n=yield this.paymentIntegrationService.submitOrder(e,t)}catch(e){return s.checkout.closeFlow(),Promise.reject(e)}return i=n.getPaymentRedirectUrl(),i&&s.checkout.startFlow(i),new Promise(m.noop)}yield this.paymentIntegrationService.submitOrder(e,t)}))}finalize(e){return P(this,void 0,void 0,(function*(){return this.paymentIntegrationService.getState().getOrder()&&this.isAcknowledgedOrFinalized()?(yield this.paymentIntegrationService.finalizeOrder(e),Promise.resolve()):Promise.reject(new v)}))}isAcknowledgedOrFinalized(){const e=this.paymentIntegrationService.getState();return e.getPaymentStatus()===u.ACKNOWLEDGE||e.getPaymentStatus()===u.FINALIZE}isInContextEnabled(){return!(!this.paymentMethod||!this.paymentMethod.config.merchantId)}}class S extends f{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}class k{constructor(e){this.scriptLoader=e,this.window=window}loadPaypalSDK(e=""){return t=this,i=function*(){const t=Object.assign({async:!0,attributes:{"data-merchant-id":e}},e&&{attributes:{"data-merchant-id":e}});if(yield this.scriptLoader.loadScript("//www.paypalobjects.com/api/checkout.min.js",t),!this.window.paypal)throw new S;return this.window.paypal},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{o(i.next(e))}catch(e){a(e)}}function r(e){try{o(i.throw(e))}catch(e){a(e)}}function o(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(s,r)}o((i=i.apply(t,[])).next())}));var t,n,i}}const E=I((e=>new M(e,new k((0,p.vQ)()))),[{id:"paypalexpress",type:"PAYMENT_TYPE_HOSTED"},{id:"paypalexpresscredit",type:"PAYMENT_TYPE_HOSTED"}]);class C extends f{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}const O={"X-Checkout-SDK-Version":"1.813.2"};var z=function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((i=i.apply(e,t||[])).next())}))};class A{constructor(e,t,n){this.paymentIntegrationService=e,this.paypalExpressScriptLoader=t,this.formPoster=n}initialize(e){return z(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId);if(!e.paypal)throw new C;if(!t.config.merchantId)throw new b(i.MissingPaymentMethod);const n=yield this.paypalExpressScriptLoader.loadPaypalSDK(t.config.merchantId);this.renderButton(e,n)}))}deinitialize(){return Promise.resolve()}renderButton(e,t){const{containerId:n,methodId:a,paypal:s}=e,{allowCredit:r,clientId:o,onPaymentError:c,shouldProcessPayment:d,style:u}=s,l=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId);if(!l.config.merchantId)throw new b(i.MissingPaymentMethod);const h=l.config.merchantId,p=l.config.testMode?"sandbox":"production",m={[p]:o},y=t.FUNDING.CREDIT||"credit",g=r?[y]:[],I=r?[]:[y];return t.Button.render({env:p,client:m,commit:d,funding:{allowed:g,disallowed:I},style:this.getStyle(u),payment:(e,t)=>this.setupPayment(h,t,c),onAuthorize:(e,t)=>this.tokenizePayment(e,a,t,d)},n)}getStyle(e){const{color:t,fundingicons:n,label:i,layout:a,shape:s,size:o,tagline:c}=e||{};return{color:t,fundingicons:n,label:i,layout:a,shape:s||d.RECT,size:"small"===o?r.RESPONSIVE:o,tagline:c}}setupPayment(e,t,n){return z(this,void 0,void 0,(function*(){if(!t)throw new w(a.CheckoutButtonNotInitialized);try{const n=yield this.paymentIntegrationService.loadDefaultCheckout(),{id:i}=n.getCartOrThrow(),a=n.getHost()||"";return(yield t.request.post(`${a}/api/storefront/payment/paypalexpress`,{merchantId:e,cartId:i},{headers:Object.assign({"X-API-INTERNAL":"This API endpoint is for internal use only and may change in the future"},O)})).id}catch(e){throw n&&e instanceof f&&n(e),e}}))}tokenizePayment(e,t,n,s){return z(this,void 0,void 0,(function*(){if(!n)throw new w(a.CheckoutButtonNotInitialized);if(!e.paymentID||!e.payerID)throw new b(i.MissingPayment);const r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(t),o=yield n.payment.get(e.paymentID);return this.formPoster.postForm("/checkout.php",{payment_type:"paypal",provider:r.id,action:s?"process_payment":"set_external_checkout",paymentId:e.paymentID,payerId:e.payerID,payerInfo:JSON.stringify(o.payer.payer_info)})}))}}I((e=>new A(e,new k((0,p.vQ)()),(0,y.createFormPoster)())),[{id:"paypalexpress"}]);var N=n(70355),U=n(31698);const x=(0,n(19285).A)((e=>{var{checkoutService:t,isEmbedded:n=!1}=e,i=(0,h.__rest)(e,["checkoutService","isEmbedded"]);const a=(0,N.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{integrations:[E],paypalexpress:{useRedirectFlow:n}}))),[t,n]);return N.createElement(U.A,Object.assign({},i,{checkoutService:t,deinitializePayment:t.deinitializePayment,initializePayment:a}))}),[{id:"paypalexpress"}])},31698:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(31635),a=n(44218),s=n(69440),r=n(70355),o=n(65685),c=n(94611),d=n(11474),u=n(40646),l=n(91182);const h=e=>{const{description:t,isInitializing:n=!1,initializePayment:h,method:p,onUnhandledError:m=s.noop,deinitializePayment:y}=e,[g,I]=(0,r.useState)(!1),[f,b]=(0,r.useState)(),w=function(e){const t=(0,a.B4)(((e=[])=>e.filter(o.A))),n=(0,a.B4)(((e=[])=>e.filter((({trustedShippingAddress:e})=>e)))),{checkoutService:i,checkoutState:s,isUsingMultiShipping:r=!1,method:d}=e,{data:{getCart:u,getConfig:l,getCustomer:h,getInstruments:p,isPaymentDataRequired:m,isPaymentDataSubmitted:y},statuses:{isLoadingInstruments:g}}=s,I=u(),f=l(),b=h();if(!f||!I||!b)throw new Error("Unable to get checkout");const w=t(p(d)),v=n(w);return{instruments:v,isNewAddress:0===v.length&&w.length>0,isInstrumentFeatureAvailable:!y(d.id,d.gateway)&&(0,c.A)({config:f,customer:b,isUsingMultiShipping:r,paymentMethod:d}),isLoadingInstruments:g(),isPaymentDataRequired:m(),loadInstruments:i.loadInstruments}}(e),{isLoadingInstruments:v,instruments:P,isNewAddress:M,isInstrumentFeatureAvailable:S,loadInstruments:k}=w,E=(0,r.useCallback)((()=>{if(!g&&P.length)return(0,s.find)(P,{defaultInstrument:!0})||P[0]}),[g,P]),C=(0,r.useCallback)((()=>{I(!0),b(void 0)}),[]),O=(0,r.useCallback)((e=>{I(!1),b((0,s.find)(P,{bigpayToken:e}))}),[P]);(0,r.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield h({gatewayId:p.gateway,methodId:p.id}),S&&(yield k())}catch(e){m(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield y({gatewayId:p.gateway,methodId:p.id})}catch(e){m(e)}}))})),[]);const z=f||E(),A=n||v,N=S&&(P.length>0||M);return t||S?r.createElement(l.A,{hideContentWhenLoading:!0,isLoading:A},r.createElement("div",{className:"paymentMethod paymentMethod--hosted"},t,N&&r.createElement(d.A,{instruments:P,onSelectInstrument:O,onUseNewInstrument:C,selectedInstrument:z}),S&&r.createElement(u.A,{instrumentId:z&&z.bigpayToken,instruments:P,isAccountInstrument:!0}))):null}},94611:(e,t,n)=>{function i({config:e,customer:t,isUsingMultiShipping:n,paymentMethod:i}){return!(!e.checkoutSettings.isCardVaultingEnabled||!i.config.isVaultingEnabled||t.isGuest||n)}n.d(t,{A:()=>i})}}]);
//# sourceMappingURL=paypal-express-payment-method-defcd4c7.js.map