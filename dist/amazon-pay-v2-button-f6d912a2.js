"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[3380,3948],{29905:(e,t,n)=>{function i(e){switch(e){case"amex":case"american_express":return"american-express";case"diners":case"diners_club":return"diners-club";default:return e}}n.d(t,{A:()=>i})},31448:(e,t,n)=>{n.d(t,{A:()=>i});const i=(0,n(12077).createSelector)((({data:e})=>{const t=e.getCart();return t&&t.lineItems}),(e=>(t,n)=>!!e&&function({lineItems:e,instrument:t,paymentMethod:n}){const{isVaultingCardNumberValidationAvailable:i=!0}=(null==n?void 0:n.initializationData)||{};return!(0===e.physicalItems.length||!i||t.trustedShippingAddress)}({lineItems:e,instrument:t,paymentMethod:n})))},47109:(e,t,n)=>{n.d(t,{A:()=>g});var i=n(31635),s=n(3375),a=n.n(s),r=n(69440),d=n(70355),o=n(72769),m=n(52137),l=n(11474),u=n(62677),c=n(40646),h=n(43125),p=n(49655),I=n(68801);class y extends d.Component{constructor(){super(...arguments),this.state={isAddingNewCard:!1},this.handleDeleteInstrument=e=>{const{instruments:t,setFieldValue:n}=this.props,{selectedInstrumentId:i}=this.state;0===t.length?(this.setState({isAddingNewCard:!0,selectedInstrumentId:void 0}),n("instrumentId","")):i===e&&(this.setState({selectedInstrumentId:this.getDefaultInstrumentId()}),n("instrumentId",this.getDefaultInstrumentId()))},this.handleUseNewCard=()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const{deinitializePayment:e,initializePayment:t=r.noop,method:n}=this.props;this.setState({isAddingNewCard:!0,selectedInstrumentId:void 0}),yield e({gatewayId:n.gateway,methodId:n.id}),yield t({gatewayId:n.gateway,methodId:n.id})})),this.handleSelectInstrument=e=>{this.setState({isAddingNewCard:!1,selectedInstrumentId:e})}}componentDidMount(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const{isInstrumentFeatureAvailable:e,loadInstruments:t,method:n,onUnhandledError:i=r.noop,setValidationSchema:s}=this.props;s(n,this.getValidationSchema());try{e&&(yield t()),yield this.initializeMethod()}catch(e){i(e)}}))}componentDidUpdate(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const{deinitializePayment:n,instruments:i,method:s,onUnhandledError:a=r.noop,setValidationSchema:d,isPaymentDataRequired:o}=this.props,{selectedInstrumentId:m}=this.state;if(d(s,this.getValidationSchema()),m!==t.selectedInstrumentId||e.instruments.length>0&&0===i.length||e.isPaymentDataRequired!==o)try{yield n({gatewayId:s.gateway,methodId:s.id}),yield this.initializeMethod()}catch(e){a(e)}}))}componentWillUnmount(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const{deinitializeCustomer:e=r.noop,deinitializePayment:t,method:n,onUnhandledError:i=r.noop,setSubmit:s,setValidationSchema:a}=this.props;a(n,null),s(n,null);try{yield t({gatewayId:n.gateway,methodId:n.id}),yield e({methodId:n.id})}catch(e){i(e)}}))}render(){const{instruments:e,hideWidget:t=!1,isInitializing:n=!1,isAccountInstrument:i,isInstrumentFeatureAvailable:s,isLoadingInstruments:a,shouldHideInstrumentExpiryDate:r=!1,shouldShow:o=!0}=this.props,{isAddingNewCard:h,selectedInstrumentId:p=this.getDefaultInstrumentId()}=this.state;if(!o)return null;const y=e.find((e=>e.bigpayToken===p))||e[0],g=s&&e.length>0,b=!g||h,E=(n||a)&&!t,v=this.getSelectedBankAccountInstrument(h,y),C=e[0]&&(0,m.T)(e[0]);return d.createElement(I.A,{hideContentWhenLoading:!0,isLoading:E},d.createElement("div",{className:"paymentMethod--hosted"},C&&g&&d.createElement(l.A,{instruments:e,onSelectInstrument:this.handleSelectInstrument,onUseNewInstrument:this.handleUseNewCard,selectedInstrument:v}),!C&&g&&d.createElement(u.A,{instruments:e,onDeleteInstrument:this.handleDeleteInstrument,onSelectInstrument:this.handleSelectInstrument,onUseNewInstrument:this.handleUseNewCard,selectedInstrumentId:p,shouldHideExpiryDate:r,validateInstrument:this.getValidateInstrument()}),this.renderPaymentDescriptorIfAvailable(),this.renderContainer(b),s&&d.createElement(c.A,{instrumentId:p,instruments:e,isAccountInstrument:i||C}),this.renderEditButtonIfAvailable()))}getValidateInstrument(){const{hideVerificationFields:e,instruments:t,method:n,isInstrumentCardNumberRequired:i,validateInstrument:s}=this.props,{selectedInstrumentId:a=this.getDefaultInstrumentId()}=this.state,d=(0,r.find)(t,{bigpayToken:a});if(d){(0,h.A)(d);const t=i(d,n);if(e)return;if(s)return s(t,d)}}renderContainer(e){const{containerId:t,hideContentWhenSignedOut:n=!1,hideWidget:i,isSignInRequired:s=!1,isSignedIn:r,method:o,additionalContainerClassName:m,shouldRenderCustomInstrument:l=!1,renderCustomPaymentForm:u}=this.props;return d.createElement("div",{className:a()("widget",`widget--${o.id}`,"payment-widget",l?"":m),id:t,style:{display:n&&s&&!r||!e||i?"none":void 0},tabIndex:-1},l&&u&&u())}getValidationSchema(){const{isInstrumentFeatureAvailable:e,isPaymentDataRequired:t,storedCardValidationSchema:n}=this.props;if(!t)return null;const i=this.getSelectedInstrument();return e&&i&&n||null}getSelectedInstrument(){const{instruments:e}=this.props,{selectedInstrumentId:t=this.getDefaultInstrumentId()}=this.state;return(0,r.find)(e,{bigpayToken:t})}getSelectedBankAccountInstrument(e,t){return!e&&(0,m.T)(t)?t:void 0}renderEditButtonIfAvailable(){const{shouldShowEditButton:e,buttonId:t}=this.props,n=d.createElement(p.A,{id:"remote.select_different_card_action"});if(e)return d.createElement("p",null,d.createElement("a",{className:a()("stepHeader","widget-link-amazonpay"),id:t,onClick:(0,o.A)()},n))}renderPaymentDescriptorIfAvailable(){const{shouldShowDescriptor:e,paymentDescriptor:t}=this.props;if(e&&t)return d.createElement("div",{className:"payment-descriptor"},t)}initializeMethod(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const{isPaymentDataRequired:e,isSignedIn:t,isSignInRequired:n,initializeCustomer:i=r.noop,initializePayment:s=r.noop,instruments:a,method:d,setSubmit:o,signInCustomer:m=r.noop}=this.props,{selectedInstrumentId:l=this.getDefaultInstrumentId(),isAddingNewCard:u}=this.state;let c;return e?n&&!t?(o(d,m),i({methodId:d.id})):(o(d,null),u||(c=a.find((e=>e.bigpayToken===l))||a[0]),s({gatewayId:d.gateway,methodId:d.id},c)):(o(d,null),Promise.resolve())}))}getDefaultInstrumentId(){const{isAddingNewCard:e}=this.state;if(e)return;const{instruments:t}=this.props,n=t.find((e=>e.defaultInstrument))||t[0];return n&&n.bigpayToken}}const g=y},48407:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(12077);const s=["bluesnapdirect"];const a=(0,i.createSelector)((({data:e})=>{const t=e.getCart();return t&&t.lineItems}),(e=>(t,n)=>!!e&&function({instrument:e,lineItems:t,paymentMethod:n}){const{config:{isVaultingCvvEnabled:i,cardCode:a},initializationData:r}=n,{isVaultingCardCodeValidationAvailable:d=!0}=r||{};return!(s.includes(e.provider)||!d||!(t.digitalItems.length>0||t.giftCertificates.length>0)&&(e.trustedShippingAddress?!i:!i&&!a))}({instrument:t,lineItems:e,paymentMethod:n})))},62677:(e,t,n)=>{n.d(t,{A:()=>w});var i=n(70355),s=n(49655),a=n(24750),r=n(40052),d=n(35393),o=n(97834),m=n(22437),l=n(3375),u=n.n(l),c=n(52921),h=n.n(c),p=n(69440),I=n(86516),y=n(47237),g=n(29905);const b=({className:e,instrument:t,testId:n,shouldHideExpiryDate:a=!1,onClick:r})=>{var d;const o=(0,g.A)(t.brand),l=h().getTypeInfo(o),c=!(0,m.expirationDate)({month:t.expiryMonth,year:t.expiryYear}).isValid;return i.createElement("button",{className:e,"data-test":n,onClick:r,type:"button"},i.createElement("div",{className:u()("instrumentSelect-details",{"instrumentSelect-details--expired":c})},i.createElement(I.A,{cardType:o}),i.createElement("div",{className:"instrumentSelect-card","data-test":`${null!=n?n:""}-last4`},l?i.createElement(s.A,{data:{cardTitle:null!==(d=l.niceType)&&void 0!==d?d:"",endingIn:t.last4},id:"payment.instrument_ending_in_text"}):i.createElement(s.A,{data:{endingIn:t.last4},id:"payment.instrument_default_ending_in_text"})),!a&&i.createElement("div",{className:u()("instrumentSelect-expiry",{"instrumentSelect-expiry--expired":c}),"data-test":`${n||""}-expiry`},c?i.createElement(s.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expired_text"}):i.createElement(s.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expires_text"}))))},E=({instrument:e,shouldHideExpiryDate:t=!1,onClick:n=p.noop})=>{const s=(0,i.useCallback)((()=>{n(e.bigpayToken)}),[n,e]);return i.createElement(b,{instrument:e,onClick:s,shouldHideExpiryDate:t,testId:"instrument-select-option"})},v=({className:e,testId:t,onClick:n=p.noop})=>i.createElement("button",{className:e,"data-test":t,onClick:n,type:"button"},i.createElement("div",{className:"instrumentSelect-details instrumentSelect-details--addNew"},i.createElement(I.A,null),i.createElement("div",{className:"instrumentSelect-card"},i.createElement(s.A,{id:"payment.instrument_add_card_action"})))),C=({instruments:e,selectedInstrumentId:t,shouldHideExpiryDate:n=!1,onSelectInstrument:s,onUseNewInstrument:a})=>i.createElement("ul",{className:"instrumentSelect-dropdownMenu instrumentSelect-dropdownMenuNext dropdown-menu","data-test":"instrument-select-menu"},e.map((e=>i.createElement("li",{className:u()("instrumentSelect-option dropdown-menu-item",{"instrumentSelect-option--selected":e.bigpayToken===t}),key:e.bigpayToken},i.createElement(E,{instrument:e,onClick:s,shouldHideExpiryDate:n,testId:"instrument-select-option"})))),i.createElement("li",{className:"instrumentSelect-option instrumentSelect-option--addNew dropdown-menu-item"},i.createElement(v,{onClick:a,testId:"instrument-select-option-use-new"}))),S=({instrument:e,shouldHideExpiryDate:t=!1,testId:n,onClick:s})=>e?i.createElement(b,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",instrument:e,onClick:s,shouldHideExpiryDate:t,testId:n}):i.createElement(v,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",testId:n}),f=({field:e,form:t,instruments:n,onSelectInstrument:s,onUseNewInstrument:a,selectedInstrumentId:r,shouldHideExpiryDate:d=!1})=>{const o=(0,i.useRef)(r),m=(0,i.useCallback)(((n="")=>{t.setFieldValue(e.name,n)}),[t,e.name]);(0,i.useEffect)((()=>(setTimeout((()=>m(r))),()=>{""===e.value&&void 0!==r&&m()})),[]),(0,i.useEffect)((()=>{o.current!==r&&m(r),o.current=r}),[r,m]);const l=(0,p.find)(n,{bigpayToken:r});return i.createElement("div",{className:"instrumentSelect"},i.createElement(y.A,{dropdown:i.createElement(C,{instruments:n,onSelectInstrument:s,onUseNewInstrument:a,selectedInstrumentId:r,shouldHideExpiryDate:d})},i.createElement(S,{instrument:l,shouldHideExpiryDate:d,testId:"instrument-select"}),i.createElement("input",Object.assign({type:"hidden"},e))))};var A=n(3701);const w=(0,i.memo)((({instruments:e,onDeleteInstrument:t,onSelectInstrument:n,onUseNewInstrument:m,selectedInstrumentId:l,shouldHideExpiryDate:u=!1,validateInstrument:c=null})=>{const h=(0,i.useCallback)((t=>i.createElement(f,Object.assign({},t,{instruments:e,onSelectInstrument:n,onUseNewInstrument:m,selectedInstrumentId:l,shouldHideExpiryDate:u}))),[e,n,m,l,u]),p=(0,i.useCallback)((n=>i.createElement(A.A,Object.assign({instruments:e,onDeleteInstrument:t},n))),[e,t]);return i.createElement(a.A,{additionalClassName:"instrumentFieldset",legend:i.createElement(r.A,{hidden:!0},i.createElement(s.A,{id:"payment.instrument_text"}))},i.createElement(d.A,{modal:p},(({onClick:e})=>i.createElement("button",{className:"instrumentModal-trigger",onClick:e,type:"button"},i.createElement(s.A,{id:"payment.instrument_manage_button"})))),i.createElement(o.A,{name:"instrumentId",render:h}),i.createElement("div",{style:{display:l?void 0:"none"}},c))}))},63582:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(31635),s=n(70355);const a=(0,n(19285).A)((({checkoutService:{deinitializeCustomer:e,initializeCustomer:t},checkoutButtonContainerClass:n,containerId:a,methodId:r,onUnhandledError:d,onWalletButtonClick:o,additionalInitializationOptions:m})=>((0,s.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t({methodId:r,[r]:Object.assign({container:a,onUnhandledError:d,onClick:()=>o(r)},m)})}catch(e){"function"==typeof d&&e instanceof Error&&d(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield e({methodId:r})}catch(e){"function"==typeof d&&e instanceof Error&&d(e)}}))})),[]),s.createElement("div",{className:n,"data-test":a,id:a}))),[])},66960:(e,t,n)=>{n.d(t,{N:()=>a,i:()=>s});var i=n(70355);const s=(0,i.createContext)(void 0);function a(){const e=(0,i.useContext)(s);if(!e)throw new Error("usePaymentFormContext must be used within a PaymentFormContextProvider");return e}},86516:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(70355),s=n(97685),a=n(2156);const r=(0,i.memo)((({cardType:e})=>{const t={additionalClassName:"cardIcon-icon",size:a.l.Medium,testId:`credit-card-icon-${e||"default"}`},n=(0,s.qT)(e);return n?i.createElement(i.Suspense,null,i.createElement(n,Object.assign({},t))):i.createElement("div",{className:"cardIcon-icon cardIcon-icon--default icon icon--medium"})}))},88727:(e,t,n)=>{n.r(t),n.d(t,{AmazonPayV2Button:()=>h,AmazonPayV2PaymentMethod:()=>l});var i=n(31635),s=n(69440),a=n(70355),r=n(47109),d=n(48407),o=n(31448),m=n(19285);const l=(0,m.A)((e=>{var{checkoutService:t,checkoutState:n,paymentForm:m,method:l,method:{initializationData:{paymentDescriptor:u,paymentToken:c}}}=e,h=(0,i.__rest)(e,["checkoutService","checkoutState","paymentForm","method","method"]);const p=(0,a.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{amazonpay:{editButtonId:"editButtonId"}}))),[t]),I=(0,a.useCallback)((()=>window.location.reload()),[]),{hidePaymentSubmitButton:y,disableSubmit:g,setFieldValue:b,setSubmit:E,setValidationSchema:v}=m,{data:{getCheckout:C,isPaymentDataRequired:S},statuses:{isLoadingInstruments:f}}=n,A=C(),w=n.data.getCustomer(),N=!(null==w?void 0:w.isGuest)&&Boolean(l.config.isVaultingEnabled),z=n.data.getInstruments(l)||[];return a.createElement(r.A,Object.assign({},h,{buttonId:"editButtonId",containerId:"paymentWidget",deinitializePayment:t.deinitializePayment,disableSubmit:g,hidePaymentSubmitButton:y,hideWidget:!0,initializePayment:p,instruments:z,isInstrumentCardCodeRequired:(0,d.A)(n),isInstrumentCardNumberRequired:(0,o.A)(n),isInstrumentFeatureAvailable:N,isLoadingInstruments:f(),isPaymentDataRequired:S(),isSignInRequired:!1,isSignedIn:(0,s.some)(null==A?void 0:A.payments,{providerId:l.id}),loadInstruments:t.loadInstruments,method:l,onSignOut:I,paymentDescriptor:u,setFieldValue:b,setSubmit:E,setValidationSchema:v,shouldShow:!!c,shouldShowDescriptor:!!c,shouldShowEditButton:!!c,signOut:t.signOutCustomer}))}),[{id:"amazonpay"}]);var u=n(63582);const c=()=>{var e;if(!document.querySelector(".checkout-button-container"))return;const t=document.querySelector("#amazonpayCheckoutButton > div");if(t){const n=null===(e=t.shadowRoot)||void 0===e?void 0:e.querySelector(".amazonpay-button-view1");if(n instanceof HTMLElement)return void(n.style.height="36px")}setTimeout(c,10)},h=(0,m.A)((e=>((0,a.useEffect)((()=>{c()}),[]),a.createElement("div",{className:"AmazonPayContainer"},a.createElement(u.A,Object.assign({},e))))),[{id:"amazonpay"}])},97685:(e,t,n)=>{n.d(t,{Ay:()=>a,TE:()=>d,qT:()=>r});var i=n(70355);const s={AMEX:{instrument:"american-express",component:(0,i.lazy)((()=>n.e(5609).then(n.bind(n,68494))))},BITCOIN:{instrument:"bitcoin",component:(0,i.lazy)((()=>n.e(5137).then(n.bind(n,25755))))},BITCOIN_CASH:{instrument:"bitcoin-cash",component:(0,i.lazy)((()=>n.e(63).then(n.bind(n,94526))))},BANCONTACT:{instrument:"bancontact",component:(0,i.lazy)((()=>n.e(8841).then(n.bind(n,69790))))},CARNET:{instrument:"carnet",component:(0,i.lazy)((()=>n.e(535).then(n.bind(n,57228))))},CB:{instrument:"cb",component:(0,i.lazy)((()=>n.e(5615).then(n.bind(n,79060))))},DINERS:{instrument:"diners-club",component:(0,i.lazy)((()=>n.e(9764).then(n.bind(n,43228))))},DANKORT:{instrument:"dankort",component:(0,i.lazy)((()=>n.e(8773).then(n.bind(n,1530))))},DISCOVER:{instrument:"discover",component:(0,i.lazy)((()=>n.e(8057).then(n.bind(n,83262))))},DOGECOIN:{instrument:"dogecoin",component:(0,i.lazy)((()=>n.e(69).then(n.bind(n,24125))))},ELECTRON:{instrument:"electron",component:(0,i.lazy)((()=>n.e(1782).then(n.bind(n,97841))))},ELO:{instrument:"elo",component:(0,i.lazy)((()=>n.e(4322).then(n.bind(n,27261))))},ETHEREUM:{instrument:"ethereum",component:(0,i.lazy)((()=>n.e(6954).then(n.bind(n,71518))))},HIPER:{instrument:"hiper",component:(0,i.lazy)((()=>n.e(7292).then(n.bind(n,47919))))},JCB:{instrument:"jcb",component:(0,i.lazy)((()=>n.e(4833).then(n.bind(n,30758))))},LITECOIN:{instrument:"litecoin",component:(0,i.lazy)((()=>n.e(7234).then(n.bind(n,52646))))},MADA:{instrument:"mada",component:(0,i.lazy)((()=>n.e(1767).then(n.bind(n,18732))))},MAESTRO:{instrument:"maestro",component:(0,i.lazy)((()=>n.e(2891).then(n.bind(n,22704))))},MC:{instrument:"mastercard",component:(0,i.lazy)((()=>n.e(4936).then(n.bind(n,63723))))},SHIBA_INU:{instrument:"shiba-inu",component:(0,i.lazy)((()=>n.e(4795).then(n.bind(n,55420))))},TROY:{instrument:"troy",component:(0,i.lazy)((()=>n.e(370).then(n.bind(n,23229))))},CUP:{instrument:"unionpay",component:(0,i.lazy)((()=>n.e(2425).then(n.bind(n,66302))))},USD_COIN:{instrument:"usd-coin",component:(0,i.lazy)((()=>n.e(2643).then(n.bind(n,68650))))},VISA:{instrument:"visa",component:(0,i.lazy)((()=>n.e(1507).then(n.bind(n,24856))))}};function a(e){var t;return(null===(t=s[e])||void 0===t?void 0:t.instrument)||void 0}function r(e){if(!e)return;const t=Object.values(s).find((t=>t.instrument===e));return t?t.component:void 0}function d(e){const t=Object.values(s).map((e=>e.instrument));return e.filter((e=>t.includes(e)))}}}]);
//# sourceMappingURL=amazon-pay-v2-button-f6d912a2.js.map