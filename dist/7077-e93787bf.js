"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[7077],{17077:(e,t,n)=>{n.d(t,{A:()=>$});var r=n(31635),a=n(70355),i=n(94611),s=n(44218),d=n(69440),c=n(43125),o=n(48407),l=n(31448),m=n(22437),u=n(52921),g=n.n(u),p=n(94202),h=n(29905);const C=(0,s.Bj)((function({instrumentBrand:e,instrumentLast4:t,isCardCodeRequired:n,isCardNumberRequired:r,language:a}){const i={instrumentId:(0,p.Yj)().required()};return n&&(i.ccCvv=(0,p.Yj)().required(a.translate("payment.credit_card_cvv_required_error")).test({message:a.translate("payment.credit_card_cvv_invalid_error"),test(t=""){const n=(0,h.A)(e),r=g().getTypeInfo(n);return(0,m.cvv)(t,r&&r.code?r.code.size:void 0).isValid}})),r&&(i.ccNumber=(0,p.Yj)().required(a.translate("payment.credit_card_number_required_error")).test({message:a.translate("payment.credit_card_number_invalid_error"),test:(e="")=>(0,m.number)(e).isValid}).test({message:a.translate("payment.credit_card_number_mismatch_error"),test:(e="")=>e.slice(-t.length)===t})),(0,p.Ik)(i)})),f=(0,s.Bj)((function({isCardCodeRequired:e,language:t}){const n={ccCustomerCode:(0,p.Yj)(),ccCvv:(0,p.Yj)(),ccExpiry:(0,p.Yj)().required(t.translate("payment.credit_card_expiration_required_error")).test({message:t.translate("payment.credit_card_expiration_invalid_error"),test:e=>(0,m.expirationDate)(e).isValid}),ccName:(0,p.Yj)().max(200).required(t.translate("payment.credit_card_name_required_error")),ccNumber:(0,p.Yj)().required(t.translate("payment.credit_card_number_required_error")).test({message:t.translate("payment.credit_card_number_invalid_error"),test:e=>(0,m.number)(e).isValid})};return e&&(n.ccCvv=(0,p.Yj)().required(t.translate("payment.credit_card_cvv_required_error")).test({message:t.translate("payment.credit_card_cvv_invalid_error"),test(e){const{card:t}=(0,m.number)(this.parent.ccNumber);return(0,m.cvv)(e,t&&t.code?t.code.size:void 0).isValid}})),(0,p.Ik)(n)}));var _=n(62677),E=n(49655),y=n(10156),v=n(14456),b=n(30680);function I(e,t=" "){const{card:n}=(0,m.number)(e);if(!n)return e;const r=function(e,t=" "){const{card:n}=(0,m.number)(e);return n?e.replace(new RegExp(t,"g"),""):e}(e,t);return n.gaps.filter((e=>r.length>e)).reduce(((e,n,r)=>[e.slice(0,n+r),e.slice(n+r)].join(t)),r)}class A extends a.PureComponent{constructor(){super(...arguments),this.inputRef=(0,a.createRef)(),this.nextSelectionEnd=0,this.handleChange=e=>{const{value:t=""}=e.target,{field:n,form:r}=this.props,{name:a,value:i=""}=n,s=this.inputRef.current&&this.inputRef.current.selectionEnd;if(new RegExp("[^\\d ]").test(t))return r.setFieldValue(a,i);const c=(0,d.max)(g()(t).map((e=>(0,d.max)(e.lengths)))),o=I(t.replace(new RegExp(" ","g"),"").slice(0,c)," ");return s===t.length&&t.length<o.length?this.nextSelectionEnd=o.length:this.nextSelectionEnd=s||0,r.setFieldValue(a,o)}}componentDidUpdate(){this.inputRef.current&&this.inputRef.current.selectionEnd!==this.nextSelectionEnd&&this.inputRef.current.setSelectionRange(this.nextSelectionEnd,this.nextSelectionEnd)}render(){const{field:e}=this.props;return a.createElement(a.Fragment,null,a.createElement(y.A,Object.assign({},e,{additionalClassName:"has-icon",autoComplete:"cc-number",id:e.name,onChange:this.handleChange,ref:this.inputRef,type:"tel"})),a.createElement(v.A,null))}}const w=(0,a.memo)((({name:e})=>{const t=(0,a.useCallback)((({field:e,form:t,meta:n})=>a.createElement(A,{field:e,form:t,meta:n})),[]),n=(0,a.useMemo)((()=>a.createElement(E.A,{id:"payment.credit_card_number_label"})),[]);return a.createElement(b.A,{additionalClassName:"form-field--ccNumber",input:t,labelContent:n,name:e})}));var S=n(97429),N=n(2224),F=n(90767);const q=(0,a.memo)((({name:e})=>{const t=(0,a.useCallback)((({field:e})=>a.createElement(a.Fragment,null,a.createElement(y.A,Object.assign({},e,{additionalClassName:"has-icon",autoComplete:"cc-csc",id:e.name,type:"tel"})),a.createElement(v.A,null))),[]),n=(0,a.useMemo)((()=>a.createElement(a.Fragment,null,a.createElement(E.A,{id:"payment.credit_card_cvv_label"}),a.createElement(S.A,{placement:"top-start",tooltip:a.createElement(F.A,null)},a.createElement("span",{className:"has-tip"},a.createElement(N.A,null))))),[]);return a.createElement(b.A,{additionalClassName:"form-ccFields-field--ccCvv",input:t,labelContent:n,name:e})})),R=({shouldShowNumberField:e,shouldShowCardCodeField:t})=>a.createElement(a.Fragment,null,e&&a.createElement("p",null,a.createElement("strong",null,a.createElement(E.A,{id:"payment.instrument_trusted_shipping_address_title_text"})),a.createElement("br",null),a.createElement(E.A,{id:"payment.instrument_trusted_shipping_address_text"})),a.createElement("div",{className:"form-ccFields"},e&&a.createElement(w,{name:"ccNumber"}),t&&a.createElement(q,{name:"ccCvv"})));var x=n(24750),j=n(40052),k=n(76049);const M=(0,a.memo)((({name:e})=>{const{language:t}=(0,k.Y)(),n=(0,a.useCallback)((0,s.B4)(((e,t)=>n=>{t.setFieldValue(e.name,function(e){const[t="",n=""]=e.split(new RegExp("\\s*/\\s*")),r=t.slice(0,2),a=4===n.length?n.slice(-2):n?n.slice(0,2):t.slice(2);return e.length<2?t:e.length>3&&!a?r:`${r} / ${a}`}(n.target.value))})),[]),r=(0,a.useCallback)((({field:e,form:r})=>a.createElement(y.A,Object.assign({},e,{autoComplete:"cc-exp",id:e.name,onChange:n(e,r),placeholder:t.translate("payment.credit_card_expiration_placeholder_text"),type:"tel"}))),[n,t]),i=(0,a.useMemo)((()=>a.createElement(E.A,{id:"payment.credit_card_expiration_label"})),[]);return a.createElement(b.A,{additionalClassName:"form-field--ccExpiry",input:r,labelContent:i,name:e})})),V=(0,a.memo)((({name:e})=>{const t=(0,a.useCallback)((({field:e})=>a.createElement(y.A,Object.assign({},e,{autoComplete:"cc-name",id:e.name}))),[]),n=(0,a.useMemo)((()=>a.createElement(E.A,{id:"payment.credit_card_name_label"})),[]);return a.createElement(b.A,{additionalClassName:"form-field--ccName",input:t,labelContent:n,name:e})}));var O=n(53783);const T=(0,a.memo)((({shouldShowCardCodeField:e,shouldShowCustomerCodeField:t})=>a.createElement(x.A,{additionalClassName:"creditCardFieldset",legend:a.createElement(j.A,{hidden:!0},a.createElement(E.A,{id:"payment.credit_card_text"}))},a.createElement("div",{className:"form-ccFields"},a.createElement(w,{name:"ccNumber"}),a.createElement(M,{name:"ccExpiry"}),a.createElement(V,{name:"ccName"}),e&&a.createElement(q,{name:"ccCvv"}),t&&a.createElement(O.A,{name:"ccCustomerCode"})))));var U=n(40646),P=n(84186),Y=n(84087);function z(e){if(!e)throw new Error("Missing configuration data");const{inputDateFormat:t}=e;return{currency:(0,P.P5)(e),date:{inputFormat:t},language:(0,Y.A)()}}var D=n(70640),L=n(91182);const B=e=>{const[t,n]=(0,a.useState)({isAddingNewCard:!1}),u=(0,s.B4)(((e=[])=>e.filter(c.a))),g=()=>{const{checkoutState:t,isUsingMultiShipping:n=!1,method:r}=e,{data:{getConfig:a,getCustomer:s,getInstruments:d,isPaymentDataRequired:c},statuses:{isLoadingInstruments:m}}=t,g=a(),p=s();if(!g||!p||!r)throw new Error("Unable to get checkout");const h=u(d(r)),C=(0,i.A)({config:g,customer:p,isUsingMultiShipping:n,paymentMethod:r});return{instruments:h,isCardCodeRequired:r.config.cardCode||null===r.config.cardCode,isCustomerCodeRequired:!!r.config.requireCustomerCode,isInstrumentCardCodeRequired:(0,o.A)(t),isInstrumentCardNumberRequired:(0,l.A)(t),isInstrumentFeatureAvailable:C,isLoadingInstruments:m(),isPaymentDataRequired:c(),shouldShowInstrumentFieldset:C&&h.length>0}},p=()=>{const{isAddingNewCard:e}=t;if(e)return;const{instruments:n}=g(),r=n.find((e=>e.defaultInstrument))||n[0];return r&&r.bigpayToken},h=()=>{const{instruments:e}=g(),{selectedInstrumentId:n=p()}=t;return(0,d.find)(e,{bigpayToken:n})},E=()=>{const{cardValidationSchema:t,language:n,method:r,storedCardValidationSchema:a}=e,{isInstrumentCardCodeRequired:i,isInstrumentCardNumberRequired:s,isInstrumentFeatureAvailable:d,isPaymentDataRequired:c}=g();if(!c)return null;const o=h();return d&&o?a||C({instrumentBrand:o.brand,instrumentLast4:o.last4,isCardCodeRequired:i(o,r),isCardNumberRequired:s(o,r),language:n}):t||f({isCardCodeRequired:!0===r.config.cardCode,language:n})};(0,a.useEffect)((()=>((0,r.__awaiter)(void 0,void 0,void 0,(function*(){const{initializePayment:t,method:n,onUnhandledError:r,paymentForm:{setValidationSchema:a}}=e;a(n,E()),function(){const e=m.creditCardType.getTypeInfo("discover"),t=m.creditCardType.getTypeInfo("visa");m.creditCardType.updateCard("visa",{lengths:[13,...t.lengths||[]]}),m.creditCardType.updateCard("discover",{patterns:[...e.patterns||[],[810,817]]}),m.creditCardType.addCard({niceType:"Mada",type:"mada",patterns:[400861,401757,407197,407395,409201,410685,412565,417633,419593,422817,422818,422819,428331,428671,428672,428673,431361,432328,434107,439954,440533,440647,440795,445564,446393,446404,446672,455036,455708,457865,458456,462220,468540,468541,468542,468543,483010,483011,483012,484783,486094,486095,486096,489317,489318,489319,493428,504300,506968,508160,513213,520058,521076,524130,524514,529415,529741,530060,530906,531095,531196,532013,535825,535989,536023,537767,539931,543085,543357,549760,554180,557606,558848,585265,588845,588846,588847,588848,588849,588850,588851,588982,588983,589005,589206,604906,605141,636120,968201,968202,968203,968204,968205,968206,968207,968208,968209,968210,968211],gaps:[4,8,12],lengths:[16,18,19],code:{name:"CVV",size:3}})}();try{yield t({gatewayId:n.gateway,methodId:n.id},h())}catch(e){e instanceof Error&&r(e)}})),()=>{(0,r.__awaiter)(void 0,void 0,void 0,(function*(){const{deinitializePayment:t,method:n,onUnhandledError:r,paymentForm:{setValidationSchema:a}}=e;a(n,null);try{yield t({gatewayId:n.gateway,methodId:n.id})}catch(e){e instanceof Error&&r(e)}}))})),[]);const y=(0,a.useRef)(!1);(0,a.useEffect)((()=>{if(!y.current)return void(y.current=!0);(0,r.__awaiter)(void 0,void 0,void 0,(function*(){const{deinitializePayment:t,initializePayment:n,method:r,onUnhandledError:a,paymentForm:{setValidationSchema:i}}=e;i(r,E());try{yield t({gatewayId:r.gateway,methodId:r.id}),yield n({gatewayId:r.gateway,methodId:r.id},h())}catch(e){e instanceof Error&&a(e)}}))}),[t.selectedInstrumentId,t.isAddingNewCard]);const{checkoutState:{data:{getConfig:v}},cardFieldset:b,getStoredCardValidationFieldset:I,isInitializing:A,method:w}=e,{instruments:S,isInstrumentCardCodeRequired:N,isInstrumentCardNumberRequired:F,isInstrumentFeatureAvailable:q,isLoadingInstruments:x,shouldShowInstrumentFieldset:j}=g(),{isAddingNewCard:M}=t,V=h(),O=!j||M,P=A||x,Y=!!V&&F(V,w),B=!!V&&N(V,w),$=v(),J=w?`DataCreditCardFieldset ${JSON.stringify(w)}`:"";if(!$)throw Error("Unable to get config or customer");return a.createElement(k.A.Provider,{value:z($)},a.createElement(L.A,{hideContentWhenLoading:!0,isLoading:P},a.createElement("div",{className:"paymentMethod paymentMethod--creditCard","data-test":"credit-cart-payment-method"},j&&a.createElement(_.A,{instruments:S,onDeleteInstrument:r=>{const{paymentForm:{setFieldValue:a}}=e,{instruments:i}=g(),{selectedInstrumentId:s}=t;0===i.length?(n(Object.assign(Object.assign({},t),{isAddingNewCard:!0,selectedInstrumentId:void 0})),a("instrumentId","")):s===r&&(n(Object.assign(Object.assign({},t),{selectedInstrumentId:p()})),a("instrumentId",p()))},onSelectInstrument:e=>{n(Object.assign(Object.assign({},t),{isAddingNewCard:!1,selectedInstrumentId:e}))},onUseNewInstrument:()=>{n(Object.assign(Object.assign({},t),{isAddingNewCard:!0,selectedInstrumentId:void 0}))},selectedInstrumentId:V&&V.bigpayToken,validateInstrument:I?I(V):a.createElement(R,{shouldShowCardCodeField:B,shouldShowNumberField:Y})}),O&&!b&&a.createElement(a.Fragment,null,a.createElement(D.v,{message:J}),a.createElement(T,{shouldShowCardCodeField:w.config.cardCode||null===w.config.cardCode,shouldShowCustomerCodeField:w.config.requireCustomerCode})),O&&b,q&&a.createElement(U.A,{instrumentId:V&&V.bigpayToken,instruments:S}))))},$=e=>{const[t,n]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{(0,r.__awaiter)(void 0,void 0,void 0,(function*(){const{checkoutService:t,checkoutState:r,isUsingMultiShipping:a=!1,method:s}=e,{data:{getConfig:d,getCustomer:c}}=r,o=d(),l=c();if(!o||!l||!s)throw new Error("Unable to get checkout");(0,i.A)({config:o,customer:l,isUsingMultiShipping:a,paymentMethod:s})&&(yield t.loadInstruments()),n(!0)}))}),[]),t?a.createElement(B,Object.assign({},e)):null}},53783:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(70355),a=n(49655),i=n(10156),s=n(30680);const d=(0,r.memo)((({name:e})=>{const t=(0,r.useCallback)((({field:e})=>r.createElement(i.A,Object.assign({},e,{id:e.name}))),[]),n=(0,r.useMemo)((()=>r.createElement(r.Fragment,null,r.createElement(a.A,{id:"payment.credit_card_customer_code_label"})," ",r.createElement("small",{className:"optimizedCheckout-contentSecondary"},r.createElement(a.A,{id:"common.optional_text"})))),[]);return r.createElement(s.A,{input:t,labelContent:n,name:e})}))},70640:(e,t,n)=>{n.d(t,{v:()=>i});var r=n(70355),a=n(39981);const i=({message:e})=>{const{errorLogger:t}=(0,a.Q)();return(0,r.useEffect)((()=>{e&&t&&(t.logMessage?t.logMessage(e):console.log(`checkout-js attempted to log the following message: "${e}", but no Sentry logger is configured.`))}),[e]),null}},94611:(e,t,n)=>{function r({config:e,customer:t,isUsingMultiShipping:n,paymentMethod:r}){return!(!e.checkoutSettings.isCardVaultingEnabled||!r.config.isVaultingEnabled||t.isGuest||n)}n.d(t,{A:()=>r})}}]);
//# sourceMappingURL=7077-e93787bf.js.map