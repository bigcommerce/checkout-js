"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[1659],{12402:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(98610);function i(e){if(e)return e===n.A.PaypalCommerce||e===n.A.PaypalCommerceCreditCards?n.A.PayPalCommerceAcceleratedCheckout:e===n.A.Braintree?n.A.BraintreeAcceleratedCheckout:e}},59713:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(69440);function i(e,t,a){const i=window.getComputedStyle(e,a);return t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:i.getPropertyValue((0,n.kebabCase)(t))})),{})}},63163:(e,t,a)=>{a.d(t,{Ak:()=>n,Ay:()=>u,Mp:()=>i});var n,i,r=a(31635),o=a(3375),s=a.n(o),l=a(70355);function c(e){const{className:t,isFullWidth:a,isLoading:r,size:o,variant:l}=e;return s()("button",t,{"button--primary":l===n.Primary},{"button--tertiary":l===n.Secondary},{"button--action":l===n.Action},{"button--small":o===i.Small},{"button--tiny":o===i.Tiny},{"button--large":o===i.Large},{"button--slab":a},{"optimizedCheckout-buttonPrimary":l===n.Primary||l===n.Action},{"optimizedCheckout-buttonSecondary":l===n.Secondary},{"is-loading":r})}!function(e){e.Primary="primary",e.Secondary="secondary",e.Action="action"}(n||(n={})),function(e){e.Small="small",e.Tiny="tiny",e.Large="large"}(i||(i={}));const u=e=>{var{children:t,className:a,disabled:n,isFullWidth:i,isLoading:o,size:s,testId:u,type:m,variant:d}=e,g=(0,r.__rest)(e,["children","className","disabled","isFullWidth","isLoading","size","testId","type","variant"]);return l.createElement("button",Object.assign({},g,{className:c({className:a,isFullWidth:i,isLoading:o,size:s,variant:d}),"data-test":u,disabled:n||o,type:m||"button"}),t)}},76387:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Oe});var n=a(31635),i=a(7991),r=a(52115),o=a(32018),s=a(6327),l=a(60269),c=a(69440),u=a(70355),m=a(45980),d=a(89792),g=a(98610),E=a(3375),b=a.n(E),h=a(69462),p=a(55150),k=a(72769),C=a(49655),A=a(68512),y=a(41410),f=a(71161),v=a(11889),_=a(46487),S=a(4899),w=a(60833),L=a(44218),P=a(94202),I=a(10685);const F=/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i;function x({language:e}){return(0,P.Ik)({email:(0,P.Yj)().max(256).matches(F,e.translate("customer.email_invalid_error")).required(e.translate("customer.email_required_error"))})}function N(e){return(t,{label:a,min:n,max:i})=>{if(e)return"required"===t?e.translate("customer.required_error",{label:a}):"max"===t&&i?e.translate("customer.max_error",{label:a,max:i}):"min"===t&&n?e.translate("customer.min_error",{label:a,min:n}):"invalid"===t?e.translate("customer.invalid_characters_error",{label:a}):void 0}}const z=(0,L.Bj)((function({formFields:e,language:t,passwordRequirements:{description:a,numeric:n,alpha:i,minLength:r}}){return(0,P.Ik)({firstName:(0,P.Yj)().required(t.translate("address.first_name_required_error")),lastName:(0,P.Yj)().required(t.translate("address.last_name_required_error")),password:(0,P.Yj)().required(t.translate("customer.password_required_error")||a).matches(n,t.translate("customer.password_number_required_error")||a).matches(i,t.translate("customer.password_letter_required_error")||a).min(r,t.translate("customer.password_under_minimum_length_error")||a).max(100,t.translate("customer.password_over_maximum_length_error"))}).concat(x({language:t})).concat((0,I.A)({formFields:e,translate:N(t)}))}));var M=a(23847);function q(e,t){return e?["1"]:t?[]:["0"]}const O=(0,A.A)((0,h.bk)({handleSubmit:(e,{props:{onSubmit:t=c.noop}})=>{t(e)},mapPropsToValues:({defaultShouldSubscribe:e,requiresMarketingConsent:t})=>({firstName:"",lastName:"",email:"",password:"",customFields:{},acceptsMarketingEmails:q(e,t)}),validationSchema:({language:e,formFields:t})=>{var a;const n=null===(a=t.find((({requirements:e})=>e)))||void 0===a?void 0:a.requirements;if(!n)throw new Error("Password requirements missing");return z({language:e,formFields:t,passwordRequirements:(0,M.A)(n)})}})((({formFields:e,createAccountError:t,isCreatingAccount:a,isExecutingPaymentMethodCheckout:n,onCancel:i,isFloatingLabelEnabled:r,defaultShouldSubscribe:o})=>{const{themeV2:s}=(0,p.w)(),l=(0,u.useMemo)((()=>{if(t){if((0,f.A)(t)&&409===t.status){const e=t.message.split(":");return e.length>1?u.createElement(C.A,{data:{email:e[1].trim()},id:"customer.email_in_use_text"}):u.createElement(C.A,{id:"customer.unknown_email_in_use_text"})}return t.message}}),[t]),c=function(e,t){return e.map((e=>{if("acceptsMarketingEmails"===e.name){const{options:a}=e,n=((null==a?void 0:a.items)||[]).map((e=>({value:t?"1":e.value,label:e.label})));return Object.assign(Object.assign({},e),{options:{items:n}})}return e}))}(e,o);return u.createElement(S.A,{className:"checkout-form",id:"checkout-customer-returning",testId:"checkout-customer-returning"},u.createElement(w.A,null,l&&u.createElement(v.A,{type:v.v.Error},l),u.createElement("div",{className:"create-account-form"},c.map((e=>u.createElement(y.A,{autocomplete:e.name,extraClass:`dynamic-form-field--${e.name}`,field:e,isFloatingLabelEnabled:r,key:e.id,parentFieldName:e.custom?"customFields":void 0,themeV2:s}))))),u.createElement("div",{className:"form-actions"},u.createElement(_.Ay,{className:s?"body-bold":"",disabled:a||n,id:"checkout-customer-create",isLoading:a||n,testId:"customer-continue-create",type:"submit",variant:_.Ak.Primary},u.createElement(C.A,{id:"customer.create_account_action"})),u.createElement("a",{className:b()("button optimizedCheckout-buttonSecondary",{"body-bold":s}),"data-test":"customer-cancel-button",href:"#",id:"checkout-customer-cancel",onClick:(0,k.A)(i)},u.createElement(C.A,{id:"common.cancel_action"}))))})));var B=a(31573),j=a(77546),W=a(76049);const T=({data:e,id:t,onClick:a,testId:n})=>{const{language:i}=(0,W.Y)(),r=i.translate(t,e),o=(0,j.A)(r);return o.length?u.createElement(u.Fragment,null,o[0],u.createElement("a",{"data-test":n,href:"#",onClick:(0,k.A)(a)},o[1]),o[2]):u.createElement(u.Fragment,null,r)};var V=a(48447),R=a(85814),G=a(92909),U=a(58330),$=a(54454),Y=a(22375);const D=(0,u.memo)((({onChange:e,isFloatingLabelEnabled:t})=>{const{themeV2:a}=(0,p.w)(),n=(0,u.useCallback)((e=>u.createElement($.A,Object.assign({},e.field,{autoComplete:e.field.name,id:e.field.name,isFloatingLabelEnabled:t,themeV2:a,type:"email"}))),[t]),i=(0,u.useMemo)((()=>u.createElement(C.A,{id:"customer.email_label"})),[]);return u.createElement(Y.A,{input:n,isFloatingLabelEnabled:t,labelContent:i,name:"email",onChange:e,themeV2:a})})),Q=(0,A.A)((0,h.bk)({mapPropsToValues:({email:e=""})=>({email:e}),handleSubmit:(e,{props:{onSendLoginEmail:t=c.noop}})=>{t(e)},validationSchema:({language:e})=>x({language:e})})((0,u.memo)((({email:e,isOpen:t,isSendingEmail:a=!1,emailHasBeenRequested:n,onRequestClose:i=c.noop,sentEmailError:r,sentEmail:o,submitForm:s,isFloatingLabelEnabled:l,values:{email:m}})=>{const d=(0,u.useMemo)((()=>n?r?"common.error_heading":"login_email.sent_header":e?"login_email.header_with_email":"login_email.header"),[n,r,e]),g=(0,u.useMemo)((()=>u.createElement("div",{className:"modal-footer"},u.createElement(_.Ay,{onClick:i},u.createElement(C.A,{id:"common.ok_action"})))),[i]),E=(0,u.useMemo)((()=>r&&429===r.status?g:n&&!r?a?u.createElement(R.A,{isLoading:!0}):o&&"reset_password"===o.sent_email?g:u.createElement("p",null,u.createElement(T,{id:"login_email.resend_link",onClick:s}),u.createElement(T,{id:"login_email.use_password_link",onClick:i})):u.createElement("div",{className:"modal-footer"},u.createElement(_.Ay,{className:"optimizedCheckout-buttonSecondary",onClick:i,type:"button"},u.createElement(C.A,{id:"common.cancel_action"})),u.createElement(_.Ay,{isLoading:a,type:"submit",variant:_.Ak.Primary},u.createElement(C.A,{id:"login_email.send"})))),[r,n,g,s,a,i,o]),b=(0,u.useMemo)((()=>{if(!r)return null;const{status:e}=r;return u.createElement(v.A,{type:v.v.Error},429===e?u.createElement(C.A,{id:"login_email.error_temporary_disabled"}):u.createElement(C.A,{id:404===e?"login_email.error_not_found":"login_email.error_server"}))}),[r]),h=(0,u.useMemo)((()=>{if(r&&429===r.status)return null;if(n&&o&&!r){const{expiry:e,sent_email:t}=o;return u.createElement("p",null,u.createElement(V.A,{data:{minutes:Math.round(e/60)},id:"sign_in"===t?"login_email.sent_text":"customer.reset_password_before_login_error"}))}return n&&!o?u.createElement(D,{isFloatingLabelEnabled:l}):u.createElement(u.Fragment,null,u.createElement("p",null,u.createElement(C.A,{id:"login_email.text"})),u.createElement(D,{isFloatingLabelEnabled:l}))}),[r,n,o,m]);return u.createElement(G.A,{additionalBodyClassName:"modal--withText",additionalModalClassName:"modal--medium",header:u.createElement(U.A,null,u.createElement(C.A,{id:d})),isOpen:t,onRequestClose:i,shouldShowCloseButton:!0},u.createElement(S.A,null,u.createElement(R.A,{isLoading:a&&!e}),b,h,E))}))));var H=a(77050),J=a(28058),K=a(39981),X=a(82922),Z=a(12402),ee=a(57345),te=a(45293),ae=a(79842),ne=a(41968);const ie=(0,u.lazy)((()=>Promise.all([a.e(2570),a.e(1244)]).then(a.bind(a,89512))));const re=(0,u.memo)((0,te.A)((function({checkoutState:e,checkoutService:t}){return{checkoutService:t,checkoutState:e}}))((({checkoutService:e,checkoutState:t,hideText:a=!1,isInitializing:n=!1,methodIds:i=[],checkEmbeddedSupport:r,deinitialize:o,initialize:s,onClick:l=c.noop,onError:m})=>{const{language:d}=(0,W.Y)(),g=(0,ae.U)(i);if(0===g.length)return null;if(r)try{r(g)}catch(e){if(!(e instanceof Error&&m))throw e;return m(e),null}return u.createElement(u.Fragment,null,!n&&!a&&u.createElement("p",null,u.createElement(C.A,{id:"remote.continue_with_text"})),u.createElement("div",{className:"checkoutRemote"},g.map((a=>{const n=(0,ne.A)({id:a});return n?u.createElement(ee.A,{key:a},u.createElement(n,{checkoutService:e,checkoutState:t,containerId:`${a}CheckoutButton`,language:d,methodId:a,onUnhandledError:l,onWalletButtonClick:l})):u.createElement(ee.A,{key:a},u.createElement(ie,{deinitialize:o,initialize:s,isShowingWalletButtonsOnTop:!1,key:a,methodId:a,onClick:l,onError:l}))}))))})));var oe=a(87647);function se(e){return e.hasOwnProperty("paypalFastlane")||e.hasOwnProperty("braintreeFastlane")}const le=()=>{var e,t;const{checkoutState:a}=(0,K.Q)(),{getPaymentMethod:n,getConfig:i}=a.data,r=(null===(e=i())||void 0===e?void 0:e.checkoutSettings.providerWithCustomCheckout)||"",o=!!r&&(0,X.A)(r)&&n(r),s=se(window)&&!!o&&!!(null===(t=o.initializationData)||void 0===t?void 0:t.isFastlanePrivacySettingEnabled);return(0,u.useEffect)((()=>{if(s&&se(window)){((0,oe.A)(r)?window.braintreeFastlane:window.paypalFastlane).FastlaneWatermarkComponent({includeAdditionalInfo:!0}).then((e=>{e.render("#paypalFastlaneWatermark")}))}}),[]),s?u.createElement("div",{className:"paypalFastlaneWatermark-container"},u.createElement("div",{"data-test":"paypalFastlaneWatermark",id:"paypalFastlaneWatermark"})):u.createElement(u.Fragment,null)};var ce=a(37958);const ue=({url:e,themeV2:t})=>u.createElement(ce.A,{labelContent:u.createElement(V.A,{data:{url:e},id:"privacy_policy.label"}),name:"privacyPolicy",testId:"privacy-policy-checkbox",themeV2:t}),me=({url:e,themeV2:t})=>u.createElement(w.A,{additionalClassName:"checkout-privacy-policy"},u.createElement(ue,{themeV2:t,url:e})),de=({url:e,themeV2:t})=>u.createElement("p",{className:t?"body-regular":""},u.createElement(V.A,{data:{url:e},id:"privacy_policy_auto_consent.label"})),ge=(0,u.memo)((({url:e,isExpressPrivacyPolicy:t})=>{const{themeV2:a}=(0,p.w)();return t?u.createElement(de,{themeV2:a,url:e}):u.createElement(me,{themeV2:a,url:e})}));function Ee({isRequired:e,language:t}){const a={};return e&&(a.privacyPolicy=(0,P.zM)().oneOf([!0],t.translate("privacy_policy.required_error"))),(0,P.Ik)(a)}var be=a(43586),he=a(29853),pe=a(34953),ke=a(28407);const Ce=(0,u.memo)((({field:e,requiresMarketingConsent:t})=>{const{themeV2:a}=(0,p.w)();return u.createElement(u.Fragment,null,u.createElement(pe.A,Object.assign({},e,{checked:e.value,className:"form-checkbox",id:e.name,testId:"should-subscribe-checkbox",type:"checkbox",value:String(e.value)})),u.createElement(ke.A,{additionalClassName:a?"body-regular":"",htmlFor:e.name},u.createElement(V.A,{id:t?"customer.guest_marketing_consent":"customer.guest_subscribe_to_newsletter_text"})))}));var Ae=a(43471);function ye(e,t){return!!Ae.y.getSubscribeStatus()||!e&&t}const fe=(0,A.A)((0,h.bk)({mapPropsToValues:({email:e="",defaultShouldSubscribe:t=!1,requiresMarketingConsent:a})=>({email:e,shouldSubscribe:ye(a,t),privacyPolicy:!1}),handleSubmit:(e,{props:{onContinueAsGuest:t}})=>{t(e)},validationSchema:({language:e,privacyPolicyUrl:t,isExpressPrivacyPolicy:a})=>{const n=(0,P.Yj)().email(e.translate("customer.email_invalid_error")).max(256).required(e.translate("customer.email_required_error")),i=(0,P.Ik)({email:n});return t&&!a?i.concat(Ee({isRequired:!!t,language:e})):i}})((0,u.memo)((({canSubscribe:e,checkoutButtons:t,continueAsGuestButtonLabelId:a,defaultShouldSubscribe:n,isLoading:i,onChangeEmail:r,onShowLogin:o,privacyPolicyUrl:s,requiresMarketingConsent:l,isExpressPrivacyPolicy:c,isFloatingLabelEnabled:m,shouldShowEmailWatermark:d,setFieldValue:g})=>{const{checkoutState:{data:{getConfig:E}}}=(0,K.Q)(),{themeV2:h}=(0,p.w)(),k=E(),A=(0,u.useCallback)((e=>u.createElement(Ce,Object.assign({},e,{requiresMarketingConsent:l}))),[l]);if((0,u.useEffect)((()=>{g("shouldSubscribe",ye(l,n))}),[l,n]),!k)return null;const{checkoutSettings:{shouldRedirectToStorefrontForAuth:y},links:{checkoutLink:f,loginLink:v}}=k;return u.createElement(S.A,{className:"checkout-form",id:"checkout-customer-guest",testId:"checkout-customer-guest"},u.createElement(w.A,{legend:u.createElement(be.A,{hidden:!0},u.createElement(C.A,{id:"customer.guest_customer_text"}))},u.createElement("div",{className:"customerEmail-container"},u.createElement("div",{className:"customerEmail-body"},u.createElement(D,{isFloatingLabelEnabled:m,onChange:r}),d&&u.createElement(le,null),(e||l)&&u.createElement(he.A,{name:"shouldSubscribe",render:A})),u.createElement("div",{className:b()("form-actions customerEmail-action",{"customerEmail-floating--enabled":m})},u.createElement(_.Ay,{className:b()("customerEmail-button",{"body-bold":h}),id:"checkout-customer-continue",isLoading:i,testId:"customer-continue-as-guest-button",type:"submit",variant:_.Ak.Primary},u.createElement(C.A,{id:a})))),s&&u.createElement(ge,{isExpressPrivacyPolicy:c,url:s}),!i&&u.createElement("p",{className:b()("customer-login-link",{"body-regular":h})},u.createElement(C.A,{id:"customer.login_text"})," ",u.createElement("a",{"data-test":"customer-continue-button",id:"checkout-customer-login",onClick:()=>{if(!y)return o();window.location.assign(`${v}?redirectTo=${f}`)},role:"button",tabIndex:0},u.createElement(C.A,{id:"customer.login_action"}))),t))}))));var ve=a(59713);const _e=(0,A.A)((0,h.bk)({mapPropsToValues:({email:e="",defaultShouldSubscribe:t=!1,requiresMarketingConsent:a})=>({email:e,shouldSubscribe:!a&&t,privacyPolicy:!1}),handleSubmit:(e,{setStatus:t})=>{t({valSuccess:!0,shouldSubscribe:e.shouldSubscribe})},validationSchema:({language:e,privacyPolicyUrl:t,isExpressPrivacyPolicy:a})=>t&&!a?Ee({isRequired:!!t,language:e}):(0,P.Ik)({})})((0,u.memo)((({continueAsGuestButtonLabelId:e,isLoading:t,initialize:a,isExpressPrivacyPolicy:n,deinitialize:i,onChangeEmail:r,onShowLogin:o,onContinueAsGuest:s,canSubscribe:c,checkoutButtons:m,defaultShouldSubscribe:d,requiresMarketingConsent:g,privacyPolicyUrl:E,step:b,status:h,setFieldValue:p})=>{const[k,A]=(0,u.useState)(!0),[y,f]=(0,u.useState)(""),[v,L]=(0,u.useState)(!1),[P,I]=(0,u.useState)(!0),[F,x]=(0,u.useState)(!1),N=()=>{s({email:y,shouldSubscribe:!!(null==h?void 0:h.shouldSubscribe)})},z=(0,u.useCallback)(((e,t)=>{p("email",t),r(t),f(t),A(!t),L(e),e||x(!0)}),[A,r]);(0,u.useEffect)((()=>{(!b.isComplete||F)&&y&&v&&N()}),[y,v,F]),(0,u.useEffect)((()=>{(null==h?void 0:h.valSuccess)&&N()}),[null==h?void 0:h.valSuccess]);const M=(0,u.useCallback)((e=>{I(e)}),[]);(0,u.useEffect)((()=>(a({methodId:"stripeupe",integrations:[l.Tv],stripeupe:{container:"stripeupeLink",onEmailChange:z,isLoading:M,getStyles:B,gatewayId:"stripeupe",methodId:"card"}}),()=>{i({methodId:"stripeupe"})})),[]),(0,u.useEffect)((()=>{p("shouldSubscribe",!g&&d)}),[g,d]);const q=(e,t)=>{const a=document.getElementById(e);if(a)return(0,ve.A)(a,t)},O="stripe-card-component-field",B=(0,u.useCallback)((()=>{const e=q(`${O}--input`,["color","background-color","border-color","box-shadow"]),t=q(`${O}--label`,["color"]),a=q(`${O}--error`,["color"]);return t&&e&&a?{labelText:t.color,fieldText:e.color,fieldPlaceholderText:e.color,fieldErrorText:a.color,fieldBackground:e["background-color"],fieldInnerShadow:e["box-shadow"],fieldBorder:e["border-color"]}:void 0}),[]),j=(0,u.useCallback)((e=>u.createElement(Ce,Object.assign({},e,{requiresMarketingConsent:g}))),[g]),W=v&&!F?"customer.continue_as_stripe_customer_action":e;return u.createElement(u.Fragment,null,u.createElement(S.A,{className:"checkout-form",id:"checkout-customer-guest",testId:"checkout-customer-guest"},u.createElement("div",{className:"checkout-form",style:{display:P?"none":void 0}},u.createElement(w.A,{legend:!v&&u.createElement(be.A,{hidden:!0},u.createElement(C.A,{id:"customer.guest_customer_text"}))},u.createElement("div",{className:"customerEmail-container"},u.createElement("div",{className:"customerEmail-body"},u.createElement("div",{id:"stripeupeLink"}),u.createElement("br",null),(c||g)&&u.createElement(he.A,{name:"shouldSubscribe",render:j})),u.createElement("div",{className:"form-actions customerEmail-action"},(!v||v&&!F)&&u.createElement(_.Ay,{className:"stripeCustomerEmail-button",disabled:k,id:"stripe-checkout-customer-continue",isLoading:t,testId:"stripe-customer-continue-as-guest-button",type:"submit",variant:_.Ak.Primary},u.createElement(C.A,{id:W})))),E&&u.createElement(ge,{isExpressPrivacyPolicy:n,url:E}),!t&&u.createElement("p",null,u.createElement(C.A,{id:"customer.login_text"})," ",u.createElement("a",{"data-test":"customer-continue-button",id:"checkout-customer-login",onClick:o,role:"button",tabIndex:0},u.createElement(C.A,{id:"customer.login_action"}))),!v&&m)),u.createElement("div",{className:"optimizedCheckout-form-input",id:`${O}--input`},u.createElement("div",{className:"form-field--error"},u.createElement("div",{className:"optimizedCheckout-form-label",id:`${O}--error`})),u.createElement("div",{className:"optimizedCheckout-form-label",id:`${O}--label`}))))}))));const Se=({email:e,isFloatingLabelEnabled:t,isWalletButtonsOnTop:a,isSubscribed:n,step:i,checkEmbeddedSupport:r,handleChangeEmail:o,handleContinueAsGuest:s,handleShowLogin:l,onWalletButtonClick:c,onUnhandledError:m})=>{const{checkoutState:d,checkoutService:g}=(0,K.Q)(),{data:{isPaymentDataRequired:E,getConfig:b,getCart:h},statuses:{isInitializingCustomer:p,isContinuingAsGuest:k,isExecutingPaymentMethodCheckout:C}}=d,{deinitializeCustomer:A,initializeCustomer:y}=g,f=b(),v=h(),_=k()||C();if(!f||!v)return null;const{checkoutSettings:{privacyPolicyUrl:S,requiresMarketingConsent:w,remoteCheckoutProviders:L,providerWithCustomCheckout:P,isExpressPrivacyPolicy:I},shopperConfig:{showNewsletterSignup:F}}=f,x=(0,Z.A)(P),N=a||!E()?null:u.createElement(re,{checkEmbeddedSupport:r,deinitialize:A,initialize:y,isInitializing:p(),methodIds:L,onClick:c,onError:m});return function(e,t){return t===J.A.StripeUPE&&(0,H.A)(e)}(v,x)?u.createElement(_e,{canSubscribe:F,checkoutButtons:N,continueAsGuestButtonLabelId:"customer.continue",defaultShouldSubscribe:n,deinitialize:A,email:e,initialize:y,isExpressPrivacyPolicy:I,isLoading:k()||p()||C(),onChangeEmail:o,onContinueAsGuest:s,onShowLogin:l,privacyPolicyUrl:S,requiresMarketingConsent:w,step:i}):u.createElement(fe,{canSubscribe:F,checkoutButtons:N,continueAsGuestButtonLabelId:"customer.continue",defaultShouldSubscribe:n,email:e,isExpressPrivacyPolicy:I,isFloatingLabelEnabled:t,isLoading:_,onChangeEmail:o,onContinueAsGuest:s,onShowLogin:l,privacyPolicyUrl:S,requiresMarketingConsent:w,shouldShowEmailWatermark:(0,X.A)(x)})};var we=a(45080);const Le=(0,we.A)((()=>u.createElement("svg",{viewBox:"0 0 576 512",xmlns:"http://www.w3.org/2000/svg"},u.createElement("path",{d:"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"})))),Pe=(0,we.A)((()=>u.createElement("svg",{viewBox:"0 0 640 512",xmlns:"http://www.w3.org/2000/svg"},u.createElement("path",{d:"M634 471L36 3.51A16 16 0 0 0 13.51 6l-10 12.49A16 16 0 0 0 6 41l598 467.49a16 16 0 0 0 22.49-2.49l10-12.49A16 16 0 0 0 634 471zM296.79 146.47l134.79 105.38C429.36 191.91 380.48 144 320 144a112.26 112.26 0 0 0-23.21 2.47zm46.42 219.07L208.42 260.16C210.65 320.09 259.53 368 320 368a113 113 0 0 0 23.21-2.46zM320 112c98.65 0 189.09 55 237.93 144a285.53 285.53 0 0 1-44 60.2l37.74 29.5a333.7 333.7 0 0 0 52.9-75.11 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64c-36.7 0-71.71 7-104.63 18.81l46.41 36.29c18.94-4.3 38.34-7.1 58.22-7.1zm0 288c-98.65 0-189.08-55-237.93-144a285.47 285.47 0 0 1 44.05-60.19l-37.74-29.5a333.6 333.6 0 0 0-52.89 75.1 32.35 32.35 0 0 0 0 29.19C89.72 376.41 197.08 448 320 448c36.7 0 71.71-7.05 104.63-18.81l-46.41-36.28C359.28 397.2 339.89 400 320 400z"}))));var Ie=a(45707);const Fe=(0,u.memo)((({isFloatingLabelEnabled:e=!1})=>{const{themeV2:t}=(0,p.w)(),a=(0,u.useCallback)((a=>u.createElement(Ie.A,{openByDefault:!1},(({isOpen:n,toggle:i})=>u.createElement("div",{className:"form-field-password"},u.createElement($.A,Object.assign({},a.field,{additionalClassName:"form-input--withIcon",id:a.field.name,isFloatingLabelEnabled:e,themeV2:t,type:n?"text":"password"})),e&&u.createElement(ke.A,{additionalClassName:t?"floating-form-field-label":"",htmlFor:a.field.name,id:`${a.field.name}-label`,isFloatingLabelEnabled:!0},u.createElement(C.A,{id:"customer.password_label"})),u.createElement("a",{className:"form-toggle-password form-input-icon",href:"#",onClick:i},n?u.createElement(Le,null):u.createElement(Pe,null)))))),[e]),n=(0,u.useMemo)((()=>u.createElement(C.A,{id:"customer.password_label"})),[]);return u.createElement(Y.A,{input:a,isFloatingLabelEnabled:e,labelContent:e?null:n,name:"password"})}));var xe=a(63163);const Ne=({isDisabled:e,isLoading:t})=>{const{themeV2:a}=(0,p.w)(),{checkoutState:{data:{getConfig:n}}}=(0,K.Q)(),i=n();if(!i)return null;const{checkoutLink:r,loginLink:o}=i.links;return u.createElement(xe.Ay,{className:a?"body-bold":"",disabled:e,id:"checkout-customer-continue",isLoading:t,onClick:()=>window.location.assign(`${o}?redirectTo=${r}`),testId:"customer-continue-button",variant:xe.Ak.Primary},u.createElement(C.A,{id:"customer.sign_in_action"}))},ze=(0,A.A)((0,h.bk)({mapPropsToValues:({email:e=""})=>({email:e,password:""}),handleSubmit:(e,{props:{onSignIn:t}})=>{t(e)},validationSchema:({language:e})=>x({language:e}).concat((0,P.Ik)({password:(0,P.Yj)().required(e.translate("customer.password_required_error"))}))})((0,u.memo)((({continueAsGuestButtonLabelId:e,email:t,isEmbedded:a,language:n,signInError:i,onCancel:r=c.noop,onChangeEmail:o,onContinueAsGuest:s,onCreateAccount:l=c.noop,onSendLoginEmail:m=c.noop,isFloatingLabelEnabled:d,viewType:g=B.A.Login})=>{const{themeV2:E}=(0,p.w)(),{checkoutState:h}=(0,K.Q)(),{data:{getCart:A,getConfig:y},statuses:{isExecutingPaymentMethodCheckout:f,isSigningIn:L}}=h,P=A(),I=y();if(!P||!I)throw new Error("cart is not available");const{checkoutSettings:{isAccountCreationEnabled:F,isSignInEmailEnabled:x,guestCheckoutEnabled:N,shouldRedirectToStorefrontForAuth:z},links:{forgotPasswordLink:M}}=I,q="BUY_NOW"===P.source,O=(0,u.useCallback)((()=>t?u.createElement("p",{className:"optimizedCheckout-contentSecondary"},u.createElement(T,{data:{email:t},id:"customer.guest_could_login_change_email",onClick:r,testId:"change-email"})):null),[t,r]);return u.createElement(S.A,{className:"checkout-form",id:"checkout-customer-returning",testId:"checkout-customer-returning"},u.createElement(w.A,{legend:u.createElement(be.A,{hidden:!0},u.createElement(C.A,{id:"customer.returning_customer_text"}))},i&&u.createElement(v.A,{testId:"customer-login-error-message",type:v.v.Error},function(e,t){switch(e.body&&e.body.type){case"throttled_login":return t("customer.sign_in_throttled_error");case"reset_password_before_login":return t("customer.reset_password_before_login_error");case"empty_cart":return t("cart.empty_cart_error_message");default:return t("customer.sign_in_error")}}(i,(e=>n.translate(e)))),g===B.A.SuggestedLogin&&u.createElement(v.A,{type:v.v.Info},u.createElement(V.A,{data:{email:t},id:"customer.guest_could_login"})),g===B.A.CancellableEnforcedLogin&&u.createElement(v.A,{type:v.v.Info},u.createElement(V.A,{data:{email:t},id:"customer.guest_must_login"})),g===B.A.EnforcedLogin&&u.createElement(v.A,{type:v.v.Error},u.createElement(T,{id:"customer.guest_temporary_disabled",onClick:l})),(g===B.A.Login||g===B.A.EnforcedLogin)&&u.createElement(D,{isFloatingLabelEnabled:d,onChange:o}),!z&&u.createElement(Fe,{isFloatingLabelEnabled:d}),u.createElement("p",{className:b()("form-legend-container",{"body-cta":E})},u.createElement("span",null,x&&!a&&!q&&u.createElement(T,{id:"login_email.link",onClick:m,testId:"customer-signin-link"}),!x&&!a&&!z&&u.createElement("a",{"data-test":"forgot-password-link",href:M,rel:"noopener noreferrer",target:"_blank"},u.createElement(C.A,{id:"customer.forgot_password_action"}))),g===B.A.Login&&F&&u.createElement("span",null,u.createElement(T,{id:"customer.create_account_to_continue_text",onClick:l}))),u.createElement("div",{className:"form-actions"},z?u.createElement(Ne,{isDisabled:Boolean(L()||f()),isLoading:Boolean(L()||f())}):u.createElement(_.Ay,{className:E?"body-bold":"",disabled:L()||f(),id:"checkout-customer-continue",isLoading:L()||f(),testId:"customer-continue-button",type:"submit",variant:_.Ak.Primary},u.createElement(C.A,{id:"customer.sign_in_action"})),g===B.A.SuggestedLogin&&u.createElement("a",{className:b()("button optimizedCheckout-buttonSecondary",{"body-bold":E}),"data-test":"customer-guest-continue",href:"#",id:"checkout-guest-continue",onClick:(0,k.A)(s)},u.createElement(C.A,{id:e})),N&&g!==B.A.EnforcedLogin&&g!==B.A.SuggestedLogin&&u.createElement("a",{className:b()("button optimizedCheckout-buttonSecondary",{"body-bold":E}),"data-test":"customer-cancel-button",href:"#",id:"checkout-customer-cancel",onClick:(0,k.A)(r)},u.createElement(C.A,{id:g===B.A.CancellableEnforcedLogin?"login_email.use_another_email":"common.cancel_action"}))),g===B.A.SuggestedLogin&&O()))}))));var Me=a(6663);var qe=a(84559);const Oe=({viewType:e,step:t,isEmbedded:a,isSubscribed:E,isWalletButtonsOnTop:b,onChangeViewType:h=c.noop,onAccountCreated:p=c.noop,onContinueAsGuest:k=c.noop,onContinueAsGuestError:C=c.noop,onReady:A=c.noop,onSubscribeToNewsletter:y,onSignIn:f=c.noop,onSignInError:v=c.noop,onUnhandledError:_=c.noop,onWalletButtonClick:S=c.noop})=>{const[w,L]=(0,u.useState)({isEmailLoginFormOpen:!1,isReady:!1,hasRequestedLoginEmail:!1,draftEmail:void 0}),{analyticsTracker:P}=(0,m.A)(),I=(()=>{const{checkoutState:e,checkoutService:t}=(0,K.Q)(),{data:{getBillingAddress:a,getCustomerAccountFields:n,getCheckout:i,getCustomer:r,getCart:o,getSignInEmail:s,getConfig:l,isPaymentDataRequired:c},errors:{getSignInError:u,getSignInEmailError:m,getCreateCustomerAccountError:d},statuses:{isContinuingAsGuest:E,isExecutingPaymentMethodCheckout:b,isInitializingCustomer:h,isSigningIn:p,isSendingSignInEmail:k,isCreatingCustomerAccount:C}}=e,A=a(),y=i(),f=r(),v=o(),_=s(),S=l();if(!y||!S||!v)return{data:{},actions:{}};const{checkoutSettings:{privacyPolicyUrl:w,requiresMarketingConsent:L,isSignInEmailEnabled:P,isAccountCreationEnabled:I,isExpressPrivacyPolicy:F,shouldRedirectToStorefrontForAuth:x,remoteCheckoutProviders:N,providerWithCustomCheckout:z},shopperConfig:{showNewsletterSignup:M,defaultNewsletterSignup:q},links:{forgotPasswordLink:O}}=S,B=(0,Z.A)(z);return{data:{email:(null==A?void 0:A.email)||(null==f?void 0:f.email),firstName:null==f?void 0:f.firstName,hasBillingId:!!(null==A?void 0:A.id),isBuyNowCart:"BUY_NOW"===v.source,customerAccountFields:n(),canSubscribe:M,defaultShouldSubscribe:q,requiresMarketingConsent:L,isFloatingLabelEnabled:(0,qe.A)(S.checkoutSettings),forgotPasswordUrl:O,privacyPolicyUrl:w,isSignInEmailEnabled:P,isAccountCreationEnabled:I,isGuestEnabled:S.checkoutSettings.guestCheckoutEnabled,isExpressPrivacyPolicy:F,shouldRedirectToStorefrontForAuth:x,isContinuingAsGuest:E(),isExecutingPaymentMethodCheckout:b(),isInitializing:h(),isSigningIn:p(),isSendingSignInEmail:k(),isCreatingAccount:C(),signInError:u(),signInEmailError:m(),createAccountError:d(),signInEmail:_,checkoutButtonIds:N,providerWithCustomCheckout:B,isPaymentDataRequired:c(),shouldRenderStripeForm:B===g.A.StripeUPE&&(0,H.A)(v)},actions:{clearError:t.clearError,createAccount:t.createCustomerAccount,continueAsGuest:t.continueAsGuest,sendLoginEmail:t.sendSignInEmail,deinitializeCustomer:t.deinitializeCustomer,executePaymentMethodCheckout:t.executePaymentMethodCheckout,initializeCustomer:t.initializeCustomer,signIn:t.signInCustomer}}})();(0,u.useEffect)((()=>{L((e=>Object.assign(Object.assign({},e),{draftEmail:I.data.email})))}),[I.data.email]),(0,u.useEffect)((()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{I.data.providerWithCustomCheckout&&I.data.providerWithCustomCheckout!==g.A.StripeUPE&&(yield I.actions.initializeCustomer({methodId:I.data.providerWithCustomCheckout,integrations:[i.Wu,o.ep,s.Qp,r.z2,l.Tv,l.BK]}))}catch(e){_(e)}L((e=>Object.assign(Object.assign({},e),{isReady:!0}))),A()}))}),[]),(0,u.useEffect)((()=>()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield I.actions.deinitializeCustomer({methodId:I.data.providerWithCustomCheckout})}catch(e){_(e)}}))}),[I.actions.deinitializeCustomer,I.data.providerWithCustomCheckout,_]);const F=(0,u.useCallback)((e=>{L((t=>Object.assign(Object.assign({},t),{draftEmail:e}))),P.customerEmailEntry(e)}),[P]),x=(0,u.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield I.actions.signIn(e),f(),L((e=>Object.assign(Object.assign({},e),{draftEmail:void 0})))}catch(e){v(e)}}))),[I.actions.signIn,f,v]),N=(0,u.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const t=e.email.trim(),a=!I.data.hasBillingId&&!I.data.defaultShouldSubscribe&&void 0;try{const{data:n}=yield I.actions.continueAsGuest({email:t,acceptsMarketingNewsletter:!(!I.data.canSubscribe||!e.shouldSubscribe)||a,acceptsAbandonedCartEmails:!!e.shouldSubscribe||a});y(e.shouldSubscribe),Ae.y.setSubscribeStatus(e.shouldSubscribe);const i=n.getCustomer(),r=n.getPaymentProviderCustomer();if(i&&i.shouldEncourageSignIn&&i.isGuest&&!(null==r?void 0:r.stripeLinkAuthenticationState))return h(B.A.SuggestedLogin);yield z(),L((e=>Object.assign(Object.assign({},e),{draftEmail:void 0})))}catch(e){if(!(0,d.A)(e)||"update_subscriptions"!==e.type&&"payment_method_client_invalid"!==e.type||(L((e=>Object.assign(Object.assign({},e),{draftEmail:void 0}))),k()),(0,d.A)(e)&&"empty_cart"===e.type)return C(e);if((0,d.A)(e)&&429===e.status)return h(B.A.EnforcedLogin);if((0,d.A)(e)&&403===e.status)return h(B.A.CancellableEnforcedLogin);C(e)}}))),[I,y,h,k,C]),z=(0,u.useCallback)((()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){I.data.providerWithCustomCheckout&&I.data.providerWithCustomCheckout!==g.A.StripeUPE?yield I.actions.executePaymentMethodCheckout({methodId:I.data.providerWithCustomCheckout,continueWithCheckoutCallback:k,checkoutPaymentMethodExecuted:e=>{P.customerPaymentMethodExecuted(e)}}):k()}))),[I.actions.executePaymentMethodCheckout,I.data.providerWithCustomCheckout,k,P]),M=(0,u.useCallback)((()=>{h(B.A.Login)}),[h]),q=(0,u.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield I.actions.createAccount(function(e){var{acceptsMarketingEmails:t,customFields:a}=e,i=(0,n.__rest)(e,["acceptsMarketingEmails","customFields"]);return Object.assign(Object.assign({},i),{acceptsMarketingEmails:t&&t.length>0,customFields:(0,Me.A)(a)})}(e)),p()}))),[I.actions.createAccount,p]),j=(0,u.useCallback)((()=>{I.data.createAccountError&&I.actions.clearError(I.data.createAccountError),h(B.A.Login)}),[I.actions.clearError,I.data.createAccountError,h]),W=(0,u.useCallback)((()=>{I.data.signInError&&I.actions.clearError(I.data.signInError),h(B.A.Guest)}),[I.actions.clearError,I.data.signInError,h]),T=(0,u.useCallback)((()=>{h(B.A.CreateAccount)}),[h]),V=(0,u.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield I.actions.sendLoginEmail(e)}catch(e){}finally{L((e=>Object.assign(Object.assign({},e),{hasRequestedLoginEmail:!0})))}}))),[I.actions.sendLoginEmail]),R=(0,u.useCallback)((()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{e!==B.A.Login&&w.draftEmail&&(yield V({email:w.draftEmail}))}finally{L((e=>Object.assign(Object.assign({},e),{isEmailLoginFormOpen:!0})))}}))),[e,w.draftEmail,V]),G=(0,u.useCallback)((()=>{L((e=>Object.assign(Object.assign({},e),{isEmailLoginFormOpen:!1,hasRequestedLoginEmail:!1})))}),[]),U=e===B.A.Guest,$=e===B.A.CreateAccount,Y=!U&&!$;return w.isReady?u.createElement(u.Fragment,null,w.isEmailLoginFormOpen&&u.createElement(Q,{email:w.draftEmail,emailHasBeenRequested:w.hasRequestedLoginEmail,isFloatingLabelEnabled:I.data.isFloatingLabelEnabled,isOpen:w.isEmailLoginFormOpen,isSendingEmail:I.data.isSendingSignInEmail,onRequestClose:G,onSendLoginEmail:V,sentEmail:I.data.signInEmail,sentEmailError:I.data.signInEmailError}),Y&&u.createElement(ze,{continueAsGuestButtonLabelId:"customer.continue_as_guest_action",email:w.draftEmail||I.data.email,isEmbedded:a,isFloatingLabelEnabled:I.data.isFloatingLabelEnabled,onCancel:W,onChangeEmail:F,onContinueAsGuest:z,onCreateAccount:T,onSendLoginEmail:R,onSignIn:x,signInError:I.data.signInError,viewType:e}),U&&u.createElement(Se,{email:w.draftEmail||I.data.email,handleChangeEmail:F,handleContinueAsGuest:N,handleShowLogin:M,isFloatingLabelEnabled:I.data.isFloatingLabelEnabled,isSubscribed:E,isWalletButtonsOnTop:b,onUnhandledError:_,onWalletButtonClick:S,step:t}),$&&u.createElement(O,{createAccountError:I.data.createAccountError,defaultShouldSubscribe:I.data.defaultShouldSubscribe,formFields:I.data.customerAccountFields,isCreatingAccount:I.data.isCreatingAccount,isExecutingPaymentMethodCheckout:I.data.isExecutingPaymentMethodCheckout,isFloatingLabelEnabled:I.data.isFloatingLabelEnabled,onCancel:j,onSubmit:q,requiresMarketingConsent:I.data.requiresMarketingConsent})):null}},77546:(e,t,a)=>{function n(e){const t=document.createElement("div");t.innerHTML=e;const a=t.querySelector("a");if(!a)return[];const n=t.innerHTML.split(a.outerHTML);return[n[0],a.text,n[1]]}a.d(t,{A:()=>n})}}]);
//# sourceMappingURL=customer-09c4e6d9.js.map