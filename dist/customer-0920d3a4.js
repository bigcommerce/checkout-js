"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[1659],{12402:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(98610);function i(e){if(e)return e===n.A.PaypalCommerce||e===n.A.PaypalCommerceCreditCards?n.A.PayPalCommerceAcceleratedCheckout:e===n.A.Braintree?n.A.BraintreeAcceleratedCheckout:e}},59713:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(69440);function i(e,t,a){const i=window.getComputedStyle(e,a);return t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:i.getPropertyValue((0,n.kebabCase)(t))})),{})}},63163:(e,t,a)=>{a.d(t,{Ak:()=>n,Ay:()=>u,Mp:()=>i});var n,i,o=a(31635),r=a(3375),l=a.n(r),s=a(70355);function c(e){const{className:t,isFullWidth:a,isLoading:o,size:r,variant:s}=e;return l()("button",t,{"button--primary":s===n.Primary},{"button--tertiary":s===n.Secondary},{"button--action":s===n.Action},{"button--small":r===i.Small},{"button--tiny":r===i.Tiny},{"button--large":r===i.Large},{"button--slab":a},{"optimizedCheckout-buttonPrimary":s===n.Primary||s===n.Action},{"optimizedCheckout-buttonSecondary":s===n.Secondary},{"is-loading":o})}!function(e){e.Primary="primary",e.Secondary="secondary",e.Action="action"}(n||(n={})),function(e){e.Small="small",e.Tiny="tiny",e.Large="large"}(i||(i={}));const u=e=>{var{children:t,className:a,disabled:n,isFullWidth:i,isLoading:r,size:l,testId:u,type:d,variant:m}=e,g=(0,o.__rest)(e,["children","className","disabled","isFullWidth","isLoading","size","testId","type","variant"]);return s.createElement("button",Object.assign({},g,{className:c({className:a,isFullWidth:i,isLoading:r,size:l,variant:m}),"data-test":u,disabled:n||r,type:d||"button"}),t)}},76387:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Oe});var n=a(31635),i=a(7991),o=a(52115),r=a(32018),l=a(6327),s=a(60269),c=a(69440),u=a(70355),d=a(45980),m=a(89792),g=a(98610),E=a(69462),b=a(72769),h=a(49655),p=a(68512),k=a(41410),C=a(71161),A=a(11889),y=a(46487),f=a(4899),v=a(60833),_=a(44218),S=a(94202),L=a(10685);const w=/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i;function I({language:e}){return(0,S.Ik)({email:(0,S.Yj)().max(256).matches(w,e.translate("customer.email_invalid_error")).required(e.translate("customer.email_required_error"))})}function P(e){return(t,{label:a,min:n,max:i})=>{if(e)return"required"===t?e.translate("customer.required_error",{label:a}):"max"===t&&i?e.translate("customer.max_error",{label:a,max:i}):"min"===t&&n?e.translate("customer.min_error",{label:a,min:n}):"invalid"===t?e.translate("customer.invalid_characters_error",{label:a}):void 0}}const F=(0,_.Bj)((function({formFields:e,language:t,passwordRequirements:{description:a,numeric:n,alpha:i,minLength:o}}){return(0,S.Ik)({firstName:(0,S.Yj)().required(t.translate("address.first_name_required_error")),lastName:(0,S.Yj)().required(t.translate("address.last_name_required_error")),password:(0,S.Yj)().required(t.translate("customer.password_required_error")||a).matches(n,t.translate("customer.password_number_required_error")||a).matches(i,t.translate("customer.password_letter_required_error")||a).min(o,t.translate("customer.password_under_minimum_length_error")||a).max(100,t.translate("customer.password_over_maximum_length_error"))}).concat(I({language:t})).concat((0,L.A)({formFields:e,translate:P(t)}))}));var x=a(23847);function N(e,t){return e?["1"]:t?[]:["0"]}const z=(0,p.A)((0,E.bk)({handleSubmit:(e,{props:{onSubmit:t=c.noop}})=>{t(e)},mapPropsToValues:({defaultShouldSubscribe:e,requiresMarketingConsent:t})=>({firstName:"",lastName:"",email:"",password:"",customFields:{},acceptsMarketingEmails:N(e,t)}),validationSchema:({language:e,formFields:t})=>{var a;const n=null===(a=t.find((({requirements:e})=>e)))||void 0===a?void 0:a.requirements;if(!n)throw new Error("Password requirements missing");return F({language:e,formFields:t,passwordRequirements:(0,x.A)(n)})}})((({formFields:e,createAccountError:t,isCreatingAccount:a,isExecutingPaymentMethodCheckout:n,onCancel:i,isFloatingLabelEnabled:o,defaultShouldSubscribe:r})=>{const l=(0,u.useMemo)((()=>{if(t){if((0,C.A)(t)&&409===t.status){const e=t.message.split(":");return e.length>1?u.createElement(h.A,{data:{email:e[1].trim()},id:"customer.email_in_use_text"}):u.createElement(h.A,{id:"customer.unknown_email_in_use_text"})}return t.message}}),[t]),s=function(e,t){return e.map((e=>{if("acceptsMarketingEmails"===e.name){const{options:a}=e,n=((null==a?void 0:a.items)||[]).map((e=>({value:t?"1":e.value,label:e.label})));return Object.assign(Object.assign({},e),{options:{items:n}})}return e}))}(e,r);return u.createElement(f.A,{className:"checkout-form",id:"checkout-customer-returning",testId:"checkout-customer-returning"},u.createElement(v.A,null,l&&u.createElement(A.A,{type:A.v.Error},l),u.createElement("div",{className:"create-account-form"},s.map((e=>u.createElement(k.A,{autocomplete:e.name,extraClass:`dynamic-form-field--${e.name}`,field:e,isFloatingLabelEnabled:o,key:e.id,parentFieldName:e.custom?"customFields":void 0}))))),u.createElement("div",{className:"form-actions"},u.createElement(y.Ay,{className:"body-bold",disabled:a||n,id:"checkout-customer-create",isLoading:a||n,testId:"customer-continue-create",type:"submit",variant:y.Ak.Primary},u.createElement(h.A,{id:"customer.create_account_action"})),u.createElement("a",{className:"button optimizedCheckout-buttonSecondary body-bold","data-test":"customer-cancel-button",href:"#",id:"checkout-customer-cancel",onClick:(0,b.A)(i)},u.createElement(h.A,{id:"common.cancel_action"}))))})));var M=a(31573),q=a(3375),O=a.n(q),B=a(55150),j=a(42596),W=a(77546);const T=({data:e,id:t,onClick:a,testId:n})=>{const{language:i}=(0,j.Y)(),o=i.translate(t,e),r=(0,W.A)(o);return r.length?u.createElement(u.Fragment,null,r[0],u.createElement("a",{"data-test":n,href:"#",onClick:(0,b.A)(a)},r[1]),r[2]):u.createElement(u.Fragment,null,o)};var R=a(48447),G=a(85814),U=a(92909),$=a(58330),V=a(54454),Y=a(22375);const D=(0,u.memo)((({onChange:e,isFloatingLabelEnabled:t})=>{const a=(0,u.useCallback)((e=>u.createElement(V.A,Object.assign({},e.field,{autoComplete:e.field.name,id:e.field.name,isFloatingLabelEnabled:t,type:"email"}))),[t]),n=(0,u.useMemo)((()=>u.createElement(h.A,{id:"customer.email_label"})),[]);return u.createElement(Y.A,{input:a,isFloatingLabelEnabled:t,labelContent:n,name:"email",onChange:e})})),Q=(0,p.A)((0,E.bk)({mapPropsToValues:({email:e=""})=>({email:e}),handleSubmit:(e,{props:{onSendLoginEmail:t=c.noop}})=>{t(e)},validationSchema:({language:e})=>I({language:e})})((0,u.memo)((({email:e,isOpen:t,isSendingEmail:a=!1,emailHasBeenRequested:n,onRequestClose:i=c.noop,sentEmailError:o,sentEmail:r,submitForm:l,isFloatingLabelEnabled:s,values:{email:d}})=>{const{themeV2:m}=(0,B.w)(),g=(0,u.useMemo)((()=>n?o?"common.error_heading":"login_email.sent_header":e?"login_email.header_with_email":"login_email.header"),[n,o,e]),E=(0,u.useMemo)((()=>u.createElement("div",{className:"modal-footer"},u.createElement(y.Ay,{onClick:i},u.createElement(h.A,{id:"common.ok_action"})))),[i]),b=(0,u.useMemo)((()=>o&&429===o.status?E:n&&!o?a?u.createElement(G.A,{isLoading:!0}):r&&"reset_password"===r.sent_email?E:u.createElement("p",null,u.createElement(T,{id:"login_email.resend_link",onClick:l}),u.createElement(T,{id:"login_email.use_password_link",onClick:i})):u.createElement("div",{className:"modal-footer"},u.createElement(y.Ay,{className:"optimizedCheckout-buttonSecondary",onClick:i,type:"button"},u.createElement(h.A,{id:"common.cancel_action"})),u.createElement(y.Ay,{isLoading:a,type:"submit",variant:y.Ak.Primary},u.createElement(h.A,{id:"login_email.send"})))),[o,n,E,l,a,i,r]),p=(0,u.useMemo)((()=>{if(!o)return null;const{status:e}=o;return u.createElement(A.A,{type:A.v.Error},429===e?u.createElement(h.A,{id:"login_email.error_temporary_disabled"}):u.createElement(h.A,{id:404===e?"login_email.error_not_found":"login_email.error_server"}))}),[o]),k=(0,u.useMemo)((()=>{if(o&&429===o.status)return null;if(n&&r&&!o){const{expiry:e,sent_email:t}=r;return u.createElement("p",null,u.createElement(R.A,{data:{minutes:Math.round(e/60)},id:"sign_in"===t?"login_email.sent_text":"customer.reset_password_before_login_error"}))}return n&&!r?u.createElement(D,{isFloatingLabelEnabled:s}):u.createElement(u.Fragment,null,u.createElement("p",null,u.createElement(h.A,{id:"login_email.text"})),u.createElement(D,{isFloatingLabelEnabled:s}))}),[o,n,r,d]);return u.createElement(U.A,{additionalBodyClassName:"modal--withText",additionalModalClassName:O()("modal--medium",{themeV2:m}),header:u.createElement($.A,null,u.createElement(h.A,{id:g})),isOpen:t,onRequestClose:i,shouldShowCloseButton:!0},u.createElement(f.A,null,u.createElement(G.A,{isLoading:a&&!e}),p,k,b))}))));var H=a(59456),J=a(77050),K=a(28058),X=a(86212),Z=a(12402),ee=a(57345),te=a(45293),ae=a(79842),ne=a(41968);const ie=(0,u.lazy)((()=>Promise.all([a.e(2570),a.e(1244)]).then(a.bind(a,89512))));const oe=(0,u.memo)((0,te.A)((function({checkoutState:e,checkoutService:t}){return{checkoutService:t,checkoutState:e}}))((({checkoutService:e,checkoutState:t,hideText:a=!1,isInitializing:n=!1,methodIds:i=[],checkEmbeddedSupport:o,deinitialize:r,initialize:l,onClick:s=c.noop,onError:d})=>{const{language:m}=(0,j.Y)(),g=(0,ae.U)(i);if(0===g.length)return null;if(o)try{o(g)}catch(e){if(!(e instanceof Error&&d))throw e;return d(e),null}return u.createElement(u.Fragment,null,!n&&!a&&u.createElement("p",null,u.createElement(h.A,{id:"remote.continue_with_text"})),u.createElement("div",{className:"checkoutRemote"},g.map((a=>{const n=(0,ne.A)({id:a});return n?u.createElement(ee.A,{key:a},u.createElement(n,{checkoutService:e,checkoutState:t,containerId:`${a}CheckoutButton`,language:m,methodId:a,onUnhandledError:s,onWalletButtonClick:s})):u.createElement(ee.A,{key:a},u.createElement(ie,{deinitialize:r,initialize:l,isShowingWalletButtonsOnTop:!1,key:a,methodId:a,onClick:s,onError:s}))}))))})));var re=a(87647);function le(e){return e.hasOwnProperty("paypalFastlane")||e.hasOwnProperty("braintreeFastlane")}const se=()=>{var e,t;const{checkoutState:a}=(0,H.Q)(),{getPaymentMethod:n,getConfig:i}=a.data,o=(null===(e=i())||void 0===e?void 0:e.checkoutSettings.providerWithCustomCheckout)||"",r=!!o&&(0,X.A)(o)&&n(o),l=le(window)&&!!r&&!!(null===(t=r.initializationData)||void 0===t?void 0:t.isFastlanePrivacySettingEnabled);return(0,u.useEffect)((()=>{if(l&&le(window)){((0,re.A)(o)?window.braintreeFastlane:window.paypalFastlane).FastlaneWatermarkComponent({includeAdditionalInfo:!0}).then((e=>{e.render("#paypalFastlaneWatermark")}))}}),[]),l?u.createElement("div",{className:"paypalFastlaneWatermark-container"},u.createElement("div",{"data-test":"paypalFastlaneWatermark",id:"paypalFastlaneWatermark"})):u.createElement(u.Fragment,null)};var ce=a(37958);const ue=({url:e})=>u.createElement(ce.A,{labelContent:u.createElement(R.A,{data:{url:e},id:"privacy_policy.label"}),name:"privacyPolicy",testId:"privacy-policy-checkbox"}),de=({url:e})=>u.createElement(v.A,{additionalClassName:"checkout-privacy-policy"},u.createElement(ue,{url:e})),me=({url:e})=>u.createElement("p",{className:"body-regular"},u.createElement(R.A,{data:{url:e},id:"privacy_policy_auto_consent.label"})),ge=(0,u.memo)((({url:e,isExpressPrivacyPolicy:t})=>t?u.createElement(me,{url:e}):u.createElement(de,{url:e})));function Ee({isRequired:e,language:t}){const a={};return e&&(a.privacyPolicy=(0,S.zM)().oneOf([!0],t.translate("privacy_policy.required_error"))),(0,S.Ik)(a)}var be=a(43586),he=a(29853),pe=a(34953),ke=a(28407);const Ce=(0,u.memo)((({field:e,requiresMarketingConsent:t})=>u.createElement(u.Fragment,null,u.createElement(pe.A,Object.assign({},e,{checked:e.value,className:"form-checkbox",id:e.name,testId:"should-subscribe-checkbox",type:"checkbox",value:String(e.value)})),u.createElement(ke.A,{additionalClassName:"body-regular",htmlFor:e.name},u.createElement(R.A,{id:t?"customer.guest_marketing_consent":"customer.guest_subscribe_to_newsletter_text"})))));var Ae=a(43471);function ye(e,t){return!!Ae.y.getSubscribeStatus()||!e&&t}const fe=(0,p.A)((0,E.bk)({mapPropsToValues:({email:e="",defaultShouldSubscribe:t=!1,requiresMarketingConsent:a})=>({email:e,shouldSubscribe:ye(a,t),privacyPolicy:!1}),handleSubmit:(e,{props:{onContinueAsGuest:t}})=>{t(e)},validationSchema:({language:e,privacyPolicyUrl:t,isExpressPrivacyPolicy:a})=>{const n=(0,S.Yj)().email(e.translate("customer.email_invalid_error")).max(256).required(e.translate("customer.email_required_error")),i=(0,S.Ik)({email:n});return t&&!a?i.concat(Ee({isRequired:!!t,language:e})):i}})((0,u.memo)((({canSubscribe:e,checkoutButtons:t,continueAsGuestButtonLabelId:a,defaultShouldSubscribe:n,isLoading:i,onChangeEmail:o,onShowLogin:r,privacyPolicyUrl:l,requiresMarketingConsent:s,isExpressPrivacyPolicy:c,isFloatingLabelEnabled:d,shouldShowEmailWatermark:m,setFieldValue:g})=>{const{checkoutState:{data:{getConfig:E}}}=(0,H.Q)(),{themeV2:b}=(0,B.w)(),p=E(),k=(0,u.useCallback)((e=>u.createElement(Ce,Object.assign({},e,{requiresMarketingConsent:s}))),[s]);if((0,u.useEffect)((()=>{g("shouldSubscribe",ye(s,n))}),[s,n]),!p)return null;const{checkoutSettings:{shouldRedirectToStorefrontForAuth:C},links:{checkoutLink:A,loginLink:_}}=p,S=()=>{if(!C)return r();window.location.assign(`${_}?redirectTo=${A}`)};return u.createElement(f.A,{className:"checkout-form",id:"checkout-customer-guest",testId:"checkout-customer-guest"},u.createElement(v.A,{legend:u.createElement(be.A,{hidden:!0},u.createElement(h.A,{id:"customer.guest_customer_text"}))},b&&!i&&u.createElement("p",{className:"customer-login-link body-regular"},u.createElement(h.A,{id:"customer.login_text"})," ",u.createElement("a",{"data-test":"customer-continue-button",id:"checkout-customer-login",onClick:S,role:"button",tabIndex:0},u.createElement(h.A,{id:"customer.login_action"}))),u.createElement("div",{className:"customerEmail-container"},u.createElement("div",{className:"customerEmail-body"},u.createElement(D,{isFloatingLabelEnabled:d,onChange:o}),m&&u.createElement(se,null),(e||s)&&u.createElement(he.A,{name:"shouldSubscribe",render:k})),u.createElement("div",{className:O()("form-actions customerEmail-action",{"customerEmail-floating--enabled":d})},u.createElement(y.Ay,{className:"customerEmail-button body-bold",id:"checkout-customer-continue",isLoading:i,testId:"customer-continue-as-guest-button",type:"submit",variant:y.Ak.Primary},u.createElement(h.A,{id:a})))),l&&u.createElement(ge,{isExpressPrivacyPolicy:c,url:l}),!b&&!i&&u.createElement("p",{className:"customer-login-link"},u.createElement(h.A,{id:"customer.login_text"})," ",u.createElement("a",{"data-test":"customer-continue-button",id:"checkout-customer-login",onClick:S,role:"button",tabIndex:0},u.createElement(h.A,{id:"customer.login_action"}))),t))}))));var ve=a(59713);const _e=(0,p.A)((0,E.bk)({mapPropsToValues:({email:e="",defaultShouldSubscribe:t=!1,requiresMarketingConsent:a})=>({email:e,shouldSubscribe:!a&&t,privacyPolicy:!1}),handleSubmit:(e,{setStatus:t})=>{t({valSuccess:!0,shouldSubscribe:e.shouldSubscribe})},validationSchema:({language:e,privacyPolicyUrl:t,isExpressPrivacyPolicy:a})=>t&&!a?Ee({isRequired:!!t,language:e}):(0,S.Ik)({})})((0,u.memo)((({continueAsGuestButtonLabelId:e,isLoading:t,initialize:a,isExpressPrivacyPolicy:n,deinitialize:i,onChangeEmail:o,onShowLogin:r,onContinueAsGuest:l,canSubscribe:c,checkoutButtons:d,defaultShouldSubscribe:m,requiresMarketingConsent:g,privacyPolicyUrl:E,step:b,status:p,setFieldValue:k})=>{const[C,A]=(0,u.useState)(!0),[_,S]=(0,u.useState)(""),[L,w]=(0,u.useState)(!1),[I,P]=(0,u.useState)(!0),[F,x]=(0,u.useState)(!1),N=()=>{l({email:_,shouldSubscribe:!!(null==p?void 0:p.shouldSubscribe)})},z=(0,u.useCallback)(((e,t)=>{k("email",t),o(t),S(t),A(!t),w(e),e||x(!0)}),[A,o]);(0,u.useEffect)((()=>{(!b.isComplete||F)&&_&&L&&N()}),[_,L,F]),(0,u.useEffect)((()=>{(null==p?void 0:p.valSuccess)&&N()}),[null==p?void 0:p.valSuccess]);const M=(0,u.useCallback)((e=>{P(e)}),[]);(0,u.useEffect)((()=>(a({methodId:"stripeupe",integrations:[s.Tv],stripeupe:{container:"stripeupeLink",onEmailChange:z,isLoading:M,getStyles:B,gatewayId:"stripeupe",methodId:"card"}}),()=>{i({methodId:"stripeupe"})})),[]),(0,u.useEffect)((()=>{k("shouldSubscribe",!g&&m)}),[g,m]);const q=(e,t)=>{const a=document.getElementById(e);if(a)return(0,ve.A)(a,t)},O="stripe-card-component-field",B=(0,u.useCallback)((()=>{const e=q(`${O}--input`,["color","background-color","border-color","box-shadow"]),t=q(`${O}--label`,["color"]),a=q(`${O}--error`,["color"]);return t&&e&&a?{labelText:t.color,fieldText:e.color,fieldPlaceholderText:e.color,fieldErrorText:a.color,fieldBackground:e["background-color"],fieldInnerShadow:e["box-shadow"],fieldBorder:e["border-color"]}:void 0}),[]),j=(0,u.useCallback)((e=>u.createElement(Ce,Object.assign({},e,{requiresMarketingConsent:g}))),[g]),W=L&&!F?"customer.continue_as_stripe_customer_action":e;return u.createElement(u.Fragment,null,u.createElement(f.A,{className:"checkout-form",id:"checkout-customer-guest",testId:"checkout-customer-guest"},u.createElement("div",{className:"checkout-form",style:{display:I?"none":void 0}},u.createElement(v.A,{legend:!L&&u.createElement(be.A,{hidden:!0},u.createElement(h.A,{id:"customer.guest_customer_text"}))},u.createElement("div",{className:"customerEmail-container"},u.createElement("div",{className:"customerEmail-body"},u.createElement("div",{id:"stripeupeLink"}),u.createElement("br",null),(c||g)&&u.createElement(he.A,{name:"shouldSubscribe",render:j})),u.createElement("div",{className:"form-actions customerEmail-action"},(!L||L&&!F)&&u.createElement(y.Ay,{className:"stripeCustomerEmail-button",disabled:C,id:"stripe-checkout-customer-continue",isLoading:t,testId:"stripe-customer-continue-as-guest-button",type:"submit",variant:y.Ak.Primary},u.createElement(h.A,{id:W})))),E&&u.createElement(ge,{isExpressPrivacyPolicy:n,url:E}),!t&&u.createElement("p",null,u.createElement(h.A,{id:"customer.login_text"})," ",u.createElement("a",{"data-test":"customer-continue-button",id:"checkout-customer-login",onClick:r,role:"button",tabIndex:0},u.createElement(h.A,{id:"customer.login_action"}))),!L&&d)),u.createElement("div",{className:"optimizedCheckout-form-input",id:`${O}--input`},u.createElement("div",{className:"form-field--error"},u.createElement("div",{className:"optimizedCheckout-form-label",id:`${O}--error`})),u.createElement("div",{className:"optimizedCheckout-form-label",id:`${O}--label`}))))}))));const Se=({email:e,isFloatingLabelEnabled:t,isWalletButtonsOnTop:a,isSubscribed:n,step:i,checkEmbeddedSupport:o,handleChangeEmail:r,handleContinueAsGuest:l,handleShowLogin:s,onWalletButtonClick:c,onUnhandledError:d})=>{const{checkoutState:m,checkoutService:g}=(0,H.Q)(),{data:{isPaymentDataRequired:E,getConfig:b,getCart:h},statuses:{isInitializingCustomer:p,isContinuingAsGuest:k,isExecutingPaymentMethodCheckout:C}}=m,{deinitializeCustomer:A,initializeCustomer:y}=g,f=b(),v=h(),_=k()||C();if(!f||!v)return null;const{checkoutSettings:{privacyPolicyUrl:S,requiresMarketingConsent:L,remoteCheckoutProviders:w,providerWithCustomCheckout:I,isExpressPrivacyPolicy:P},shopperConfig:{showNewsletterSignup:F}}=f,x=(0,Z.A)(I),N=a||!E()?null:u.createElement(oe,{checkEmbeddedSupport:o,deinitialize:A,initialize:y,isInitializing:p(),methodIds:w,onClick:c,onError:d});return function(e,t){return t===K.A.StripeUPE&&(0,J.A)(e)}(v,x)?u.createElement(_e,{canSubscribe:F,checkoutButtons:N,continueAsGuestButtonLabelId:"customer.continue",defaultShouldSubscribe:n,deinitialize:A,email:e,initialize:y,isExpressPrivacyPolicy:P,isLoading:k()||p()||C(),onChangeEmail:r,onContinueAsGuest:l,onShowLogin:s,privacyPolicyUrl:S,requiresMarketingConsent:L,step:i}):u.createElement(fe,{canSubscribe:F,checkoutButtons:N,continueAsGuestButtonLabelId:"customer.continue",defaultShouldSubscribe:n,email:e,isExpressPrivacyPolicy:P,isFloatingLabelEnabled:t,isLoading:_,onChangeEmail:r,onContinueAsGuest:l,onShowLogin:s,privacyPolicyUrl:S,requiresMarketingConsent:L,shouldShowEmailWatermark:(0,X.A)(x)})};var Le=a(45080);const we=(0,Le.A)((()=>u.createElement("svg",{viewBox:"0 0 576 512",xmlns:"http://www.w3.org/2000/svg"},u.createElement("path",{d:"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"})))),Ie=(0,Le.A)((()=>u.createElement("svg",{viewBox:"0 0 640 512",xmlns:"http://www.w3.org/2000/svg"},u.createElement("path",{d:"M634 471L36 3.51A16 16 0 0 0 13.51 6l-10 12.49A16 16 0 0 0 6 41l598 467.49a16 16 0 0 0 22.49-2.49l10-12.49A16 16 0 0 0 634 471zM296.79 146.47l134.79 105.38C429.36 191.91 380.48 144 320 144a112.26 112.26 0 0 0-23.21 2.47zm46.42 219.07L208.42 260.16C210.65 320.09 259.53 368 320 368a113 113 0 0 0 23.21-2.46zM320 112c98.65 0 189.09 55 237.93 144a285.53 285.53 0 0 1-44 60.2l37.74 29.5a333.7 333.7 0 0 0 52.9-75.11 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64c-36.7 0-71.71 7-104.63 18.81l46.41 36.29c18.94-4.3 38.34-7.1 58.22-7.1zm0 288c-98.65 0-189.08-55-237.93-144a285.47 285.47 0 0 1 44.05-60.19l-37.74-29.5a333.6 333.6 0 0 0-52.89 75.1 32.35 32.35 0 0 0 0 29.19C89.72 376.41 197.08 448 320 448c36.7 0 71.71-7.05 104.63-18.81l-46.41-36.28C359.28 397.2 339.89 400 320 400z"}))));var Pe=a(45707);const Fe=(0,u.memo)((({isFloatingLabelEnabled:e=!1})=>{const t=(0,u.useCallback)((t=>u.createElement(Pe.A,{openByDefault:!1},(({isOpen:a,toggle:n})=>u.createElement("div",{className:"form-field-password"},u.createElement(V.A,Object.assign({},t.field,{additionalClassName:"form-input--withIcon",id:t.field.name,isFloatingLabelEnabled:e,type:a?"text":"password"})),e&&u.createElement(ke.A,{additionalClassName:"floating-form-field-label",htmlFor:t.field.name,id:`${t.field.name}-label`,isFloatingLabelEnabled:!0},u.createElement(h.A,{id:"customer.password_label"})),u.createElement("a",{className:"form-toggle-password form-input-icon",href:"#",onClick:n},a?u.createElement(we,null):u.createElement(Ie,null)))))),[e]),a=(0,u.useMemo)((()=>u.createElement(h.A,{id:"customer.password_label"})),[]);return u.createElement(Y.A,{input:t,isFloatingLabelEnabled:e,labelContent:e?null:a,name:"password"})}));var xe=a(63163);const Ne=({isDisabled:e,isLoading:t})=>{const{checkoutState:{data:{getConfig:a}}}=(0,H.Q)(),n=a();if(!n)return null;const{checkoutLink:i,loginLink:o}=n.links;return u.createElement(xe.Ay,{className:"body-bold",disabled:e,id:"checkout-customer-continue",isLoading:t,onClick:()=>window.location.assign(`${o}?redirectTo=${i}`),testId:"customer-continue-button",variant:xe.Ak.Primary},u.createElement(h.A,{id:"customer.sign_in_action"}))},ze=(0,p.A)((0,E.bk)({mapPropsToValues:({email:e=""})=>({email:e,password:""}),handleSubmit:(e,{props:{onSignIn:t}})=>{t(e)},validationSchema:({language:e})=>I({language:e}).concat((0,S.Ik)({password:(0,S.Yj)().required(e.translate("customer.password_required_error"))}))})((0,u.memo)((({continueAsGuestButtonLabelId:e,email:t,isEmbedded:a,language:n,signInError:i,onCancel:o=c.noop,onChangeEmail:r,onContinueAsGuest:l,onCreateAccount:s=c.noop,onSendLoginEmail:d=c.noop,isFloatingLabelEnabled:m,viewType:g=M.A.Login})=>{const{checkoutState:E}=(0,H.Q)(),{data:{getCart:p,getConfig:k},statuses:{isExecutingPaymentMethodCheckout:C,isSigningIn:_}}=E,S=p(),L=k();if(!S||!L)throw new Error("cart is not available");const{checkoutSettings:{isAccountCreationEnabled:w,isSignInEmailEnabled:I,guestCheckoutEnabled:P,shouldRedirectToStorefrontForAuth:F},links:{forgotPasswordLink:x}}=L,N="BUY_NOW"===S.source,z=(0,u.useCallback)((()=>t?u.createElement("p",{className:"optimizedCheckout-contentSecondary"},u.createElement(T,{data:{email:t},id:"customer.guest_could_login_change_email",onClick:o,testId:"change-email"})):null),[t,o]);return u.createElement(f.A,{className:"checkout-form",id:"checkout-customer-returning",testId:"checkout-customer-returning"},u.createElement(v.A,{legend:u.createElement(be.A,{hidden:!0},u.createElement(h.A,{id:"customer.returning_customer_text"}))},i&&u.createElement(A.A,{testId:"customer-login-error-message",type:A.v.Error},function(e,t){switch(e.body&&e.body.type){case"throttled_login":return t("customer.sign_in_throttled_error");case"reset_password_before_login":return t("customer.reset_password_before_login_error");case"empty_cart":return t("cart.empty_cart_error_message");default:return t("customer.sign_in_error")}}(i,(e=>n.translate(e)))),g===M.A.SuggestedLogin&&u.createElement(A.A,{type:A.v.Info},u.createElement(R.A,{data:{email:t},id:"customer.guest_could_login"})),g===M.A.CancellableEnforcedLogin&&u.createElement(A.A,{type:A.v.Info},u.createElement(R.A,{data:{email:t},id:"customer.guest_must_login"})),g===M.A.EnforcedLogin&&u.createElement(A.A,{type:A.v.Error},u.createElement(T,{id:"customer.guest_temporary_disabled",onClick:s})),(g===M.A.Login||g===M.A.EnforcedLogin)&&u.createElement(D,{isFloatingLabelEnabled:m,onChange:r}),!F&&u.createElement(Fe,{isFloatingLabelEnabled:m}),u.createElement("p",{className:"form-legend-container body-cta"},u.createElement("span",null,I&&!a&&!N&&u.createElement(T,{id:"login_email.link",onClick:d,testId:"customer-signin-link"}),!I&&!a&&!F&&u.createElement("a",{"data-test":"forgot-password-link",href:x,rel:"noopener noreferrer",target:"_blank"},u.createElement(h.A,{id:"customer.forgot_password_action"}))),g===M.A.Login&&w&&u.createElement("span",null,u.createElement(T,{id:"customer.create_account_to_continue_text",onClick:s}))),u.createElement("div",{className:"form-actions"},F?u.createElement(Ne,{isDisabled:Boolean(_()||C()),isLoading:Boolean(_()||C())}):u.createElement(y.Ay,{className:"body-bold",disabled:_()||C(),id:"checkout-customer-continue",isLoading:_()||C(),testId:"customer-continue-button",type:"submit",variant:y.Ak.Primary},u.createElement(h.A,{id:"customer.sign_in_action"})),g===M.A.SuggestedLogin&&u.createElement("a",{className:"button optimizedCheckout-buttonSecondary body-bold","data-test":"customer-guest-continue",href:"#",id:"checkout-guest-continue",onClick:(0,b.A)(l)},u.createElement(h.A,{id:e})),P&&g!==M.A.EnforcedLogin&&g!==M.A.SuggestedLogin&&u.createElement("a",{className:"button optimizedCheckout-buttonSecondary body-bold","data-test":"customer-cancel-button",href:"#",id:"checkout-customer-cancel",onClick:(0,b.A)(o)},u.createElement(h.A,{id:g===M.A.CancellableEnforcedLogin?"login_email.use_another_email":"common.cancel_action"}))),g===M.A.SuggestedLogin&&z()))}))));var Me=a(6663);var qe=a(84559);const Oe=({viewType:e,step:t,isEmbedded:a,isSubscribed:E,isWalletButtonsOnTop:b,onChangeViewType:h=c.noop,onAccountCreated:p=c.noop,onContinueAsGuest:k=c.noop,onContinueAsGuestError:C=c.noop,onReady:A=c.noop,onSubscribeToNewsletter:y,onSignIn:f=c.noop,onSignInError:v=c.noop,onUnhandledError:_=c.noop,onWalletButtonClick:S=c.noop})=>{const[L,w]=(0,u.useState)({isEmailLoginFormOpen:!1,isReady:!1,hasRequestedLoginEmail:!1,draftEmail:void 0}),{analyticsTracker:I}=(0,d.A)(),P=(()=>{const{checkoutState:e,checkoutService:t}=(0,H.Q)(),{data:{getBillingAddress:a,getCustomerAccountFields:n,getCheckout:i,getCustomer:o,getCart:r,getSignInEmail:l,getConfig:s,isPaymentDataRequired:c},errors:{getSignInError:u,getSignInEmailError:d,getCreateCustomerAccountError:m},statuses:{isContinuingAsGuest:E,isExecutingPaymentMethodCheckout:b,isInitializingCustomer:h,isSigningIn:p,isSendingSignInEmail:k,isCreatingCustomerAccount:C}}=e,A=a(),y=i(),f=o(),v=r(),_=l(),S=s();if(!y||!S||!v)return{data:{},actions:{}};const{checkoutSettings:{privacyPolicyUrl:L,requiresMarketingConsent:w,isSignInEmailEnabled:I,isAccountCreationEnabled:P,isExpressPrivacyPolicy:F,shouldRedirectToStorefrontForAuth:x,remoteCheckoutProviders:N,providerWithCustomCheckout:z},shopperConfig:{showNewsletterSignup:M,defaultNewsletterSignup:q},links:{forgotPasswordLink:O}}=S,B=(0,Z.A)(z);return{data:{email:(null==A?void 0:A.email)||(null==f?void 0:f.email),firstName:null==f?void 0:f.firstName,hasBillingId:!!(null==A?void 0:A.id),isBuyNowCart:"BUY_NOW"===v.source,customerAccountFields:n(),canSubscribe:M,defaultShouldSubscribe:q,requiresMarketingConsent:w,isFloatingLabelEnabled:(0,qe.A)(S.checkoutSettings),forgotPasswordUrl:O,privacyPolicyUrl:L,isSignInEmailEnabled:I,isAccountCreationEnabled:P,isGuestEnabled:S.checkoutSettings.guestCheckoutEnabled,isExpressPrivacyPolicy:F,shouldRedirectToStorefrontForAuth:x,isContinuingAsGuest:E(),isExecutingPaymentMethodCheckout:b(),isInitializing:h(),isSigningIn:p(),isSendingSignInEmail:k(),isCreatingAccount:C(),signInError:u(),signInEmailError:d(),createAccountError:m(),signInEmail:_,checkoutButtonIds:N,providerWithCustomCheckout:B,isPaymentDataRequired:c(),shouldRenderStripeForm:B===g.A.StripeUPE&&(0,J.A)(v)},actions:{clearError:t.clearError,createAccount:t.createCustomerAccount,continueAsGuest:t.continueAsGuest,sendLoginEmail:t.sendSignInEmail,deinitializeCustomer:t.deinitializeCustomer,executePaymentMethodCheckout:t.executePaymentMethodCheckout,initializeCustomer:t.initializeCustomer,signIn:t.signInCustomer}}})();(0,u.useEffect)((()=>{w((e=>Object.assign(Object.assign({},e),{draftEmail:P.data.email})))}),[P.data.email]),(0,u.useEffect)((()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{P.data.providerWithCustomCheckout&&P.data.providerWithCustomCheckout!==g.A.StripeUPE&&(yield P.actions.initializeCustomer({methodId:P.data.providerWithCustomCheckout,integrations:[i.Wu,r.ep,l.Qp,o.z2,s.Tv,s.BK]}))}catch(e){_(e)}w((e=>Object.assign(Object.assign({},e),{isReady:!0}))),A()}))}),[]),(0,u.useEffect)((()=>()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield P.actions.deinitializeCustomer({methodId:P.data.providerWithCustomCheckout})}catch(e){_(e)}}))}),[P.actions.deinitializeCustomer,P.data.providerWithCustomCheckout,_]);const F=(0,u.useCallback)((e=>{w((t=>Object.assign(Object.assign({},t),{draftEmail:e}))),I.customerEmailEntry(e)}),[I]),x=(0,u.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield P.actions.signIn(e),f(),w((e=>Object.assign(Object.assign({},e),{draftEmail:void 0})))}catch(e){v(e)}}))),[P.actions.signIn,f,v]),N=(0,u.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const t=e.email.trim(),a=!P.data.hasBillingId&&!P.data.defaultShouldSubscribe&&void 0;try{const{data:n}=yield P.actions.continueAsGuest({email:t,acceptsMarketingNewsletter:!(!P.data.canSubscribe||!e.shouldSubscribe)||a,acceptsAbandonedCartEmails:!!e.shouldSubscribe||a});y(e.shouldSubscribe),Ae.y.setSubscribeStatus(e.shouldSubscribe);const i=n.getCustomer(),o=n.getPaymentProviderCustomer();if(i&&i.shouldEncourageSignIn&&i.isGuest&&!(null==o?void 0:o.stripeLinkAuthenticationState))return h(M.A.SuggestedLogin);yield q(),w((e=>Object.assign(Object.assign({},e),{draftEmail:void 0})))}catch(e){if(!(0,m.A)(e)||"update_subscriptions"!==e.type&&"payment_method_client_invalid"!==e.type||(w((e=>Object.assign(Object.assign({},e),{draftEmail:void 0}))),k()),(0,m.A)(e)&&"empty_cart"===e.type)return C(e);if((0,m.A)(e)&&429===e.status)return h(M.A.EnforcedLogin);if((0,m.A)(e)&&403===e.status)return h(M.A.CancellableEnforcedLogin);C(e)}}))),[P,y,h,k,C]),q=(0,u.useCallback)((()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){P.data.providerWithCustomCheckout&&P.data.providerWithCustomCheckout!==g.A.StripeUPE?yield P.actions.executePaymentMethodCheckout({methodId:P.data.providerWithCustomCheckout,continueWithCheckoutCallback:k,checkoutPaymentMethodExecuted:e=>{I.customerPaymentMethodExecuted(e)}}):k()}))),[P.actions.executePaymentMethodCheckout,P.data.providerWithCustomCheckout,k,I]),O=(0,u.useCallback)((()=>{h(M.A.Login)}),[h]),B=(0,u.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield P.actions.createAccount(function(e){var{acceptsMarketingEmails:t,customFields:a}=e,i=(0,n.__rest)(e,["acceptsMarketingEmails","customFields"]);return Object.assign(Object.assign({},i),{acceptsMarketingEmails:t&&t.length>0,customFields:(0,Me.A)(a)})}(e)),p()}))),[P.actions.createAccount,p]),j=(0,u.useCallback)((()=>{P.data.createAccountError&&P.actions.clearError(P.data.createAccountError),h(M.A.Login)}),[P.actions.clearError,P.data.createAccountError,h]),W=(0,u.useCallback)((()=>{P.data.signInError&&P.actions.clearError(P.data.signInError),h(M.A.Guest)}),[P.actions.clearError,P.data.signInError,h]),T=(0,u.useCallback)((()=>{h(M.A.CreateAccount)}),[h]),R=(0,u.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield P.actions.sendLoginEmail(e)}catch(e){}finally{w((e=>Object.assign(Object.assign({},e),{hasRequestedLoginEmail:!0})))}}))),[P.actions.sendLoginEmail]),G=(0,u.useCallback)((()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{e!==M.A.Login&&L.draftEmail&&(yield R({email:L.draftEmail}))}finally{w((e=>Object.assign(Object.assign({},e),{isEmailLoginFormOpen:!0})))}}))),[e,L.draftEmail,R]),U=(0,u.useCallback)((()=>{w((e=>Object.assign(Object.assign({},e),{isEmailLoginFormOpen:!1,hasRequestedLoginEmail:!1})))}),[]),$=e===M.A.Guest,V=e===M.A.CreateAccount,Y=!$&&!V;return L.isReady?u.createElement(u.Fragment,null,L.isEmailLoginFormOpen&&u.createElement(Q,{email:L.draftEmail,emailHasBeenRequested:L.hasRequestedLoginEmail,isFloatingLabelEnabled:P.data.isFloatingLabelEnabled,isOpen:L.isEmailLoginFormOpen,isSendingEmail:P.data.isSendingSignInEmail,onRequestClose:U,onSendLoginEmail:R,sentEmail:P.data.signInEmail,sentEmailError:P.data.signInEmailError}),Y&&u.createElement(ze,{continueAsGuestButtonLabelId:"customer.continue_as_guest_action",email:L.draftEmail||P.data.email,isEmbedded:a,isFloatingLabelEnabled:P.data.isFloatingLabelEnabled,onCancel:W,onChangeEmail:F,onContinueAsGuest:q,onCreateAccount:T,onSendLoginEmail:G,onSignIn:x,signInError:P.data.signInError,viewType:e}),$&&u.createElement(Se,{email:L.draftEmail||P.data.email,handleChangeEmail:F,handleContinueAsGuest:N,handleShowLogin:O,isFloatingLabelEnabled:P.data.isFloatingLabelEnabled,isSubscribed:E,isWalletButtonsOnTop:b,onUnhandledError:_,onWalletButtonClick:S,step:t}),V&&u.createElement(z,{createAccountError:P.data.createAccountError,defaultShouldSubscribe:P.data.defaultShouldSubscribe,formFields:P.data.customerAccountFields,isCreatingAccount:P.data.isCreatingAccount,isExecutingPaymentMethodCheckout:P.data.isExecutingPaymentMethodCheckout,isFloatingLabelEnabled:P.data.isFloatingLabelEnabled,onCancel:j,onSubmit:B,requiresMarketingConsent:P.data.requiresMarketingConsent})):null}},77546:(e,t,a)=>{function n(e){const t=document.createElement("div");t.innerHTML=e;const a=t.querySelector("a");if(!a)return[];const n=t.innerHTML.split(a.outerHTML);return[n[0],a.text,n[1]]}a.d(t,{A:()=>n})}}]);
//# sourceMappingURL=customer-0920d3a4.js.map