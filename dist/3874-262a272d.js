"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[3874],{2480:(e,t,a)=>{a.d(t,{A:()=>f});var n=a(31635),r=a(70355),i=a(11474),o=a(40646),c=a(48447),d=a(19285),s=a(91182),l=a(67437),m=a(69440),u=a(65685),y=a(39981),p=a(66960);const h=e=>{const[t,a]=(0,r.useState)(),{checkoutState:n}=(0,y.Q)(),i=n.data.getCustomer(),o=n.data.getInstruments(e)||[],{paymentForm:c}=(0,p.N)(),{setFieldValue:d}=c,s=(0,r.useMemo)(()=>o.filter(u.A),[o]),l=(0,r.useMemo)(()=>s.filter(e=>e.trustedShippingAddress),[s]),h=s.length>0,f=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled)&&!e.initializationData.isComplete,b=f&&h,v=b&&!t,g=b&&!!t&&!l.length;(0,r.useEffect)(()=>{a(f?(()=>{if(!l.length)return;return l.filter(({defaultInstrument:e})=>e)[0]||l[0]})():void 0)},[f,l]),(0,r.useEffect)(()=>{b||d("instrumentId","")},[d,b]);const _=(0,r.useCallback)(e=>{a((0,m.find)(l,{bigpayToken:e})),d("instrumentId",e),d("shouldSetAsDefaultInstrument",!1)},[l,d]),E=(0,r.useCallback)(()=>{a(void 0),d("instrumentId",""),d("shouldSaveInstrument",!1),d("shouldSetAsDefaultInstrument",!1)},[d]);return{trustedAccountInstruments:l,currentInstrument:t,handleSelectInstrument:_,handleUseNewInstrument:E,isInstrumentFeatureAvailable:f,shouldShowInstrumentFieldset:b,shouldCreateNewInstrument:v,shouldConfirmInstrument:g}},f=(0,d.A)(e=>{const{checkoutState:{data:{isPaymentDataRequired:t,getCustomer:a,getInstruments:d},statuses:{isLoadingInstruments:m,isLoadingPaymentMethod:u}}}=e,y=e.method,{config:{isVaultingEnabled:p}}=y,f=(0,n.__rest)(y.initializationData,[]),{method:b,checkoutService:v,onUnhandledError:g}=e,{trustedAccountInstruments:_,currentInstrument:E,handleSelectInstrument:I,handleUseNewInstrument:C,isInstrumentFeatureAvailable:S,shouldShowInstrumentFieldset:A,shouldConfirmInstrument:P}=h(b);if((0,r.useEffect)(()=>{const{isGuest:e}=a()||{};!e&&p&&!f&&(0,n.__awaiter)(void 0,void 0,void 0,function*(){try{yield v.loadInstruments()}catch(e){e instanceof Error&&g(e)}})}),!t())return null;const w=m()||u(b.id),k=d()||[];return r.createElement(s.A,{hideContentWhenLoading:!0,isLoading:w},r.createElement(l.A,Object.assign({currentInstrument:E,providerOptionsKey:"bigcommerce_payments",shouldConfirmInstrument:P},e),A&&r.createElement(i.A,{instruments:_,onSelectInstrument:I,onUseNewInstrument:C,selectedInstrument:E}),P&&r.createElement("div",null,r.createElement(c.A,{id:"payment.account_instrument_new_shipping_address"})),S&&r.createElement(o.A,{instrumentId:null==E?void 0:E.bigpayToken,instruments:k,isAccountInstrument:!0})))},[{id:"bigcommerce_payments"}])},37434:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(70355),r=a(19285),i=a(67437);const o=(0,r.A)(e=>{const{checkoutState:t}=e;return t.data.isPaymentDataRequired()?n.createElement(i.A,Object.assign({providerOptionsKey:"bigcommerce_payments_paylater"},e)):null},[{id:"bigcommerce_payments_paylater"}])},65374:(e,t,a)=>{a.d(t,{A:()=>c});var n=a(70355),r=a(29345),i=a(19285),o=a(67437);const c=(0,i.A)(e=>{const{method:t,checkoutState:a}=e;if(!a.data.isPaymentDataRequired())return null;const i=(0,r.A)(t.id,t.gateway),c={apmFieldsContainer:`#${i}`,apmFieldsStyles:{variables:{fontFamily:"Open Sans, Helvetica Neue, Arial, sans-serif",colorBackground:"transparent",textColor:"black",fontSizeBase:"16px",spacingUnit:"1rem",borderColor:"#d9d9d9",borderRadius:"4px",borderWidth:"1px"},rules:{".Input":{backgroundColor:"white",color:"#333",fontSize:"1rem"},".Input:active":{color:"#4496f6"},".Input--invalid":{color:"#ed6a6a"}}}};return n.createElement(o.A,Object.assign({providerOptionsData:c,providerOptionsKey:"bigcommerce_payments_apms"},e),n.createElement("div",{className:`widget widget--${t.id} payment-widget`,id:i}))},[{gateway:"bigcommerce_payments_apms"}])},67437:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(31635),r=a(70355);const i=({method:e,checkoutService:t,paymentForm:a,onUnhandledError:i,providerOptionsKey:o,providerOptionsData:c,children:d,currentInstrument:s,language:l,shouldConfirmInstrument:m})=>{const u=(0,r.useRef)(null),y=(0,r.useRef)(null),p=(0,r.useRef)(null),h=(0,r.useRef)(!1),f=a.getFieldValue("terms"),b=a.getFieldValue("shouldSaveInstrument"),v=()=>(0,n.__awaiter)(void 0,void 0,void 0,function*(){const e=yield a.validateForm();return Object.keys(e)}),g=()=>(0,n.__awaiter)(void 0,void 0,void 0,function*(){if(!u.current)return;(yield v()).length?u.current.disable():u.current.enable()}),_=(0,r.useCallback)(()=>{s&&!m?(a.hidePaymentSubmitButton(e,!1),h.current=!1):!h.current&&p.current&&(a.hidePaymentSubmitButton(e,!0),setTimeout(()=>{var e;null===(e=p.current)||void 0===e||e.call(p),h.current=!0},0))},[s]);(0,r.useEffect)(()=>{_()},[_,p.current]),(0,r.useEffect)(()=>{g()},[f]),(0,r.useEffect)(()=>{y.current={shouldSaveInstrument:m||Boolean(b)}},[b,m]);return(0,r.useEffect)(()=>((0,n.__awaiter)(void 0,void 0,void 0,function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,[o]:Object.assign({container:"#checkout-payment-continue",shouldRenderPayPalButtonOnInitialization:!1,onRenderButton:()=>{a.hidePaymentSubmitButton(e,!0)},onInit:e=>{p.current=e},submitForm:()=>{a.setSubmitted(!0),a.submitForm()},onError:t=>{a.disableSubmit(e,!0),"INSTRUMENT_DECLINED"===t.message?i(new Error(l.translate("payment.errors.instrument_declined"))):i(t)},onValidate:(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,function*(){const n=yield v();return n.length?(a.setSubmitted(!0),n.forEach(e=>a.setFieldTouched(e)),t()):e()}),onInitButton:e=>(0,n.__awaiter)(void 0,void 0,void 0,function*(){u.current=e,yield g()}),getFieldsValues:()=>y.current},c||{})})}catch(e){e instanceof Error&&i(e)}}),()=>{(0,n.__awaiter)(void 0,void 0,void 0,function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&i(e)}})}),[]),d?r.createElement(r.Fragment,null,d):r.createElement(r.Fragment,null)}},68737:(e,t,a)=>{a.d(t,{A:()=>g});var n=a(31635),r=a(70355),i=a(94027),o=a(39981),c=a(66960),d=a(19285),s=a(9343),l=a(91182),m=a(56943);const u=({renderPayPalCardComponent:e})=>((0,r.useEffect)(()=>{"function"==typeof e&&e("#big-commerce-payments-fastlane-cc-form-container")},[e]),r.createElement("div",{className:"big-commerce-payments-fastlane-cc-form-container","data-test":"big-commerce-payments-fastlane-cc-form-container",id:"big-commerce-payments-fastlane-cc-form-container"}));var y=a(49655),p=a(35172),h=a(86516),f=a(63163);const b=({onChange:e,handleSelectInstrument:t,selectedInstrument:a})=>{const i=function(e){switch(e.toLowerCase()){case"amex":case"american_express":return"american-express";case"diners":return"diners-club";case"master_card":return"mastercard";default:return e}}(a.brand).toLowerCase();return r.createElement("div",{className:"big-commerce-payments-fastlane-instrument","data-test":"big-commerce-payments-fastlane-instrument-form"},r.createElement("div",null,r.createElement("div",{className:"big-commerce-payments-fastlane-instrument-details"},r.createElement(h.A,{cardType:i}),r.createElement("div",{className:"instrumentSelect-card","data-test":"big-commerce-fastlane-instrument-last4"},r.createElement("span",null,"●●●● ",a.last4))),r.createElement("div",{className:"big-commerce-payments-fastlane-instrument-branding"},r.createElement(p.A,null))),r.createElement("div",{className:"big-commerce-payments-fastlane-instrument-change-action"},r.createElement(f.Ay,{onClick:()=>(0,n.__awaiter)(void 0,void 0,void 0,function*(){if("function"==typeof e){const a=yield e();a&&t(a)}}),size:f.Mp.Tiny,testId:"big-commerce-payments-fastlane-instrument-change",variant:f.Ak.Secondary},r.createElement(y.A,{id:"common.change_action"}))))},v=({renderPayPalCardComponent:e,showPayPalCardSelector:t})=>{const{instruments:a,handleSelectInstrument:n,selectedInstrument:i}=(()=>{const[e,t]=(0,r.useState)(),{getPaymentProviderCustomer:a}=(0,o.Q)().checkoutState.data,n=a(),i=(0,m.A)(n)?n:{},{paymentForm:d}=(0,c.N)();return{instruments:i.instruments||[],handleSelectInstrument:e=>{t(e),d.setFieldValue("instrumentId",e.bigpayToken)},selectedInstrument:e}})(),d=a.length>0;return(0,r.useEffect)(()=>{!i&&a.length>0&&n(a[0])},[a,i,n]),r.createElement("div",{className:"paymentMethod paymentMethod--creditCard"},d&&r.createElement(b,{handleSelectInstrument:n,onChange:t,selectedInstrument:i||a[0]}),!d&&r.createElement(u,{renderPayPalCardComponent:e}))};const g=(0,d.A)(({method:e,checkoutService:t,checkoutState:a,onUnhandledError:d,paymentForm:m,language:u})=>{const y=(0,r.useRef)({}),{isLoadingPaymentMethod:p,isInitializingPayment:h}=a.statuses;(0,r.useEffect)(()=>((0,n.__awaiter)(void 0,void 0,void 0,function*(){try{yield t.initializePayment({methodId:e.id,bigcommerce_payments_fastlane:{onInit:e=>{y.current.renderPayPalCardComponent=e},onChange:e=>{y.current.showPayPalCardSelector=e},onError:e=>{let t;return t=function(e){return"object"==typeof e&&null!==e&&"translationKey"in e}(e)?new Error(u.translate(e.translationKey)):e instanceof Error?e:new Error(u.translate("payment.errors.general_error")),d(t)}}})}catch(e){e instanceof Error&&d(e)}}),()=>{(0,n.__awaiter)(void 0,void 0,void 0,function*(){try{yield t.deinitializePayment({methodId:e.id})}catch(e){e instanceof Error&&d(e)}})}),[]);const f=h()||p(e.id),b={isSubmitted:m.isSubmitted(),setSubmitted:m.setSubmitted};return r.createElement(s.Ay.Provider,{value:b},r.createElement(o.A.Provider,{value:{checkoutState:a,checkoutService:t}},r.createElement(i.A,{checkoutService:t},r.createElement(c.i.Provider,{value:{paymentForm:m}},r.createElement(l.A,{hideContentWhenLoading:!0,isLoading:f},r.createElement(v,{renderPayPalCardComponent:y.current.renderPayPalCardComponent,showPayPalCardSelector:y.current.showPayPalCardSelector}))))))},[{id:"bigcommerce_payments_fastlane"}])},69958:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(70355),r=a(19285),i=a(67437);const o=(0,r.A)(e=>e.checkoutState.data.isPaymentDataRequired()?n.createElement(i.A,Object.assign({providerOptionsKey:"bigcommerce_payments_venmo"},e)):null,[{id:"bigcommerce_payments_venmo"}])},70630:(e,t,a)=>{a.d(t,{A:()=>f});var n=a(31635),r=a(70355),i=a(20874),o=a(25657),c=a(19285),d=a(33740),s=a(9343),l=a(41410),m=a(44218),u=a(94202);const y=(0,m.Bj)(function({formFieldData:e,language:t}){const a={ratepayPhoneCountryCode:"payment.ratepay.phone_country_code",ratepayPhoneNumber:"payment.ratepay.phone_number",ratepayBirthDate:"payment.ratepay.birth_date"};return(0,u.Ik)(e.reduce((e,{id:n,required:r})=>(r&&a[n]&&(e[n]=(0,u.Yj)().nullable().required(t.translate("payment.ratepay.errors.isRequired",{fieldName:t.translate(a[n])})),"ratepayPhoneCountryCode"===n&&(e[n]=e[n].matches(/^\+\d{2,}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_country_code")}))),"ratepayPhoneNumber"===n&&(e[n]=e[n].matches(/^\d{7,11}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_number")})))),e),{}))}),p="ITEM_CATEGORY_NOT_SUPPORTED_BY_PAYMENT_SOURCE",h=[{name:"ratepayBirthDate",custom:!1,id:"ratepayBirthDate",label:"payment.ratepay.birth_date",required:!0,fieldType:d.A.DATE,inputDateFormat:"dd.MM.yyyy"},{name:"ratepayPhoneCountryCode",custom:!1,id:"ratepayPhoneCountryCode",label:"payment.ratepay.phone_country_code",required:!0,fieldType:d.A.TEXT,type:"string"},{name:"ratepayPhoneNumber",custom:!1,id:"ratepayPhoneNumber",label:"payment.ratepay.phone_number",required:!0,fieldType:d.A.TEXT}],f=(0,c.A)(({method:e,checkoutService:t,onUnhandledError:a,paymentForm:{isSubmitted:c,setFieldValue:d,setValidationSchema:m,setSubmitted:u},language:f,checkoutState:b})=>{const v=(0,r.useRef)({}),g=b.data.isPaymentDataRequired();if(!g)return null;(0,r.useEffect)(()=>((0,n.__awaiter)(void 0,void 0,void 0,function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,bigcommerce_payments_ratepay:{container:"#checkout-payment-continue",legalTextContainer:"legal-text-container",loadingContainerId:"checkout-page-container",getFieldsValues:()=>v.current,onError:e=>{var t,n;const r=null===(t=e.errors)||void 0===t?void 0:t.filter(e=>e.provider_error);if(null==r?void 0:r.length){let e,t;const i=null===(n=r[0].provider_error)||void 0===n?void 0:n.code;switch(i){case"PAYMENT_SOURCE_DECLINED_BY_PROCESSOR":e="payment.ratepay.errors.paymentSourceDeclinedByProcessor";break;case"PAYMENT_SOURCE_INFO_CANNOT_BE_VERIFIED":e="payment.ratepay.errors.paymentSourceInfoCannotBeVerified";break;case p:e="payment.ratepay.errors.itemCategoryNotSupportedByPaymentSource";break;default:e="common.error_heading"}return t=i!==p?new o.A({data:{shouldBeTranslatedAsHtml:!0,translationKey:e}}):new Error(f.translate(e)),a(t)}a(e)}}})}catch(e){e instanceof Error&&a(e)}}),()=>{(0,n.__awaiter)(void 0,void 0,void 0,function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&a(e)}})}),[]);const _=(0,r.useCallback)(e=>t=>{var a;d(e,t),a={[e]:t},v.current=Object.assign(Object.assign({},v.current),a)},[d]),E=(0,r.useMemo)(()=>y({formFieldData:h,language:f}),[f,h]);return(0,r.useEffect)(()=>{u(!1),m(e,E)},[E,e,m,u]),(0,r.useEffect)(()=>{d("ratepayPhoneCountryCode",(()=>{const e=b.data.getBillingAddress();return(0,i.B)(e.country)[0]||""})().dialCode)},[]),r.createElement("div",{style:{marginBottom:"20px"}},r.createElement(s.Ay.Provider,{value:{isSubmitted:c,setSubmitted:u}},h.map(e=>r.createElement(l.A,{extraClass:`dynamic-form-field--${e.id}`,field:e,key:e.id,label:f.translate(e.label),onChange:_(e.id)}))))},[{gateway:"bigcommerce_payments_apms",id:"ratepay"}])},74877:(e,t,a)=>{a.d(t,{A:()=>h});var n=a(31635),r=a(69440),i=a(70355),o=a(14527),c=a(98363),d=a(27883),s=a(35781),l=a(66833),m=a(82804),u=a(53783),y=a(48407),p=a(31448);const h=(0,a(19285).A)(e=>{const{checkoutService:t,checkoutState:a,paymentForm:h,language:f,method:b}=e,{cardCode:v,showCardHolderName:g,isHostedFormEnabled:_,requireCustomerCode:E}=b.config,[I,C]=(0,i.useState)(),{setFieldTouched:S,setFieldValue:A,setSubmitted:P,submitForm:w}=h,k=(0,y.A)(a),N=(0,p.A)(a),F=v||null===v,T=null==g||g,O=(0,i.useCallback)(e=>`${(0,r.compact)([b.gateway,b.id]).join("-")}-${e}`,[b]),B=(0,i.useCallback)(e=>(0,n.__awaiter)(void 0,void 0,void 0,function*(){const t=["color","fontFamily","fontSize","fontWeight"],a=!!e&&N(e,b),n=!!e&&k(e,b),i=a||n;let o;return e&&i&&(o=O("ccCvv")),e||(o=O("ccNumber")),{fields:e?{cardCodeVerification:i?{accessibilityLabel:f.translate("payment.credit_card_cvv_label"),containerId:O("ccCvv"),instrumentId:e.bigpayToken}:void 0,cardNumberVerification:i?{accessibilityLabel:f.translate("payment.credit_card_number_label"),containerId:O("ccNumber"),instrumentId:e.bigpayToken}:void 0,cardExpiryVerification:i?{accessibilityLabel:f.translate("payment.credit_card_expiry_label"),containerId:O("ccExpiry"),instrumentId:e.bigpayToken}:void 0}:{cardCode:F?{accessibilityLabel:f.translate("payment.credit_card_cvv_label"),containerId:O("ccCvv")}:void 0,cardExpiry:{accessibilityLabel:f.translate("payment.credit_card_expiration_label"),containerId:O("ccExpiry"),placeholder:f.translate("payment.credit_card_expiration_placeholder_text")},cardName:{accessibilityLabel:f.translate("payment.credit_card_name_label"),containerId:O("ccName")},cardNumber:{accessibilityLabel:f.translate("payment.credit_card_number_label"),containerId:O("ccNumber")}},styles:o?{default:yield(0,m.A)(o,t),error:yield(0,m.A)(o,t,m.S.Error),focus:yield(0,m.A)(o,t,m.S.Focus)}:{},onBlur:({fieldType:e})=>{I===e&&C(void 0)},onCardTypeChange:({cardType:e})=>{A("hostedForm.cardType",e)},onEnter:()=>{P(!0),w()},onFocus:({fieldType:e})=>{C(e)},onValidate:({errors:e={}})=>{(0,r.forIn)(e,(e,t)=>{const a=`hostedForm.errors.${t}`;A(a,e&&e[0].type?e[0].type:""),e&&e[0]&&S(a)})}}}),[I,O,F,T,k,N,f,b,A,S,C,P,w]),D=(0,i.useCallback)(e=>{const t=!!e&&N(e,b),a=!!e&&k(e,b),n=t||a;return i.createElement(c.A,{cardCodeId:a?O("ccCvv"):void 0,cardExpiryId:n?O("ccExpiry"):void 0,cardNumberId:t?O("ccNumber"):void 0,focusedFieldType:I})},[I,O,k,N,b]),R=t.initializePayment,x=(0,i.useCallback)((e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,function*(){return R(Object.assign(Object.assign({},e),{bigcommerce_payments_creditcards:{form:_?yield B(t):void 0}}))}),[B,R]);return _?i.createElement(o.A,Object.assign({},e,{cardFieldset:i.createElement(d.A,{additionalFields:E&&i.createElement(u.A,{name:"ccCustomerCode"}),cardCodeId:F?O("ccCvv"):void 0,cardExpiryId:O("ccExpiry"),cardNameId:O("ccName"),cardNumberId:O("ccNumber"),focusedFieldType:I}),cardValidationSchema:(0,s.A)({language:f}),deinitializePayment:t.deinitializePayment,getHostedFormOptions:B,getStoredCardValidationFieldset:D,initializePayment:x,storedCardValidationSchema:(0,l.A)({language:f,isCardExpiryRequired:!0})})):i.createElement(o.A,Object.assign({},e,{deinitializePayment:t.deinitializePayment,initializePayment:x}))},[{id:"bigcommerce_payments_creditcards"}])}}]);
//# sourceMappingURL=3874-262a272d.js.map