"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[4159],{4159:(e,t,a)=>{a.d(t,{PayPalCommerceAPMsPaymentMethod:()=>l,PayPalCommerceButton:()=>V,PayPalCommerceCreditButton:()=>u,PayPalCommerceCreditCardsPaymentMethod:()=>_,PayPalCommerceCreditPaymentMethod:()=>y,PayPalCommerceFastlanePaymentMethod:()=>z,PayPalCommercePaymentMethod:()=>Y,PayPalCommerceVenmoPaymentMethod:()=>$,PaypalCommerceRatePayPaymentMethod:()=>ae});var n=a(70355),r=a(29345),i=a(19285),o=a(31635),c=a(6327);const d=({method:e,checkoutService:t,paymentForm:a,onUnhandledError:r,providerOptionsKey:i,providerOptionsData:d,children:l,currentInstrument:s,language:m,shouldConfirmInstrument:u})=>{const y=(0,n.useRef)(null),p=(0,n.useRef)(null),h=(0,n.useRef)(null),v=(0,n.useRef)(!1),f=a.getFieldValue("terms"),g=a.getFieldValue("shouldSaveInstrument"),b=()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const e=yield a.validateForm();return Object.keys(e)})),E=()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(!y.current)return;(yield b()).length?y.current.disable():y.current.enable()})),C=(0,n.useCallback)((()=>{s&&!u?(a.hidePaymentSubmitButton(e,!1),v.current=!1):!v.current&&h.current&&(a.hidePaymentSubmitButton(e,!0),setTimeout((()=>{var e;null===(e=h.current)||void 0===e||e.call(h),v.current=!0}),0))}),[s]);(0,n.useEffect)((()=>{C()}),[C,h.current]),(0,n.useEffect)((()=>{E()}),[f]),(0,n.useEffect)((()=>{p.current={shouldSaveInstrument:u||Boolean(g)}}),[g,u]);return(0,n.useEffect)((()=>((0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,integrations:[c.Rk,c.bg,c.uq,c.xU],[i]:Object.assign({container:"#checkout-payment-continue",shouldRenderPayPalButtonOnInitialization:!1,onRenderButton:()=>{a.hidePaymentSubmitButton(e,!0)},onInit:e=>{h.current=e},submitForm:()=>{a.setSubmitted(!0),a.submitForm()},onError:t=>{a.disableSubmit(e,!0),"INSTRUMENT_DECLINED"===t.message?r(new Error(m.translate("payment.errors.instrument_declined"))):r(t)},onValidate:(e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const n=yield b();return n.length?(a.setSubmitted(!0),n.forEach((e=>a.setFieldTouched(e))),t()):e()})),onInitButton:e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){y.current=e,yield E()})),getFieldsValues:()=>p.current},d||{})})}catch(e){e instanceof Error&&r(e)}})),()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&r(e)}}))})),[]),l?n.createElement(n.Fragment,null,l):n.createElement(n.Fragment,null)},l=(0,i.A)((e=>{const{method:t,checkoutState:a}=e,{isPaymentDataRequired:i}=a.data,{id:o}=t;if(!i())return null;const c=(0,r.A)(o,t.gateway),l={apmFieldsContainer:`#${c}`,apmFieldsStyles:{variables:{fontFamily:"Open Sans, Helvetica Neue, Arial, sans-serif",colorBackground:"transparent",textColor:"black",fontSizeBase:"16px",spacingUnit:"1rem",borderColor:"#d9d9d9",borderRadius:"4px",borderWidth:"1px"},rules:{".Input":{backgroundColor:"white",color:"#333",fontSize:"1rem"},".Input:active":{color:"#4496f6"},".Input--invalid":{color:"#ed6a6a"}}}};return n.createElement(d,Object.assign({providerOptionsData:l,providerOptionsKey:"paypalcommercealternativemethods"},e),n.createElement("div",{className:`widget widget--${o} payment-widget`,id:c}))}),[{gateway:"paypalcommercealternativemethods"}]);var s=a(63582),m=a(4907);const u=(0,i.A)((e=>{const{onUnhandledError:t}=e,a={onComplete:m.A,onError:t};return n.createElement(s.A,Object.assign({additionalInitializationOptions:a,integrations:[c.Bs]},e))}),[{id:"paypalcommercecredit"}]),y=(0,i.A)((e=>{const{checkoutState:t}=e,{isPaymentDataRequired:a}=t.data;return a()?n.createElement(d,Object.assign({providerOptionsKey:"paypalcommercecredit"},e)):null}),[{id:"paypalcommercecredit"}]);var p=a(69440),h=a(17077),v=a(98363),f=a(27883),g=a(35781),b=a(66833),E=a(48407),C=a(31448),I=a(82804),P=a(53783);const _=(0,i.A)((e=>{const{checkoutService:t,checkoutState:a,paymentForm:r,language:i,method:d}=e,{cardCode:l,showCardHolderName:s,isHostedFormEnabled:m,requireCustomerCode:u}=d.config,[y,_]=(0,n.useState)(),{setFieldTouched:S,setFieldValue:A,setSubmitted:w,submitForm:k}=r,F=(0,E.A)(a),N=(0,C.A)(a),O=l||null===l,T=null==s||s,B=(0,n.useCallback)((e=>`${(0,p.compact)([d.gateway,d.id]).join("-")}-${e}`),[d]),D=(0,n.useCallback)((e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const t=["color","fontFamily","fontSize","fontWeight"],a=!!e&&N(e,d),n=!!e&&F(e,d),r=a||n;let o;return e&&r&&(o=B("ccCvv")),e||(o=B("ccNumber")),{fields:e?{cardCodeVerification:r?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:B("ccCvv"),instrumentId:e.bigpayToken}:void 0,cardNumberVerification:r?{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:B("ccNumber"),instrumentId:e.bigpayToken}:void 0,cardExpiryVerification:r?{accessibilityLabel:i.translate("payment.credit_card_expiry_label"),containerId:B("ccExpiry"),instrumentId:e.bigpayToken}:void 0}:{cardCode:O?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:B("ccCvv")}:void 0,cardExpiry:{accessibilityLabel:i.translate("payment.credit_card_expiration_label"),containerId:B("ccExpiry"),placeholder:i.translate("payment.credit_card_expiration_placeholder_text")},cardName:{accessibilityLabel:i.translate("payment.credit_card_name_label"),containerId:B("ccName")},cardNumber:{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:B("ccNumber")}},styles:o?{default:yield(0,I.A)(o,t),error:yield(0,I.A)(o,t,I.S.Error),focus:yield(0,I.A)(o,t,I.S.Focus)}:{},onBlur:({fieldType:e})=>{y===e&&_(void 0)},onCardTypeChange:({cardType:e})=>{A("hostedForm.cardType",e)},onEnter:()=>{w(!0),k()},onFocus:({fieldType:e})=>{_(e)},onValidate:({errors:e={}})=>{(0,p.forIn)(e,((e,t)=>{const a=`hostedForm.errors.${t}`;A(a,e&&e[0].type?e[0].type:""),e&&e[0]&&S(a)}))}}}))),[y,B,O,T,F,N,i,d,A,S,_,w,k]),R=(0,n.useCallback)((e=>{const t=!!e&&N(e,d),a=!!e&&F(e,d),r=t||a;return n.createElement(v.A,{cardCodeId:a?B("ccCvv"):void 0,cardExpiryId:r?B("ccExpiry"):void 0,cardNumberId:t?B("ccNumber"):void 0,focusedFieldType:y})}),[y,B,F,N,d]),x=t.initializePayment,M=(0,n.useCallback)(((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return x(Object.assign(Object.assign({},e),{integrations:[c.Kv],paypalcommercecreditcards:{form:m?yield D(t):void 0}}))}))),[D,x]);return m?n.createElement(h.A,Object.assign({},e,{cardFieldset:n.createElement(f.A,{additionalFields:u&&n.createElement(P.A,{name:"ccCustomerCode"}),cardCodeId:O?B("ccCvv"):void 0,cardExpiryId:B("ccExpiry"),cardNameId:B("ccName"),cardNumberId:B("ccNumber"),focusedFieldType:y}),cardValidationSchema:(0,g.A)({language:i}),deinitializePayment:t.deinitializePayment,getHostedFormOptions:D,getStoredCardValidationFieldset:R,initializePayment:M,storedCardValidationSchema:(0,b.A)({language:i,isCardExpiryRequired:!0})})):n.createElement(h.A,Object.assign({},e,{deinitializePayment:t.deinitializePayment,initializePayment:M}))}),[{id:"paypalcommercecreditcards"}]);var S=a(94027),A=a(39981),w=a(66960),k=a(9343),F=a(91182),N=a(56943);const O=({renderPayPalCardComponent:e})=>((0,n.useEffect)((()=>{"function"==typeof e&&e("#paypal-commerce-fastlane-cc-form-container")}),[e]),n.createElement("div",{className:"paypal-commerce-fastlane-cc-form-container","data-test":"paypal-commerce-fastlane-cc-form-container",id:"paypal-commerce-fastlane-cc-form-container"}));var T=a(49655),B=a(35172),D=a(86516),R=a(63163);const x=({onChange:e,handleSelectInstrument:t,selectedInstrument:a})=>{const r=function(e){switch(e.toLowerCase()){case"amex":case"american_express":return"american-express";case"diners":return"diners-club";case"master_card":return"mastercard";default:return e}}(a.brand).toLowerCase();return n.createElement("div",{className:"paypal-commerce-fastlane-instrument","data-test":"paypal-commerce-fastlane-instrument-form"},n.createElement("div",null,n.createElement("div",{className:"paypal-commerce-fastlane-instrument-details"},n.createElement(D.A,{cardType:r}),n.createElement("div",{className:"instrumentSelect-card","data-test":"paypal-fastlane-instrument-last4"},n.createElement("span",null,"●●●● ",a.last4))),n.createElement("div",{className:"paypal-commerce-fastlane-instrument-branding"},n.createElement(B.A,null))),n.createElement("div",{className:"paypal-commerce-fastlane-instrument-change-action"},n.createElement(R.Ay,{onClick:()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof e){const a=yield e();a&&t(a)}})),size:R.Mp.Tiny,testId:"paypal-commerce-fastlane-instrument-change",variant:R.Ak.Secondary},n.createElement(T.A,{id:"common.change_action"}))))},M=({renderPayPalCardComponent:e,showPayPalCardSelector:t})=>{const{instruments:a,handleSelectInstrument:r,selectedInstrument:i}=(()=>{const[e,t]=(0,n.useState)(),{getPaymentProviderCustomer:a}=(0,A.Q)().checkoutState.data,r=a(),i=(0,N.A)(r)?r:{},{paymentForm:o}=(0,w.N)();return{instruments:i.instruments||[],handleSelectInstrument:e=>{t(e),o.setFieldValue("instrumentId",e.bigpayToken)},selectedInstrument:e}})(),o=a.length>0;return(0,n.useEffect)((()=>{!i&&a.length>0&&r(a[0])}),[a,i]),n.createElement("div",{className:"paymentMethod paymentMethod--creditCard"},o&&n.createElement(x,{handleSelectInstrument:r,onChange:t,selectedInstrument:i||a[0]}),!o&&n.createElement(O,{renderPayPalCardComponent:e}))};const z=(0,i.A)((({method:e,checkoutService:t,checkoutState:a,onUnhandledError:r,paymentForm:i,language:d})=>{const l=(0,n.useRef)({}),{isLoadingPaymentMethod:s,isInitializingPayment:m}=a.statuses;(0,n.useEffect)((()=>((0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({methodId:e.id,integrations:[c.oL],paypalcommercefastlane:{onInit:e=>{l.current.renderPayPalCardComponent=e},onChange:e=>{l.current.showPayPalCardSelector=e},onError:e=>{let t;return t=function(e){return"object"==typeof e&&null!==e&&"translationKey"in e}(e)?new Error(d.translate(e.translationKey)):e instanceof Error?e:new Error(d.translate("payment.errors.general_error")),r(t)}}})}catch(e){e instanceof Error&&r(e)}})),()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({methodId:e.id})}catch(e){e instanceof Error&&r(e)}}))})),[]);const u=m()||s(e.id),y={isSubmitted:i.isSubmitted(),setSubmitted:i.setSubmitted};return n.createElement(k.Ay.Provider,{value:y},n.createElement(A.A.Provider,{value:{checkoutState:a,checkoutService:t}},n.createElement(S.A,{checkoutService:t},n.createElement(w.i.Provider,{value:{paymentForm:i}},n.createElement(F.A,{hideContentWhenLoading:!0,isLoading:u},n.createElement(M,{renderPayPalCardComponent:l.current.renderPayPalCardComponent,showPayPalCardSelector:l.current.showPayPalCardSelector}))))))}),[{id:"paypalcommerceacceleratedcheckout"}]),V=(0,i.A)((e=>{const{onUnhandledError:t}=e,a={onComplete:m.A,onError:t};return n.createElement(s.A,Object.assign({additionalInitializationOptions:a,integrations:[c.yU]},e))}),[{id:"paypalcommerce"}]);var j=a(11474),L=a(40646),U=a(48447),q=a(65685);const K=e=>{const[t,a]=(0,n.useState)(),{checkoutState:r}=(0,A.Q)(),i=r.data.getCustomer(),o=r.data.getInstruments(e)||[],{paymentForm:c}=(0,w.N)(),{setFieldValue:d}=c,l=(0,n.useMemo)((()=>o.filter(q.A)),[o]),s=(0,n.useMemo)((()=>l.filter((e=>e.trustedShippingAddress))),[l]),m=l.length>0,u=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled)&&!e.initializationData.isComplete,y=u&&m,h=y&&!t,v=y&&!!t&&!s.length;(0,n.useEffect)((()=>{a(u?(()=>{if(!s.length)return;return s.filter((({defaultInstrument:e})=>e))[0]||s[0]})():void 0)}),[u,s]),(0,n.useEffect)((()=>{y||d("instrumentId","")}),[d,y]);const f=(0,n.useCallback)((e=>{a((0,p.find)(s,{bigpayToken:e})),d("instrumentId",e),d("shouldSetAsDefaultInstrument",!1)}),[s,d]),g=(0,n.useCallback)((()=>{a(void 0),d("instrumentId",""),d("shouldSaveInstrument",!1),d("shouldSetAsDefaultInstrument",!1)}),[d]);return{trustedAccountInstruments:s,currentInstrument:t,handleSelectInstrument:f,handleUseNewInstrument:g,isInstrumentFeatureAvailable:u,shouldShowInstrumentFieldset:y,shouldCreateNewInstrument:h,shouldConfirmInstrument:v}},Y=(0,i.A)((e=>{const{checkoutState:{data:{isPaymentDataRequired:t,getCustomer:a,getInstruments:r},statuses:{isLoadingInstruments:i,isLoadingPaymentMethod:c}},method:{config:{isVaultingEnabled:l},initializationData:{isComplete:s}},method:m,checkoutService:u,onUnhandledError:y}=e,{trustedAccountInstruments:p,currentInstrument:h,handleSelectInstrument:v,handleUseNewInstrument:f,isInstrumentFeatureAvailable:g,shouldShowInstrumentFieldset:b,shouldConfirmInstrument:E}=K(m);if((0,n.useEffect)((()=>{const{isGuest:e}=a()||{};!e&&l&&!s&&(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield u.loadInstruments()}catch(e){e instanceof Error&&y(e)}}))}),[]),!t())return null;const C=i()||c(m.id),I=r()||[];return n.createElement(F.A,{hideContentWhenLoading:!0,isLoading:C},n.createElement(d,Object.assign({currentInstrument:h,providerOptionsKey:"paypalcommerce",shouldConfirmInstrument:E},e),b&&n.createElement(j.A,{instruments:p,onSelectInstrument:v,onUseNewInstrument:f,selectedInstrument:h}),E&&n.createElement("div",null,n.createElement(U.A,{id:"payment.account_instrument_new_shipping_address"})),g&&n.createElement(L.A,{instrumentId:null==h?void 0:h.bigpayToken,instruments:I,isAccountInstrument:!0})))}),[{id:"paypalcommerce"}]),$=(0,i.A)((e=>{const{checkoutState:t}=e,{isPaymentDataRequired:a}=t.data;return a()?n.createElement(d,Object.assign({providerOptionsKey:"paypalcommercevenmo"},e)):null}),[{id:"paypalcommercevenmo"}]);var H=a(20874),W=a(25657),G=a(33740),J=a(41410),Q=a(44218),X=a(94202);const Z=(0,Q.Bj)((function({formFieldData:e,language:t}){const a={ratepayPhoneCountryCode:"payment.ratepay.phone_country_code",ratepayPhoneNumber:"payment.ratepay.phone_number",ratepayBirthDate:"payment.ratepay.birth_date"};return(0,X.Ik)(e.reduce(((e,{id:n,required:r})=>(r&&a[n]&&(e[n]=(0,X.Yj)().nullable().required(t.translate("payment.ratepay.errors.isRequired",{fieldName:t.translate(a[n])})),"ratepayPhoneCountryCode"===n&&(e[n]=e[n].matches(/^\+\d{2,}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_country_code")}))),"ratepayPhoneNumber"===n&&(e[n]=e[n].matches(/^\d{7,11}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_number")})))),e)),{}))})),ee="ITEM_CATEGORY_NOT_SUPPORTED_BY_PAYMENT_SOURCE",te=[{name:"ratepayBirthDate",custom:!1,id:"ratepayBirthDate",label:"payment.ratepay.birth_date",required:!0,fieldType:G.A.DATE,inputDateFormat:"dd.MM.yyyy"},{name:"ratepayPhoneCountryCode",custom:!1,id:"ratepayPhoneCountryCode",label:"payment.ratepay.phone_country_code",required:!0,fieldType:G.A.TEXT,type:"string"},{name:"ratepayPhoneNumber",custom:!1,id:"ratepayPhoneNumber",label:"payment.ratepay.phone_number",required:!0,fieldType:G.A.TEXT}],ae=(0,i.A)((({method:e,checkoutService:t,onUnhandledError:a,paymentForm:{isSubmitted:r,setFieldValue:i,setValidationSchema:d,setSubmitted:l},language:s,checkoutState:m})=>{const u=(0,n.useRef)({}),y=m.data.isPaymentDataRequired();(0,n.useEffect)((()=>((0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,integrations:[c.gi],paypalcommerceratepay:{container:"#checkout-payment-continue",legalTextContainer:"legal-text-container",loadingContainerId:"checkout-page-container",getFieldsValues:()=>Object.assign(Object.assign({},{ratepayBirthDate:{getDate:()=>0,getMonth:()=>0,getFullYear:()=>0},ratepayPhoneCountryCode:"",ratepayPhoneNumber:""}),u.current),onError:e=>{var t,n;const r=null===(t=e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error));if(null==r?void 0:r.length){let e,t;const i=null===(n=r[0].provider_error)||void 0===n?void 0:n.code;switch(i){case"PAYMENT_SOURCE_DECLINED_BY_PROCESSOR":e="payment.ratepay.errors.paymentSourceDeclinedByProcessor";break;case"PAYMENT_SOURCE_INFO_CANNOT_BE_VERIFIED":e="payment.ratepay.errors.paymentSourceInfoCannotBeVerified";break;case ee:e="payment.ratepay.errors.itemCategoryNotSupportedByPaymentSource";break;default:e="common.error_heading"}return t=i!==ee?new W.A({data:{shouldBeTranslatedAsHtml:!0,translationKey:e}}):new Error(s.translate(e)),a(t)}a(e)}}})}catch(e){e instanceof Error&&a(e)}})),()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&a(e)}}))})),[]);const p=(0,n.useCallback)((e=>t=>{var a;i(e,t),a={[e]:t},u.current=Object.assign(Object.assign({},u.current),a)}),[i]),h=(0,n.useMemo)((()=>Z({formFieldData:te,language:s})),[s,te]);if((0,n.useEffect)((()=>{l(!1),d(e,h)}),[h,e,d,l]),(0,n.useEffect)((()=>{const e=(()=>{const e=m.data.getBillingAddress();if(e&&!e.country)return(0,H.B)(e.country)[0]})();e&&i("ratepayPhoneCountryCode",e.dialCode)}),[]),!y)return null;const v={isSubmitted:r(),setSubmitted:l};return n.createElement("div",{style:{marginBottom:"20px"}},n.createElement(k.Ay.Provider,{value:v},te.map((e=>n.createElement(J.A,{extraClass:`dynamic-form-field--${e.id}`,field:e,key:e.id,label:s.translate(e.label),onChange:p(e.id)})))))}),[{gateway:"paypalcommercealternativemethods",id:"ratepay"}])}}]);
//# sourceMappingURL=4159-13a0ce32.js.map