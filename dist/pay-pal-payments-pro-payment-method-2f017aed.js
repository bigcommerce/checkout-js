"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[112,9154],{31698:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(31635),r=n(44218),a=n(69440),s=n(70355),o=n(65685),d=n(94611),c=n(11474),u=n(40646),l=n(68801);const h=e=>{const{description:t,isInitializing:n=!1,initializePayment:h,method:m,onUnhandledError:p=a.noop,deinitializePayment:g}=e,[y,b]=(0,s.useState)(!1),[f,v]=(0,s.useState)(),_=function(e){const t=(0,r.B4)(((e=[])=>e.filter(o.A))),n=(0,r.B4)(((e=[])=>e.filter((({trustedShippingAddress:e})=>e)))),{checkoutService:i,checkoutState:a,isUsingMultiShipping:s=!1,method:c}=e,{data:{getCart:u,getConfig:l,getCustomer:h,getInstruments:m,isPaymentDataRequired:p,isPaymentDataSubmitted:g},statuses:{isLoadingInstruments:y}}=a,b=u(),f=l(),v=h();if(!f||!b||!v)throw new Error("Unable to get checkout");const _=t(m(c)),C=n(_);return{instruments:C,isNewAddress:0===C.length&&_.length>0,isInstrumentFeatureAvailable:!g(c.id,c.gateway)&&(0,d.A)({config:f,customer:v,isUsingMultiShipping:s,paymentMethod:c}),isLoadingInstruments:y(),isPaymentDataRequired:p(),loadInstruments:i.loadInstruments}}(e),{isLoadingInstruments:C,instruments:I,isNewAddress:w,isInstrumentFeatureAvailable:P,loadInstruments:S}=_,M=(0,s.useCallback)((()=>{if(!y&&I.length)return(0,a.find)(I,{defaultInstrument:!0})||I[0]}),[y,I]),A=(0,s.useCallback)((()=>{b(!0),v(void 0)}),[]),k=(0,s.useCallback)((e=>{b(!1),v((0,a.find)(I,{bigpayToken:e}))}),[I]);(0,s.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield h({gatewayId:m.gateway,methodId:m.id}),P&&(yield S())}catch(e){p(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield g({gatewayId:m.gateway,methodId:m.id})}catch(e){p(e)}}))})),[]);const E=f||M(),O=n||C,N=P&&(I.length>0||w);return t||P?s.createElement(l.A,{hideContentWhenLoading:!0,isLoading:O},s.createElement("div",{className:"paymentMethod paymentMethod--hosted"},t,N&&s.createElement(c.A,{instruments:I,onSelectInstrument:k,onUseNewInstrument:A,selectedInstrument:E}),P&&s.createElement(u.A,{instrumentId:E&&E.bigpayToken,instruments:I,isAccountInstrument:!0}))):null}},73760:(e,t,n)=>{n.d(t,{PayPalPaymentsProPaymentMethod:()=>H});var i,r,a,s=n(80315),o=n(69440),d=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{d(i.next(e))}catch(e){a(e)}}function o(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))};class c{constructor(e,t){this._paymentIntegrationService=e,this._cardinalClient=t}prepare(e){return d(this,void 0,void 0,(function*(){yield this._cardinalClient.load(e.id,e.config.testMode),yield this._cardinalClient.configure(yield this._getClientToken(e))}))}start(e,t,n,i){return d(this,void 0,void 0,(function*(){const{getCardInstrument:r,getPaymentMethodOrThrow:a}=this._paymentIntegrationService.getState(),{payment:{methodId:s="",paymentData:d={}}={}}=t,c=function(e){return Boolean(e.instrumentId)}(d)&&r(d.instrumentId),u=c?c.iin:i&&i.getBin();u&&(yield this._cardinalClient.runBinProcess(u));try{return yield e((0,o.merge)(t,{payment:{paymentData:{threeDSecure:{token:a(s).clientToken}}}}),n)}catch(e){if(!(e=>"object"==typeof e&&null!==e&&"body"in e)(e)||!(0,o.some)(e.body.errors,{code:"three_d_secure_required"}))throw e;const n=yield this._cardinalClient.getThreeDSecureData(e.body.three_ds_result,this._getOrderData());if(!i)return void(yield this._paymentIntegrationService.submitPayment((0,o.merge)(t.payment,{paymentData:{threeDSecure:n}})));yield i.submit((0,o.merge)(t.payment,{paymentData:{threeDSecure:n}}))}}))}_getClientToken(e){return d(this,void 0,void 0,(function*(){return e.clientToken?e.clientToken:(yield this._paymentIntegrationService.loadPaymentMethod(e.id),this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e.id).clientToken||"")}))}_getOrderData(){const e=this._paymentIntegrationService.getState(),t=e.getBillingAddressOrThrow(),n=e.getShippingAddress(),i=e.getCheckoutOrThrow(),r=e.getOrderOrThrow();return{billingAddress:t,shippingAddress:n,currencyCode:i.cart.currency.code,id:r.orderId.toString(),amount:i.cart.cartAmount}}}class u extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}(a=i||(i={}))[a.MissingBillingAddress=0]="MissingBillingAddress",a[a.MissingCart=1]="MissingCart",a[a.MissingCheckout=2]="MissingCheckout",a[a.MissingConsignments=3]="MissingConsignments",a[a.MissingCustomer=4]="MissingCustomer",a[a.MissingCheckoutConfig=5]="MissingCheckoutConfig",a[a.MissingOrder=6]="MissingOrder",a[a.MissingOrderConfig=7]="MissingOrderConfig",a[a.MissingOrderId=8]="MissingOrderId",a[a.MissingPayment=9]="MissingPayment",a[a.MissingPaymentId=10]="MissingPaymentId",a[a.MissingPaymentInstrument=11]="MissingPaymentInstrument",a[a.MissingPaymentMethod=12]="MissingPaymentMethod",a[a.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",a[a.MissingPaymentStatus=14]="MissingPaymentStatus",a[a.MissingPaymentToken=15]="MissingPaymentToken",a[a.MissingShippingAddress=16]="MissingShippingAddress";class l extends u{constructor(e){super(function(e){switch(e){case i.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case i.MissingCart:return"Unable to proceed because cart data is unavailable.";case i.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case i.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case i.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case i.MissingCheckoutConfig:case i.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case i.MissingOrder:return"Unable to proceed because order data is unavailable.";case i.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case i.MissingPayment:return"Unable to proceed because payment data is unavailable.";case i.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case i.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case i.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}class h extends u{constructor(e){super(e||"Unable to proceed because the client library of a payment method has thrown an unexpected error."),this.name="PaymentMethodFailedError",this.type="payment_method_client_invalid"}}!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(r||(r={}));class m extends u{constructor(e){super(function(e){switch(e){case r.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case r.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case r.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case r.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}const p=[100004,1010,1011,1020];var g,y,b,f,v,_,C;!function(e){e.SetupCompleted="payments.setupComplete",e.Validated="payments.validated"}(g||(g={})),function(e){e.Init="init",e.Complete="complete",e.Confirm="confirm"}(y||(y={})),function(e){e.Success="SUCCESS",e.NoAction="NOACTION",e.Failure="FAILURE",e.Error="ERROR"}(b||(b={})),function(e){e.CCA="CCA",e.Paypal="Paypal",e.Wallet="Wallet",e.VisaCheckout="VisaCheckout",e.ApplePay="ApplePay",e.DiscoverWallet="DiscoverWallet"}(f||(f={})),function(e){e.BinProcess="bin.process"}(v||(v={})),function(e){e.CCA="cca"}(_||(_={})),function(e){e.Yes="Y",e.No="N"}(C||(C={}));class I{constructor(e){this._scriptLoader=e,this._provider="",this._testMode=!1,this._configurationToken=""}load(e,t=!1){return this._provider=e,this._testMode=t,this._sdk||(this._sdk=this._scriptLoader.load(e,t)),this._sdk.then(o.noop)}configure(e){if(this._configurationToken){if(this._configurationToken===e)return Promise.resolve();this._sdk=this._scriptLoader.load(`${this._provider}.${Date.now()}`,this._testMode)}return this._getClientSDK().then((t=>new Promise(((n,r)=>{t.on(g.SetupCompleted,(()=>{t.off(g.SetupCompleted),t.off(g.Validated),this._configurationToken=e,n()})),t.on(g.Validated,(e=>{t.off(g.SetupCompleted),t.off(g.Validated),e.ActionCode===b.Error&&((0,o.includes)(p,e.ErrorNumber)&&r(new l(i.MissingPaymentMethod)),r(new h(e.ErrorDescription)))})),t.setup(y.Init,{jwt:e})}))))}runBinProcess(e){return this._getClientSDK().then((t=>t.trigger(v.BinProcess,e).catch(o.noop))).then((e=>{if(!e||!e.Status)throw new m(r.PaymentNotInitialized)}))}getThreeDSecureData(e,t){return this._getClientSDK().then((n=>new Promise(((i,r)=>{n.on(g.Validated,((e,t)=>{if(n.off(g.Validated),!t)return r(new h(e.ErrorDescription?e.ErrorDescription:"An error was encountered while processing the transaction."));if(!e.ActionCode)return i({token:t});switch(e.ActionCode){case b.Success:return i({token:t});case b.NoAction:return e.ErrorNumber>0?r(new h(e.ErrorDescription)):e.Payment&&e.Payment.ExtendedData&&e.Payment.ExtendedData.SignatureVerification===C.Yes?i({token:t}):r(new h("Transaction signature could not be validated."));case b.Failure:return r(new h("User failed authentication or an error was encountered while processing the transaction."));case b.Error:return r(new h(e.ErrorDescription))}}));const a={AcsUrl:e.acs_url,Payload:e.merchant_data},s=this._mapToPartialOrder(t,e.payer_auth_request);n.continue(_.CCA,a,s)}))))}_mapToPartialOrder(e,t){const n={BillingAddress:this._mapToCardinalAddress(e.billingAddress)};return e.paymentData&&(n.Account=this._mapToCardinalAccount(e.paymentData)),e.billingAddress.email&&(n.Email1=e.billingAddress.email),e.shippingAddress&&(n.ShippingAddress=this._mapToCardinalAddress(e.shippingAddress)),{Consumer:n,OrderDetails:{OrderNumber:e.id,Amount:e.amount,CurrencyCode:e.currencyCode,OrderChannel:"S",TransactionId:t}}}_mapToCardinalAccount(e){return{AccountNumber:Number(e.ccNumber),ExpirationMonth:Number(e.ccExpiry.month),ExpirationYear:Number(e.ccExpiry.year),NameOnAccount:e.ccName,CardCode:Number(e.ccCvv)}}_mapToCardinalAddress(e){const t={FirstName:e.firstName,LastName:e.lastName,Address1:e.address1,City:e.city,State:e.stateOrProvince,PostalCode:e.postalCode,CountryCode:e.countryCode};return e.address2&&(t.Address2=e.address2),e.phone&&(t.Phone1=e.phone),t}_getClientSDK(){if(!this._sdk)throw new m(r.PaymentNotInitialized);return this._sdk}}class w extends u{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}class P{constructor(e,t=window){this._scriptLoader=e,this._window=t}load(e,t){const n=t?"https://songbirdstag.cardinalcommerce.com/edge/v1/songbird.js":"https://static.client.cardinaltrusted.com/songbird/v2.0.0/songbird.js";return this._scriptLoader.loadScript(`${n}?v=${e}`).then((()=>{if(!this._window.Cardinal)throw new w;return this._window.Cardinal}))}}class S extends u{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class M extends u{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}class A extends S{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}var k,E=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{d(i.next(e))}catch(e){a(e)}}function o(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))},O=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};class N{constructor(e){this._paymentIntegrationService=e}execute(e,t){var n,i;return this._isHostedPaymentFormEnabled(null===(n=e.payment)||void 0===n?void 0:n.methodId,null===(i=e.payment)||void 0===i?void 0:i.gatewayId)&&this._shouldRenderHostedForm?this._executeWithHostedForm(e,t):this._executeWithoutHostedForm(e,t)}initialize(e){if(!this._isHostedPaymentFormEnabled(null==e?void 0:e.methodId,null==e?void 0:e.gatewayId)||!this._isHostedFieldAvailable(e))return this._shouldRenderHostedForm=!1,Promise.resolve();const t=e&&e.creditCard&&e.creditCard.form,n=this._paymentIntegrationService.getState(),{paymentSettings:{bigpayBaseUrl:i=""}={}}=n.getStoreConfigOrThrow();if(!t)throw new S;const r=this._paymentIntegrationService.createHostedForm(i,t);return r.attach().then((()=>(this._shouldRenderHostedForm=!0,this._hostedForm=r,Promise.resolve())))}deinitialize(){return this._hostedForm&&this._hostedForm.detach(),Promise.resolve()}finalize(){return Promise.reject(new M)}_executeWithoutHostedForm(e,t){return E(this,void 0,void 0,(function*(){const{payment:n}=e,i=O(e,["payment"]),r=n&&n.paymentData;if(!n||!r)throw new A(["payment.paymentData"]);yield this._paymentIntegrationService.submitOrder(i,t),yield this._paymentIntegrationService.submitPayment(Object.assign(Object.assign({},n),{paymentData:r}))}))}_executeWithHostedForm(e,t){return E(this,void 0,void 0,(function*(){const{payment:n}=e,i=O(e,["payment"]),a=this._hostedForm;if(!a)throw new m(r.PaymentNotInitialized);if(!n||!n.methodId)throw new A(["payment.methodId"]);yield this._paymentIntegrationService.submitOrder(i,t),yield a.validate().then((()=>a.submit(n)))}))}_isHostedPaymentFormEnabled(e,t){return!!e&&!0===this._paymentIntegrationService.getState().getPaymentMethodOrThrow(e,t).config.isHostedFormEnabled}_isHostedFieldAvailable(e){return!(0,o.values)(e&&e.creditCard&&e.creditCard.form.fields).every(o.isNil)}}!function(e){e.ACKNOWLEDGE="ACKNOWLEDGE",e.FINALIZE="FINALIZE",e.INITIALIZE="INITIALIZE"}(k||(k={}));const D=k;var T=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{d(i.next(e))}catch(e){a(e)}}function o(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))};class z extends N{constructor(e,t){super(e),this.paymentIntegrationService=e,this.threeDSecureFlow=t}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return T(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId);n.config.is3dsEnabled&&(yield this.threeDSecureFlow.prepare(n))}))}execute(e,t){const n=Object.create(null,{execute:{get:()=>super.execute}});return T(this,void 0,void 0,(function*(){const{payment:{methodId:i=""}={}}=e,r=this.paymentIntegrationService.getState();return r.getPaymentStatus()===D.ACKNOWLEDGE?(yield this.paymentIntegrationService.submitOrder(Object.assign(Object.assign({},e),{payment:{methodId:i}}),t),Promise.resolve()):r.getPaymentMethodOrThrow(i).config.is3dsEnabled?this.threeDSecureFlow.start(n.execute.bind(this),e,t,this._hostedForm):n.execute.call(this,e,t)}))}}const U=(x=e=>new z(e,new c(e,new I(new P((0,s.vQ)())))),F=[{id:"paypal"}],Object.assign(x,{resolveIds:F}));var x,F,j=n(70355),L=n(5003),B=n(31698);const H=(0,n(19285).A)((({method:e,checkoutService:t,checkoutState:n,paymentForm:i,language:r,onUnhandledError:a})=>{const s=(0,j.useCallback)((n=>{var i;return t.initializePayment(Object.assign(Object.assign({},n),{gatewayId:e.gateway,methodId:e.id,integrations:[...null!==(i=n.integrations)&&void 0!==i?i:[],U]}))}),[t,e]);return"PAYMENT_TYPE_HOSTED"===e.type?j.createElement(B.A,{checkoutService:t,checkoutState:n,deinitializePayment:t.deinitializePayment,initializePayment:s,language:r,method:e,onUnhandledError:a,paymentForm:i}):j.createElement(L.A,{checkoutService:t,checkoutState:n,initializePayment:s,language:r,method:e,onUnhandledError:a,paymentForm:i})}),[{id:"paypal"}])}}]);
//# sourceMappingURL=pay-pal-payments-pro-payment-method-2f017aed.js.map