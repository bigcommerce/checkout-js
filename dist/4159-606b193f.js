"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[4159],{4159:(e,t,a)=>{a.d(t,{PayPalCommerceAPMsPaymentMethod:()=>s,PayPalCommerceButton:()=>z,PayPalCommerceCreditButton:()=>u,PayPalCommerceCreditCardsPaymentMethod:()=>S,PayPalCommerceCreditPaymentMethod:()=>y,PayPalCommerceFastlanePaymentMethod:()=>M,PayPalCommercePaymentMethod:()=>K,PayPalCommerceVenmoPaymentMethod:()=>Y,PaypalCommerceRatePayPaymentMethod:()=>te});var n=a(70355),r=a(29345),i=a(19285),o=a(31635),c=a(6327);const d=({method:e,checkoutService:t,paymentForm:a,onUnhandledError:r,providerOptionsKey:i,providerOptionsData:d,children:s,currentInstrument:l,language:m,shouldConfirmInstrument:u})=>{const y=(0,n.useRef)(null),p=(0,n.useRef)(null),h=(0,n.useRef)(null),f=(0,n.useRef)(!1),v=a.getFieldValue("terms"),g=a.getFieldValue("shouldSaveInstrument"),b=()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const e=yield a.validateForm();return Object.keys(e)})),E=()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(!y.current)return;(yield b()).length?y.current.disable():y.current.enable()})),C=(0,n.useCallback)((()=>{l&&!u?(a.hidePaymentSubmitButton(e,!1),f.current=!1):!f.current&&h.current&&(a.hidePaymentSubmitButton(e,!0),setTimeout((()=>{var e;null===(e=h.current)||void 0===e||e.call(h),f.current=!0}),0))}),[l]);(0,n.useEffect)((()=>{C()}),[C,h.current]),(0,n.useEffect)((()=>{E()}),[v]),(0,n.useEffect)((()=>{p.current={shouldSaveInstrument:u||Boolean(g)}}),[g,u]);return(0,n.useEffect)((()=>((0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,integrations:[c.Rk,c.bg,c.uq,c.xU],[i]:Object.assign({container:"#checkout-payment-continue",shouldRenderPayPalButtonOnInitialization:!1,onRenderButton:()=>{a.hidePaymentSubmitButton(e,!0)},onInit:e=>{h.current=e},submitForm:()=>{a.setSubmitted(!0),a.submitForm()},onError:t=>{a.disableSubmit(e,!0),"INSTRUMENT_DECLINED"===t.message?r(new Error(m.translate("payment.errors.instrument_declined"))):r(t)},onValidate:(e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const n=yield b();return n.length?(a.setSubmitted(!0),n.forEach((e=>a.setFieldTouched(e))),t()):e()})),onInitButton:e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){y.current=e,yield E()})),getFieldsValues:()=>p.current},d||{})})}catch(e){e instanceof Error&&r(e)}})),()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&r(e)}}))})),[]),s?n.createElement(n.Fragment,null,s):n.createElement(n.Fragment,null)},s=(0,i.A)((e=>{const{method:t,checkoutState:a}=e,{isPaymentDataRequired:i}=a.data,{id:o}=t;if(!i())return null;const c=(0,r.A)(o,t.gateway),s={apmFieldsContainer:`#${c}`,apmFieldsStyles:{variables:{fontFamily:"Open Sans, Helvetica Neue, Arial, sans-serif",colorBackground:"transparent",textColor:"black",fontSizeBase:"16px",spacingUnit:"1rem",borderColor:"#d9d9d9",borderRadius:"4px",borderWidth:"1px"},rules:{".Input":{backgroundColor:"white",color:"#333",fontSize:"1rem"},".Input:active":{color:"#4496f6"},".Input--invalid":{color:"#ed6a6a"}}}};return n.createElement(d,Object.assign({providerOptionsData:s,providerOptionsKey:"paypalcommercealternativemethods"},e),n.createElement("div",{className:`widget widget--${o} payment-widget`,id:c}))}),[{gateway:"paypalcommercealternativemethods"}]);var l=a(63582),m=a(4907);const u=(0,i.A)((e=>{const{onUnhandledError:t}=e,a={onComplete:m.A,onError:t};return n.createElement(l.A,Object.assign({additionalInitializationOptions:a,integrations:[c.Bs]},e))}),[{id:"paypalcommercecredit"}]),y=(0,i.A)((e=>{const{checkoutState:t}=e,{isPaymentDataRequired:a}=t.data;return a()?n.createElement(d,Object.assign({providerOptionsKey:"paypalcommercecredit"},e)):null}),[{id:"paypalcommercecredit"}]);var p=a(69440),h=a(45053),f=a(98363),v=a(27883),g=a(35781),b=a(66833),E=a(48407),C=a(31448),I=a(82804),P=a(53783),_=a(68801);const S=(0,i.A)((e=>{const{checkoutService:t,checkoutState:a,paymentForm:r,language:i,method:d}=e,{cardCode:s,showCardHolderName:l,isHostedFormEnabled:m,requireCustomerCode:u}=d.config,[y,S]=(0,n.useState)(),[A,w]=(0,n.useState)(!0),{setFieldTouched:N,setFieldValue:k,setSubmitted:F,submitForm:O}=r,T=(0,E.A)(a),B=(0,C.A)(a),D=s||null===s,R=null==l||l,x=(0,n.useCallback)((e=>`${(0,p.compact)([d.gateway,d.id]).join("-")}-${e}`),[d]),M=(0,n.useCallback)((e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const t=["color","fontFamily","fontSize","fontWeight"],a=!!e&&B(e,d),n=!!e&&T(e,d),r=a||n;let o;return e&&r&&(o=x("ccCvv")),e||(o=x("ccNumber")),{fields:e?{cardCodeVerification:r?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:x("ccCvv"),instrumentId:e.bigpayToken}:void 0,cardNumberVerification:r?{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:x("ccNumber"),instrumentId:e.bigpayToken}:void 0,cardExpiryVerification:r?{accessibilityLabel:i.translate("payment.credit_card_expiry_label"),containerId:x("ccExpiry"),instrumentId:e.bigpayToken}:void 0}:{cardCode:D?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:x("ccCvv")}:void 0,cardExpiry:{accessibilityLabel:i.translate("payment.credit_card_expiration_label"),containerId:x("ccExpiry"),placeholder:i.translate("payment.credit_card_expiration_placeholder_text")},cardName:{accessibilityLabel:i.translate("payment.credit_card_name_label"),containerId:x("ccName")},cardNumber:{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:x("ccNumber")}},styles:o?{default:yield(0,I.A)(o,t),error:yield(0,I.A)(o,t,I.S.Error),focus:yield(0,I.A)(o,t,I.S.Focus)}:{},onBlur:({fieldType:e})=>{y===e&&S(void 0)},onCardTypeChange:({cardType:e})=>{k("hostedForm.cardType",e)},onEnter:()=>{F(!0),O()},onFocus:({fieldType:e})=>{S(e)},onValidate:({errors:e={}})=>{(0,p.forIn)(e,((e,t)=>{const a=`hostedForm.errors.${t}`;k(a,e&&e[0].type?e[0].type:""),e&&e[0]&&N(a)}))}}}))),[y,x,D,R,T,B,i,d,k,N,S,F,O]),z=(0,n.useCallback)((e=>{const t=!!e&&B(e,d),a=!!e&&T(e,d),r=t||a;return n.createElement(f.A,{cardCodeId:a?x("ccCvv"):void 0,cardExpiryId:r?x("ccExpiry"):void 0,cardNumberId:t?x("ccNumber"):void 0,focusedFieldType:y})}),[y,x,T,B,d]),V=t.initializePayment,L=(0,n.useCallback)(((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return V(Object.assign(Object.assign({},e),{integrations:[c.Kv],paypalcommercecreditcards:{form:m?yield M(t):void 0,onLoadComplete:()=>w(!1)}}))}))),[M,V]);return m?n.createElement(_.A,{isLoading:A},n.createElement(h.A,Object.assign({},e,{cardFieldset:n.createElement(v.A,{additionalFields:u&&n.createElement(P.A,{name:"ccCustomerCode"}),cardCodeId:D?x("ccCvv"):void 0,cardExpiryId:x("ccExpiry"),cardNameId:x("ccName"),cardNumberId:x("ccNumber"),focusedFieldType:y}),cardValidationSchema:(0,g.A)({language:i}),deinitializePayment:t.deinitializePayment,getHostedFormOptions:M,getStoredCardValidationFieldset:z,initializePayment:L,storedCardValidationSchema:(0,b.A)({language:i,isCardExpiryRequired:!0})}))):n.createElement(h.A,Object.assign({},e,{deinitializePayment:t.deinitializePayment,initializePayment:L}))}),[{id:"paypalcommercecreditcards"}]);var A=a(9343),w=a(59456),N=a(79026),k=a(56943);const F=({renderPayPalCardComponent:e})=>((0,n.useEffect)((()=>{"function"==typeof e&&e("#paypal-commerce-fastlane-cc-form-container")}),[e]),n.createElement("div",{className:"paypal-commerce-fastlane-cc-form-container","data-test":"paypal-commerce-fastlane-cc-form-container",id:"paypal-commerce-fastlane-cc-form-container"}));var O=a(49655),T=a(35172),B=a(86516),D=a(63163);const R=({onChange:e,handleSelectInstrument:t,selectedInstrument:a})=>{const r=function(e){switch(e.toLowerCase()){case"amex":case"american_express":return"american-express";case"diners":return"diners-club";case"master_card":return"mastercard";default:return e}}(a.brand).toLowerCase();return n.createElement("div",{className:"paypal-commerce-fastlane-instrument","data-test":"paypal-commerce-fastlane-instrument-form"},n.createElement("div",null,n.createElement("div",{className:"paypal-commerce-fastlane-instrument-details"},n.createElement(B.A,{cardType:r}),n.createElement("div",{className:"instrumentSelect-card","data-test":"paypal-fastlane-instrument-last4"},n.createElement("span",null,"●●●● ",a.last4))),n.createElement("div",{className:"paypal-commerce-fastlane-instrument-branding"},n.createElement(T.A,null))),n.createElement("div",{className:"paypal-commerce-fastlane-instrument-change-action"},n.createElement(D.Ay,{onClick:()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof e){const a=yield e();a&&t(a)}})),size:D.Mp.Tiny,testId:"paypal-commerce-fastlane-instrument-change",variant:D.Ak.Secondary},n.createElement(O.A,{id:"common.change_action"}))))},x=({renderPayPalCardComponent:e,showPayPalCardSelector:t})=>{const{instruments:a,handleSelectInstrument:r,selectedInstrument:i}=(()=>{const[e,t]=(0,n.useState)(),{getPaymentProviderCustomer:a}=(0,w.Q)().checkoutState.data,r=a(),i=(0,k.A)(r)?r:{},{paymentForm:o}=(0,N.N)();return{instruments:i.instruments||[],handleSelectInstrument:e=>{t(e),o.setFieldValue("instrumentId",e.bigpayToken)},selectedInstrument:e}})(),o=a.length>0;return(0,n.useEffect)((()=>{!i&&a.length>0&&r(a[0])}),[a,i]),n.createElement("div",{className:"paymentMethod paymentMethod--creditCard"},o&&n.createElement(R,{handleSelectInstrument:r,onChange:t,selectedInstrument:i||a[0]}),!o&&n.createElement(F,{renderPayPalCardComponent:e}))};const M=(0,i.A)((({method:e,checkoutService:t,checkoutState:a,onUnhandledError:r,paymentForm:i,language:d})=>{const s=(0,n.useRef)({}),{isLoadingPaymentMethod:l,isInitializingPayment:m}=a.statuses;(0,n.useEffect)((()=>((0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({methodId:e.id,integrations:[c.oL],paypalcommercefastlane:{onInit:e=>{s.current.renderPayPalCardComponent=e},onChange:e=>{s.current.showPayPalCardSelector=e},onError:e=>{let t;return t=function(e){return"object"==typeof e&&null!==e&&"translationKey"in e}(e)?new Error(d.translate(e.translationKey)):e instanceof Error?e:new Error(d.translate("payment.errors.general_error")),r(t)}}})}catch(e){e instanceof Error&&r(e)}})),()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({methodId:e.id})}catch(e){e instanceof Error&&r(e)}}))})),[]);const u=m()||l(e.id),y={isSubmitted:i.isSubmitted(),setSubmitted:i.setSubmitted};return n.createElement(A.Ay.Provider,{value:y},n.createElement(_.A,{hideContentWhenLoading:!0,isLoading:u},n.createElement(x,{renderPayPalCardComponent:s.current.renderPayPalCardComponent,showPayPalCardSelector:s.current.showPayPalCardSelector})))}),[{id:"paypalcommerceacceleratedcheckout"}]),z=(0,i.A)((e=>{const{onUnhandledError:t}=e,a={onComplete:m.A,onError:t};return n.createElement(l.A,Object.assign({additionalInitializationOptions:a,integrations:[c.yU]},e))}),[{id:"paypalcommerce"}]);var V=a(11474),L=a(40646),j=a(48447),U=a(65685);const q=e=>{const[t,a]=(0,n.useState)(),{checkoutState:r}=(0,w.Q)(),i=r.data.getCustomer(),o=r.data.getInstruments(e)||[],{paymentForm:c}=(0,N.N)(),{setFieldValue:d}=c,s=(0,n.useMemo)((()=>o.filter(U.A)),[o]),l=(0,n.useMemo)((()=>s.filter((e=>e.trustedShippingAddress))),[s]),m=s.length>0,u=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled)&&!e.initializationData.isComplete,y=u&&m,h=y&&!t,f=y&&!!t&&!l.length;(0,n.useEffect)((()=>{a(u?(()=>{if(!l.length)return;return l.filter((({defaultInstrument:e})=>e))[0]||l[0]})():void 0)}),[u,l]),(0,n.useEffect)((()=>{y||d("instrumentId","")}),[d,y]);const v=(0,n.useCallback)((e=>{a((0,p.find)(l,{bigpayToken:e})),d("instrumentId",e),d("shouldSetAsDefaultInstrument",!1)}),[l,d]),g=(0,n.useCallback)((()=>{a(void 0),d("instrumentId",""),d("shouldSaveInstrument",!1),d("shouldSetAsDefaultInstrument",!1)}),[d]);return{trustedAccountInstruments:l,currentInstrument:t,handleSelectInstrument:v,handleUseNewInstrument:g,isInstrumentFeatureAvailable:u,shouldShowInstrumentFieldset:y,shouldCreateNewInstrument:h,shouldConfirmInstrument:f}},K=(0,i.A)((e=>{const{checkoutState:{data:{isPaymentDataRequired:t,getCustomer:a,getInstruments:r},statuses:{isLoadingInstruments:i,isLoadingPaymentMethod:c}},method:{config:{isVaultingEnabled:s},initializationData:{isComplete:l}},method:m,checkoutService:u,onUnhandledError:y}=e,{trustedAccountInstruments:p,currentInstrument:h,handleSelectInstrument:f,handleUseNewInstrument:v,isInstrumentFeatureAvailable:g,shouldShowInstrumentFieldset:b,shouldConfirmInstrument:E}=q(m);if((0,n.useEffect)((()=>{const{isGuest:e}=a()||{};!e&&s&&!l&&(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield u.loadInstruments()}catch(e){e instanceof Error&&y(e)}}))}),[]),!t())return null;const C=i()||c(m.id),I=r()||[];return n.createElement(_.A,{hideContentWhenLoading:!0,isLoading:C},n.createElement(d,Object.assign({currentInstrument:h,providerOptionsKey:"paypalcommerce",shouldConfirmInstrument:E},e),b&&n.createElement(V.A,{instruments:p,onSelectInstrument:f,onUseNewInstrument:v,selectedInstrument:h}),E&&n.createElement("div",null,n.createElement(j.A,{id:"payment.account_instrument_new_shipping_address"})),g&&n.createElement(L.A,{instrumentId:null==h?void 0:h.bigpayToken,instruments:I,isAccountInstrument:!0})))}),[{id:"paypalcommerce"}]),Y=(0,i.A)((e=>{const{checkoutState:t}=e,{isPaymentDataRequired:a}=t.data;return a()?n.createElement(d,Object.assign({providerOptionsKey:"paypalcommercevenmo"},e)):null}),[{id:"paypalcommercevenmo"}]);var $=a(20874),H=a(25657),W=a(33740),G=a(41410),J=a(44218),Q=a(94202);const X=(0,J.Bj)((function({formFieldData:e,language:t}){const a={ratepayPhoneCountryCode:"payment.ratepay.phone_country_code",ratepayPhoneNumber:"payment.ratepay.phone_number",ratepayBirthDate:"payment.ratepay.birth_date"};return(0,Q.Ik)(e.reduce(((e,{id:n,required:r})=>(r&&a[n]&&(e[n]=(0,Q.Yj)().nullable().required(t.translate("payment.ratepay.errors.isRequired",{fieldName:t.translate(a[n])})),"ratepayPhoneCountryCode"===n&&(e[n]=e[n].matches(/^\+\d{2,}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_country_code")}))),"ratepayPhoneNumber"===n&&(e[n]=e[n].matches(/^\d{7,11}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_number")})))),e)),{}))})),Z="ITEM_CATEGORY_NOT_SUPPORTED_BY_PAYMENT_SOURCE",ee=[{name:"ratepayBirthDate",custom:!1,id:"ratepayBirthDate",label:"payment.ratepay.birth_date",required:!0,fieldType:W.A.DATE,inputDateFormat:"dd.MM.yyyy"},{name:"ratepayPhoneCountryCode",custom:!1,id:"ratepayPhoneCountryCode",label:"payment.ratepay.phone_country_code",required:!0,fieldType:W.A.TEXT,type:"string"},{name:"ratepayPhoneNumber",custom:!1,id:"ratepayPhoneNumber",label:"payment.ratepay.phone_number",required:!0,fieldType:W.A.TEXT}],te=(0,i.A)((({method:e,checkoutService:t,onUnhandledError:a,paymentForm:{isSubmitted:r,setFieldValue:i,setValidationSchema:d,setSubmitted:s},language:l,checkoutState:m})=>{const u=(0,n.useRef)({}),y=m.data.isPaymentDataRequired();(0,n.useEffect)((()=>((0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,integrations:[c.gi],paypalcommerceratepay:{container:"#checkout-payment-continue",legalTextContainer:"legal-text-container",loadingContainerId:"checkout-page-container",getFieldsValues:()=>Object.assign(Object.assign({},{ratepayBirthDate:{getDate:()=>0,getMonth:()=>0,getFullYear:()=>0},ratepayPhoneCountryCode:"",ratepayPhoneNumber:""}),u.current),onError:e=>{var t,n;const r=null===(t=e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error));if(null==r?void 0:r.length){let e,t;const i=null===(n=r[0].provider_error)||void 0===n?void 0:n.code;switch(i){case"PAYMENT_SOURCE_DECLINED_BY_PROCESSOR":e="payment.ratepay.errors.paymentSourceDeclinedByProcessor";break;case"PAYMENT_SOURCE_INFO_CANNOT_BE_VERIFIED":e="payment.ratepay.errors.paymentSourceInfoCannotBeVerified";break;case Z:e="payment.ratepay.errors.itemCategoryNotSupportedByPaymentSource";break;default:e="common.error_heading"}return t=i!==Z?new H.A({data:{shouldBeTranslatedAsHtml:!0,translationKey:e}}):new Error(l.translate(e)),a(t)}a(e)}}})}catch(e){e instanceof Error&&a(e)}})),()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&a(e)}}))})),[]);const p=(0,n.useCallback)((e=>t=>{var a;i(e,t),a={[e]:t},u.current=Object.assign(Object.assign({},u.current),a)}),[i]),h=(0,n.useMemo)((()=>X({formFieldData:ee,language:l})),[l,ee]);if((0,n.useEffect)((()=>{s(!1),d(e,h)}),[h,e,d,s]),(0,n.useEffect)((()=>{const e=(()=>{const e=m.data.getBillingAddress();if(e&&!e.country)return(0,$.B)(e.country)[0]})();e&&i("ratepayPhoneCountryCode",e.dialCode)}),[]),!y)return null;const f={isSubmitted:r(),setSubmitted:s};return n.createElement("div",{style:{marginBottom:"20px"}},n.createElement(A.Ay.Provider,{value:f},ee.map((e=>n.createElement(G.A,{extraClass:`dynamic-form-field--${e.id}`,field:e,key:e.id,label:l.translate(e.label),onChange:p(e.id)})))))}),[{gateway:"paypalcommercealternativemethods",id:"ratepay"}])}}]);
//# sourceMappingURL=4159-606b193f.js.map