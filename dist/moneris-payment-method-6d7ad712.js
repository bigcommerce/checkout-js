"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[6051,9154],{12929:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355),a=n(49655),r=n(88186),s=n(30680);const o=({appearFocused:e,id:t,name:n})=>{const o=(0,i.useCallback)((()=>i.createElement(r.A,{appearFocused:e,id:t})),[t,e]);return i.createElement(s.A,{additionalClassName:"form-field--ccExpiry",input:o,labelContent:i.createElement(a.A,{id:"payment.credit_card_expiration_label"}),name:n})}},36659:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(70355),a=n(49655),r=n(88186),s=n(30680),o=n(14456);const d=({appearFocused:e,id:t,name:n})=>{const d=(0,i.useCallback)((()=>i.createElement(i.Fragment,null,i.createElement(r.A,{additionalClassName:"has-icon",appearFocused:e,id:t}),i.createElement(o.A,null))),[t,e]);return i.createElement(s.A,{additionalClassName:"form-field--ccNumber",input:d,labelContent:i.createElement(a.A,{id:"payment.credit_card_number_label"}),name:n})}},39527:(e,t,n)=>{n.d(t,{i:()=>l});var i=n(31635),a=n(69440),r=n(70355),s=n(82804),o=n(48407),d=n(31448),c=n(98363);const l=({checkoutState:e,method:t,language:n,paymentForm:l})=>{const{setFieldTouched:u,setFieldValue:m,setSubmitted:p,submitForm:h}=l,{config:g}=t,{cardCode:y}=g,b=y||null===y,v=(0,o.A)(e),f=(0,d.A)(e),I=(0,r.useCallback)((e=>`${(0,a.compact)([t.gateway,t.id]).join("-")}-${e}`),[t]),[C,_]=(0,r.useState)();return{getHostedStoredCardValidationFieldset:(0,r.useCallback)((e=>{const n=!!e&&f(e,t),i=!!e&&v(e,t);return r.createElement(c.A,{cardCodeId:i?I("ccCvv"):void 0,cardNumberId:n?I("ccNumber"):void 0,focusedFieldType:C})}),[C,I,v,f,t]),getHostedFormOptions:(0,r.useCallback)((e=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){const i=["color","fontFamily","fontSize","fontWeight"],r=!!e&&f(e,t),o=!!e&&v(e,t);let d;return e?o?d=I("ccCvv"):r&&(d=I("ccNumber")):d=I("ccNumber"),{fields:e?{cardCodeVerification:o&&e?{accessibilityLabel:n.translate("payment.credit_card_cvv_label"),containerId:I("ccCvv"),instrumentId:e.bigpayToken}:void 0,cardNumberVerification:r&&e?{accessibilityLabel:n.translate("payment.credit_card_number_label"),containerId:I("ccNumber"),instrumentId:e.bigpayToken}:void 0}:{cardCode:b?{accessibilityLabel:n.translate("payment.credit_card_cvv_label"),containerId:I("ccCvv")}:void 0,cardExpiry:{accessibilityLabel:n.translate("payment.credit_card_expiration_label"),containerId:I("ccExpiry"),placeholder:n.translate("payment.credit_card_expiration_placeholder_text")},cardName:{accessibilityLabel:n.translate("payment.credit_card_name_label"),containerId:I("ccName")},cardNumber:{accessibilityLabel:n.translate("payment.credit_card_number_label"),containerId:I("ccNumber")}},styles:d?{default:yield(0,s.A)(d,i),error:yield(0,s.A)(d,i,s.S.Error),focus:yield(0,s.A)(d,i,s.S.Focus)}:{},onBlur:({fieldType:e})=>{C===e&&_(void 0)},onCardTypeChange:({cardType:e})=>{m("hostedForm.cardType",e)},onEnter:()=>{p(!0),h()},onFocus:({fieldType:e})=>{_(e)},onValidate:({errors:e={}})=>{(0,a.forIn)(e,((e=[],t)=>{var n,i;const a=`hostedForm.errors.${t}`;m(a,null!==(i=null===(n=e[0])||void 0===n?void 0:n.type)&&void 0!==i?i:""),e[0]&&u(a)}))}}}))),[C,I,b,v,f,n,t,u,m,p,h])}}},47459:(e,t,n)=>{n.d(t,{A:()=>u});var i=n(70355),a=n(90767),r=n(49655),s=n(88186),o=n(30680),d=n(97429),c=n(2224),l=n(14456);const u=({appearFocused:e,id:t,name:n})=>{const u=(0,i.useCallback)((()=>i.createElement(i.Fragment,null,i.createElement(s.A,{additionalClassName:"has-icon",appearFocused:e,id:t}),i.createElement(l.A,null))),[t,e]),m=(0,i.useMemo)((()=>i.createElement(i.Fragment,null,i.createElement(r.A,{id:"payment.credit_card_cvv_label"}),i.createElement(d.A,{placement:"top-start",tooltip:i.createElement(a.A,null)},i.createElement("span",{className:"has-tip"},i.createElement(c.A,null))))),[]);return i.createElement(o.A,{additionalClassName:"form-ccFields-field--ccCvv",input:u,labelContent:m,name:n})}},59713:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(69440);function a(e,t,n){const a=window.getComputedStyle(e,n);return t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:a.getPropertyValue((0,i.kebabCase)(t))})),{})}},66833:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(44218),a=n(94202);const r=(0,i.Bj)((function({language:e,isCardExpiryRequired:t=!1}){return(0,a.Ik)().shape({instrumentId:(0,a.Yj)().required(),hostedForm:(0,a.Ik)().required().shape({errors:(0,a.Ik)().required().shape(Object.assign({cardCodeVerification:(0,a.Yj)().test({message:e.translate("payment.credit_card_cvv_required_error"),test:e=>"required"!==e}).test({message:e.translate("payment.credit_card_cvv_invalid_error"),test:e=>"invalid_card_code"!==e}),cardNumberVerification:(0,a.Yj)().test({message:e.translate("payment.credit_card_number_required_error"),test:e=>"required"!==e}).test({message:e.translate("payment.credit_card_number_invalid_error"),test:e=>"invalid_card_number"!==e}).test({message:e.translate("payment.credit_card_number_mismatch_error"),test:e=>"mismatched_card_number"!==e})},t?{cardExpiryVerification:(0,a.Yj)().test({message:e.translate("payment.credit_card_expiration_required_error"),test:e=>"required"!==e}).test({message:e.translate("payment.credit_card_expiration_invalid_error"),test:e=>"invalid_card_expiry"!==e})}:{}))})})}))},82804:(e,t,n)=>{n.d(t,{A:()=>u,S:()=>i});var i,a=n(69440),r=n(70355),s=n(54622),o=n(59713),d=n(9343),c=n(85216),l=n(10156);function u(e,t,n=i.Default){const u=document.createElement("div"),m=document.getElementById(e);if(!m)throw new Error("Unable to retrieve input styles as the provided container ID is not valid.");return m.appendChild(u),new Promise((e=>{s.render(r.createElement(d.Ay.Provider,{value:{isSubmitted:!0,setSubmitted:a.noop}},r.createElement(c.A,{hasError:n===i.Error},r.createElement(l.A,{appearFocused:n===i.Focus,ref:n=>{n&&(e((0,o.A)(n,t)),s.unmountComponentAtNode(u),u.parentElement&&u.parentElement.removeChild(u))}}))),u)}))}!function(e){e.Default="default",e.Error="error",e.Focus="focus"}(i||(i={}))},83147:(e,t,n)=>{n.d(t,{MonerisPaymentMethod:()=>A});var i,a,r,s=n(31635),o=n(69440);class d extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class c extends d{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}(r=i||(i={}))[r.MissingBillingAddress=0]="MissingBillingAddress",r[r.MissingCart=1]="MissingCart",r[r.MissingCheckout=2]="MissingCheckout",r[r.MissingConsignments=3]="MissingConsignments",r[r.MissingCustomer=4]="MissingCustomer",r[r.MissingCheckoutConfig=5]="MissingCheckoutConfig",r[r.MissingOrder=6]="MissingOrder",r[r.MissingOrderConfig=7]="MissingOrderConfig",r[r.MissingOrderId=8]="MissingOrderId",r[r.MissingPayment=9]="MissingPayment",r[r.MissingPaymentId=10]="MissingPaymentId",r[r.MissingPaymentInstrument=11]="MissingPaymentInstrument",r[r.MissingPaymentMethod=12]="MissingPaymentMethod",r[r.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",r[r.MissingPaymentStatus=14]="MissingPaymentStatus",r[r.MissingPaymentToken=15]="MissingPaymentToken",r[r.MissingShippingAddress=16]="MissingShippingAddress";class l extends d{constructor(e){super(function(e){switch(e){case i.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case i.MissingCart:return"Unable to proceed because cart data is unavailable.";case i.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case i.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case i.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case i.MissingCheckoutConfig:case i.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case i.MissingOrder:return"Unable to proceed because order data is unavailable.";case i.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case i.MissingPayment:return"Unable to proceed because payment data is unavailable.";case i.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case i.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case i.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}class u extends c{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}class m extends d{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}!function(e){e[e.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",e[e.CustomerNotInitialized=1]="CustomerNotInitialized",e[e.PaymentNotInitialized=2]="PaymentNotInitialized",e[e.ShippingNotInitialized=3]="ShippingNotInitialized",e[e.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized"}(a||(a={}));class p extends d{constructor(e){super(function(e){switch(e){case a.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case a.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case a.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case a.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}var h=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{d(i.next(e))}catch(e){r(e)}}function o(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}d((i=i.apply(e,t||[])).next())}))};const g="moneris-payment-iframe";class y{constructor(e){this.paymentIntegrationService=e}initialize(e){return h(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState(),{moneris:n,methodId:a}=e;if(!a)throw new c('Unable to initialize payment because "methodId" argument is not provided.');if(!n)throw new c('Unable to initialize payment because "options.moneris" argument is not provided.');this.initializeOptions=n;const{config:r,initializationData:s}=t.getPaymentMethodOrThrow(a);if(!(null==s?void 0:s.profileId))throw new l(i.MissingPaymentMethod);return n.form&&this.shouldShowTSVHostedForm(a)&&(this.hostedForm=yield this.mountCardVerificationfields(n.form)),this.iframe||(this.iframe=this.createIframe(n.containerId,s,!!r.testMode)),Promise.resolve()}))}execute(e,t){return h(this,void 0,void 0,(function*(){const{payment:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(n[i[a]]=e[i[a]])}return n}(e,["payment"]);if(!n)throw new u(["payment"]);const{isStoreCreditApplied:a}=this.paymentIntegrationService.getState().getCheckoutOrThrow();var r;if(a&&(yield this.paymentIntegrationService.applyStoreCredit(a)),yield this.paymentIntegrationService.submitOrder(i,t),!n.paymentData||(r=n.paymentData,!Boolean(r.instrumentId)))return this.executeWithCC(n);yield this.executeWithVaulted(n)}))}finalize(){return Promise.reject(new m)}deinitialize(){return this.hostedForm&&this.hostedForm.detach(),this.windowEventListener&&(window.removeEventListener("message",this.windowEventListener),this.windowEventListener=void 0),this.iframe&&this.iframe.parentNode&&(this.iframe.parentNode.removeChild(this.iframe),this.iframe=void 0),Promise.resolve()}executeWithCC(e){return h(this,void 0,void 0,(function*(){const t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e.methodId).config.testMode,n=e.paymentData||{},i="object"!=typeof(r=n)||null===r||void 0!==r.shouldSaveInstrument&&"boolean"!=typeof r.shouldSaveInstrument||void 0!==r.shouldSetAsDefaultInstrument&&"boolean"!=typeof r.shouldSetAsDefaultInstrument?{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1}:n;var r;const{shouldSaveInstrument:s,shouldSetAsDefaultInstrument:o}=i,d=yield new Promise(((e,n)=>{if(!this.iframe)throw new p(a.PaymentNotInitialized);const i=this.iframe.contentWindow;if(null===i)throw new p(a.PaymentNotInitialized);i.postMessage("tokenize",this.monerisURL(!!t)),this.windowEventListener=i=>{if("string"==typeof i.data&&i.origin===`https://${t?"esqa":"www3"}.moneris.com`)try{e(this.handleMonerisResponse(i))}catch(e){n(e)}},window.addEventListener("message",this.windowEventListener)}));void 0!==d&&(yield this.paymentIntegrationService.submitPayment({methodId:e.methodId,paymentData:{nonce:d,shouldSaveInstrument:s,shouldSetAsDefaultInstrument:o}}))}))}executeWithVaulted(e){return h(this,void 0,void 0,(function*(){if(this.hostedForm){const t=this.hostedForm;return yield t.validate(),yield t.submit(e),this.paymentIntegrationService.loadCurrentOrder()}return this.paymentIntegrationService.submitPayment(e)}))}shouldShowTSVHostedForm(e){return this.isHostedPaymentFormEnabled(e)&&this.isHostedFieldAvailable()}isHostedPaymentFormEnabled(e){const t=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(e);return Boolean(t.config.isHostedFormEnabled)}isHostedFieldAvailable(){var e;const t=this.getInitializeOptions(),n=(0,o.omitBy)(null===(e=t.form)||void 0===e?void 0:e.fields,o.isEmpty);return!(0,o.isEmpty)(n)}getInitializeOptions(){if(!this.initializeOptions)throw new p(a.PaymentNotInitialized);return this.initializeOptions}mountCardVerificationfields(e){var t;return h(this,void 0,void 0,(function*(){const n=null===(t=this.paymentIntegrationService.getState().getStoreConfig())||void 0===t?void 0:t.paymentSettings.bigpayBaseUrl;if(!n)throw new l(i.MissingCheckoutConfig);const a=this.paymentIntegrationService.createHostedForm(n,e);return yield a.attach(),a}))}createIframe(e,t,n,i){const a=document.getElementById(e);if(!a)throw new c("Unable to create iframe without valid container ID.");const r=document.createElement("iframe"),s={id:t.profileId,pmmsg:!0,display_labels:1,enable_exp:1,enable_cvd:1,css_body:(null==i?void 0:i.cssBody)||"font-family: Arial, Helvetica,sans-serif;background: transparent;",css_textbox:(null==i?void 0:i.cssTextbox)||"border-radius:4px;border: 2px solid rgb(00,00,00);width: 100%;font-weight: 600;padding: 8px 8px;outline: 0;",css_textbox_pan:(null==i?void 0:i.cssTextboxCardNumber)||"width: 240px;",css_textbox_exp:(null==i?void 0:i.cssTextboxExpiryDate)||"margin-bottom: 0;width: calc(30% - 12px);",css_textbox_cvd:(null==i?void 0:i.cssTextboxCVV)||"margin-bottom: 0;width: calc(30% - 12px);",css_input_label:(null==i?void 0:i.cssInputLabel)||"font-size: 10px;position: relative;top: 8px;left: 6px;background: rgb(255,255,255);padding: 3px 2px;color: rgb(66,66,66);font-weight: 600;z-index: 2;",pan_label:t.creditCardLabel||"Credit Card Number",exp_label:t.expiryDateLabel||"Expiration",cvd_label:t.cvdLabel||"CVD"},d=(0,o.map)(s,((e,t)=>`${t}=${e}`)).join("&");return r.width="100%",r.height="100%",r.name=g,r.id=g,r.style.border="none",r.src=`${this.monerisURL(n)}?${d}`,r.allow="payment",a.appendChild(r),r}handleMonerisResponse(e){const t=JSON.parse(e.data);if("001"!==t.responseCode[0])throw new Error(t.errorMessage);return t.dataKey}monerisURL(e){return`https://${e?"esqa":"www3"}.moneris.com/HPPtoken/index.php`}}const b=(v=e=>new y(e),f=[{id:"moneris"}],Object.assign(v,{resolveIds:f}));var v,f,I=n(70355),C=n(39527),_=n(66833),w=n(89799),E=n(48407),S=n(31448);const A=(0,n(19285).A)((e=>{var{language:t,paymentForm:n,checkoutState:i,checkoutService:a,method:r}=e,d=(0,s.__rest)(e,["language","paymentForm","checkoutState","checkoutService","method"]);const c="moneris-iframe-container",{getHostedStoredCardValidationFieldset:l,getHostedFormOptions:u}=(0,C.i)({checkoutState:i,method:r,language:t,paymentForm:n}),m=(0,_.A)({language:t}),{hidePaymentSubmitButton:p,disableSubmit:h,setFieldValue:g,setSubmit:y,setValidationSchema:v}=n,f=i.data.getInstruments(r)||[],{data:{getCheckout:A,isPaymentDataRequired:x},statuses:{isLoadingInstruments:k}}=i,M=A(),F=i.data.getCustomer(),P=!(null==F?void 0:F.isGuest)&&Boolean(r.config.isVaultingEnabled),N=(0,I.useCallback)(((e,t)=>(0,s.__awaiter)(void 0,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},e),{integrations:[b],moneris:Object.assign({containerId:c},t&&{form:yield u(t)})});return a.initializePayment(n)}))),[c,u,a]);return I.createElement(w.A,Object.assign({containerId:c,deinitializePayment:a.deinitializePayment,disableSubmit:h,hidePaymentSubmitButton:p,initializePayment:N,instruments:f,isInstrumentCardCodeRequired:(0,E.A)(i),isInstrumentCardNumberRequired:(0,S.A)(i),isInstrumentFeatureAvailable:P,isLoadingInstruments:k(),isPaymentDataRequired:x(),isSignedIn:(0,o.some)(null==M?void 0:M.payments,{providerId:r.id}),loadInstruments:a.loadInstruments,method:r,setFieldValue:g,setSubmit:y,setValidationSchema:v,signOut:a.signOutCustomer,storedCardValidationSchema:m,validateInstrument:(e,t)=>l(t)},d))}),[{id:"moneris"}])},88186:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(31635),a=n(3375),r=n.n(a),s=n(70355);const o=e=>{var{additionalClassName:t,appearFocused:n,testId:a}=e,o=(0,i.__rest)(e,["additionalClassName","appearFocused","testId"]);return s.createElement("div",Object.assign({},o,{className:r()("form-input","optimizedCheckout-form-input",{"form-input--focus":n},{"optimizedCheckout-form-input--focus":n},t),"data-test":a}))}},89799:(e,t,n)=>{n.d(t,{A:()=>f});var i=n(31635),a=n(69440),r=n(70355),s=n(52137),o=n(43125),d=n(11474),c=n(62677),l=n(40646),u=n(91182),m=n(3375),p=n.n(m),h=n(72769),g=n(49655);const y=({buttonId:e,shouldShowEditButton:t})=>{if(t){const t=r.createElement(g.A,{id:"remote.select_different_card_action"});return r.createElement("p",null,r.createElement("button",{className:p()("stepHeader","widget-link-amazonpay"),id:e,onClick:(0,h.A)(),type:"button"},t))}return null},b=({shouldShowDescriptor:e,paymentDescriptor:t})=>e&&t?r.createElement("div",{className:"payment-descriptor"},t):null,v=({additionalContainerClassName:e,containerId:t,hideContentWhenSignedOut:n,hideWidget:i,isSignInRequired:a,isSignedIn:s,method:o,renderCustomPaymentForm:d,shouldRenderCustomInstrument:c,shouldShowCreditCardFieldset:l})=>r.createElement("div",{className:p()("widget",`widget--${o.id}`,"payment-widget",c?"":e),id:t,style:{display:n&&a&&!s||!l||i?"none":void 0},tabIndex:-1},c&&d&&d()),f=({instruments:e,hideWidget:t=!1,isInitializing:n=!1,isAccountInstrument:m,isInstrumentFeatureAvailable:p,isLoadingInstruments:h,shouldHideInstrumentExpiryDate:g=!1,shouldShow:f=!0,hideVerificationFields:I,method:C,storedCardValidationSchema:_,isPaymentDataRequired:w,setValidationSchema:E,loadInstruments:S,onUnhandledError:A=a.noop,deinitializeCustomer:x,deinitializePayment:k,setSubmit:M,initializeCustomer:F,initializePayment:P,signInCustomer:N,isSignedIn:z,isSignInRequired:O,isInstrumentCardNumberRequired:T,validateInstrument:U,containerId:V,hideContentWhenSignedOut:D=!1,renderCustomPaymentForm:q,additionalContainerClassName:R,shouldRenderCustomInstrument:j=!1,paymentDescriptor:L,shouldShowDescriptor:B,shouldShowEditButton:H,buttonId:W,setFieldValue:$})=>{const[Y,J]=(0,r.useState)(!1),[G,K]=(0,r.useState)(void 0),Q=(0,r.useRef)(e);(0,r.useEffect)((()=>{Q.current=e}),[e]);const X=(0,r.useCallback)((()=>{if(Y)return;const e=Q.current.find((e=>e.defaultInstrument))||Q.current[0];return e?e.bigpayToken:void 0}),[Y]),Z=(0,r.useCallback)((()=>{const e=G||X();return(0,a.find)(Q.current,{bigpayToken:e})}),[G,X]),ee=(0,r.useCallback)((()=>{if(!w)return null;const e=Z();return p&&e&&_||null}),[Z,p,w,_]),te=(0,r.useCallback)(((e,t)=>!e&&(0,s.T)(t)?t:void 0),[]),ne=(0,r.useCallback)((t=>{if(0===e.length)return J(!0),K(void 0),void $("instrumentId","");if(G===t){const e=X();K(e),$("instrumentId",e)}}),[e,G,X]),ie=(0,r.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){J(!0),K(void 0),k&&(yield k({gatewayId:C.gateway,methodId:C.id})),P&&(yield P({gatewayId:C.gateway,methodId:C.id}))}))),[C,k,P]),ae=(0,r.useCallback)((e=>{J(!1),K(e)}),[]),re=(0,r.useCallback)((()=>{const t=G||X(),n=(0,a.find)(e,{bigpayToken:t});if(n){(0,o.A)(n);const e=T(n,C);if(I)return;if(U)return U(e,n)}}),[G,X,e,C,I,U]),se=()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){const e=Q.current;if(!w)return void M(C,null);if(O&&!z)return M(C,N||null),F?F({methodId:C.id}):void 0;let t;if(M(C,null),!Y){const n=G||X(),i=e.find((e=>e.bigpayToken===n))||e[0];i&&(0,o.a)(i)&&(t=i)}return P?P({gatewayId:C.gateway,methodId:C.id},t):void 0})),oe=G||X(),de=oe&&e.find((e=>e.bigpayToken===oe))||e[0],ce=e.filter((e=>!(0,s.T)(e))),le=e.filter((e=>(0,s.T)(e))),ue=p&&e.length>0,me=!ue||Y,pe=(n||h)&&!t,he=de?te(Y,de):void 0,ge=e[0]&&(0,s.T)(e[0]);(0,r.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){E(C,ee());try{p&&(yield null==S?void 0:S()),yield se()}catch(e){e instanceof Error&&A(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){E(C,null),M(C,null);try{k&&(yield k({gatewayId:C.gateway,methodId:C.id})),x&&(yield x({methodId:C.id}))}catch(e){e instanceof Error&&A(e)}}))})),[]);const ye=(0,r.useRef)(!0),be=(0,r.useRef)(e.length),ve=(0,r.useRef)(w),fe=(0,r.useRef)(G);return(0,r.useEffect)((()=>{if(ye.current)return void(ye.current=!1);E(C,ee());(fe.current!==G||Number(be.current)>0&&0===e.length||ve.current!==w)&&(fe.current=G,be.current=e.length,ve.current=w,(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{k&&(yield k({gatewayId:C.gateway,methodId:C.id})),yield se()}catch(e){e instanceof Error&&A(e)}})))}),[G,e,w]),f?r.createElement(u.A,{hideContentWhenLoading:!0,isLoading:pe},r.createElement("div",{className:"paymentMethod--hosted"},ge&&ue&&r.createElement(d.A,{instruments:le,onSelectInstrument:ae,onUseNewInstrument:ie,selectedInstrument:he}),!ge&&ue&&r.createElement(c.A,{instruments:ce,onDeleteInstrument:ne,onSelectInstrument:ae,onUseNewInstrument:ie,selectedInstrumentId:oe,shouldHideExpiryDate:g,validateInstrument:re()}),r.createElement(b,{paymentDescriptor:L,shouldShowDescriptor:B}),r.createElement(v,{additionalContainerClassName:R,containerId:V,hideContentWhenSignedOut:D,hideWidget:t,isSignInRequired:O,isSignedIn:z,method:C,renderCustomPaymentForm:q,shouldRenderCustomInstrument:j,shouldShowCreditCardFieldset:me}),p&&r.createElement(l.A,{instrumentId:oe,instruments:e,isAccountInstrument:Boolean(m||ge)}),r.createElement(y,{buttonId:W,shouldShowEditButton:H}))):r.createElement("div",{style:{display:"none"}})}},98363:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(70355),a=n(49655),r=n(36659),s=n(47459),o=n(12929);const d=({cardCodeId:e,cardNumberId:t,cardExpiryId:n,focusedFieldType:d})=>i.createElement(i.Fragment,null,t&&i.createElement("p",null,i.createElement("strong",null,i.createElement(a.A,{id:"payment.instrument_trusted_shipping_address_title_text"})),i.createElement("br",null),i.createElement(a.A,{id:"payment.instrument_trusted_shipping_address_text"})),i.createElement("div",{className:"form-ccFields"},t&&i.createElement(r.A,{appearFocused:"cardNumber"===d,id:t,name:"hostedForm.errors.cardNumberVerification"}),e&&i.createElement(s.A,{appearFocused:"cardCode"===d,id:e,name:"hostedForm.errors.cardCodeVerification"}),n&&i.createElement(o.A,{appearFocused:"cardExpiry"===d,id:n,name:"hostedForm.errors.cardExpiryVerification"})))}}]);
//# sourceMappingURL=moneris-payment-method-6d7ad712.js.map