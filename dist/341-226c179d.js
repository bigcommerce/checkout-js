"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[341],{31341:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var n=a(31635),r=a(14371),i=a(30455),o=a(41109),s=a(49655);const c=function(e){var t=e.children;return i.createElement("header",{className:"cart-header"},i.createElement("h3",{className:"cart-title optimizedCheckout-headingSecondary"},i.createElement(s.A,{id:"cart.cart_heading"})),t)};var l=a(62901),E=a(66317),u=a(62755),m=a(60164),d=a(97947),N=a(9660),R=a(6357),A=a(58330),L=a(45293),p=a(84744),f="https://yx1041xohb.execute-api.us-east-2.amazonaws.com/Prod/",T=function(){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){var e;return(0,n.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,fetch("/customer/current.jwt?app_client_id=bzhkzdt0f7vrrg92o4iym8rxvd872qj",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}})];case 1:return[4,t.sent().json()];case 2:return[2,t.sent().token];case 3:return e=t.sent(),console.error("Error fetching token:",e),[2,null];case 4:return[2]}}))}))},O=function(e){return{Accept:"application/json","Content-Type":"application/json","X-Current-Customer":e}},h=function(e){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){var t,a,r;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,T()];case 1:if(!(t=n.sent()))throw new Error("Token not available");return a=O(t),[4,p.A.post("".concat(f,"createTransaction"),e,{headers:a})];case 2:return[2,n.sent().data];case 3:throw r=n.sent(),console.error("Error validating with avalara:",r),r;case 4:return[2]}}))}))},C=function(e){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){var t,a,r,i;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,T()];case 1:if(!(t=n.sent()))throw new Error("Token not available");return a={Accept:"application/json","Content-Type":"application/json","X-Current-Customer":t},[4,p.A.post("".concat(f,"/create"),e,{headers:a})];case 2:if(200!==(r=n.sent()).status)throw new Error("Error submitting the form: ".concat(r.statusText));return[2,r.data];case 3:throw i=n.sent(),console.error("Error creating certificate:",i),i;case 4:return[2]}}))}))},v=a(71055),M=a(46522);const S={Alabama:"AL",Alaska:"AK",Arizona:"AZ",Arkansas:"AR",California:"CA",Colorado:"CO",Connecticut:"CT",Delaware:"DE",Florida:"FL",Georgia:"GA",Hawaii:"HI",Idaho:"ID",Illinois:"IL",Indiana:"IN",Iowa:"IA",Kansas:"KS",Kentucky:"KY",Louisiana:"LA",Maine:"ME",Maryland:"MD",Massachusetts:"MA",Michigan:"MI",Minnesota:"MN",Mississippi:"MS",Missouri:"MO",Montana:"MT",Nebraska:"NE",Nevada:"NV","New Hampshire":"NH","New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND",Ohio:"OH",Oklahoma:"OK",Oregon:"OR",Pennsylvania:"PA","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD",Tennessee:"TN",Texas:"TX",Utah:"UT",Vermont:"VT",Virginia:"VA",Washington:"WA","West Virginia":"WV",Wisconsin:"WI",Wyoming:"WY"};const g={Alabama:["RESALE","TRIBAL GOVERNMENT"],Alaska:["RESALE"],Alberta:[],"American Samoa":[],Arizona:["RESALE","TRIBAL GOVERNMENT"],Arkansas:["RESALE"],"British Columbia":["RESALE","TRIBAL GOVERNMENT"],California:["RESALE","TRIBAL GOVERNMENT"],"Canada (GST)":["TRIBAL GOVERNMENT"],Colorado:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Connecticut:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Delaware:[],"District Of Columbia":["RESALE"],Florida:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Georgia:["LOCAL GOVERNMENT","RESALE"],Guam:[],Hawaii:["RESALE"],Idaho:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Illinois:["LOCAL GOVERNMENT","RESALE"],Indiana:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Iowa:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Kansas:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Kentucky:["LOCAL GOVERNMENT","RESALE"],Louisiana:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Maine:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Manitoba:["RESALE","TRIBAL GOVERNMENT"],Maryland:["LOCAL GOVERNMENT","RESALE"],Massachusetts:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Michigan:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Minnesota:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Mississippi:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Missouri:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Montana:["RESALE"],Nebraska:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Nevada:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],"New Brunswick":["TRIBAL GOVERNMENT"],Newfoundland:["TRIBAL GOVERNMENT"],"New Hampshire":[],"New Jersey":["LOCAL GOVERNMENT","RESALE"],"New Mexico":["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],"New York":["RESALE","TRIBAL GOVERNMENT"],"North Carolina":["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],"North Dakota":["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],"Northern Mariana Islands":[],"Northwest Territories":[],"Nova Scotia":["TRIBAL GOVERNMENT"],Nunavut:[],Ohio:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Oklahoma:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Ontario:["TRIBAL GOVERNMENT"],Oregon:["RESALE"],Pennsylvania:["LOCAL GOVERNMENT","RESALE"],"Prince Edward Island":["TRIBAL GOVERNMENT"],"Puerto Rico":["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Quebec:["TRIBAL GOVERNMENT"],"Rhode Island":["RESALE","TRIBAL GOVERNMENT"],Saskatchewan:["RESALE","TRIBAL GOVERNMENT"],"South Carolina":["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],"South Dakota":["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Tennessee:["LOCAL GOVERNMENT","RESALE"],Texas:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],"U.S. Virgin Islands":[],Utah:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Vermont:["LOCAL GOVERNMENT","RESALE"],Virginia:["LOCAL GOVERNMENT","RESALE"],Washington:["RESALE","TRIBAL GOVERNMENT"],"West Virginia":["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Wisconsin:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Wyoming:["LOCAL GOVERNMENT","RESALE","TRIBAL GOVERNMENT"],Yukon:[]};var V=a(62854),I=[{value:"19",label:"AFFIDAVIT"},{value:"29",label:"AUTO-VALIDATION NO ISSUES FOUND"},{value:"22",label:"CERTEXPRESS IMPORT"},{value:"26",label:"CERTEXPRESS PUBLIC UPLOAD"}];const G=(0,v.withFormik)({mapPropsToValues:function(e){return{region:e.initialRegion||"",exemptionReason:"",effectiveDate:"",entityUseCode:"",exemptionDescription:"",certificateLabels:[]}},validationSchema:M.Ik().shape({region:M.Yj().required("Region is required"),exemptionReason:M.Yj().required("Reason for exemption is required"),effectiveDate:M.p6().required("Effective date is required").nullable()}),handleSubmit:function(e,t){t.props.onSubmit(e)}})((function(e){var t=e.values,a=e.touched,n=e.errors,r=e.handleChange,o=e.handleSubmit,s=e.setFieldValue,c=(0,i.useState)([]),l=c[0],E=c[1];return(0,i.useEffect)((function(){if(t.region){var e=t.region;E(g[e]||[]),s("exemptionReason","")}}),[t.region,s]),i.createElement("form",{className:"form certificate-form",onSubmit:o},i.createElement("fieldset",{className:"form-fieldset"},i.createElement("div",{className:"form-body"},i.createElement("div",{className:"form-row"},i.createElement("div",{className:"form-field"},i.createElement("label",{htmlFor:"region"},"Regions Covered by Certificate"),i.createElement("select",{name:"region",id:"region",className:"form-input",value:t.region,onChange:r},i.createElement("option",{value:""},"Select a Region"),Object.keys(S).map((function(e){return i.createElement("option",{key:e,value:e},e)}))),a.region&&n.region&&i.createElement("div",{className:"error"},n.region))),i.createElement("div",{className:"form-row"},i.createElement("div",{className:"form-field"},i.createElement("label",{htmlFor:"exemptionReason"},"Reason for Exemption"),i.createElement("select",{name:"exemptionReason",id:"exemptionReason",className:"form-input",value:t.exemptionReason,onChange:r},i.createElement("option",{value:""},"Select a Reason"),l.map((function(e){return i.createElement("option",{key:e,value:e},e)}))),a.exemptionReason&&n.exemptionReason&&i.createElement("div",{className:"error"},n.exemptionReason))),i.createElement("div",{className:"form-row"},i.createElement("div",{className:"form-field"},i.createElement("label",{htmlFor:"effectiveDate"},"Effective Date"),i.createElement("input",{type:"date",name:"effectiveDate",id:"effectiveDate",className:"form-input",value:t.effectiveDate,onChange:r}),a.effectiveDate&&n.effectiveDate&&i.createElement("div",{className:"error"},n.effectiveDate))),i.createElement("div",{className:"form-row"},i.createElement("div",{className:"form-field"},i.createElement("label",{htmlFor:"entityUseCode"},"Entity Use Code"),i.createElement("input",{type:"text",name:"entityUseCode",id:"entityUseCode",className:"form-input",value:t.entityUseCode,onChange:r}))),i.createElement("div",{className:"form-row"},i.createElement("div",{className:"form-field"},i.createElement("label",{htmlFor:"exemptionDescription"},"Exemption Description"),i.createElement("input",{type:"text",name:"exemptionDescription",id:"exemptionDescription",className:"form-input",value:t.exemptionDescription,onChange:r}))),i.createElement("div",{className:"form-row"},i.createElement("div",{className:"form-field"},i.createElement("label",{htmlFor:"certificateLabels"},"Certificate Labels"),i.createElement(V.Ay,{id:"certificateLabels",name:"certificateLabels",options:I,isMulti:!0,value:t.certificateLabels,onChange:function(e){return s("certificateLabels",e)}})))),i.createElement("div",{className:"form-actions"},i.createElement("button",{type:"submit",className:"button button--primary"},"Create Certificate"))))}));const y=(0,L.A)((function(e){var t=e.checkoutState.data,a=t.getBillingAddress,n=t.getCheckout,r=t.getCustomer,i=t.getShippingAddress,o=a(),s=n(),c=r(),l=i();return o&&s&&c&&l&&o&&s&&c?{email:o.email||c.email,customer:c,shippingAddress:l}:null}))((function(e){var t=e.customer,a=e.certIds,r=e.shippingAddress,o=(0,i.useState)([]),s=o[0],c=o[1],l=(0,i.useState)(!0),E=l[0],u=l[1],m=(0,i.useState)(null),d=m[0],N=m[1],L=i.useState(!1),h=L[0],v=L[1],M=(0,i.useState)(!1),S=M[0],g=M[1];(0,i.useEffect)((function(){if(0!==a.length){(0,n.__awaiter)(void 0,void 0,void 0,(function(){var e,t;return(0,n.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,5,6]),a.length>0?[4,Promise.all(a.map((function(e){return function(e){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){var t,a,r;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,T()];case 1:if(!(t=n.sent()))throw new Error("Token not available");return a=O(t),[4,p.A.get("".concat(f,"query/").concat(e),{headers:a})];case 2:return[2,n.sent().data];case 3:throw r=n.sent(),console.error("Error fetching certificate details:",r),r;case 4:return[2]}}))}))}(e)})))]:[3,2];case 1:return e=r.sent(),c(e),[3,3];case 2:c([]),r.label=3;case 3:return[3,6];case 4:return t=r.sent(),console.error("Error :",t),N("Failed to load certificate details"),[3,6];case 5:return u(!1),[7];case 6:return[2]}}))}))}}),[a,r]);return t.isGuest?i.createElement("p",null,"Please ",i.createElement("a",{href:"{`/login.php`}",rel:"noopener noreferrer"},"sign in")," to apply tax exemption certificates to this transaction."):E?i.createElement("p",null,"Checking if any certificates apply to this transaction..."):d?i.createElement("p",null,d):s.length?i.createElement(i.Fragment,null,i.createElement("div",null,i.createElement("span",null,"Certificate Applied:"),s.length>0?s.map((function(e,t){var a,n=Array.isArray(e)?e[0]:e;return n?i.createElement("div",{key:n.id},i.createElement("p",null,i.createElement("span",null,"Exempt Reason:")," ",(null===(a=null==n?void 0:n.exemptionReason)||void 0===a?void 0:a.name)||"Unknown",i.createElement("br",null),i.createElement("span",null,"State:")," ",null==n?void 0:n.exposureZone.region," |Â ",i.createElement("span",null,"Percent:")," ",null==n?void 0:n.exemptPercentage,"%")):i.createElement("p",{key:t},"No details available")})):i.createElement("p",null,"No exemption certificates found.")),i.createElement("a",{onClick:function(){v(!0)}}," Use Tax/ Exempt Certificate  "),i.createElement(R.A,{additionalModalClassName:"modal--big",header:i.createElement(A.A,null,"Add New Certificate"),isOpen:h,onAfterOpen:function(){console.log("after open")},onRequestClose:function(){v(!1)},shouldShowCloseButton:!0},i.createElement(G,{onSubmit:function(e){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){var a,i;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),a=function(e,t,a,n,r,i,o){return{signedDate:a,expirationDate:"9999-12-31",exposureZone:{name:e},exemptionReason:{name:t},valid:!0,CertificateCustomFields:{1:n,2:r},customers:[{customerCode:i.id,name:i.fullName,line1:o.address1,line2:o.address2,city:o.city,postalCode:o.postalCode,phoneNumber:o.phone,emailAddress:i.email,country:o.countryCode,region:o.stateOrProvinceCode}]}}(e.region,e.exemptionReason,e.effectiveDate,e.entityUseCode,e.exemptionDescription,t,r),[4,C(a)];case 1:return n.sent()&&(g(!0),setTimeout((function(){window.location.reload()}),3e3)),[3,3];case 2:return i=n.sent(),console.error("Error creating certificate:",i),[3,3];case 3:return[2]}}))}))}}),S&&i.createElement("div",{className:"success-message"},"Certificate Created Sucessfully!"))):i.createElement("p",null,"No exemption certificates found.")}));const b=function(e){var t=e.isTaxIncluded,a=e.taxes,R=e.storeCurrency,A=e.shopperCurrency,L=e.headerLink,p=e.additionalLineItems,f=e.lineItems,T=e.total,O=(0,n.__rest)(e,["isTaxIncluded","taxes","storeCurrency","shopperCurrency","headerLink","additionalLineItems","lineItems","total"]),C=(0,i.useState)([]),v=C[0],M=C[1];(0,i.useEffect)((function(){(0,r.createCheckoutService)().loadCheckout().then((function(e){var t,a,r=e.data.getShippingAddress(),i=e.data.getCart(),o=(null===(t=e.data.getCustomer())||void 0===t?void 0:t.id)||"",s=null===(a=e.data.getConsignments())||void 0===a?void 0:a.reduce((function(e,t){var a;return e+((null===(a=t.selectedShippingOption)||void 0===a?void 0:a.cost)||0)}),0);r&&i&&o&&function(e,t,a,r,i){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){var o,s,c,l,E,u,m,d,N,R;return(0,n.__generator)(this,(function(A){switch(A.label){case 0:o=(new Date).toISOString().split("T")[0],s=(0,n.__spreadArray)((0,n.__spreadArray)((0,n.__spreadArray)((0,n.__spreadArray)([],a.physicalItems,!0),a.digitalItems,!0),a.customItems,!0),a.giftCertificates,!0),c=s.map((function(e,t){return{number:"".concat(t+1),quantity:e.quantity||1,amount:e.listPrice||e.amount||0,taxCode:"P0000000",itemCode:e.sku||e.itemCode||"item-".concat(t+1),description:e.name||"Product"}})),i>0&&c.push({number:"".concat(c.length+1),quantity:1,amount:i,taxCode:"FR00000",itemCode:"shipping",description:"Shipping Cost"}),l={id:e.id,code:e.id,createTransactionModel:{lines:c.map((function(e,t){return{number:"".concat(t+1),quantity:e.quantity,amount:e.amount,taxCode:e.taxCode,itemCode:e.itemCode,description:e.description}})),type:"SalesInvoice",date:o,customerCode:"".concat("5ytm98vliq","_").concat(r),purchaseOrderNo:"".concat(o,"-").concat(e.id),addresses:{singleLocation:{line1:t.address1,line2:t.address2,city:t.city,region:t.region,country:t.country,postalCode:t.postalCode}},commit:!1,currencyCode:"USD",description:"Order transaction"}},A.label=1;case 1:return A.trys.push([1,3,,4]),[4,h(l)];case 2:return E=A.sent(),u=E.totalTax,m=E.lines,d=new Set,m.forEach((function(e){e.certificateId&&d.add(e.certificateId)})),N=Array.from(d),[2,{taxes:[{name:"Tax",amount:u}],certificateIds:N}];case 3:throw R=A.sent(),console.error("Error:",R),R;case 4:return[2]}}))}))}(i,r,f,o,s).then((function(e){var t=e.certificateIds;M(t)})).catch((function(e){console.error("Error:",e)}))})).catch((function(e){e instanceof Error?console.error("Error:",e.message):console.error("Error")}))}),[f]);var S=(0,i.useMemo)((function(){return(0,N.A)(f)}),[f]),g=t&&a&&a.length>0;return i.createElement("article",{className:"cart optimizedCheckout-orderSummary","data-test":"cart"},i.createElement(c,null,L),i.createElement(u.A,null,i.createElement(l.A,{displayLineItemsCount:!0,items:S})),i.createElement(o.Y,{region:"summary.lastItem.after"}),i.createElement(u.A,null,i.createElement(m.A,(0,n.__assign)({isTaxIncluded:t,taxes:a},O)),p),i.createElement(u.A,null,i.createElement(y,{certIds:v})),i.createElement(u.A,null,i.createElement(d.A,{orderAmount:T,shopperCurrencyCode:A.code,storeCurrencyCode:R.code})),g&&i.createElement(u.A,null,i.createElement("h5",{className:"cart-taxItem cart-taxItem--subtotal optimizedCheckout-contentPrimary","data-test":"tax-text"},i.createElement(s.A,{id:"tax.inclusive_label"})),(a||[]).map((function(e,t){return i.createElement(E.A,{amount:e.amount,key:t,label:e.name,testId:"cart-taxes"})}))))}}}]);
//# sourceMappingURL=341-226c179d.js.map