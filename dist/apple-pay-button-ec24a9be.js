"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[981],{10952:(e,t,i)=>{i.d(t,{ApplePayButton:()=>de,ApplePayPaymentMethod:()=>ce});var n=i(51077),a=i(80315),o=i(69440),r={};function s(e,t,i=!0){var n;return null!==(n=e[t])&&void 0!==n?n:i}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const d="3.128.0",l="3.123.2",c="3.106.0";class h{constructor(e){this.paymentIntegrationService=e,this.braintreeWindow=window}getSDKVersion(){const e=this.paymentIntegrationService.getState().getStoreConfig(),t=(null==e?void 0:e.checkoutSettings.features)||{};return this.getPreloadedSDKVersion()||(s(t,"PAYPAL-5809.braintree_hosted_fields_fix_version")?d:s(t,"PAYPAL-5636.update_braintree_sdk_version")?l:c)}getPreloadedSDKVersion(){const e=this.braintreeWindow.braintree;if(e){const t=(0,o.find)(Object.values(e),(e=>!!e.VERSION));return null==t?void 0:t.VERSION}}}class u extends Error{constructor(e){var t;super(e||"An unexpected error has occurred."),this.name="StandardError",this.type="standard",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class p extends u{constructor(e){super(e||"Unsupported browser error"),this.name="UnsupportedBrowserError",this.type="unsupported_browser"}}var y,m,g,v,S,b,f,C,_;(_=y||(y={}))[_.CheckoutButtonNotInitialized=0]="CheckoutButtonNotInitialized",_[_.CustomerNotInitialized=1]="CustomerNotInitialized",_[_.PaymentNotInitialized=2]="PaymentNotInitialized",_[_.ShippingNotInitialized=3]="ShippingNotInitialized",_[_.SpamProtectionNotInitialized=4]="SpamProtectionNotInitialized";class w extends u{constructor(e){super(function(e){switch(e){case y.CustomerNotInitialized:return"Unable to proceed because the customer step of checkout has not been initialized.";case y.PaymentNotInitialized:return"Unable to proceed because the payment step of checkout has not been initialized.";case y.ShippingNotInitialized:return"Unable to proceed because the shipping step of checkout has not been initialized.";case y.SpamProtectionNotInitialized:return"Unable to proceed because the checkout spam protection has not been initialized.";default:return"Unable to proceed because the required component has not been initialized."}}(e)),this.subtype=e,this.name="NotInitializedError",this.type="not_initialized"}}!function(e){e.ESTIMATED="ESTIMATED",e.FINAL="FINAL",e.NOT_CURRENTLY_KNOWN="NOT_CURRENTLY_KNOWN"}(m||(m={})),function(e){e.Completed="COMPLETED",e.Pending="PENDING",e.Failed="FAILED"}(g||(g={})),function(e){e.TRUSTLY="trustly"}(v||(v={})),function(e){e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="cancelled",e.UNRECOGNIZED="unrecognized"}(S||(S={})),function(e){e.Customer="CUSTOMER",e.Merchant="MERCHANT",e.Network="NETWORK",e.Internal="INTERNAL",e.Unknown="UNKNOWN"}(b||(b={})),function(e){e.KountNotEnabled="DATA_COLLECTOR_KOUNT_NOT_ENABLED"}(f||(f={})),function(e){e.Visa="visa",e.Mastercard="mastercard",e.AmericanExpress="american-express",e.DinersClub="diners-club",e.Discover="discover",e.Jcb="jcb",e.UnionPay="union-pay",e.Maestro="maestro",e.Elo="elo",e.Mir="mir",e.Hiper="hiper",e.Hipercard="hipercard"}(C||(C={}));var P,I,k,T=function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}d((n=n.apply(e,t||[])).next())}))};class A{constructor(e){this.braintreeScriptLoader=e}initialize(e){this.setClientToken(e)}deinitialize(){return T(this,void 0,void 0,(function*(){yield this.teardownModule(this.dataCollector),this.dataCollector=void 0}))}getClient(){return T(this,void 0,void 0,(function*(){if(!this.client){const e=this.getClientTokenOrThrow(),t=yield this.braintreeScriptLoader.loadClient();this.client=yield t.create({authorization:e})}return this.client}))}getDataCollectorOrThrow(e){return T(this,void 0,void 0,(function*(){const t={deviceData:void 0,teardown:()=>Promise.resolve()};if(!this.dataCollector)try{const t=yield this.getClient(),i=yield this.braintreeScriptLoader.loadDataCollector(),n=Object.assign({client:t,kount:!0},e);this.dataCollector=yield i.create(n)}catch(e){if(function(e){return Boolean("object"==typeof e&&null!==e&&("type"in e||"message"in e||"code"in e))}(e)&&e.code===f.KountNotEnabled)return t;throw e}return this.dataCollector}))}getBraintreeGooglePayment(){return T(this,void 0,void 0,(function*(){if(!this.googlePayment){const[e,t]=yield Promise.all([this.getClient(),this.braintreeScriptLoader.loadGooglePayment()]);this.googlePayment=yield t.create({client:e})}return this.googlePayment}))}getBraintreeThreeDS(){return T(this,void 0,void 0,(function*(){if(!this.threeDS){const[e,t]=yield Promise.all([this.getClient(),this.braintreeScriptLoader.load3DS()]);this.threeDS=yield t.create({client:e,version:2})}return this.threeDS}))}getBraintreeLocalPayment(e){return T(this,void 0,void 0,(function*(){if(!this.braintreeLocalPayment){const[t,i]=yield Promise.all([this.getClient(),this.braintreeScriptLoader.loadLocalPayment()]);this.braintreeLocalPayment=yield new Promise(((n,a)=>{i.create({client:t,merchantAccountId:e},((e,t)=>{e&&a(e),n(t)}))}))}return this.braintreeLocalPayment}))}getUsBankAccount(){return T(this,void 0,void 0,(function*(){if(!this.usBankAccount){const e=yield this.getClient(),t=yield this.braintreeScriptLoader.loadUsBankAccount();this.usBankAccount=yield t.create({client:e})}return this.usBankAccount}))}getBraintreeVisaCheckout(){return this.visaCheckout||(this.visaCheckout=Promise.all([this.getClient(),this.braintreeScriptLoader.loadVisaCheckout()]).then((([e,t])=>t.create({client:e})))),this.visaCheckout}getVisaCheckoutSdk(e){return T(this,void 0,void 0,(function*(){return this.visaCheckoutSDK||(this.visaCheckoutSDK=yield this.braintreeScriptLoader.loadVisaCheckoutSdk(e)),this.visaCheckoutSDK}))}getVenmoCheckoutOrThrow(){return T(this,void 0,void 0,(function*(){if(!this.braintreeVenmo){const e=yield this.getClient(),t=yield this.braintreeScriptLoader.loadVenmoCheckout(),i={client:e,allowDesktop:!0,paymentMethodUsage:"multi_use"},n=yield t.create(i);if(!n.isBrowserSupported())throw new p;this.braintreeVenmo=n}return this.braintreeVenmo}))}setClientToken(e){this.clientToken=e}getClientTokenOrThrow(){if(!this.clientToken)throw new w(y.PaymentNotInitialized);return this.clientToken}teardownModule(e){return e?e.teardown():Promise.resolve()}}class M extends u{constructor(e){super(e||"Unable to proceed because the client library of a payment method is not loaded or ready to be used."),this.name="PaymentMethodClientUnavailableError",this.type="payment_method_client_unavailable"}}!function(e){e.Sandbox="sandbox",e.Production="production"}(P||(P={})),function(e){e.Client="client",e.DataCollector="dataCollector",e.Fastlane="fastlane",e.GooglePayment="googlePayment",e.HostedFields="hostedFields",e.LocalPayment="localPayment",e.Paypal="paypal",e.PaypalCheckout="paypalCheckout",e.ThreeDSecure="threeDSecure",e.UsBankAccount="usBankAccount",e.Venmo="venmo",e.VisaCheckout="visaCheckout"}(I||(I={})),function(e){e.CardCode="cardCode",e.CardCodeVerification="cardCodeVerification",e.CardExpiry="cardExpiry",e.CardName="cardName",e.CardNumber="cardNumber",e.CardNumberVerification="cardNumberVerification"}(k||(k={}));const E={[c]:{[I.Client]:"sha384-26BXDNnJI23JYRyFBj4xe4sVNrUSSiSSu11kxVXNM/vEPONm4LuL00w6ZaTgQewt",[I.PaypalCheckout]:"sha384-B+vzbZwnQtzWBthpkT4TXKUibO65tyeK7eCxSvpblgprTep2+IAXB2Cxxjrn710O",[I.Paypal]:"sha384-uyAGL1/3+XJAHnGoNy4eCoXdzJ4f7Ilzp+6w9PNnEjs6DCCz9WMyJjMN1gzc78U+",[I.LocalPayment]:"sha384-LIvOEMkIVEwVuYBdVOQc1AC5YbGGlwyfUheS0ACK218D2STuVYQlZ4FyEPowAEfT",[I.DataCollector]:"sha384-1bo9JDz+Kscthc085cCKWur8CLwUoBpoNyxsDi7932mCl0zFq3A5mv+FQLw9GHpV",[I.UsBankAccount]:"sha384-xmHBVaU+w74V+OebD3AaPONFxHUGMf+QRs8G/JxVPXNNP7MDa2jL0ICWHIe2tTfJ",[I.GooglePayment]:"sha384-WKDJl8mqoP82qZpMGH6AbZxnvXnSW8ILV4M64CyMLiugGMwu7LyP89wjCkHqsiBe",[I.ThreeDSecure]:"sha384-VQUlpGHzsGvs5XeiGFip7EXRsvoHWEXDVmgCacfbyieZI9mdBOqq3NSoyo28OCOB",[I.VisaCheckout]:"sha384-yx7mADfzTN0T43Q6rlH49LIg1EJ0iUZgBp/EczX9LXsUGkySgxrD+nWHQRBkyfoT",[I.Venmo]:"sha384-QX4rPjoj1ZDhuG0aSyKs56lEKDqTMTcjYxUHY1SzO5VZDsqIE2NTkqot7KNSCyov",[I.HostedFields]:"sha384-VvYBACfSu0Cr/J32uKmxG7AXcNOJE1AzIIL3kbikyS7YKp5fz5Is+NzNP/lyauNy",[I.Fastlane]:"sha384-9oGsZMRZwpGtDEDYa/dFt76dECqj1xAni9gIKgc3KfMIiRnR73nEeeUDLiBzxhFa"},[l]:{[I.Client]:"sha384-o+nbQGcwNNxIBeXeu3+XmbSq+Cg8R3EN3N0l5hXCgMMU2RGY0t1z0LroSEIAbfAO",[I.PaypalCheckout]:"sha384-WrfbWPBS4mH86GAoycPSgiH8hQ8KH7A67C93Hjhunv/xhNk2YpBn3wbFA4Fhg9U/",[I.Paypal]:"sha384-VF389nvvrRUgDsTXMxTYORDtVegB9IQa3Cxr//DyJnLYnz8/X8VCzEvck2c+Megt",[I.LocalPayment]:"sha384-tZKx2rEQbfmZpoPSY5VPmJEhaq4X75dLvwHMs3VE9U+C8lPyw+hWTIL1+GPvWCIH",[I.DataCollector]:"sha384-E6k3wOpP7syCDDwaRDLF06942Y00NkbwJvWi2OQXwwKzGwG5fd3E7RFUvCCecfvO",[I.UsBankAccount]:"sha384-258FON8LZGG0W9Qaz4Jij83pZHu30YnKjJA7gNulLBh6CclkucgF+tHDQuYFRYfW",[I.GooglePayment]:"sha384-taJ2p/0+n0VH328POAoBiuEbL3tnHUTE9S42hK1V+Txs3X+QYjZOyKW35JgHRFfO",[I.ThreeDSecure]:"sha384-+NSZH4Zj3sO5bdWvPKhU5N16QDxeueTVTnUVeleeESkhLSaz4Ob1hh/5myecc9Ym",[I.VisaCheckout]:"sha384-66DiBjghxk1OmBj8aksN8gbQ+CwoQcx1vPfiXUN08g1iQVM+BwewF0p7toM3i7SS",[I.Venmo]:"sha384-B5UwY42kE4RoLoWbQ7YpqosUlUad2/DlGWiw0HhoZbSPk30CQAaSA10ohyLDTkDU",[I.HostedFields]:"sha384-Aw9EesSaUeWxe36PqEHiOyOyOq8M6CIb1gw7/yHNVPRzGtFXXcd2OQ8qXrIlOj2P",[I.Fastlane]:"sha384-rhBL1hpZ71JqG+2TsT0Dih47mbjx8cjJCpeZjk9tw3df1gFMKfCTmMyZunhr7H4Y"},[d]:{[I.Client]:"sha384-0WNxksIpRP+fYZiIdr12g6DBUQfLDzYCQJZtR/C8KkcwSGhPHfcFp3tTaGcMyFTq",[I.PaypalCheckout]:"sha384-lWM1jk4BOxoDNV6Kop7tVNvQgINlmEVz0c/OwM+HNHK3QC8xqwd54Ovrt2QRDTjh",[I.Paypal]:"sha384-fXUmVxC2EMZBDXZ7eTHSTL/LFBrHej/MSXT/vTBXvra4lzgLNGvREAp+x0GYObuH",[I.LocalPayment]:"sha384-pha1xGuGSkmZH5x9aqHvRaO4xLea7rmQ/79PFj9zxNzxuFcOWZg7gOP7FibygOEC",[I.DataCollector]:"sha384-Q6PI2F9eekWbAxhroybl+aEcvqhdowN/EQlGwBUyJOzPFn9982u9xl6SU6XfGKzc",[I.UsBankAccount]:"sha384-W3RLQSKJL1tQ3+Y7mP6tmkamtZ8bV4Yw/XxL9Jj5JtXHraD8loMF8hAIG5m2zK7F",[I.GooglePayment]:"sha384-TITQMsFWA3elDNGP2mWz2oKBo4qjt+TlqzovcaPoeBiAh/wPBi6nae50ADdgU1/i",[I.ThreeDSecure]:"sha384-YiycYN89ZlL/Evcaq4y1ajW1mhd7JYfZBDuOwHtIn4/Jnm20GL+/XCM+zYAwWD8D",[I.VisaCheckout]:"sha384-/OdaTv9qrkKzjObtUe6yzfDhHozFW/+uXlrSl736sOZRJpjGQETvpYXqMFFg69xv",[I.Venmo]:"sha384-dA+ojdW9vbJS4JavcXyOs9d5uZHJg5dNtYupoPSH2zsXIiYDVS5amLb/u8qmQ6oz",[I.HostedFields]:"sha384-31ZkS58+iaWsW06ftW52zzVZFp43WPd7pNYRiddYynSNg6Oh7WGbSFGorAUH6T1z",[I.Fastlane]:"sha384-jlbrwNvL3HvLAUCtLSmrnQ2GH1udCUrRS/bVmReAS5fuIVvcW8Pko/Gkg82tlgtr"}};var N,O=function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}d((n=n.apply(e,t||[])).next())}))};class D{constructor(e,t,i){this.scriptLoader=e,this.braintreeHostWindow=t,this.braintreeSDKVersionManager=i}loadClient(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.Client,"client.min.js")}))}loadFastlane(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.Fastlane,"fastlane.min.js")}))}loadPaypalCheckout(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.PaypalCheckout,"paypal-checkout.min.js")}))}loadPaypal(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.Paypal,"paypal.min.js")}))}loadLocalPayment(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.LocalPayment,"local-payment.min.js")}))}loadDataCollector(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.DataCollector,"data-collector.min.js")}))}loadUsBankAccount(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.UsBankAccount,"us-bank-account.min.js")}))}loadGooglePayment(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.GooglePayment,"google-payment.min.js")}))}load3DS(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.ThreeDSecure,"three-d-secure.min.js")}))}loadVisaCheckout(){return this.loadBraintreeModuleOrThrow(I.VisaCheckout,"visa-checkout.min.js")}loadVenmoCheckout(){return this.loadBraintreeModuleOrThrow(I.Venmo,"venmo.min.js")}loadHostedFields(){return O(this,void 0,void 0,(function*(){return this.loadBraintreeModuleOrThrow(I.HostedFields,"hosted-fields.min.js")}))}loadVisaCheckoutSdk(e){return O(this,void 0,void 0,(function*(){if(this.braintreeHostWindow.V)return this.braintreeHostWindow.V;const t=e?"sha384-0eu1s1GtqzXlL9DtLgmwzC5WWlEH/ADRM0n38cVQkvtT+W/gey96rcb1LwuUOPDm":"sha384-1f1csvP3ZFxg4dILH1GaY4LHlZ0oX7Rk83rxmLlwbnIi4TM0NYzXoev1VoEiVDS6";return this.scriptLoader.loadScript(`//${e?"sandbox-":""}assets.secure.checkout.visa.com/checkout-widget/resources/js/integration/v1/sdk.js`,{async:!0,attributes:{integrity:t,crossorigin:"anonymous"}}).then((()=>{if(!this.braintreeHostWindow.V)throw new M;return this.braintreeHostWindow.V}))}))}loadBraintreeModuleOrThrow(e,t){return O(this,void 0,void 0,(function*(){let i=this.getBraintreeModule(e);if(i)return i;const n=this.braintreeSDKVersionManager.getSDKVersion(),a=`//js.braintreegateway.com/web/${n}/js/${t}`,o=n in E?this.getIntegrityValuesByModuleName(e,n):void 0;if(yield this.scriptLoader.loadScript(a,o?{async:!0,attributes:{integrity:o,crossorigin:"anonymous"}}:void 0),i=this.getBraintreeModule(e),!i)throw new M;return i}))}getBraintreeModule(e){var t;return null===(t=this.braintreeHostWindow.braintree)||void 0===t?void 0:t[e]}getIntegrityValuesByModuleName(e,t){const i=E[t][e];if(!i)throw new Error("Unexpected fileName value");return i}}function B(e,t){return Object.assign(e,{resolveIds:t})}class L extends u{constructor(e){super(e||"Invalid arguments have been provided."),this.name="InvalidArgumentError",this.type="invalid_argument"}}class z extends L{constructor(e){let t="Unable to submit payment for the order because the payload is invalid.";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(", ")}.`),super(t),this.name="PaymentArgumentInvalidError"}}class x extends u{constructor(){super("The current order does not need to be finalized at this stage."),this.name="OrderFinalizationNotRequiredError",this.type="order_finalization_not_required"}}class U extends u{constructor(e){super(e||"Payment process was cancelled."),this.name="PaymentMethodCancelledError",this.type="payment_cancelled"}}!function(e){e.BRAINTREE="braintree",e.BRAINTREE_FASTLANE="braintreeacceleratedcheckout"}(N||(N={}));var F,R=function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}d((n=n.apply(e,t||[])).next())}))};!function(e){e.Shipping="Shipping",e.Subtotal="Subtotal",e.StoreCredit="Store Credit"}(F||(F={}));class V{constructor(e,t,i,n,a){this._requestSender=e,this._paymentIntegrationService=t,this._sessionFactory=i,this._braintreeSdk=n,this._applePayScriptLoader=a,this._shippingLabel=F.Shipping,this._subTotalLabel=F.Subtotal,this._storeCreditLabel=F.StoreCredit}initialize(e){var t,i,n,a;return R(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.methodId))throw new L('Unable to submit payment because "options.methodId" argument is not provided.');const{methodId:o}=e;yield this._applePayScriptLoader.loadSdk(),this._shippingLabel=(null===(t=e.applepay)||void 0===t?void 0:t.shippingLabel)||F.Shipping,this._subTotalLabel=(null===(i=e.applepay)||void 0===i?void 0:i.subtotalLabel)||F.Subtotal,this._storeCreditLabel=(null===(n=e.applepay)||void 0===n?void 0:n.storeCreditLabel)||F.StoreCredit;const r=(yield this._paymentIntegrationService.loadPaymentMethod(o)).getPaymentMethodOrThrow(o);(null===(a=r.initializationData)||void 0===a?void 0:a.gateway)===N.BRAINTREE&&(yield this._initializeBraintreeSdk())}))}execute(e,t){return R(this,void 0,void 0,(function*(){const{payment:i}=e,n=this._paymentIntegrationService.getState();if(!i)throw new z(["payment"]);const{methodId:a}=i,o=n.getPaymentMethodOrThrow(a),r=this._getBaseRequest(n,o),s=this._sessionFactory.create(r);return yield this._paymentIntegrationService.submitOrder({useStoreCredit:e.useStoreCredit},t),s.begin(),new Promise(((e,t)=>{this._handleApplePayEvents(s,o,{resolve:e,reject:t})}))}))}finalize(){return Promise.reject(new x)}deinitialize(){return Promise.resolve()}_getBaseRequest(e,t){const i=e.getCheckoutOrThrow(),n=e.getCartOrThrow(),a=e.getStoreConfigOrThrow(),{storeProfile:{storeCountryCode:o,storeName:r}}=a,{currency:{code:s,decimalPlaces:d}}=n,{initializationData:{merchantCapabilities:l,supportedNetworks:c}}=t,{grandTotal:h,isStoreCreditApplied:u,outstandingBalance:p}=i,y=[{label:this._subTotalLabel,amount:`${i.subtotal.toFixed(d)}`}];if(i.taxes.forEach((e=>y.push({label:e.name,amount:`${e.amount.toFixed(d)}`}))),y.push({label:this._shippingLabel,amount:`${i.shippingCostTotal.toFixed(d)}`}),u){const{storeCredit:t}=e.getCustomerOrThrow();y.push({label:this._storeCreditLabel,amount:`-${Math.min(h,t).toFixed(d)}`})}return{countryCode:o,currencyCode:s,merchantCapabilities:l,supportedNetworks:c,lineItems:y,total:{label:r,amount:`${p.toFixed(d)}`,type:"final"}}}_handleApplePayEvents(e,t,i){e.onvalidatemerchant=i=>R(this,void 0,void 0,(function*(){try{const{body:n}=yield this._onValidateMerchant(t,i);e.completeMerchantValidation(n)}catch(e){throw new Error("Merchant validation failed")}})),e.oncancel=()=>R(this,void 0,void 0,(function*(){return i.reject(new U("Continue with applepay"))})),e.onpaymentauthorized=n=>this._onPaymentAuthorized(n,e,t,i)}_onValidateMerchant(e,t){return R(this,void 0,void 0,(function*(){const i=[`validationUrl=${t.validationURL}`,`merchantIdentifier=${e.initializationData.merchantId}`,`displayName=${e.initializationData.storeName}`,`domainName=${window.location.hostname}`].join("&");return this._requestSender.post(`${e.initializationData.paymentsUrl}/api/public/v1/payments/applepay/validate_merchant`,{credentials:!1,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded","X-XSRF-TOKEN":null},body:i})}))}_onPaymentAuthorized(e,t,i,n){var a;return R(this,void 0,void 0,(function*(){const{token:o}=e.payment;let r;(null===(a=i.initializationData)||void 0===a?void 0:a.gateway)===N.BRAINTREE&&(r=yield this._getBraintreeDeviceData());const s={methodId:i.id,paymentData:{deviceSessionId:r,formattedPayload:{apple_pay_token:{payment_data:o.paymentData,payment_method:o.paymentMethod,transaction_id:o.transactionIdentifier}}}};try{return yield this._paymentIntegrationService.submitPayment(s),t.completePayment(ApplePaySession.STATUS_SUCCESS),n.resolve()}catch(e){return t.completePayment(ApplePaySession.STATUS_FAILURE),n.reject(new w(y.PaymentNotInitialized))}}))}_getBraintreeDeviceData(){return R(this,void 0,void 0,(function*(){try{const{deviceData:e}=yield this._braintreeSdk.getDataCollectorOrThrow();return e}catch(e){}}))}_initializeBraintreeSdk(){return R(this,void 0,void 0,(function*(){const e=this._paymentIntegrationService.getState();let t=e.getPaymentMethod(N.BRAINTREE_FASTLANE)||e.getPaymentMethod(N.BRAINTREE);t||(yield this._paymentIntegrationService.loadPaymentMethod(N.BRAINTREE),t=e.getPaymentMethod(N.BRAINTREE)),t&&t.clientToken&&t.initializationData&&this._braintreeSdk.initialize(t.clientToken)}))}}function j(e){if(!function(e){return"ApplePaySession"in e}(e))throw new Error("Apple pay is not supported")}class q{create(e){return j(window),new ApplePaySession(1,e)}}class H{constructor(e){this.scriptLoader=e,this.sdkVersion="1.latest"}loadSdk(){return e=this,i=function*(){yield this.scriptLoader.loadScript(`https://applepay.cdn-apple.com/jsapi/${this.sdkVersion}/apple-pay-sdk.js`),j(window)},new((t=void 0)||(t=Promise))((function(n,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function r(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var i;e.done?n(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(o,r)}s((i=i.apply(e,[])).next())}));var e,t,i}}const W=B((e=>{const{getHost:t}=e.getState(),i=new h(e);return new V((0,n.createRequestSender)({host:t()}),e,new q,new A(new D((0,a.vQ)(),window,i)),new H(new a.B2))}),[{id:"applepay"}]);var G;!function(e){e[e.MissingBillingAddress=0]="MissingBillingAddress",e[e.MissingCart=1]="MissingCart",e[e.MissingCheckout=2]="MissingCheckout",e[e.MissingConsignments=3]="MissingConsignments",e[e.MissingCustomer=4]="MissingCustomer",e[e.MissingCheckoutConfig=5]="MissingCheckoutConfig",e[e.MissingOrder=6]="MissingOrder",e[e.MissingOrderConfig=7]="MissingOrderConfig",e[e.MissingOrderId=8]="MissingOrderId",e[e.MissingPayment=9]="MissingPayment",e[e.MissingPaymentId=10]="MissingPaymentId",e[e.MissingPaymentInstrument=11]="MissingPaymentInstrument",e[e.MissingPaymentMethod=12]="MissingPaymentMethod",e[e.MissingPaymentRedirectUrl=13]="MissingPaymentRedirectUrl",e[e.MissingPaymentStatus=14]="MissingPaymentStatus",e[e.MissingPaymentToken=15]="MissingPaymentToken",e[e.MissingShippingAddress=16]="MissingShippingAddress"}(G||(G={}));class $ extends u{constructor(e){super(function(e){switch(e){case G.MissingBillingAddress:return"Unable to proceed because billing address data is unavailable.";case G.MissingCart:return"Unable to proceed because cart data is unavailable.";case G.MissingConsignments:return"Unable to proceed because consignments data is unavailable.";case G.MissingCheckout:return"Unable to proceed because checkout data is unavailable.";case G.MissingCustomer:return"Unable to proceed because customer data is unavailable.";case G.MissingCheckoutConfig:case G.MissingOrderConfig:return"Unable to proceed because configuration data is unavailable.";case G.MissingOrder:return"Unable to proceed because order data is unavailable.";case G.MissingOrderId:return"Unable to proceed because order ID is unavailable or not generated yet.";case G.MissingPayment:return"Unable to proceed because payment data is unavailable.";case G.MissingPaymentToken:return"Unable to proceed because the token required to submit a payment is missing.";case G.MissingPaymentMethod:return"Unable to proceed because payment method data is unavailable or not properly configured.";case G.MissingShippingAddress:return"Unable to proceed because shipping address data is unavailable.";default:return"Unable to proceed because the required data is unavailable."}}(e)),this.subtype=e,this.name="MissingDataError",this.type="missing_data"}}class K extends u{constructor(e){super(e||"Not implemented."),this.name="NotImplementedError",this.type="not_implemented"}}var X,Y=function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}d((n=n.apply(e,t||[])).next())}))};!function(e){e.Subtotal="Subtotal",e.Shipping="Shipping"}(X||(X={}));class Q{constructor(e,t,i,n,a){this._requestSender=e,this._paymentIntegrationService=t,this._sessionFactory=i,this._braintreeSdk=n,this._applePayScriptLoader=a,this._onAuthorizeCallback=o.noop,this._onError=o.noop,this._onClick=o.noop,this._subTotalLabel=X.Subtotal,this._shippingLabel=X.Shipping,this._hasApplePaySession=!1}initialize(e){var t;return Y(this,void 0,void 0,(function*(){const{methodId:i,applepay:n}=e;if(!i||!n)throw new $(G.MissingPaymentMethod);const{container:a,shippingLabel:r,subtotalLabel:s,onError:d=o.noop,onClick:l=o.noop,onPaymentAuthorize:c}=n;this._shippingLabel=r||X.Shipping,this._subTotalLabel=s||X.Subtotal,this._onAuthorizeCallback=c,this._onError=d,this._onClick=l;let h=this._paymentIntegrationService.getState();yield this._applePayScriptLoader.loadSdk();try{this._paymentMethod=h.getPaymentMethodOrThrow(i)}catch(e){h=yield this._paymentIntegrationService.loadPaymentMethod(i),this._paymentMethod=h.getPaymentMethodOrThrow(i)}yield this._paymentIntegrationService.verifyCheckoutSpamProtection(),this._applePayButton=this._createButton(a),this._applePayButton.addEventListener("click",this._handleWalletButtonClick.bind(this)),(null===(t=this._paymentMethod.initializationData)||void 0===t?void 0:t.gateway)===N.BRAINTREE&&(yield this._initializeBraintreeSdk())}))}deinitialize(){return Promise.resolve()}signIn(){throw new K('In order to sign in via Apple, the shopper must click on "Apple Pay" button.')}signOut(){throw new K("Need to do signout via apple.")}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}_createButton(e){const t=document.getElementById(e);if(!t)throw new L("Unable to create sign-in button without valid container ID.");const i=this._createApplePayButtonElement();return t.appendChild(i),i}_createApplePayButtonElement(){const e=document.createElement("apple-pay-button");return e.setAttribute("buttonstyle","black"),e.setAttribute("type","plain"),e.setAttribute("style","--apple-pay-button-width: 100%; --apple-pay-button-height: 36px; --apple-pay-button-border-radius: 4px;"),e}_handleWalletButtonClick(e){if(e.preventDefault(),this._hasApplePaySession)return;this._onClick();const t=this._paymentIntegrationService.getState(),i=t.getCartOrThrow(),n=t.getStoreConfigOrThrow(),a=t.getCheckoutOrThrow();if(!this._paymentMethod||!this._paymentMethod.initializationData)throw new $(G.MissingPaymentMethod);const o=this._getBaseRequest(i,a,n,this._paymentMethod),r=this._sessionFactory.create(o);this._handleApplePayEvents(r,this._paymentMethod,n),r.begin(),this._hasApplePaySession=!0}_getBaseRequest(e,t,i,n){var a;const{storeProfile:{storeCountryCode:o,storeName:r}}=i,{currency:{code:s,decimalPlaces:d}}=e,{initializationData:{merchantCapabilities:l,supportedNetworks:c}}=n,h=e.lineItems.physicalItems.length>0,u={requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:["email","phone"],countryCode:o,currencyCode:s,merchantCapabilities:l,supportedNetworks:c,lineItems:[],total:h?{label:r,amount:`${t.grandTotal.toFixed(d)}`,type:"pending"}:{label:r,amount:`${t.grandTotal.toFixed(d)}`,type:"final"}};if(h)null===(a=u.requiredShippingContactFields)||void 0===a||a.push("postalAddress");else{const e=[{label:this._subTotalLabel,amount:`${t.subtotal.toFixed(d)}`}];t.taxes.forEach((t=>e.push({label:t.name,amount:`${t.amount.toFixed(d)}`}))),u.lineItems=e}return u}_handleApplePayEvents(e,t,i){e.onvalidatemerchant=i=>Y(this,void 0,void 0,(function*(){try{const{body:n}=yield this._onValidateMerchant(t,i);e.completeMerchantValidation(n)}catch(e){this._onError(e)}})),e.onshippingcontactselected=t=>Y(this,void 0,void 0,(function*(){return this._handleShippingContactSelected(e,i,t)})),e.onshippingmethodselected=t=>Y(this,void 0,void 0,(function*(){return this._handleShippingMethodSelected(e,i,t)})),e.oncancel=()=>Y(this,void 0,void 0,(function*(){this._hasApplePaySession=!1;try{const e=`/remote-checkout/${t.id}/signout`;return yield this._requestSender.get(e),yield this._paymentIntegrationService.loadCheckout()}catch(e){return this._onError(new U)}})),e.onpaymentauthorized=i=>Y(this,void 0,void 0,(function*(){return this._onPaymentAuthorized(i,e,t)}))}_handleShippingContactSelected(e,t,i){var n;return Y(this,void 0,void 0,(function*(){const a=this._transformContactToAddress(i.shippingContact);try{yield this._paymentIntegrationService.updateShippingAddress(a)}catch(t){return e.abort(),this._hasApplePaySession=!1,this._onError(t)}const{storeProfile:{storeName:o}}=t;let r=this._paymentIntegrationService.getState();const{currency:{decimalPlaces:s}}=r.getCartOrThrow();let d=r.getCheckoutOrThrow();const l=null===(n=d.consignments[0].selectedShippingOption)||void 0===n?void 0:n.id,c=d.consignments[0].availableShippingOptions,h=null==c?void 0:c.find((({id:e})=>e===l)),u=null==c?void 0:c.filter((e=>e.id!==l)),p=h?[{label:h.description,amount:`${h.cost.toFixed(s)}`,detail:h.additionalDescription,identifier:h.id}]:[];if(u&&[...u.filter((e=>e.isRecommended)),...u.filter((e=>!e.isRecommended))].forEach((e=>p.push({label:e.description,amount:`${e.cost.toFixed(s)}`,detail:e.additionalDescription,identifier:e.id}))),!(c instanceof Array))throw new Error("Shipping options not available.");if(0===c.length)return void e.completeShippingContactSelection(ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS,[],{type:"pending",label:o,amount:`${d.grandTotal.toFixed(s)}`},[]);const y=c.find((e=>e.isRecommended)),m=y?y.id:c[0].id,g=h?h.id:m;try{yield this._updateShippingOption(g)}catch(e){return this._onError(e)}r=this._paymentIntegrationService.getState(),d=r.getCheckoutOrThrow(),e.completeShippingContactSelection({newShippingMethods:p,newTotal:{type:"final",label:o,amount:`${d.grandTotal.toFixed(s)}`},newLineItems:this._getUpdatedLineItems(d,s)})}))}_handleShippingMethodSelected(e,t,i){return Y(this,void 0,void 0,(function*(){const{storeProfile:{storeName:n}}=t,{shippingMethod:{identifier:a}}=i;try{yield this._updateShippingOption(a)}catch(t){return e.abort(),this._hasApplePaySession=!1,this._onError(t)}const o=this._paymentIntegrationService.getState(),{currency:{decimalPlaces:r}}=o.getCartOrThrow(),s=o.getCheckoutOrThrow();e.completeShippingMethodSelection({newTotal:{type:"final",label:n,amount:`${s.grandTotal.toFixed(r)}`},newLineItems:this._getUpdatedLineItems(s,r)})}))}_getUpdatedLineItems(e,t){const i=[{label:this._subTotalLabel,amount:`${e.subtotal.toFixed(t)}`}];return e.taxes.forEach((e=>i.push({label:e.name,amount:`${e.amount.toFixed(t)}`}))),i.push({label:this._shippingLabel,amount:`${e.shippingCostTotal.toFixed(t)}`}),i}_updateShippingOption(e){return Y(this,void 0,void 0,(function*(){return this._paymentIntegrationService.selectShippingOption(e)}))}_onValidateMerchant(e,t){return Y(this,void 0,void 0,(function*(){const i=[`validationUrl=${t.validationURL}`,`merchantIdentifier=${e.initializationData.merchantId}`,`displayName=${e.initializationData.storeName}`,`domainName=${window.location.hostname}`].join("&");return this._requestSender.post(`${e.initializationData.paymentsUrl}/api/public/v1/payments/applepay/validate_merchant`,{credentials:!1,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded","X-XSRF-TOKEN":null},body:i})}))}_onPaymentAuthorized(e,t,i){var n;return Y(this,void 0,void 0,(function*(){const{token:a,billingContact:o,shippingContact:r}=e.payment,s=this._paymentIntegrationService.getState().getCartOrThrow().lineItems.physicalItems.length>0;let d;(null===(n=i.initializationData)||void 0===n?void 0:n.gateway)===N.BRAINTREE&&(d=yield this._getBraintreeDeviceData());const l={methodId:i.id,paymentData:{deviceSessionId:d,formattedPayload:{apple_pay_token:{payment_data:a.paymentData,payment_method:a.paymentMethod,transaction_id:a.transactionIdentifier}}}},c=this._transformContactToAddress(o),h=this._transformContactToAddress(r),u=null==r?void 0:r.emailAddress,p=(null==r?void 0:r.phoneNumber)||"";try{return yield this._paymentIntegrationService.updateBillingAddress(Object.assign(Object.assign({},c),{email:u,phone:p})),s&&(yield this._paymentIntegrationService.updateShippingAddress(h)),yield this._paymentIntegrationService.submitOrder({useStoreCredit:!1}),yield this._paymentIntegrationService.submitPayment(l),t.completePayment(ApplePaySession.STATUS_SUCCESS),this._onAuthorizeCallback()}catch(e){return t.completePayment(ApplePaySession.STATUS_FAILURE),this._onError(e)}}))}_transformContactToAddress(e){return{firstName:(null==e?void 0:e.givenName)||"",lastName:(null==e?void 0:e.familyName)||"",city:(null==e?void 0:e.locality)||"",company:"",address1:(null==e?void 0:e.addressLines)&&e.addressLines[0]||"",address2:(null==e?void 0:e.addressLines)&&e.addressLines[1]||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCode:(null==e?void 0:e.countryCode)||"",phone:(null==e?void 0:e.phoneNumber)||"",stateOrProvince:(null==e?void 0:e.administrativeArea)||"",stateOrProvinceCode:(null==e?void 0:e.administrativeArea)||"",customFields:[]}}_getBraintreeDeviceData(){return Y(this,void 0,void 0,(function*(){try{const{deviceData:e}=yield this._braintreeSdk.getDataCollectorOrThrow();return e}catch(e){}}))}_initializeBraintreeSdk(){return Y(this,void 0,void 0,(function*(){yield this._paymentIntegrationService.loadPaymentMethod(N.BRAINTREE);const e=this._paymentIntegrationService.getState().getPaymentMethod(N.BRAINTREE);e&&e.clientToken&&e.initializationData&&this._braintreeSdk.initialize(e.clientToken)}))}}const Z=B((e=>{const{getHost:t}=e.getState(),i=new h(e);return new Q((0,n.createRequestSender)({host:t()}),e,new q,new A(new D((0,a.vQ)(),window,i)),new H(new a.B2))}),[{id:"applepay"}]);class J extends u{constructor(e){super(e||"An unexpected error has occurred during buy now cart creation process. Please try again later."),this.name="BuyNowCartCreationError",this.type="buy_now_cart_creation_error"}}var ee,te,ie=function(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{d(n.next(e))}catch(e){o(e)}}function s(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}d((n=n.apply(e,t||[])).next())}))};!function(e){e.Subtotal="Subtotal",e.Shipping="Shipping"}(ee||(ee={})),function(e){e.Black="black",e.White="white",e.WhiteBorder="white-border"}(te||(te={}));class ne{constructor(e,t,i,n,a){this._requestSender=e,this._paymentIntegrationService=t,this._sessionFactory=i,this._braintreeSdk=n,this._applePayScriptLoader=a,this._onAuthorizeCallback=o.noop,this._subTotalLabel=ee.Subtotal,this._shippingLabel=ee.Shipping}initialize(e){var t,i;return ie(this,void 0,void 0,(function*(){const{methodId:n,containerId:a,applepay:o}=e;if(!n||!o)throw new $(G.MissingPaymentMethod);yield this._applePayScriptLoader.loadSdk();const{onPaymentAuthorize:r,buyNowInitializeOptions:s,requiresShipping:d}=o;this._requiresShipping=d,this._buyNowInitializeOptions=s,this._onAuthorizeCallback=r,s||(yield this._paymentIntegrationService.loadDefaultCheckout()),yield this._paymentIntegrationService.loadPaymentMethod(n);const l=this._paymentIntegrationService.getState();return this._paymentMethod=l.getPaymentMethodOrThrow(n),l.getCart()&&(yield this._paymentIntegrationService.verifyCheckoutSpamProtection()),(null===(t=this._paymentMethod.initializationData)||void 0===t?void 0:t.gateway)===N.BRAINTREE&&(yield this._initializeBraintreeSdk()),this._applePayButton=this._createButton(a,null===(i=this._paymentMethod.initializationData)||void 0===i?void 0:i.styleOption),this._applePayButton.addEventListener("click",this._handleWalletButtonClick.bind(this)),Promise.resolve()}))}deinitialize(){return Promise.resolve()}_createButton(e,t){const i=document.getElementById(e);if(!i)throw new L("Unable to create wallet button without valid container ID.");const n=this._createApplePayButtonElement(t);return i.appendChild(n),n}_createApplePayButtonElement(e){const t=document.createElement("apple-pay-button");return t.setAttribute("buttonstyle",(e=>{switch(e){case te.White:return"white";case te.WhiteBorder:return"white-outline";case te.Black:default:return"black"}})(e)),t.setAttribute("type","plain"),t.setAttribute("style","--apple-pay-button-width: 100%; --apple-pay-button-height: 40px; --apple-pay-button-border-radius: 4px;"),t}_handleWalletButtonClick(e){var t;return ie(this,void 0,void 0,(function*(){if(e.preventDefault(),!this._paymentMethod||!this._paymentMethod.initializationData)throw new $(G.MissingPaymentMethod);if(this._buyNowInitializeOptions&&"function"==typeof this._buyNowInitializeOptions.getBuyNowCartRequestBody){const{countryCode:e,currencyCode:i,merchantCapabilities:n,supportedNetworks:a,storeName:o}=this._paymentMethod.initializationData,r=this._getRequestWithEmptyTotal(e,i,a,n);this._requiresShipping&&(null===(t=r.requiredShippingContactFields)||void 0===t||t.push("postalAddress"));const s=this._sessionFactory.create(r);this._handleApplePayEvents(s,this._paymentMethod,o),s.begin()}else{const e=this._paymentIntegrationService.getState(),t=e.getCartOrThrow(),i=e.getStoreConfigOrThrow(),n=e.getCheckoutOrThrow(),a=this._getBaseRequest(t,n,i,this._paymentMethod),o=this._sessionFactory.create(a);this._handleApplePayEvents(o,this._paymentMethod,i.storeProfile.storeName),o.begin()}}))}_getRequestWithEmptyTotal(e,t,i,n){return{countryCode:e,currencyCode:t,supportedNetworks:i,merchantCapabilities:n,total:{label:"",amount:"0",type:"pending"},requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:["email","phone"]}}_getBaseRequest(e,t,i,n){var a;const{storeProfile:{storeCountryCode:o,storeName:r}}=i,{currency:{code:s,decimalPlaces:d}}=e,{initializationData:{merchantCapabilities:l,supportedNetworks:c}}=n,h=e.lineItems.physicalItems.length>0,u={requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:["email","phone"],countryCode:o,currencyCode:s,merchantCapabilities:l,supportedNetworks:c,lineItems:[],total:h?{label:r,amount:`${t.grandTotal.toFixed(d)}`,type:"pending"}:{label:r,amount:`${t.grandTotal.toFixed(d)}`,type:"final"}};if(h)null===(a=u.requiredShippingContactFields)||void 0===a||a.push("postalAddress");else{const e=[{label:this._subTotalLabel,amount:`${t.subtotal.toFixed(d)}`}];t.taxes.forEach((t=>e.push({label:t.name,amount:`${t.amount.toFixed(d)}`}))),u.lineItems=e}return u}_handleApplePayEvents(e,t,i){e.onvalidatemerchant=i=>ie(this,void 0,void 0,(function*(){try{const{body:n}=yield this._onValidateMerchant(t,i);e.completeMerchantValidation(n)}catch(e){throw new Error("Merchant validation failed")}})),this._buyNowInitializeOptions&&!this._requiresShipping&&(e.onpaymentmethodselected=()=>ie(this,void 0,void 0,(function*(){yield this._createBuyNowCart(),this._handlePaymentMethodSelected(e)}))),e.onshippingcontactselected=t=>ie(this,void 0,void 0,(function*(){this._buyNowInitializeOptions&&this._requiresShipping&&(yield this._createBuyNowCart()),yield this._handleShippingContactSelected(e,i,t)})),e.onshippingmethodselected=t=>ie(this,void 0,void 0,(function*(){yield this._handleShippingMethodSelected(e,i,t)})),e.oncancel=()=>ie(this,void 0,void 0,(function*(){try{const e=`/remote-checkout/${t.id}/signout`;return yield this._requestSender.get(e),yield this._paymentIntegrationService.loadCheckout()}catch(e){throw new U}})),e.onpaymentauthorized=i=>ie(this,void 0,void 0,(function*(){return this._onPaymentAuthorized(i,e,t)}))}_createBuyNowCart(){var e,t;return ie(this,void 0,void 0,(function*(){try{const i=null===(t=null===(e=this._buyNowInitializeOptions)||void 0===e?void 0:e.getBuyNowCartRequestBody)||void 0===t?void 0:t.call(e);if(!i)throw new $(G.MissingCart);const n=yield this._paymentIntegrationService.createBuyNowCart(i);yield this._paymentIntegrationService.loadCheckout(n.id);const a=this._paymentIntegrationService.getState(),{shouldExecuteSpamCheck:o}=a.getCheckoutOrThrow();o&&(yield this._paymentIntegrationService.verifyCheckoutSpamProtection())}catch(e){throw new J}}))}_handlePaymentMethodSelected(e){const t=this._paymentIntegrationService.getState(),i=t.getCartOrThrow(),n=t.getStoreConfigOrThrow(),a=t.getCheckoutOrThrow();if(!this._paymentMethod||!this._paymentMethod.initializationData)throw new $(G.MissingPaymentMethod);const o=this._getBaseRequest(i,a,n,this._paymentMethod);delete o.total.type,e.completePaymentMethodSelection({newTotal:o.total,newLineItems:o.lineItems})}_handleShippingContactSelected(e,t,i){var n;return ie(this,void 0,void 0,(function*(){const a=this._transformContactToAddress(i.shippingContact);try{yield this._paymentIntegrationService.updateShippingAddress(a)}catch(t){throw e.abort(),new Error("Shipping address update failed")}let o=this._paymentIntegrationService.getState();const{currency:{decimalPlaces:r}}=o.getCartOrThrow();let s=o.getCheckoutOrThrow();const d=null===(n=s.consignments[0].selectedShippingOption)||void 0===n?void 0:n.id,l=s.consignments[0].availableShippingOptions,c=null==l?void 0:l.find((({id:e})=>e===d)),h=null==l?void 0:l.filter((e=>e.id!==d)),u=c?[{label:c.description,amount:`${c.cost.toFixed(r)}`,detail:c.additionalDescription,identifier:c.id}]:[];if(h&&[...h.filter((e=>e.isRecommended)),...h.filter((e=>!e.isRecommended))].forEach((e=>u.push({label:e.description,amount:`${e.cost.toFixed(r)}`,detail:e.additionalDescription,identifier:e.id}))),!(l instanceof Array))throw new Error("Shipping options not available.");if(0===l.length)return void e.completeShippingContactSelection(ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS,[],{type:"pending",label:t,amount:`${s.grandTotal.toFixed(r)}`},[]);const p=l.find((e=>e.isRecommended)),y=p?p.id:l[0].id,m=c?c.id:y;try{yield this._updateShippingOption(m)}catch(e){throw new Error("Shipping options update failed")}o=this._paymentIntegrationService.getState(),s=o.getCheckoutOrThrow(),e.completeShippingContactSelection({newShippingMethods:u,newTotal:{type:"final",label:t,amount:`${s.grandTotal.toFixed(r)}`},newLineItems:this._getUpdatedLineItems(s,r)})}))}_handleShippingMethodSelected(e,t,i){return ie(this,void 0,void 0,(function*(){const{shippingMethod:{identifier:n}}=i;try{yield this._updateShippingOption(n)}catch(t){throw e.abort(),new Error("Shipping option selection update failed.")}const a=this._paymentIntegrationService.getState(),{currency:{decimalPlaces:o}}=a.getCartOrThrow(),r=a.getCheckoutOrThrow();e.completeShippingMethodSelection({newTotal:{type:"final",label:t,amount:`${r.grandTotal.toFixed(o)}`},newLineItems:this._getUpdatedLineItems(r,o)})}))}_getUpdatedLineItems(e,t){const i=[{label:this._subTotalLabel,amount:`${e.subtotal.toFixed(t)}`}];return e.taxes.forEach((e=>i.push({label:e.name,amount:`${e.amount.toFixed(t)}`}))),i.push({label:this._shippingLabel,amount:`${e.shippingCostTotal.toFixed(t)}`}),i}_updateShippingOption(e){return ie(this,void 0,void 0,(function*(){return this._paymentIntegrationService.selectShippingOption(e)}))}_onValidateMerchant(e,t){return ie(this,void 0,void 0,(function*(){const i=[`validationUrl=${t.validationURL}`,`merchantIdentifier=${e.initializationData.merchantId}`,`displayName=${e.initializationData.storeName}`,`domainName=${window.location.hostname}`].join("&");return this._requestSender.post(`${e.initializationData.paymentsUrl}/api/public/v1/payments/applepay/validate_merchant`,{credentials:!1,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded","X-XSRF-TOKEN":null},body:i})}))}_onPaymentAuthorized(e,t,i){var n;return ie(this,void 0,void 0,(function*(){const{token:a,billingContact:o,shippingContact:r}=e.payment,s=this._paymentIntegrationService.getState().getCartOrThrow().lineItems.physicalItems.length>0;let d;(null===(n=i.initializationData)||void 0===n?void 0:n.gateway)===N.BRAINTREE&&(d=yield this._getBraintreeDeviceData());const l={methodId:i.id,paymentData:{deviceSessionId:d,formattedPayload:{apple_pay_token:{payment_data:a.paymentData,payment_method:a.paymentMethod,transaction_id:a.transactionIdentifier}}}},c=this._transformContactToAddress(o),h=this._transformContactToAddress(r),u=null==r?void 0:r.emailAddress,p=(null==r?void 0:r.phoneNumber)||"";try{return yield this._paymentIntegrationService.updateBillingAddress(Object.assign(Object.assign({},c),{email:u,phone:p})),s&&(yield this._paymentIntegrationService.updateShippingAddress(h)),yield this._paymentIntegrationService.submitOrder({useStoreCredit:!1}),yield this._paymentIntegrationService.submitPayment(l),t.completePayment(ApplePaySession.STATUS_SUCCESS),this._onAuthorizeCallback()}catch(e){throw t.completePayment(ApplePaySession.STATUS_FAILURE),new Error("Payment cannot complete")}}))}_transformContactToAddress(e){return{firstName:(null==e?void 0:e.givenName)||"",lastName:(null==e?void 0:e.familyName)||"",city:(null==e?void 0:e.locality)||"",company:"",address1:(null==e?void 0:e.addressLines)&&e.addressLines[0]||"",address2:(null==e?void 0:e.addressLines)&&e.addressLines[1]||"",postalCode:(null==e?void 0:e.postalCode)||"",countryCode:(null==e?void 0:e.countryCode)||"",phone:(null==e?void 0:e.phoneNumber)||"",stateOrProvince:(null==e?void 0:e.administrativeArea)||"",stateOrProvinceCode:(null==e?void 0:e.administrativeArea)||"",customFields:[]}}_getBraintreeDeviceData(){return ie(this,void 0,void 0,(function*(){try{const{deviceData:e}=yield this._braintreeSdk.getDataCollectorOrThrow();return e}catch(e){}}))}_initializeBraintreeSdk(){return ie(this,void 0,void 0,(function*(){yield this._paymentIntegrationService.loadPaymentMethod(N.BRAINTREE);const e=this._paymentIntegrationService.getState().getPaymentMethod(N.BRAINTREE);e&&e.clientToken&&e.initializationData&&this._braintreeSdk.initialize(e.clientToken)}))}}B((e=>{const{getHost:t}=e.getState(),i=new h(e);return new ne((0,n.createRequestSender)({host:t()}),e,new q,new A(new D((0,a.vQ)(),window,i)),new H(new a.B2))}),[{id:"applepay"}]);var ae=i(70355),oe=i(63582),re=i(19285),se=i(4907);const de=(0,re.A)((e=>{const{language:t,onUnhandledError:i}=e,n=[Z],a={shippingLabel:t.translate("cart.shipping_text"),subtotalLabel:t.translate("cart.subtotal_text"),onPaymentAuthorize:se.A,onError:i};return ae.createElement(oe.A,Object.assign({additionalInitializationOptions:a,integrations:n},e))}),[{id:"applepay"}]);var le=i(31635);const ce=(0,re.A)((({method:e,checkoutService:t,language:i,onUnhandledError:n})=>((0,ae.useEffect)((()=>((0,le.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,integrations:[W],applepay:{shippingLabel:i.translate("cart.shipping_text"),subtotalLabel:i.translate("cart.subtotal_text")}})}catch(e){e instanceof Error&&n(e)}})),()=>{(0,le.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&n(e)}}))})),[t,i,e,n]),ae.createElement(ae.Fragment,null))),[{id:"applepay"}])},19285:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(70355);function a(e,t){return Object.assign((t=>n.createElement(e,Object.assign({},t))),{resolveIds:t})}},63582:(e,t,i)=>{i.d(t,{A:()=>o});var n=i(31635),a=i(70355);const o=(0,i(19285).A)((({checkoutService:{deinitializeCustomer:e,initializeCustomer:t},checkoutButtonContainerClass:i,containerId:o,methodId:r,onUnhandledError:s,onWalletButtonClick:d,additionalInitializationOptions:l,integrations:c})=>((0,a.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t({methodId:r,integrations:c,[r]:Object.assign({container:o,onUnhandledError:s,onClick:()=>d(r)},l)})}catch(e){"function"==typeof s&&e instanceof Error&&s(e)}})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield e({methodId:r})}catch(e){"function"==typeof s&&e instanceof Error&&s(e)}}))})),[]),a.createElement("div",{className:i,"data-test":o,id:o}))),[])}}]);
//# sourceMappingURL=apple-pay-button-ec24a9be.js.map