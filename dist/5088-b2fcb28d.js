"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[5088],{12319:(e,t,s)=>{s.d(t,{A:()=>H});var n=s(44218),a=s(69440),o=s(70355),r=s(49655),l=s(68512),i=s(33740),d=s(41410),c=s(69022),m=s(60833),u=s(37958);const p={address1:"addressLine1",address2:"addressLine2",postalCode:"postCode",stateOrProvince:"province",stateOrProvinceCode:"provinceCode"};function h(e){return p[e]||e}function g(e){return`${h(e)}Input`}class f{constructor(e){const{address_components:t,name:s}=e;this._name=null!=s?s:"",this._address=t}getState(){return this._get("administrative_area_level_1","short_name")}getStreet(){return this._name}getStreet2(){return"NZ"===this.getCountry()?this._get("sublocality","short_name"):this._get("subpremise","short_name")}getCity(){return this._get("postal_town","long_name")||this._get("locality","long_name")||this._get("neighborhood","short_name")}getCountry(){return this._get("country","short_name")}getPostCode(){return this._get("postal_code","short_name")}_get(e,t){const s=this._address&&this._address.find(t=>t.types.includes(e));return s?s[t]:""}}class y extends f{getStreet(){const e=this._get("subpremise","short_name");return`${e?`${e}/`:""}${this._get("street_number","long_name")} ${this._get("route","long_name")}`}getStreet2(){return""}}class _ extends f{getCity(){return this._get("sublocality_level_1","long_name")||this._get("locality","long_name")}}class v extends f{getState(){return""}getStreet2(){return this._get("locality","long_name")}getPostCode(){return""}}class b{static create(e){var t;const s=null===(t=e.address_components)||void 0===t?void 0:t.find(e=>e.types.includes("country"));switch((null==s?void 0:s.short_name)||""){case"GB":return new v(e);case"CA":return new _(e);case"AU":return new y(e);default:return new f(e)}}}var A=s(3375),C=s.n(A),E=s(28407),S=s(22375),w=s(36951);const P=({children:e})=>o.createElement("div",{className:"popover"},e);function O(e,t){const s=["popoverList-item"];return e===t&&s.push("is-active"),s.join(" ")}const k=(0,o.memo)(({highlightedIndex:e=-1,testId:t,getItemProps:s=e=>e,menuProps:n={},items:a})=>a.length?o.createElement("ul",Object.assign({className:"popoverList","data-test":t},n),a.map((n,a)=>o.createElement("li",Object.assign({className:O(e,a),"data-test":t&&`${t}-item`},s({key:n.id,index:a,item:n}),{key:a}),n.content))):null);class x extends o.PureComponent{constructor(){super(...arguments),this.stateReducer=(e,t)=>{const{onChange:s}=this.props;switch(t.type){case w.Ay.stateChangeTypes.blurInput:case w.Ay.stateChangeTypes.blurButton:case w.Ay.stateChangeTypes.mouseUp:case w.Ay.stateChangeTypes.touchEnd:return Object.assign(Object.assign({},t),{inputValue:e.inputValue});case w.Ay.stateChangeTypes.changeInput:return t.inputValue!==e.inputValue&&s&&s(t.inputValue||"",e.isOpen),t;case w.Ay.stateChangeTypes.keyDownEnter:default:return t}},this.handleStateChange=({isOpen:e,inputValue:t})=>{const{onToggleOpen:s=a.noop}=this.props;void 0!==e&&s({isOpen:e,inputValue:t||""})}}render(){const{inputProps:e,initialValue:t,initialHighlightedIndex:s,defaultHighlightedIndex:n,items:r,children:l,onSelect:i,listTestId:d}=this.props;if(!this.context)throw Error("Need to wrap in style context");const{themeV2:c}=this.context;return o.createElement(w.Ay,{defaultHighlightedIndex:n,initialHighlightedIndex:s,initialInputValue:t,itemToString:this.itemToString,labelId:e&&e["aria-labelledby"]?e["aria-labelledby"]:null,onChange:i,onStateChange:this.handleStateChange,stateReducer:this.stateReducer},({isOpen:s,getInputProps:n,getMenuProps:i,getItemProps:m,highlightedIndex:u})=>{const p=Object.assign(Object.assign({},n({value:t})),e);return delete p.labelText,o.createElement("div",null,o.createElement("input",Object.assign({},p)),e&&(0,a.includes)(e.className,"floating")&&o.createElement(E.A,{additionalClassName:c?"floating-form-field-label":"",htmlFor:e.id,id:e["aria-labelledby"],isFloatingLabelEnabled:!0},e.labelText),s&&!!r.length&&o.createElement(P,null,o.createElement(k,{getItemProps:m,highlightedIndex:(0,a.isNumber)(u)?u:-1,items:r.map(e=>this.toPopoverItem(e)),menuProps:i(),testId:d}),l))})}toPopoverItem(e){return Object.assign(Object.assign({},e),{content:this.highlightItem(e)})}highlightItem(e){if(!e.highlightedSlices||!e.highlightedSlices.length)return e.label;let t=0,s=0;return e.highlightedSlices.reduce((n,a,r)=>{const{label:l}=e,{offset:i,length:d}=a,c=i-t;return c&&(n.push(o.createElement(o.Fragment,{key:s},l.substr(t,c))),s+=1),t=i+d,n.push(o.createElement("strong",{key:s},l.substr(i,d))),s+=1,r===(e.highlightedSlices||[]).length-1&&(n.push(o.createElement(o.Fragment,{key:s},l.substr(t))),s+=1),n},[])}itemToString(e){return e&&e.value||""}}x.contextType=c.A;const N=x;var I=s(80315);class F{constructor(){this._scriptLoader=(0,I.vQ)()}loadMapsSdk(e){return this._googleAutoComplete||(this._googleAutoComplete=new Promise((t,s)=>{const n="initAutoComplete",a=["language=en",`key=${e}`,"libraries=places",`callback=${n}`].join("&");window[n]=()=>{(function(e){const t=e;return Boolean(t.google&&t.google.maps&&t.google.maps.places)})(window)&&t(window.google.maps),s(new Error("Failed to initialize Google Maps Autocomplete SDK."))},this._scriptLoader.loadScript(`//maps.googleapis.com/maps/api/js?${a}`).catch(e=>{throw this._googleAutoComplete=void 0,e})})),this._googleAutoComplete}}let V;class T{constructor(e,t=function(){return V||(V=new F),V}()){this._apiKey=e,this._scriptLoader=t}getAutocompleteService(){return this._autocompletePromise||(this._autocompletePromise=this._scriptLoader.loadMapsSdk(this._apiKey).then(e=>{if(!e.places.AutocompleteService)throw new Error("`AutocompleteService` is undefined");return new e.places.AutocompleteService})),this._autocompletePromise}getPlacesServices(){const e=document.createElement("div");return this._placesPromise||(this._placesPromise=this._scriptLoader.loadMapsSdk(this._apiKey).then(t=>{if(!t.places.PlacesService)throw new Error("`PlacesService` is undefined");return new t.places.PlacesService(e)})),this._placesPromise}}class L extends o.PureComponent{constructor(e){super(e),this.onSelect=e=>{const{fields:t,onSelect:s=a.noop,nextElement:n}=this.props;this.googleAutocompleteService.getPlacesServices().then(a=>{a.getDetails({placeId:e.id,fields:t||["address_components","name"]},t=>{n&&n.focus(),s(t,e)})})},this.onChange=e=>{const{isAutocompleteEnabled:t,onChange:s=a.noop}=this.props;if(s(e,!1),!t)return this.resetAutocomplete();this.setAutocomplete(e),this.setItems(e)},this.googleAutocompleteService=new T(e.apiKey),this.state={items:[],autoComplete:"off"}}render(){const{initialValue:e,onToggleOpen:t=a.noop,inputProps:s={}}=this.props,{autoComplete:n,items:r}=this.state;return o.createElement(N,{defaultHighlightedIndex:-1,initialHighlightedIndex:-1,initialValue:e,inputProps:Object.assign(Object.assign({},s),{autoComplete:n}),items:r,listTestId:"address-autocomplete-suggestions",onChange:this.onChange,onSelect:this.onSelect,onToggleOpen:t},o.createElement("div",{className:"co-googleAutocomplete-footer"}))}setItems(e){if(!e)return void this.setState({items:[]});const{componentRestrictions:t,types:s}=this.props;this.googleAutocompleteService.getAutocompleteService().then(n=>{n.getPlacePredictions({input:e,types:s||["geocode"],componentRestrictions:t},e=>this.setState({items:this.toAutocompleteItems(null!=e?e:void 0)}))})}resetAutocomplete(){this.setState({items:[],autoComplete:"off"})}setAutocomplete(e){this.setState(Object.assign(Object.assign({},this.state),{autoComplete:e&&e.length?"nope":"off"}))}toAutocompleteItems(e){return(e||[]).map(e=>({label:e.description,value:e.structured_formatting.main_text,highlightedSlices:e.matched_substrings,id:e.place_id}))}}const j=L,$=(0,o.memo)(({field:{default:e,name:t,maxLength:s},countryCode:n,supportedCountries:a,parentFieldName:l,nextElement:i,apiKey:d,onSelect:m,onChange:u,onToggleOpen:p,isFloatingLabelEnabled:f})=>{const y=l?`${l}.${t}`:t,{themeV2:_}=(0,c.w)(),v=(0,o.useMemo)(()=>o.createElement(r.A,{id:"address.address_line_1_label"}),[]),b=function(e){return`${h(e)}Label`}(t),A=(0,o.useMemo)(()=>({className:C()("form-input optimizedCheckout-form-input",{"floating-input":f},{"floating-form-field-input":_}),id:g(t),"aria-labelledby":b,placeholder:f?" ":e,labelText:f?v:null,maxLength:s||void 0}),[t,b,e,v,s]),w=(0,o.useCallback)(({field:e})=>o.createElement(j,{apiKey:d,componentRestrictions:n?{country:n}:void 0,initialValue:e.value,inputProps:A,isAutocompleteEnabled:!!n&&a.includes(n),nextElement:i,onChange:u,onSelect:m,onToggleOpen:p}),[d,n,A,i,u,m,p,a]),P=f?null:o.createElement(E.A,{additionalClassName:_?"body-regular":"",htmlFor:A.id,id:b,isFloatingLabelEnabled:f},v);return o.createElement("div",{className:C()("dynamic-form-field dynamic-form-field--addressLineAutocomplete",{"floating-form-field":f}),"data-test":"google-autocomplete-form-field"},o.createElement(S.A,{input:w,isFloatingLabelEnabled:f,label:P,name:y,themeV2:_}))}),M={address1:"address.address_line_1_label",address2:"address.address_line_2_label",city:"address.city_label",company:"address.company_name_label",countryCode:"address.country_label",firstName:"address.first_name_label",lastName:"address.last_name_label",phone:"address.phone_number_label",postalCode:"address.postal_code_label",stateOrProvince:"address.state_label",stateOrProvinceCode:"address.state_label"},B={address1:"address-line1",address2:"address-line2",city:"address-level2",company:"organization",countryCode:"country",firstName:"given-name",lastName:"family-name",phone:"tel",postalCode:"postal-code",stateOrProvince:"address-level1",stateOrProvinceCode:"address-level1"},R={countryCode:"address.select_country_action",stateOrProvince:"address.select_state_action",stateOrProvinceCode:"address.select_state_action"},D="address1";class K extends o.Component{constructor(){super(...arguments),this.containerRef=(0,o.createRef)(),this.handleDynamicFormFieldChange=(0,n.Bj)(e=>t=>{this.syncNonFormikValue(e,t)}),this.handleAutocompleteChange=(e,t)=>{t||this.syncNonFormikValue(D,e)},this.handleAutocompleteSelect=(e,{value:t})=>{const{countries:s,setFieldValue:n=a.noop,onChange:o=a.noop}=this.props,r=function(e,t=[]){if(!e||!e.address_components)return{};const s=b.create(e),n=s.getState(),a=s.getCountry(),o=t&&t.find(e=>a===e.code),r=s.getStreet2(),l="AU"===a?s.getStreet():void 0;return Object.assign({address1:l,address2:r,city:s.getCity(),countryCode:a,postalCode:s.getPostCode()},n?function(e,t=[]){const s=t.find(({code:t,name:s})=>t===e||s===e);return s?{stateOrProvince:s.name,stateOrProvinceCode:s.code}:{stateOrProvince:t.length?"":e,stateOrProvinceCode:""}}(n,o&&o.subdivisions):{})}(e,s);(0,a.forIn)(r,(e,t)=>{t===D&&void 0===e||(n(t,e),o(t,e))});const l=r.address1?r.address1:t;l&&this.syncNonFormikValue(D,l)},this.syncNonFormikValue=(e,t)=>{const{formFields:s,setFieldValue:n=a.noop,onChange:o=a.noop}=this.props,r=s.filter(e=>e.custom&&e.fieldType===i.A.DATE).map(e=>e.name);(e===D||r.includes(e))&&n(e,t),o(e,t)}}componentDidMount(){const{current:e}=this.containerRef;e&&(this.nextElement=e.querySelector('[autocomplete="address-line2"]'))}render(){const{formFields:e,fieldName:t,countriesWithAutocomplete:s,countryCode:n,googleMapsApiKey:a,onAutocompleteToggle:l,shouldShowSaveAddress:i,isFloatingLabelEnabled:c}=this.props;if(!this.context)throw Error("Need to wrap in style context");const{themeV2:p}=this.context;return o.createElement(o.Fragment,null,o.createElement(m.A,null,o.createElement("div",{className:"checkout-address",ref:this.containerRef},e.map(e=>{const i=e.name,m=R[i];return"address1"===i&&a&&s?o.createElement($,{apiKey:a,countryCode:n,field:e,isFloatingLabelEnabled:c,key:e.id,nextElement:this.nextElement||void 0,onChange:this.handleAutocompleteChange,onSelect:this.handleAutocompleteSelect,onToggleOpen:l,parentFieldName:t,supportedCountries:s}):o.createElement(d.A,{autocomplete:B[e.name],extraClass:`dynamic-form-field--${h(i)}`,field:e,inputId:g(i),isFloatingLabelEnabled:c,key:`${e.id}-${e.name}`,label:e.custom?e.label:o.createElement(r.A,{id:M[e.name]}),onChange:this.handleDynamicFormFieldChange(i),parentFieldName:e.custom?t?`${t}.customFields`:"customFields":t,placeholder:this.getPlaceholderValue(e,m),themeV2:p})}))),i&&o.createElement(u.A,{labelContent:o.createElement(r.A,{id:"address.save_in_addressbook"}),name:t?`${t}.shouldSaveAddress`:"shouldSaveAddress",themeV2:p}))}getPlaceholderValue(e,t){const{language:s}=this.props;return e.default&&"dropdown"!==e.fieldType?e.default:t&&s.translate(t)}}K.contextType=c.A;const H=(0,l.A)(K)},21106:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(57398),a=s(60045);function o(e){return(e&&e.payments?e.payments:[]).find(e=>!(0,n.A)(e)&&!(0,a.A)(e)&&!!e.providerId)}},39886:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(31635),a=s(6663);function o(e){const{customFields:t}=e,s=(0,n.__rest)(e,["customFields"]),o=e.shouldSaveAddress;return Object.assign(Object.assign({},s),{shouldSaveAddress:o,customFields:(0,a.A)(t)})}},49102:(e,t,s)=>{s.d(t,{A:()=>f});var n=s(70355),a=s(72769),o=s(49655),r=s(38989),l=s(35172),i=s(67113),d=s(68512),c=s(69022),m=s(63650),u=s(75794);const p=(0,d.A)(({selectedAddress:e,language:t,type:s,showSingleLineAddress:r,placeholderText:l})=>{const{themeV2:i}=(0,c.w)(),[d,p]=(0,n.useState)(!1);return n.createElement("a",{"aria-controls":"addressDropdown","aria-expanded":d,"aria-label":t.translate("address.enter_or_select_address_action"),className:"button dropdown-button dropdown-toggle--select","data-test":"address-select-button",href:"#",id:"addressToggle",onBlur:()=>p(!1),onClick:(0,a.A)(()=>p(!d))},n.createElement(()=>e?r?n.createElement(m.A,{address:e,type:s}):n.createElement(u.A,{address:e,type:s}):n.createElement("span",{className:i?"body-regular":"","data-test":"address-select-placeholder"},null!=l?l:n.createElement(o.A,{id:"address.enter_address_action"})),null))});var h=s(95108);const g=({addresses:e,onSelectAddress:t,onUseNewAddress:s,selectedAddress:r,type:l})=>n.createElement("ul",{className:"dropdown-menu instrumentSelect-dropdownMenu",id:"addressDropdown"},n.createElement("li",{className:"dropdown-menu-item dropdown-menu-item--select"},n.createElement("a",{"data-test":"add-new-address",href:"#",onClick:(0,a.A)(()=>s(r))},n.createElement(o.A,{id:"address.enter_address_action"}))),e.map(e=>n.createElement("li",{className:"dropdown-menu-item dropdown-menu-item--select","data-test":"address-select-option",key:e.id},n.createElement("a",{"data-test":"address-select-option-action",href:"#",onClick:(0,a.A)(()=>t(e))},n.createElement(u.A,{address:e,type:l}))))),f=(0,n.memo)(({addresses:e,selectedAddress:t,type:s,showSingleLineAddress:a,onSelectAddress:o,onUseNewAddress:d,placeholderText:c})=>{const{shouldShowPayPalFastlaneLabel:m}=(0,r.A)();return n.createElement("div",{className:"form-field"},n.createElement("div",{className:"dropdown--select"},n.createElement(i.A,{dropdown:n.createElement(g,{addresses:e,onSelectAddress:e=>{(0,h.A)(t,e)||o(e)},onUseNewAddress:()=>{d(t)},selectedAddress:t,type:s})},n.createElement(p,{addresses:e,placeholderText:c,selectedAddress:t,showSingleLineAddress:a,type:s}))),m&&n.createElement(l.A,null))})},63650:(e,t,s)=>{s.d(t,{A:()=>d,k:()=>i});var n=s(3375),a=s.n(n),o=s(69440),r=s(70355),l=s(69022);const i=({firstName:e,lastName:t,address1:s,address2:n,city:a,countryCode:o,stateOrProvince:r,postalCode:l})=>{const i=[s,n,a,r,o,l].filter(Boolean).join(", ");return e&&t&&i?`${e} ${t}, ${i}`:""},d=({address:e})=>{const{themeV2:t}=(0,l.w)();return!(0,o.isEmpty)(e)?r.createElement("div",{className:"vcard checkout-address--static","data-test":"static-address"},r.createElement("p",{className:a()("address-entry",{"body-regular":t})},i(e))):null}},67113:(e,t,s)=>{s.d(t,{A:()=>i});var n=s(70355),a=s(75514),o=s(77175),r=s(32657),l=s(91605);const i=({placement:e="bottom-start",dropdown:t,children:s})=>{const[i,d]=(0,n.useState)(!1),c=(0,n.useCallback)(()=>document.getElementById(l.B)||document.getElementById(l.S),[]),m=(0,n.useCallback)(()=>{i&&d(!1)},[i]),u=(0,n.useCallback)(()=>{i||d(!0)},[i]),p=(0,n.useCallback)(()=>{i?m():u()},[i,m,u]);return(0,n.useEffect)(()=>{const e=c();return i?null==e||e.addEventListener("click",m):null==e||e.removeEventListener("click",m),()=>{null==e||e.removeEventListener("click",m)}},[i,m,c]),n.createElement(o.mS,null,n.createElement(r.O,null,({ref:e})=>n.createElement("div",{className:"dropdownTrigger",onClick:p,ref:e},s)),n.createElement(a.N,{modifiers:[{name:"hide",enabled:!1},{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}],placement:e},({ref:e,style:s})=>i?n.createElement("div",{className:"dropdownMenu",ref:e,style:Object.assign(Object.assign({},s),{width:"100%",zIndex:1})},t):null))}},69070:(e,t,s)=>{s.d(t,{A:()=>m});var n=s(70355),a=s(49655),o=s(69022),r=s(60833),l=s(22375),i=s(54454),d=s(28407),c=s(43586);const m=()=>{const{themeV2:e}=(0,o.w)(),t=(0,n.useCallback)(e=>n.createElement(d.A,{hidden:!0,htmlFor:e},n.createElement(a.A,{id:"shipping.order_comment_label"})),[]),s=(0,n.useCallback)(({field:t})=>n.createElement(i.A,Object.assign({},t,{autoComplete:"off",id:"orderComment",maxLength:2e3,themeV2:e})),[]),m=(0,n.useMemo)(()=>n.createElement(c.A,{themeV2:e},n.createElement(a.A,{id:"shipping.order_comment_label"})),[]);return n.createElement(r.A,{legend:m,testId:"checkout-shipping-comments"},n.createElement(l.A,{id:"orderComment",input:s,label:t,name:"orderComment"}))}},74027:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(79877);function a(e){return(0,n.A)(e.lineItems.physicalItems.filter(e=>!e.addedByPromotion&&!e.parentId))}},87650:(e,t,s)=>{s.d(t,{A:()=>r});var n=s(69440),a=s(95108),o=s(33318);function r(e,t,s){return!(!e||!(0,o.A)(e,s))&&(0,n.some)(t,t=>(0,a.A)(t,e))}},91605:(e,t,s)=>{s.d(t,{B:()=>n,S:()=>a});const n="checkout-app",a="micro-app-ng-checkout"},95108:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(69440);function a(e,t){return!(!e||!t)&&((0,n.isEqual)(o(e),o(t))&&function(e,t){if(e.stateOrProvince&&e.stateOrProvince===t.stateOrProvince)return!0;if(e.stateOrProvinceCode&&e.stateOrProvinceCode===t.stateOrProvinceCode)return!0;return e.stateOrProvince===t.stateOrProvince&&e.stateOrProvinceCode===t.stateOrProvinceCode}(e,t))}function o(e){return(0,n.omit)(Object.assign(Object.assign({},e),{customFields:(e.customFields||[]).filter(({fieldValue:e})=>!!e)}),["id","shouldSaveAddress","stateOrProvince","stateOrProvinceCode","type","email","country"])}}}]);
//# sourceMappingURL=5088-b2fcb28d.js.map