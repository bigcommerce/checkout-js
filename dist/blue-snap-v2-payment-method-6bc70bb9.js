"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[2750],{31698:(e,t,a)=>{a.d(t,{A:()=>m});var n=a(31635),i=a(44218),r=a(69440),s=a(70355),l=a(65685),o=a(94611),u=a(11474),c=a(40646),d=a(91182);const m=e=>{const{description:t,isInitializing:a=!1,initializePayment:m,method:b,onUnhandledError:g=r.noop,deinitializePayment:p}=e,[y,h]=(0,s.useState)(!1),[_,I]=(0,s.useState)(),f=function(e){const t=(0,i.B4)(((e=[])=>e.filter(l.A))),a=(0,i.B4)(((e=[])=>e.filter((({trustedShippingAddress:e})=>e)))),{checkoutService:n,checkoutState:r,isUsingMultiShipping:s=!1,method:u}=e,{data:{getCart:c,getConfig:d,getCustomer:m,getInstruments:b,isPaymentDataRequired:g,isPaymentDataSubmitted:p},statuses:{isLoadingInstruments:y}}=r,h=c(),_=d(),I=m();if(!_||!h||!I)throw new Error("Unable to get checkout");const f=t(b(u)),v=a(f);return{instruments:v,isNewAddress:0===v.length&&f.length>0,isInstrumentFeatureAvailable:!p(u.id,u.gateway)&&(0,o.A)({config:_,customer:I,isUsingMultiShipping:s,paymentMethod:u}),isLoadingInstruments:y(),isPaymentDataRequired:g(),loadInstruments:n.loadInstruments}}(e),{isLoadingInstruments:v,instruments:C,isNewAddress:E,isInstrumentFeatureAvailable:S,loadInstruments:k}=f,A=(0,s.useCallback)((()=>{if(!y&&C.length)return(0,r.find)(C,{defaultInstrument:!0})||C[0]}),[y,C]),w=(0,s.useCallback)((()=>{h(!0),I(void 0)}),[]),N=(0,s.useCallback)((e=>{h(!1),I((0,r.find)(C,{bigpayToken:e}))}),[C]);(0,s.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield m({gatewayId:b.gateway,methodId:b.id}),S&&(yield k())}catch(e){g(e)}})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield p({gatewayId:b.gateway,methodId:b.id})}catch(e){g(e)}}))})),[]);const P=_||A(),F=a||v,L=S&&(C.length>0||E);return t||S?s.createElement(d.A,{hideContentWhenLoading:!0,isLoading:F},s.createElement("div",{className:"paymentMethod paymentMethod--hosted"},t,L&&s.createElement(u.A,{instruments:C,onSelectInstrument:N,onUseNewInstrument:w,selectedInstrument:P}),S&&s.createElement(c.A,{instrumentId:P&&P.bigpayToken,instruments:C,isAccountInstrument:!0}))):null}},88887:(e,t,a)=>{a.d(t,{BlueSnapDirectAlternativePaymentMethod:()=>L,BlueSnapDirectEcpPaymentMethod:()=>P,BlueSnapDirectIdealPaymentMethod:()=>R,BlueSnapDirectPayByBankPaymentMethod:()=>T,BlueSnapDirectSepaPaymentMethod:()=>q,BlueSnapV2PaymentMethod:()=>M});var n,i=a(31635),r=a(2308),s=a(70355),l=a(11474),o=a(40646),u=a(19285),c=a(91182),d=a(24750),m=a(40052),b=a(22292);!function(e){e.ConsumerChecking="CONSUMER_CHECKING",e.ConsumerSavings="CONSUMER_SAVINGS",e.CorporateChecking="CORPORATE_CHECKING",e.CorporateSavings="CORPORATE_SAVINGS"}(n||(n={}));var g=a(18336),p=a(33740),y=a(30680);const h=(0,s.memo)((e=>{var{maxLength:t,useFloatingLabel:a}=e,n=(0,i.__rest)(e,["maxLength","useFloatingLabel"]);const r=(0,s.useCallback)((({field:e})=>s.createElement(g.A,Object.assign({},e,{"aria-labelledby":`${e.name}-label ${e.name}-field-error-message`,autoComplete:"cc-number",fieldType:p.A.TELEPHONE,id:e.name,isFloatingLabelEnabled:a,maxLength:t}))),[t,a]);return s.createElement(y.A,Object.assign({input:r},n))})),_=(0,s.memo)((e=>{var{options:{helperLabel:t,items:a,rows:n},useFloatingLabel:r}=e,l=(0,i.__rest)(e,["options","useFloatingLabel"]);const o=(0,s.useCallback)((({field:e})=>s.createElement(g.A,Object.assign({},e,{"aria-labelledby":`${e.name}-label ${e.name}-field-error-message`,fieldType:p.A.DROPDOWM,id:e.name,isFloatingLabelEnabled:r,options:a,placeholder:t,rows:n}))),[t,a,n,r]);return s.createElement(y.A,Object.assign({},l,{input:o}))})),I=(0,s.memo)((e=>{var{maxLength:t,useFloatingLabel:a,autoComplete:n}=e,r=(0,i.__rest)(e,["maxLength","useFloatingLabel","autoComplete"]);const l=(0,s.useCallback)((({field:e})=>s.createElement(g.A,Object.assign({},e,{"aria-labelledby":`${e.name}-label ${e.name}-field-error-message`,autoComplete:n,id:e.name,isFloatingLabelEnabled:a,maxLength:t}))),[t,a,n]);return s.createElement(y.A,Object.assign({input:l},r))})),f=(0,s.memo)((({language:e,useFloatingLabel:t,shouldRenderCompanyName:a})=>{const i={helperLabel:e.translate("payment.bluesnap_direct_account_type_select.label"),items:[{label:e.translate("payment.bluesnap_direct_account_type_select.option_consumer_checking"),value:n.ConsumerChecking},{label:e.translate("payment.bluesnap_direct_account_type_select.option_consumer_savings"),value:n.ConsumerSavings},{label:e.translate("payment.bluesnap_direct_account_type_select.option_corporate_checking"),value:n.CorporateChecking},{label:e.translate("payment.bluesnap_direct_account_type_select.option_corporate_savings"),value:n.CorporateSavings}]};return s.createElement(s.Fragment,null,s.createElement(h,{labelContent:e.translate("payment.bluesnap_direct_account_number.label"),maxLength:17,name:"accountNumber",useFloatingLabel:t}),s.createElement(h,{labelContent:e.translate("payment.bluesnap_direct_routing_number.label"),maxLength:9,name:"routingNumber",useFloatingLabel:t}),s.createElement(_,{labelContent:e.translate("payment.bluesnap_direct_account_type.label"),name:"accountType",options:i,useFloatingLabel:t}),a&&s.createElement(I,{labelContent:e.translate("address.company_name_label"),name:"companyName",useFloatingLabel:t}))}));var v=a(69440),C=a(48709),E=a(39981),S=a(66960);const k=e=>{const[t,a]=(0,s.useState)(),{checkoutState:n}=(0,E.Q)(),i=n.data.getCustomer(),r=n.data.getInstruments(e),{paymentForm:l}=(0,S.N)(),{setFieldValue:o}=l,u=(0,s.useMemo)((()=>r?r.filter(C.A):[]),[r]),c=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled),d=c&&u.length>0,m=d&&!t,b=(0,s.useCallback)((()=>{if(!u.length)return;return u.filter((({defaultInstrument:e})=>e))[0]||u[0]}),[u]);(0,s.useEffect)((()=>{a(c?b():void 0)}),[c,b]),(0,s.useEffect)((()=>{d||o("instrumentId","")}),[o,d]);const g=(0,s.useCallback)((e=>{a((0,v.find)(u,{bigpayToken:e})),o("instrumentId",e),o("shouldSetAsDefaultInstrument",!1)}),[u,o]),p=(0,s.useCallback)((()=>{a(void 0),o("instrumentId",""),o("shouldSaveInstrument",!1),o("shouldSetAsDefaultInstrument",!1)}),[o]);return{accountInstruments:u,currentInstrument:t,handleSelectInstrument:g,handleUseNewInstrument:p,isInstrumentFeatureAvailable:c,shouldShowInstrumentFieldset:d,shouldCreateNewInstrument:m}};var A=a(44218),w=a(94202);const N=(0,A.Bj)((function(e,t,a){const n=Object.assign(Object.assign({},t?{}:{instrumentId:(0,w.Yj)().required()}),t?Object.assign(Object.assign({accountNumber:(0,w.Yj)().required(e.translate("payment.bluesnap_direct_account_number.is_required")).matches(/^\d+$/,e.translate("payment.bluesnap_direct_account_number.only_numbers")).min(4,e.translate("payment.bluesnap_direct_account_number.length")).max(17,e.translate("payment.bluesnap_direct_account_number.length_max")),routingNumber:(0,w.Yj)().required(e.translate("payment.bluesnap_direct_routing_number.is_required")).matches(/^\d+$/,e.translate("payment.bluesnap_direct_routing_number.only_numbers")).length(9,e.translate("payment.bluesnap_direct_routing_number.length"))},a?{companyName:(0,w.Yj)().required(e.translate("address.company_name_required_error")).max(50,e.translate("payment.bluesnap_direct_company_name.length_max"))}:{}),{accountType:(0,w.Yj)().required(e.translate("payment.bluesnap_direct_account_type.is_required"))}):{});return(0,w.Ik)(n)})),P=(0,u.A)((({method:e,checkoutService:{initializePayment:t,deinitializePayment:a,loadInstruments:u},checkoutState:{data:{isPaymentDataRequired:g,getCustomer:p,getBillingAddress:y},statuses:{isLoadingInstruments:h}},paymentForm:{disableSubmit:_,setValidationSchema:I,setFieldValue:v,getFormValues:C},language:E,onUnhandledError:S})=>{const[A,w]=(0,s.useState)(!0),P=(0,s.useCallback)((e=>w(!e)),[w]);(0,s.useEffect)((()=>_(e,g()&&A)),[_,A,g,e]);const F=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield t({gatewayId:e.gateway,methodId:e.id,integrations:[r.jA]})}))),[t,e]),L=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield a({gatewayId:e.gateway,methodId:e.id})}))),[a,e.gateway,e.id]);(0,s.useEffect)((()=>(F(),()=>{L()})),[L,F]),(0,s.useEffect)((()=>{const{isGuest:t}=p()||{};!t&&e.config.isVaultingEnabled&&(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield u()}catch(e){e instanceof Error&&S(e)}}))}),[]);const{accountInstruments:j,currentInstrument:z,handleSelectInstrument:O,handleUseNewInstrument:B,isInstrumentFeatureAvailable:q,shouldShowInstrumentFieldset:D,shouldCreateNewInstrument:R}=k(e),V=h(),M=!D||R,U=C().accountType,T=U===n.CorporateChecking||U===n.CorporateSavings;return(0,s.useEffect)((()=>{var e;v("companyName",T?null===(e=y())||void 0===e?void 0:e.company:void 0)}),[T,v,y]),(0,s.useEffect)((()=>{I(e,N(E,M,T))}),[E,M,T,I,e]),s.createElement(c.A,{hideContentWhenLoading:!0,isLoading:V},s.createElement(d.A,{legend:s.createElement(m.A,{hidden:!0},E.translate("payment.bluesnap_direct_electronic_check_label")),style:{paddingBottom:"1rem"}},D&&s.createElement("div",{className:"checkout-ach-form__instrument"},s.createElement(l.A,{instruments:j,onSelectInstrument:O,onUseNewInstrument:B,selectedInstrument:z})),M&&s.createElement(f,{language:E,shouldRenderCompanyName:T}),s.createElement(b.A,{labelContent:E.translate("payment.bluesnap_direct_permission"),name:"shopperPermission",onChange:P}),q&&s.createElement(o.A,{instrumentId:null==z?void 0:z.bigpayToken,instruments:j,isAccountInstrument:!0})))}),[{id:"ecp",gateway:"bluesnapdirect"}]);var F=a(31698);const L=(0,u.A)((e=>{var{checkoutService:t}=e,a=(0,i.__rest)(e,["checkoutService"]);const n=(0,s.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{integrations:[r.jA]}))),[t]);return s.createElement(F.A,Object.assign({},a,{checkoutService:t,deinitializePayment:t.deinitializePayment,initializePayment:n}))}),[{gateway:"bluesnapdirect"}]),j=e=>{return!("object"!=typeof e||null===e||!("sepaCreditorCompanyName"in e&&"string"==typeof e.sepaCreditorCompanyName||"idealIssuers"in e&&(t=e.idealIssuers,Array.isArray(t)&&t.length&&"issuerId"in t[0]&&"issuerName"in t[0])));var t};var z=a(74411);const O=e=>{const[t,a]=(0,s.useState)(),{checkoutState:n}=(0,E.Q)(),i=n.data.getCustomer(),r=n.data.getInstruments(e),{paymentForm:l}=(0,S.N)(),{setFieldValue:o}=l,u=(0,s.useMemo)((()=>r?r.filter(z.P):[]),[r]),c=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled),d=c&&u.length>0,m=d&&!t,b=(0,s.useCallback)((()=>{if(!u.length)return;return u.filter((({defaultInstrument:e})=>e))[0]||u[0]}),[u]);(0,s.useEffect)((()=>{a(c?b():void 0)}),[c,b]),(0,s.useEffect)((()=>{d||o("instrumentId","")}),[o,d]);const g=(0,s.useCallback)((e=>{a((0,v.find)(u,{bigpayToken:e})),o("instrumentId",e),o("shouldSetAsDefaultInstrument",!1)}),[u,o]),p=(0,s.useCallback)((()=>{a(void 0),o("instrumentId",""),o("shouldSaveInstrument",!1),o("shouldSetAsDefaultInstrument",!1)}),[o]);return{accountInstruments:u,currentInstrument:t,handleSelectInstrument:g,handleUseNewInstrument:p,isInstrumentFeatureAvailable:c,shouldShowInstrumentFieldset:d,shouldCreateNewInstrument:m}},B=(0,A.Bj)((function(e,t){const a=Object.assign(Object.assign({},t?{}:{instrumentId:(0,w.Yj)().required()}),t?{iban:(0,w.Yj)().matches(/^[a-zA-Z0-9]+$/i,e.translate("address.invalid_characters_error",{label:"IBAN"})).required(e.translate("payment.sepa_account_number_required")),firstName:(0,w.Yj)().required(e.translate("address.first_name_required_error")),lastName:(0,w.Yj)().required(e.translate("address.last_name_required_error"))}:{});return(0,w.Ik)(a)})),q=(0,u.A)((e=>{const{method:t,checkoutService:{initializePayment:a,deinitializePayment:n,loadInstruments:u},checkoutState:{data:{isPaymentDataRequired:g},statuses:{isLoadingInstruments:p}},paymentForm:{disableSubmit:y,setValidationSchema:h},language:_,onUnhandledError:f}=e;if(!j(t.initializationData))throw new Error("Unable to get initialization data");const[v,C]=(0,s.useState)(!0),E=(0,s.useCallback)((e=>C(!e)),[C]);(0,s.useEffect)((()=>y(t,g()&&v)),[y,v,g,t]);const S=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield a({gatewayId:t.gateway,methodId:t.id,integrations:[r.jA]})}))),[a,t]),k=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield n({gatewayId:t.gateway,methodId:t.id})}))),[n,t.gateway,t.id]);(0,s.useEffect)((()=>(S(),()=>{k()})),[k,S]);const{accountInstruments:A,currentInstrument:w,handleSelectInstrument:N,handleUseNewInstrument:P,isInstrumentFeatureAvailable:F,shouldShowInstrumentFieldset:L,shouldCreateNewInstrument:z}=O(t),q=!L||z;(0,s.useEffect)((()=>{h(t,B(_,q))}),[_,q,h,t]),(0,s.useEffect)((()=>{F&&(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield u()}catch(e){e instanceof Error&&f(e)}}))}),[]);const D=p();return s.createElement(c.A,{hideContentWhenLoading:!0,isLoading:D},s.createElement(d.A,{legend:s.createElement(m.A,{hidden:!0},_.translate("payment.bluesnap_direct_sepa_direct_debit")),style:{paddingBottom:"1rem"}},L&&s.createElement("div",{className:"checkout-ach-form__instrument"},s.createElement(l.A,{instruments:A,onSelectInstrument:N,onUseNewInstrument:P,selectedInstrument:w})),q&&s.createElement(s.Fragment,null,s.createElement(I,{autoComplete:"iban",labelContent:_.translate("payment.bluesnap_direct_iban.label"),name:"iban",useFloatingLabel:!0}),s.createElement(I,{labelContent:_.translate("address.first_name_label"),name:"firstName",useFloatingLabel:!0}),s.createElement(I,{labelContent:_.translate("address.last_name_label"),name:"lastName",useFloatingLabel:!0})),s.createElement(b.A,{labelContent:_.translate("payment.bluesnap_direct_sepa_mandate_disclaimer",{creditorName:t.initializationData.sepaCreditorCompanyName}),name:"shopperPermission",onChange:E}),F&&s.createElement(o.A,{instrumentId:null==w?void 0:w.bigpayToken,instruments:A,isAccountInstrument:!0})))}),[{id:"sepa_direct_debit",gateway:"bluesnapdirect"}]),D=(0,A.Bj)((function(e){return(0,w.Ik)({bic:(0,w.Yj)().required(e.translate("payment.ideal_bic_required"))})})),R=(0,u.A)((({method:e,checkoutService:{initializePayment:t,deinitializePayment:a},paymentForm:{setValidationSchema:n},language:l})=>{if(!j(e.initializationData))throw new Error("Unable to get initialization data");const{idealIssuers:o}=e.initializationData,u=o.map((e=>({value:e.issuerId,label:e.issuerName}))),c=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){n(e,D(l)),yield t({gatewayId:e.gateway,methodId:e.id,integrations:[r.jA]})}))),[t,e,n,l]),b=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield a({gatewayId:e.gateway,methodId:e.id})}))),[a,e.gateway,e.id]);return(0,s.useEffect)((()=>(c(),()=>{b()})),[b,c]),s.createElement(d.A,{legend:s.createElement(m.A,{hidden:!0},l.translate("payment.ideal.label")),style:{paddingBottom:"1rem"}},s.createElement(_,{labelContent:l.translate("payment.ideal.label"),name:"bic",options:{helperLabel:l.translate("payment.select_your_bank"),items:u}}))}),[{id:"ideal",gateway:"bluesnapdirect"}]);var V=a(24391);const M=(0,u.A)((e=>{var{checkoutService:t,checkoutState:a,method:n,paymentForm:l}=e,o=(0,i.__rest)(e,["checkoutService","checkoutState","method","paymentForm"]);const[u,d]=(0,s.useState)(!1),[m,b]=(0,s.useState)(),g=(0,s.useRef)({paymentPageContentRef:(0,s.createRef)()}),p=(0,s.useCallback)((()=>{b(void 0),g.current.cancelBlueSnapV2Payment&&(g.current.cancelBlueSnapV2Payment(),g.current.cancelBlueSnapV2Payment=void 0)}),[]),y=(0,s.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{integrations:[r.yk],bluesnapv2:{onLoad(e,t){b(e),d(!0),g.current.cancelBlueSnapV2Payment=t},style:{border:"1px solid lightgray",height:"60vh",width:"100%"}}}))),[t]),h=(0,s.useCallback)((()=>{g.current.paymentPageContentRef.current&&m&&(m.addEventListener("load",(()=>{d(!1)})),g.current.paymentPageContentRef.current.appendChild(m))}),[m]);return s.createElement(s.Fragment,null,s.createElement(F.A,Object.assign({},o,{checkoutService:t,checkoutState:a,deinitializePayment:t.deinitializePayment,initializePayment:y,method:n,paymentForm:l})),s.createElement(V.A,{additionalModalClassName:"modal--bluesnap",isOpen:!!m,onAfterOpen:h,onRequestClose:p,shouldShowCloseButton:!0},s.createElement(c.A,{isLoading:u},s.createElement("div",{ref:g.current.paymentPageContentRef}))))}),[{gateway:"bluesnapv2"}]),U=(0,A.Bj)((function(e){return(0,w.Ik)({iban:(0,w.Yj)().matches(/^[a-zA-Z0-9]+$/i,e.translate("address.invalid_characters_error",{label:"IBAN"})).required(e.translate("payment.pay_by_bank_iban_required"))})})),T=(0,u.A)((({method:e,language:t,paymentForm:{setValidationSchema:a},checkoutService:{initializePayment:n,deinitializePayment:l}})=>{if(!j(e.initializationData))throw new Error("Unable to get initialization data");const o=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){a(e,U(t)),yield n({gatewayId:e.gateway,methodId:e.id,integrations:[r.jA]})}))),[n,t,e,a]),u=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield l({gatewayId:e.gateway,methodId:e.id})}))),[l,e.gateway,e.id]);return(0,s.useEffect)((()=>(o(),()=>{u()})),[u,o]),s.createElement(d.A,{legend:s.createElement(m.A,{hidden:!0},t.translate("payment.bluesnap_direct_iban.label")),style:{paddingBottom:"1rem"}},s.createElement(I,{autoComplete:"iban",labelContent:t.translate("payment.bluesnap_direct_iban.label"),name:"iban",useFloatingLabel:!0}))}),[{id:"pay_by_bank",gateway:"bluesnapdirect"}])},94611:(e,t,a)=>{function n({config:e,customer:t,isUsingMultiShipping:a,paymentMethod:n}){return!(!e.checkoutSettings.isCardVaultingEnabled||!n.config.isVaultingEnabled||t.isGuest||a)}a.d(t,{A:()=>n})}}]);
//# sourceMappingURL=blue-snap-v2-payment-method-6bc70bb9.js.map