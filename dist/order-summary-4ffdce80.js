"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[134],{8294:(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});var n=r(31635),a=r(14371),o=r(30455),c=r(41109),i=r(49655);const s=function(e){var t=e.children;return o.createElement("header",{className:"cart-header"},o.createElement("h3",{className:"cart-title optimizedCheckout-headingSecondary"},o.createElement(i.A,{id:"cart.cart_heading"})),t)};var u=r(62901),l=r(66317),d=r(62755),m=r(60164),p=r(97947),h=r(9660);const f=(0,r(45293).A)((function(e){var t=e.checkoutState.data,r=t.getBillingAddress,n=t.getCheckout,a=t.getCustomer,o=r(),c=n(),i=a();return o&&c&&i?{email:o.email||i.email,customer:i}:null}))((function(e){return e.customer.isGuest?null:o.createElement(o.Fragment,null,o.createElement("a",{href:"/certificates",target:"_blank",rel:"noopener noreferrer"},"Use Tax/ Exempt Certificate"))}));var C=r(84744),g=function(e){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){var t,r,a;return(0,n.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,(0,n.__awaiter)(void 0,void 0,void 0,(function(){var e;return(0,n.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,fetch("/customer/current.jwt?app_client_id=bzhkzdt0f7vrrg92o4iym8rxvd872qj",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}})];case 1:return[4,t.sent().json()];case 2:return[2,t.sent().token];case 3:return e=t.sent(),console.error("Error fetching token:",e),[2,null];case 4:return[2]}}))}))];case 1:if(!(t=o.sent()))throw new Error("Token not available");return r=function(e){return{Accept:"application/json","Content-Type":"application/json","X-Current-Customer":e}}(t),[4,C.A.post("".concat("https://yx1041xohb.execute-api.us-east-2.amazonaws.com/Prod/","createTransaction"),e,{headers:r})];case 2:return[2,o.sent().data];case 3:throw a=o.sent(),console.error("Error validating with avalara:",a),a;case 4:return[2]}}))}))};const y=function(e){var t=e.isTaxIncluded,r=e.taxes,C=e.storeCurrency,y=e.shopperCurrency,v=e.headerLink,E=e.additionalLineItems,_=e.lineItems,x=e.total,A=(0,n.__rest)(e,["isTaxIncluded","taxes","storeCurrency","shopperCurrency","headerLink","additionalLineItems","lineItems","total"]);(0,o.useEffect)((function(){(0,a.createCheckoutService)().loadCheckout().then((function(e){var t,r,a=e.data.getShippingAddress(),o=e.data.getCart(),c=(null===(t=e.data.getCustomer())||void 0===t?void 0:t.id)||"",i=null===(r=e.data.getConsignments())||void 0===r?void 0:r.reduce((function(e,t){var r;return e+((null===(r=t.selectedShippingOption)||void 0===r?void 0:r.cost)||0)}),0);a&&o&&c&&function(e,t,r,a,o){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){var c,i,s,u,l,d,m,p;return(0,n.__generator)(this,(function(h){switch(h.label){case 0:c=(new Date).toISOString().split("T")[0],i=(0,n.__spreadArray)((0,n.__spreadArray)((0,n.__spreadArray)((0,n.__spreadArray)([],r.physicalItems,!0),r.digitalItems,!0),r.customItems,!0),r.giftCertificates,!0),s=i.map((function(e,t){return{number:"".concat(t+1),quantity:e.quantity||1,amount:e.listPrice||e.amount||0,taxCode:"P0000000",itemCode:e.sku||e.itemCode||"item-".concat(t+1),description:e.name||"Product"}})),o>0&&s.push({number:"".concat(s.length+1),quantity:1,amount:o,taxCode:"FR00000",itemCode:"shipping",description:"Shipping Cost"}),u={id:e.id,code:e.id,adjustmentReason:"Other",adjustmentDescription:"Transaction for tax calculation",createTransactionModel:{lines:s.map((function(e,t){return{number:"".concat(t+1),quantity:e.quantity,amount:e.amount,taxCode:e.taxCode,itemCode:e.itemCode,description:e.description}})),type:"SalesInvoice",date:c,customerCode:a,purchaseOrderNo:"".concat(c,"-").concat(e.id),addresses:{singleLocation:{line1:t.address1,line2:t.address2,city:t.city,region:t.region,country:t.country,postalCode:t.postalCode}},commit:!1,currencyCode:"USD",description:"Order transaction"}},h.label=1;case 1:return h.trys.push([1,3,,4]),[4,g(u)];case 2:return l=h.sent(),d=l.totalTax,m=l.summary,d>0?[2,m.filter((function(e){return e.taxCalculated>0})).map((function(e){return{name:e.taxName,amount:e.taxCalculated}}))]:[2,[]];case 3:throw p=h.sent(),console.error("Error al calcular los impuestos:",p),p;case 4:return[2]}}))}))}(o,a,_,c,i).then((function(e){console.log(e)})).catch((function(e){console.error("Error al calcular impuestos:",e)}))})).catch((function(e){e instanceof Error?console.error("Error al cargar el checkout:",e.message):console.error("Error desconocido al cargar el checkout")}))}),[_]);var k=(0,o.useMemo)((function(){return(0,h.A)(_)}),[_]),I=t&&r&&r.length>0;return o.createElement("article",{className:"cart optimizedCheckout-orderSummary","data-test":"cart"},o.createElement(s,null,v),o.createElement(d.A,null,o.createElement(u.A,{displayLineItemsCount:!0,items:k})),o.createElement(c.Y,{region:"summary.lastItem.after"}),o.createElement(d.A,null,o.createElement(m.A,(0,n.__assign)({isTaxIncluded:t,taxes:r},A)),E),o.createElement(d.A,null,o.createElement(f,null)),o.createElement(d.A,null,o.createElement(p.A,{orderAmount:x,shopperCurrencyCode:y.code,storeCurrencyCode:C.code})),I&&o.createElement(d.A,null,o.createElement("h5",{className:"cart-taxItem cart-taxItem--subtotal optimizedCheckout-contentPrimary","data-test":"tax-text"},o.createElement(i.A,{id:"tax.inclusive_label"})),(r||[]).map((function(e,t){return o.createElement(l.A,{amount:e.amount,key:t,label:e.name,testId:"cart-taxes"})}))))}}}]);
//# sourceMappingURL=order-summary-4ffdce80.js.map