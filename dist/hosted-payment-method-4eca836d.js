"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[7747],{42518:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var s=n(31635),i=n(44218),a=n(69440),r=n(70355),l=n(68512),m=n(68801),o=n(45293),c=n(83742),d=n(49655),u=n(48447),p=n(60833),I=n(43586),h=n(29853),E=n(91589),g=n(3375),C=n.n(g),N=n(67113),w=n(97712),b=n(45080);const v=(0,b.A)((()=>r.createElement("svg",{height:"25",viewBox:"0 0 35 25",width:"35",xmlns:"http://www.w3.org/2000/svg"},r.createElement("path",{clipRule:"evenodd",d:"M33 2H2L2 23H33V2ZM2 0C0.895431 0 0 0.89543 0 2V23C0 24.1046 0.89543 25 2 25H33C34.1046 25 35 24.1046 35 23V2C35 0.89543 34.1046 0 33 0H2Z",fill:"#D1D7E0",fillRule:"evenodd"}),r.createElement("path",{clipRule:"evenodd",d:"M11 12C11 11.4477 11.4477 11 12 11H24C24.5523 11 25 11.4477 25 12V14C25 14.5523 24.5523 15 24 15H12C11.4477 15 11 14.5523 11 14V12Z",fill:"#D1D7E0",fillRule:"evenodd"}),r.createElement("path",{clipRule:"evenodd",d:"M19 6C19.5523 6 20 6.44772 20 7V19C20 19.5523 19.5523 20 19 20H17C16.4477 20 16 19.5523 16 19V7C16 6.44772 16.4477 6 17 6H19Z",fill:"#D1D7E0",fillRule:"evenodd"}))));var y=n(96131);class k extends r.PureComponent{componentDidMount(){const{selectedInstrumentId:e}=this.props;setTimeout((()=>this.updateFieldValue(e)))}componentDidUpdate(e){const{selectedInstrumentId:t}=e,{selectedInstrumentId:n}=this.props;t!==n&&this.updateFieldValue(n)}componentWillUnmount(){const{selectedInstrumentId:e,field:t}=this.props;""===t.value&&void 0!==e&&this.updateFieldValue()}render(){const{field:e,instruments:t,onSelectInstrument:n,onUseNewInstrument:i,selectedInstrumentId:l}=this.props,m=(0,a.find)(t,{bigpayToken:l}),{value:o}=e,c=(0,s.__rest)(e,["value"]);return r.createElement("div",{className:"instrumentSelect"},r.createElement(N.A,{dropdown:r.createElement(A,{instruments:t,onSelectInstrument:n,onUseNewInstrument:i,selectedInstrumentId:l})},r.createElement(f,{instrument:m,testId:"instrument-select"}),r.createElement("input",Object.assign({type:"hidden",value:o||""},c))))}updateFieldValue(e=""){const{form:t,field:n}=this.props;t.setFieldValue(n.name,e)}}const A=({instruments:e,selectedInstrumentId:t,onSelectInstrument:n,onUseNewInstrument:s})=>r.createElement("ul",{className:"instrumentSelect-dropdownMenu instrumentSelect-dropdownMenuNext dropdown-menu","data-test":"instrument-select-menu"},e.map((e=>r.createElement("li",{className:C()("instrumentSelect-option dropdown-menu-item",{"instrumentSelect-option--selected":e.bigpayToken===t}),key:e.bigpayToken},r.createElement(S,{instrument:e,onClick:n,testId:"instrument-select-option"})))),r.createElement("li",{className:"instrumentSelect-option instrumentSelect-option--addNew dropdown-menu-item"},r.createElement(M,{onClick:s,testId:"instrument-select-option-use-new"}))),f=({instrument:e,testId:t,onClick:n})=>e?(0,y.A)(e)?r.createElement(D,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",instrument:e,onClick:n,testId:t}):r.createElement(_,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",instrument:e,onClick:n,testId:t}):r.createElement(M,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",testId:t}),S=({instrument:e,onClick:t=a.noop})=>{const n=(0,r.useCallback)((()=>{t(e.bigpayToken)}),[t,e]);return(0,y.A)(e)?r.createElement(D,{instrument:e,onClick:n,testId:"instrument-select-option"}):r.createElement(_,{instrument:e,onClick:n,testId:"instrument-select-option"})},_=({className:e,instrument:{externalId:t},testId:n,onClick:s})=>r.createElement("button",{className:e,"data-test":n,onClick:s,type:"button"},r.createElement("div",{className:"instrumentSelect-details"},r.createElement(w.A,{additionalClassName:"accountIcon-icon",size:b.l.Medium}),r.createElement("div",{className:"instrumentSelect-account","data-test":`${n}-externalId`},t))),D=({className:e,instrument:t,testId:n,onClick:s})=>r.createElement("button",{className:e,"data-test":n,onClick:s,type:"button"},r.createElement("div",{className:"instrumentSelect-details"},r.createElement("div",{className:"instrumentSelect-card"},r.createElement(d.A,{data:{accountNumber:t.accountNumber},id:"payment.instrument_account_number_ending"})),r.createElement("div",{className:"instrumentSelect-issuer"},r.createElement(d.A,{id:"payment.instrument_issuer"}),": ",t.issuer))),M=({className:e,testId:t,onClick:n=a.noop})=>r.createElement("button",{className:e,"data-test":t,onClick:n,type:"button"},r.createElement("div",{className:"instrumentSelect-details instrumentSelect-details--addNew"},r.createElement(v,{additionalClassName:"accountIcon-icon",size:b.l.Medium}),r.createElement("div",{className:"instrumentSelect-account"},r.createElement(d.A,{id:"payment.account_instrument_add_action"})))),U=k;var V=n(42291);const z=(0,r.memo)((({instruments:e,onSelectInstrument:t,onUseNewInstrument:n,selectedInstrument:s})=>{const i=(0,r.useCallback)((i=>r.createElement(U,Object.assign({},i,{instruments:e,onSelectInstrument:t,onUseNewInstrument:n,selectedInstrumentId:s&&s.bigpayToken}))),[e,t,n,s]),a=(0,r.useCallback)((t=>r.createElement(V.A,Object.assign({instruments:e},t))),[e]);return r.createElement(p.A,{additionalClassName:"instrumentFieldset",legend:r.createElement(I.A,{hidden:!0},r.createElement(d.A,{id:"payment.account_instrument_text"}))},r.createElement(E.A,{modal:a},(({onClick:e})=>r.createElement("button",{className:"instrumentModal-trigger",onClick:e,type:"button"},r.createElement(d.A,{id:"payment.instrument_manage_button"})))),r.createElement(h.A,{name:"instrumentId",render:i}),0===e.length&&r.createElement("div",{className:"instrumentSelect-note"},r.createElement(u.A,{id:"payment.account_instrument_new_shipping_address"})))}));var F=n(77269),x=n(13363),H=n(98873),R=n(67874);class T extends r.Component{constructor(){super(...arguments),this.state={isAddingNewInstrument:!1},this.handleUseNewInstrument=()=>{this.setState({isAddingNewInstrument:!0,selectedInstrument:void 0})},this.handleSelectInstrument=e=>{const{instruments:t}=this.props;this.setState({isAddingNewInstrument:!1,selectedInstrument:(0,a.find)(t,{bigpayToken:e})})}}componentDidMount(){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const{initializePayment:e,isInstrumentFeatureAvailable:t,loadInstruments:n,method:s,onUnhandledError:i=a.noop}=this.props;try{yield e({gatewayId:s.gateway,methodId:s.id}),t&&(yield n())}catch(e){i(e)}}))}componentWillUnmount(){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const{deinitializePayment:e,method:t,onUnhandledError:n=a.noop}=this.props;try{yield e({gatewayId:t.gateway,methodId:t.id})}catch(e){n(e)}}))}render(){const{description:e,isInitializing:t=!1,isLoadingInstruments:n,instruments:s,isNewAddress:i,isInstrumentFeatureAvailable:a}=this.props,{selectedInstrument:l=this.getDefaultInstrument()}=this.state,o=t||n,c=a&&(s.length>0||i);return e||a?r.createElement(m.A,{hideContentWhenLoading:!0,isLoading:o},r.createElement("div",{className:"paymentMethod paymentMethod--hosted"},e,c&&r.createElement(z,{instruments:s,onSelectInstrument:this.handleSelectInstrument,onUseNewInstrument:this.handleUseNewInstrument,selectedInstrument:l}),a&&r.createElement(H.A,{instrumentId:l&&l.bigpayToken,isAccountInstrument:!0}))):null}getDefaultInstrument(){const{isAddingNewInstrument:e}=this.state,{instruments:t}=this.props;if(!e&&t.length)return(0,a.find)(t,{defaultInstrument:!0})||t[0]}}const L=(0,c.A)((0,l.A)((0,R.A)((0,o.A)((()=>{const e=(0,i.memoizeOne)(((e=[])=>e.filter(F.A))),t=(0,i.memoizeOne)(((e=[])=>e.filter((({trustedShippingAddress:e})=>e))));return(n,s)=>{const{method:i}=s,{checkoutService:a,checkoutState:r}=n,{data:{getCart:l,getConfig:m,getCustomer:o,getInstruments:c,isPaymentDataRequired:d,isPaymentDataSubmitted:u},statuses:{isLoadingInstruments:p}}=r,I=l(),h=m(),E=o();if(!(h&&I&&E&&i))return null;const g=e(c(i)),C=t(g);return{instruments:C,isNewAddress:0===C.length&&g.length>0,isInstrumentFeatureAvailable:!u(i.id,i.gateway)&&(0,x.A)({config:h,customer:E,paymentMethod:i}),isLoadingInstruments:p(),isPaymentDataRequired:d(),loadInstruments:a.loadInstruments}}}))(T))))}}]);
//# sourceMappingURL=hosted-payment-method-4eca836d.js.map