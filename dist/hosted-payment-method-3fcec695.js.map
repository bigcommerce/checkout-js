{"version":3,"file":"hosted-payment-method-3fcec695.js","mappings":"2cAIA,MAuBA,GAAe,EAAAA,EAAA,IAvB2B,IACtC,uBAAKC,OAAO,KAAKC,QAAQ,YAAYC,MAAM,KAAKC,MAAM,8BAClD,wBACIC,SAAS,UACTC,EAAE,6IACFC,KAAK,UACLC,SAAS,YAEb,wBACIH,SAAS,UACTC,EAAE,sIACFC,KAAK,UACLC,SAAS,YAEb,wBACIH,SAAS,UACTC,EAAE,gIACFC,KAAK,UACLC,SAAS,e,eCErB,MAAMC,UAAgC,EAAAC,cAClC,iBAAAC,GACI,MAAM,qBAAEC,GAAyBC,KAAKC,MAKtCC,YAAW,IAAMF,KAAKG,iBAAiBJ,IAC3C,CAEA,kBAAAK,CAAmBC,GACf,MAAQN,qBAAsBO,GAA6BD,GACrD,qBAAEN,GAAyBC,KAAKC,MAElCK,IAA6BP,GAC7BC,KAAKG,iBAAiBJ,EAE9B,CAEA,oBAAAQ,GACI,MAAM,qBAAER,EAAoB,MAAES,GAAUR,KAAKC,MAEzB,KAAhBO,EAAMC,YAAyCC,IAAzBX,GACtBC,KAAKG,kBAEb,CAEA,MAAAQ,GACI,MAAM,MAAEH,EAAK,YAAEI,EAAW,mBAAEC,EAAkB,mBAAEC,EAAkB,qBAAEf,GAChEC,KAAKC,MAEHc,GAAqB,IAAAC,MAAKJ,EAAa,CAAEK,YAAalB,KACtD,MAAEU,GAA8BD,EAApBU,GAAe,YAAKV,EAAhC,WAEN,OACI,uBAAKW,UAAU,oBACX,gBAACC,EAAA,EAAe,CACZC,SACI,gBAACC,EAAqB,CAClBV,YAAaA,EACbC,mBAAoBA,EACpBC,mBAAoBA,EACpBf,qBAAsBA,KAI9B,gBAACwB,EAA6B,CAC1BC,WAAYT,EACZU,OAAO,sBAGX,uCAAOC,KAAK,SAASjB,MAAOA,GAAS,IAAQS,KAI7D,CAEQ,gBAAAf,CAAiBwB,EAAe,IACpC,MAAM,KAAEC,EAAI,MAAEpB,GAAUR,KAAKC,MAE7B2B,EAAKC,cAAcrB,EAAMsB,KAAMH,EACnC,EAUJ,MAAML,EAAuE,EACzEV,cACAb,uBACAc,qBACAC,wBAGI,sBACIK,UAAU,gFAA+E,YAC/E,0BAETP,EAAYmB,KAAKP,GACd,sBACIL,UAAW,IAAW,6CAA8C,CAChE,oCACIK,EAAWP,cAAgBlB,IAEnCiC,IAAKR,EAAWP,aAEhB,gBAACgB,EAAuB,CACpBT,WAAYA,EACZU,QAASrB,EACTY,OAAO,gCAKnB,sBAAIN,UAAU,8EACV,gBAACgB,EAA6B,CAC1BD,QAASpB,EACTW,OAAO,uCAarBF,EAAuF,EACzFC,aACAC,SACAS,aAEKV,GASG,EAAAY,EAAA,GAAwBZ,GAQ5B,gBAACa,EAAsB,CACnBlB,UAAU,mFACVK,WAAYA,EACZU,QAASA,EACTT,OAAQA,IAXZ,gBAACa,EAAyB,CACtBnB,UAAU,mFACVK,WAAYA,EACZU,QAASA,EACTT,OAAQA,IAZR,gBAACU,EAA6B,CAC1BhB,UAAU,mFACVM,OAAQA,IA4BlBQ,EAA2E,EAC7ET,aACAU,UAAU,EAAAK,SAEV,MAAMC,GAAc,IAAAC,cAAY,KAC5BP,EAAQV,EAAWP,eACpB,CAACiB,EAASV,IAEb,OAAQ,EAAAY,EAAA,GAAwBZ,GAO5B,gBAACa,EAAsB,CACnBb,WAAYA,EACZU,QAASM,EACTf,OAAO,6BATX,gBAACa,EAAyB,CACtBd,WAAYA,EACZU,QAASM,EACTf,OAAO,8BAkBba,EAA+E,EACjFnB,YACAK,YAAckB,cACdjB,SACAS,aAGI,0BAAQf,UAAWA,EAAS,YAAaM,EAAQS,QAASA,EAASR,KAAK,UACpE,uBAAKP,UAAU,4BAKX,gBAACwB,EAAA,EAAU,CAACC,oBAAoB,mBAAmBC,KAAM,IAASC,SAElE,uBAAK3B,UAAU,2BAA0B,YAAY,GAAGM,gBACnDiB,KAcfL,EAAyE,EAC3ElB,YACAK,aACAC,SACAS,aAGI,0BAAQf,UAAWA,EAAS,YAAaM,EAAQS,QAASA,EAASR,KAAK,UACpE,uBAAKP,UAAU,4BAKX,uBAAKA,UAAU,yBACX,gBAAC4B,EAAA,EAAgB,CACbC,KAAM,CAAEC,cAAezB,EAAWyB,eAClCC,GAAG,8CAGX,uBAAK/B,UAAU,2BACX,gBAAC4B,EAAA,EAAgB,CAACG,GAAG,8B,KAAiC1B,EAAW2B,UAa/EhB,EAAuF,EACzFhB,YACAM,SACAS,UAAU,EAAAK,QAEV,0BAAQpB,UAAWA,EAAS,YAAaM,EAAQS,QAASA,EAASR,KAAK,UACpE,uBAAKP,UAAU,6DACX,gBAAC,EAAc,CAACyB,oBAAoB,mBAAmBC,KAAM,IAASC,SAEtE,uBAAK3B,UAAU,4BACX,gBAAC4B,EAAA,EAAgB,CAACG,GAAG,6CAMrC,I,eCrQA,MAsDA,GAAe,IAAAE,OAtDsE,EACjFxC,cACAC,qBACAC,qBACAC,yBAEA,MAAMsC,GAAc,IAAAZ,cACfjC,GACG,gBAAC,EAAuB,iBAChBA,EAAK,CACTI,YAAaA,EACbC,mBAAoBA,EACpBC,mBAAoBA,EACpBf,qBAAsBgB,GAAsBA,EAAmBE,gBAGvE,CAACL,EAAaC,EAAoBC,EAAoBC,IAGpDuC,GAAc,IAAAb,cACfxC,GACG,gBAACsD,EAAA,EAAsB,eAAC3C,YAAaA,GAAiBX,KAE1D,CAACW,IAGL,OACI,gBAAC4C,EAAA,EAAQ,CACLZ,oBAAoB,qBACpBa,OACI,gBAACC,EAAA,EAAM,CAACC,QAAM,GACV,gBAACZ,EAAA,EAAgB,CAACG,GAAG,sCAI7B,gBAACU,EAAA,EAAY,CAACC,MAAOP,IAChB,EAAGpB,aACA,0BAAQf,UAAU,0BAA0Be,QAASA,EAASR,KAAK,UAC/D,gBAACqB,EAAA,EAAgB,CAACG,GAAG,wCAKjC,gBAACY,EAAA,EAAc,CAAChC,KAAK,eAAenB,OAAQ0C,IAEpB,IAAvBzC,EAAYmD,QACT,uBAAK5C,UAAU,yBACX,gBAAC6C,EAAA,EAAc,CAACd,GAAG,yD,gDCnBvC,MAAMe,UAA4B,EAAAC,UAAlC,c,oBAQI,KAAAC,MAAkC,CAC9BC,uBAAuB,GA+FnB,KAAAC,uBAAqC,KACzCrE,KAAKsE,SAAS,CACVF,uBAAuB,EACvBrD,wBAAoBL,KAIpB,KAAA6D,uBAAgDrB,IACpD,MAAM,YAAEtC,GAAgBZ,KAAKC,MAE7BD,KAAKsE,SAAS,CACVF,uBAAuB,EACvBrD,oBAAoB,IAAAC,MAAKJ,EAAa,CAAEK,YAAaiC,MAGjE,CA3GU,iBAAApD,G,sDACF,MAAM,kBACF0E,EACAC,6BAA8BC,EAAgC,gBAC9DC,EAAe,OACfC,EAAM,iBACNC,EAAmB,EAAAtC,MACnBvC,KAAKC,MAET,UACUuE,EAAkB,CACpBM,UAAWF,EAAOG,QAClBC,SAAUJ,EAAO1B,KAGjBwB,UACMC,IAEd,CAAE,MAAOM,GACLJ,EAAiBI,EACrB,CACJ,G,CAEM,oBAAA1E,G,sDACF,MAAM,oBAAE2E,EAAmB,OAAEN,EAAM,iBAAEC,EAAmB,EAAAtC,MAASvC,KAAKC,MAEtE,UACUiF,EAAoB,CACtBJ,UAAWF,EAAOG,QAClBC,SAAUJ,EAAO1B,IAEzB,CAAE,MAAO+B,GACLJ,EAAiBI,EACrB,CACJ,G,CAEA,MAAAtE,GACI,MAAM,YACFwE,EAAW,eACXC,GAAiB,EAAK,qBACtBC,EAAoB,YACpBzE,EAAW,aACX0E,EACAb,6BAA8BC,GAC9B1E,KAAKC,OAEH,mBAAEc,EAAqBf,KAAKuF,wBAA2BvF,KAAKmE,MAE5DqB,EAAYJ,GAAkBC,EAC9BI,EACFf,IAAqC9D,EAAYmD,OAAS,GAAKuB,GAEnE,OAAKH,GAAgBT,EAKjB,gBAACgB,EAAA,EAAc,CAACC,wBAAsB,EAACH,UAAWA,GAC9C,uBAAKrE,UAAU,uCACVgE,EAEAM,GACG,gBAAC,EAAyB,CACtB7E,YAAaA,EACbC,mBAAoBb,KAAKuE,uBACzBzD,mBAAoBd,KAAKqE,uBACzBtD,mBAAoBA,IAI3B2D,GACG,gBAACkB,EAAA,EAAuB,CACpBjE,aAAcZ,GAAsBA,EAAmBE,YACvD4E,qBAAqB,MApB9B,IA0Bf,CAEQ,oBAAAN,GACJ,MAAM,sBAAEnB,GAA0BpE,KAAKmE,OACjC,YAAEvD,GAAgBZ,KAAKC,MAE7B,IAAImE,GAA0BxD,EAAYmD,OAI1C,OAAO,IAAA/C,MAAKJ,EAAa,CAAEkF,mBAAmB,KAAWlF,EAAY,EACzE,EAmBJ,MAyDA,GAAe,EAAAmF,EAAA,IACX,EAAAC,EAAA,IAAa,EAAAC,EAAA,IAAY,EAAAC,EAAA,IAtDzB,KACA,MAAMC,GAA2B,IAAAC,aAAW,CAACxF,EAAmC,KAC5EA,EAAYyF,OAAOR,EAAA,KAEjBS,GAA2B,IAAAF,aAAW,CAACxF,EAAmC,KAC5EA,EAAYyF,QAAO,EAAGE,4BAA6BA,MAGvD,MAAO,CAACC,EAASvG,KACb,MAAM,OAAE2E,GAAW3E,GAEb,gBAAEwG,EAAe,cAAEC,GAAkBF,GAGvCxD,MAAM,QACF2D,EAAO,UACPC,EAAS,YACTC,EAAW,eACXC,EAAc,sBACdC,EAAqB,uBACrBC,GAEJC,UAAU,qBAAE5B,IACZqB,EAEEQ,EAAOP,IACPQ,EAASP,IACTQ,EAAWP,IAEjB,KAAKM,GAAWD,GAASE,GAAaxC,GAClC,OAAO,KAGX,MAAMyC,EAA2BlB,EAAyBW,EAAelC,IACnE0C,EAAqBhB,EAAyBe,GAEpD,MAAO,CACHzG,YAAa0G,EACbhC,aAA4C,IAA9BgC,EAAmBvD,QAAgBsD,EAAyBtD,OAAS,EACnFU,8BACKuC,EAAuBpC,EAAO1B,GAAI0B,EAAOG,WAC1C,EAAAN,EAAA,GAA6B,CACzB0C,SACAC,WACAG,cAAe3C,IAEvBS,qBAAsBA,IACtB0B,sBAAuBA,IACvBpC,gBAAiB8B,EAAgB9B,oBAMhB,CAAmCV,K","sources":["webpack://checkout/./packages/core/src/app/ui/icon/IconNewAccount.tsx","webpack://checkout/./packages/core/src/app/payment/storedInstrument/AccountInstrumentSelect.tsx","webpack://checkout/./packages/core/src/app/payment/storedInstrument/AccountInstrumentFieldset.tsx","webpack://checkout/./packages/core/src/app/payment/paymentMethod/HostedPaymentMethod.tsx"],"sourcesContent":["import React, { FunctionComponent } from 'react';\n\nimport withIconContainer from './withIconContainer';\n\nconst IconNewAccount: FunctionComponent = () => (\n    <svg height=\"25\" viewBox=\"0 0 35 25\" width=\"35\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path\n            clipRule=\"evenodd\"\n            d=\"M33 2H2L2 23H33V2ZM2 0C0.895431 0 0 0.89543 0 2V23C0 24.1046 0.89543 25 2 25H33C34.1046 25 35 24.1046 35 23V2C35 0.89543 34.1046 0 33 0H2Z\"\n            fill=\"#D1D7E0\"\n            fillRule=\"evenodd\"\n        />\n        <path\n            clipRule=\"evenodd\"\n            d=\"M11 12C11 11.4477 11.4477 11 12 11H24C24.5523 11 25 11.4477 25 12V14C25 14.5523 24.5523 15 24 15H12C11.4477 15 11 14.5523 11 14V12Z\"\n            fill=\"#D1D7E0\"\n            fillRule=\"evenodd\"\n        />\n        <path\n            clipRule=\"evenodd\"\n            d=\"M19 6C19.5523 6 20 6.44772 20 7V19C20 19.5523 19.5523 20 19 20H17C16.4477 20 16 19.5523 16 19V7C16 6.44772 16.4477 6 17 6H19Z\"\n            fill=\"#D1D7E0\"\n            fillRule=\"evenodd\"\n        />\n    </svg>\n);\n\nexport default withIconContainer(IconNewAccount);\n","import { AccountInstrument, AchInstrument, BankInstrument, PayPalInstrument } from '@bigcommerce/checkout-sdk';\nimport classNames from 'classnames';\nimport { FieldProps } from 'formik';\nimport { find, noop } from 'lodash';\nimport React, { FunctionComponent, PureComponent, ReactNode, useCallback } from 'react';\n\nimport { TranslatedString } from '@bigcommerce/checkout/locale';\n\nimport { DropdownTrigger } from '../../ui/dropdown';\nimport { IconNewAccount, IconPaypal, IconSize } from '../../ui/icon';\n\nimport isBankAccountInstrument from './isBankAccountInstrument';\n\nexport interface AccountInstrumentSelectProps extends FieldProps<string> {\n    instruments: AccountInstrument[];\n    selectedInstrumentId?: string;\n    onSelectInstrument(id: string): void;\n    onUseNewInstrument(): void;\n}\n\nexport interface AccountInstrumentSelectValues {\n    instrumentId: string;\n}\n\nclass AccountInstrumentSelect extends PureComponent<AccountInstrumentSelectProps> {\n    componentDidMount() {\n        const { selectedInstrumentId } = this.props;\n\n        // FIXME: Used setTimeout here because setFieldValue call doesnot set value if called before formik is properly mounted.\n        //        This ensures that update Field value is called after formik has mounted.\n        // See GitHub issue: https://github.com/jaredpalmer/formik/issues/930\n        setTimeout(() => this.updateFieldValue(selectedInstrumentId));\n    }\n\n    componentDidUpdate(prevProps: Readonly<AccountInstrumentSelectProps>) {\n        const { selectedInstrumentId: prevSelectedInstrumentId } = prevProps;\n        const { selectedInstrumentId } = this.props;\n\n        if (prevSelectedInstrumentId !== selectedInstrumentId) {\n            this.updateFieldValue(selectedInstrumentId);\n        }\n    }\n\n    componentWillUnmount() {\n        const { selectedInstrumentId, field } = this.props;\n\n        if (field.value === '' && selectedInstrumentId !== undefined) {\n            this.updateFieldValue();\n        }\n    }\n\n    render(): ReactNode {\n        const { field, instruments, onSelectInstrument, onUseNewInstrument, selectedInstrumentId } =\n            this.props;\n\n        const selectedInstrument = find(instruments, { bigpayToken: selectedInstrumentId });\n        const { value, ...otherFieldProps } = field;\n\n        return (\n            <div className=\"instrumentSelect\">\n                <DropdownTrigger\n                    dropdown={\n                        <AccountInstrumentMenu\n                            instruments={instruments}\n                            onSelectInstrument={onSelectInstrument}\n                            onUseNewInstrument={onUseNewInstrument}\n                            selectedInstrumentId={selectedInstrumentId}\n                        />\n                    }\n                >\n                    <AccountInstrumentSelectButton\n                        instrument={selectedInstrument}\n                        testId=\"instrument-select\"\n                    />\n\n                    <input type=\"hidden\" value={value || ''} {...otherFieldProps} />\n                </DropdownTrigger>\n            </div>\n        );\n    }\n\n    private updateFieldValue(instrumentId = ''): void {\n        const { form, field } = this.props;\n\n        form.setFieldValue(field.name, instrumentId);\n    }\n}\n\ninterface AccountInstrumentMenuProps {\n    instruments: AccountInstrument[];\n    selectedInstrumentId?: string;\n    onSelectInstrument(id: string): void;\n    onUseNewInstrument(): void;\n}\n\nconst AccountInstrumentMenu: FunctionComponent<AccountInstrumentMenuProps> = ({\n    instruments,\n    selectedInstrumentId,\n    onSelectInstrument,\n    onUseNewInstrument,\n}) => {\n    return (\n        <ul\n            className=\"instrumentSelect-dropdownMenu instrumentSelect-dropdownMenuNext dropdown-menu\"\n            data-test=\"instrument-select-menu\"\n        >\n            {instruments.map((instrument) => (\n                <li\n                    className={classNames('instrumentSelect-option dropdown-menu-item', {\n                        'instrumentSelect-option--selected':\n                            instrument.bigpayToken === selectedInstrumentId,\n                    })}\n                    key={instrument.bigpayToken}\n                >\n                    <AccountInstrumentOption\n                        instrument={instrument}\n                        onClick={onSelectInstrument}\n                        testId=\"instrument-select-option\"\n                    />\n                </li>\n            ))}\n\n            <li className=\"instrumentSelect-option instrumentSelect-option--addNew dropdown-menu-item\">\n                <AccountInstrumentUseNewButton\n                    onClick={onUseNewInstrument}\n                    testId=\"instrument-select-option-use-new\"\n                />\n            </li>\n        </ul>\n    );\n};\n\ninterface AccountInstrumentSelectButtonProps {\n    instrument?: AccountInstrument;\n    testId?: string;\n    onClick?(): void;\n}\n\nconst AccountInstrumentSelectButton: FunctionComponent<AccountInstrumentSelectButtonProps> = ({\n    instrument,\n    testId,\n    onClick,\n}) => {\n    if (!instrument) {\n        return (\n            <AccountInstrumentUseNewButton\n                className=\"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input\"\n                testId={testId}\n            />\n        );\n    }\n\n    return !isBankAccountInstrument(instrument) ? (\n        <AccountInstrumentMenuItem\n            className=\"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input\"\n            instrument={instrument}\n            onClick={onClick}\n            testId={testId}\n        />\n    ) : (\n        <BankInstrumentMenuItem\n            className=\"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input\"\n            instrument={instrument}\n            onClick={onClick}\n            testId={testId}\n        />\n    );\n};\n\ninterface AccountInstrumentOptionProps {\n    instrument: AccountInstrument;\n    testId?: string;\n    onClick?(token: string): void;\n}\n\nconst AccountInstrumentOption: FunctionComponent<AccountInstrumentOptionProps> = ({\n    instrument,\n    onClick = noop,\n}) => {\n    const handleClick = useCallback(() => {\n        onClick(instrument.bigpayToken);\n    }, [onClick, instrument]);\n\n    return !isBankAccountInstrument(instrument) ? (\n        <AccountInstrumentMenuItem\n            instrument={instrument}\n            onClick={handleClick}\n            testId=\"instrument-select-option\"\n        />\n    ) : (\n        <BankInstrumentMenuItem\n            instrument={instrument}\n            onClick={handleClick}\n            testId=\"instrument-select-option\"\n        />\n    );\n};\n\ninterface AccountInstrumentMenuItemProps {\n    className?: string;\n    instrument: PayPalInstrument;\n    testId?: string;\n    onClick?(): void;\n}\n\nconst AccountInstrumentMenuItem: FunctionComponent<AccountInstrumentMenuItemProps> = ({\n    className,\n    instrument: { externalId },\n    testId,\n    onClick,\n}) => {\n    return (\n        <button className={className} data-test={testId} onClick={onClick} type=\"button\">\n            <div className=\"instrumentSelect-details\">\n                {\n                    // TODO: When we include new account instrument types we can\n                    // abstract these icons in a similar way we did for credit cards.\n                }\n                <IconPaypal additionalClassName=\"accountIcon-icon\" size={IconSize.Medium} />\n\n                <div className=\"instrumentSelect-account\" data-test={`${testId}-externalId`}>\n                    {externalId}\n                </div>\n            </div>\n        </button>\n    );\n};\n\ninterface BankInstrumentMenuItemProps {\n    className?: string;\n    instrument: BankInstrument | AchInstrument;\n    testId?: string;\n    onClick?(): void;\n}\n\nconst BankInstrumentMenuItem: FunctionComponent<BankInstrumentMenuItemProps> = ({\n    className,\n    instrument,\n    testId,\n    onClick,\n}) => {\n    return (\n        <button className={className} data-test={testId} onClick={onClick} type=\"button\">\n            <div className=\"instrumentSelect-details\">\n                {\n                    // TODO: When we include new account instrument types we can\n                    // abstract these icons in a similar way we did for credit cards.\n                }\n                <div className=\"instrumentSelect-card\">\n                    <TranslatedString\n                        data={{ accountNumber: instrument.accountNumber }}\n                        id=\"payment.instrument_account_number_ending\"\n                    />\n                </div>\n                <div className=\"instrumentSelect-issuer\">\n                    <TranslatedString id=\"payment.instrument_issuer\" />: {instrument.issuer}\n                </div>\n            </div>\n        </button>\n    );\n};\n\ninterface AccountInstrumentUseNewButtonProps {\n    className?: string;\n    testId?: string;\n    onClick?(): void;\n}\n\nconst AccountInstrumentUseNewButton: FunctionComponent<AccountInstrumentUseNewButtonProps> = ({\n    className,\n    testId,\n    onClick = noop,\n}) => (\n    <button className={className} data-test={testId} onClick={onClick} type=\"button\">\n        <div className=\"instrumentSelect-details instrumentSelect-details--addNew\">\n            <IconNewAccount additionalClassName=\"accountIcon-icon\" size={IconSize.Medium} />\n\n            <div className=\"instrumentSelect-account\">\n                <TranslatedString id=\"payment.account_instrument_add_action\" />\n            </div>\n        </div>\n    </button>\n);\n\nexport default AccountInstrumentSelect;\n","import { AccountInstrument } from '@bigcommerce/checkout-sdk';\nimport { FieldProps } from 'formik';\nimport React, { FunctionComponent, memo, useCallback } from 'react';\n\nimport { TranslatedHtml, TranslatedString } from '@bigcommerce/checkout/locale';\n\nimport { BasicFormField, Fieldset, Legend } from '../../ui/form';\nimport { ModalTrigger, ModalTriggerModalProps } from '../../ui/modal';\n\nimport AccountInstrumentSelect from './AccountInstrumentSelect';\nimport ManageInstrumentsModal from './ManageInstrumentsModal';\n\nexport interface AccountInstrumentFieldsetProps {\n    instruments: AccountInstrument[];\n    selectedInstrument?: AccountInstrument;\n    onSelectInstrument(id: string): void;\n    onUseNewInstrument(): void;\n}\n\nexport interface AccountInstrumentFieldsetValues {\n    instrumentId: string;\n}\n\nconst AccountInstrumentFieldset: FunctionComponent<AccountInstrumentFieldsetProps> = ({\n    instruments,\n    onSelectInstrument,\n    onUseNewInstrument,\n    selectedInstrument,\n}) => {\n    const renderInput = useCallback(\n        (field: FieldProps<string>) => (\n            <AccountInstrumentSelect\n                {...field}\n                instruments={instruments}\n                onSelectInstrument={onSelectInstrument}\n                onUseNewInstrument={onUseNewInstrument}\n                selectedInstrumentId={selectedInstrument && selectedInstrument.bigpayToken}\n            />\n        ),\n        [instruments, onSelectInstrument, onUseNewInstrument, selectedInstrument],\n    );\n\n    const renderModal = useCallback(\n        (props: ModalTriggerModalProps) => (\n            <ManageInstrumentsModal instruments={instruments} {...props} />\n        ),\n        [instruments],\n    );\n\n    return (\n        <Fieldset\n            additionalClassName=\"instrumentFieldset\"\n            legend={\n                <Legend hidden>\n                    <TranslatedString id=\"payment.account_instrument_text\" />\n                </Legend>\n            }\n        >\n            <ModalTrigger modal={renderModal}>\n                {({ onClick }) => (\n                    <button className=\"instrumentModal-trigger\" onClick={onClick} type=\"button\">\n                        <TranslatedString id=\"payment.instrument_manage_button\" />\n                    </button>\n                )}\n            </ModalTrigger>\n\n            <BasicFormField name=\"instrumentId\" render={renderInput} />\n\n            {instruments.length === 0 && (\n                <div className=\"instrumentSelect-note\">\n                    <TranslatedHtml id=\"payment.account_instrument_new_shipping_address\" />\n                </div>\n            )}\n        </Fieldset>\n    );\n};\n\nexport default memo(AccountInstrumentFieldset);\n","import {\n    AccountInstrument,\n    CheckoutSelectors,\n    PaymentInitializeOptions,\n    PaymentInstrument,\n    PaymentMethod,\n    PaymentRequestOptions,\n} from '@bigcommerce/checkout-sdk';\nimport { memoizeOne } from '@bigcommerce/memoize';\nimport { find, noop } from 'lodash';\nimport React, { Component, ReactNode } from 'react';\n\nimport { MapToPropsFactory } from '@bigcommerce/checkout/legacy-hoc';\nimport { withLanguage, WithLanguageProps } from '@bigcommerce/checkout/locale';\nimport { CheckoutContextProps, PaymentFormValues } from '@bigcommerce/checkout/payment-integration-api';\nimport { LoadingOverlay } from '@bigcommerce/checkout/ui';\n\nimport { withCheckout } from '../../checkout';\nimport { connectFormik, ConnectFormikProps } from '../../common/form';\nimport {\n    AccountInstrumentFieldset,\n    isAccountInstrument,\n    isInstrumentFeatureAvailable,\n} from '../storedInstrument';\nimport StoreInstrumentFieldset from '../StoreInstrumentFieldset';\nimport withPayment, { WithPaymentProps } from '../withPayment';\n\nexport interface HostedPaymentMethodProps {\n    description?: ReactNode;\n    isInitializing?: boolean;\n    isUsingMultiShipping?: boolean;\n    method: PaymentMethod;\n    deinitializePayment(options: PaymentRequestOptions): Promise<CheckoutSelectors>;\n    initializePayment(options: PaymentInitializeOptions): Promise<CheckoutSelectors>;\n    onUnhandledError?(error: Error): void;\n}\n\ninterface HostedPaymentMethodState {\n    isAddingNewInstrument: boolean;\n    selectedInstrument?: AccountInstrument;\n}\n\ninterface WithCheckoutHostedPaymentMethodProps {\n    instruments: AccountInstrument[];\n    isInstrumentFeatureAvailable: boolean;\n    isLoadingInstruments: boolean;\n    isNewAddress: boolean;\n    isPaymentDataRequired: boolean;\n    loadInstruments(): Promise<CheckoutSelectors>;\n}\n\nclass HostedPaymentMethod extends Component<\n    HostedPaymentMethodProps &\n        WithCheckoutHostedPaymentMethodProps &\n        WithPaymentProps &\n        WithLanguageProps &\n        ConnectFormikProps<PaymentFormValues>,\n    HostedPaymentMethodState\n> {\n    state: HostedPaymentMethodState = {\n        isAddingNewInstrument: false,\n    };\n\n    async componentDidMount(): Promise<void> {\n        const {\n            initializePayment,\n            isInstrumentFeatureAvailable: isInstrumentFeatureAvailableProp,\n            loadInstruments,\n            method,\n            onUnhandledError = noop,\n        } = this.props;\n\n        try {\n            await initializePayment({\n                gatewayId: method.gateway,\n                methodId: method.id,\n            });\n\n            if (isInstrumentFeatureAvailableProp) {\n                await loadInstruments();\n            }\n        } catch (error) {\n            onUnhandledError(error);\n        }\n    }\n\n    async componentWillUnmount(): Promise<void> {\n        const { deinitializePayment, method, onUnhandledError = noop } = this.props;\n\n        try {\n            await deinitializePayment({\n                gatewayId: method.gateway,\n                methodId: method.id,\n            });\n        } catch (error) {\n            onUnhandledError(error);\n        }\n    }\n\n    render(): ReactNode {\n        const {\n            description,\n            isInitializing = false,\n            isLoadingInstruments,\n            instruments,\n            isNewAddress,\n            isInstrumentFeatureAvailable: isInstrumentFeatureAvailableProp,\n        } = this.props;\n\n        const { selectedInstrument = this.getDefaultInstrument() } = this.state;\n\n        const isLoading = isInitializing || isLoadingInstruments;\n        const shouldShowInstrumentFieldset =\n            isInstrumentFeatureAvailableProp && (instruments.length > 0 || isNewAddress);\n\n        if (!description && !isInstrumentFeatureAvailableProp) {\n            return null;\n        }\n\n        return (\n            <LoadingOverlay hideContentWhenLoading isLoading={isLoading}>\n                <div className=\"paymentMethod paymentMethod--hosted\">\n                    {description}\n\n                    {shouldShowInstrumentFieldset && (\n                        <AccountInstrumentFieldset\n                            instruments={instruments}\n                            onSelectInstrument={this.handleSelectInstrument}\n                            onUseNewInstrument={this.handleUseNewInstrument}\n                            selectedInstrument={selectedInstrument}\n                        />\n                    )}\n\n                    {isInstrumentFeatureAvailableProp && (\n                        <StoreInstrumentFieldset\n                            instrumentId={selectedInstrument && selectedInstrument.bigpayToken}\n                            isAccountInstrument={true}\n                        />\n                    )}\n                </div>\n            </LoadingOverlay>\n        );\n    }\n\n    private getDefaultInstrument(): AccountInstrument | undefined {\n        const { isAddingNewInstrument } = this.state;\n        const { instruments } = this.props;\n\n        if (isAddingNewInstrument || !instruments.length) {\n            return;\n        }\n\n        return find(instruments, { defaultInstrument: true }) || instruments[0];\n    }\n\n    private handleUseNewInstrument: () => void = () => {\n        this.setState({\n            isAddingNewInstrument: true,\n            selectedInstrument: undefined,\n        });\n    };\n\n    private handleSelectInstrument: (id: string) => void = (id) => {\n        const { instruments } = this.props;\n\n        this.setState({\n            isAddingNewInstrument: false,\n            selectedInstrument: find(instruments, { bigpayToken: id }),\n        });\n    };\n}\n\nconst mapFromCheckoutProps: MapToPropsFactory<\n    CheckoutContextProps,\n    WithCheckoutHostedPaymentMethodProps,\n    HostedPaymentMethodProps & ConnectFormikProps<PaymentFormValues>\n> = () => {\n    const filterAccountInstruments = memoizeOne((instruments: PaymentInstrument[] = []) =>\n        instruments.filter(isAccountInstrument),\n    );\n    const filterTrustedInstruments = memoizeOne((instruments: AccountInstrument[] = []) =>\n        instruments.filter(({ trustedShippingAddress }) => trustedShippingAddress),\n    );\n\n    return (context, props) => {\n        const { method } = props;\n\n        const { checkoutService, checkoutState } = context;\n\n        const {\n            data: {\n                getCart,\n                getConfig,\n                getCustomer,\n                getInstruments,\n                isPaymentDataRequired,\n                isPaymentDataSubmitted,\n            },\n            statuses: { isLoadingInstruments },\n        } = checkoutState;\n\n        const cart = getCart();\n        const config = getConfig();\n        const customer = getCustomer();\n\n        if (!config || !cart || !customer || !method) {\n            return null;\n        }\n\n        const currentMethodInstruments = filterAccountInstruments(getInstruments(method));\n        const trustedInstruments = filterTrustedInstruments(currentMethodInstruments);\n\n        return {\n            instruments: trustedInstruments,\n            isNewAddress: trustedInstruments.length === 0 && currentMethodInstruments.length > 0,\n            isInstrumentFeatureAvailable:\n                !isPaymentDataSubmitted(method.id, method.gateway) &&\n                isInstrumentFeatureAvailable({\n                    config,\n                    customer,\n                    paymentMethod: method,\n                }),\n            isLoadingInstruments: isLoadingInstruments(),\n            isPaymentDataRequired: isPaymentDataRequired(),\n            loadInstruments: checkoutService.loadInstruments,\n        };\n    };\n};\n\nexport default connectFormik(\n    withLanguage(withPayment(withCheckout(mapFromCheckoutProps)(HostedPaymentMethod))),\n);\n"],"names":["withIconContainer","height","viewBox","width","xmlns","clipRule","d","fill","fillRule","AccountInstrumentSelect","PureComponent","componentDidMount","selectedInstrumentId","this","props","setTimeout","updateFieldValue","componentDidUpdate","prevProps","prevSelectedInstrumentId","componentWillUnmount","field","value","undefined","render","instruments","onSelectInstrument","onUseNewInstrument","selectedInstrument","find","bigpayToken","otherFieldProps","className","DropdownTrigger","dropdown","AccountInstrumentMenu","AccountInstrumentSelectButton","instrument","testId","type","instrumentId","form","setFieldValue","name","map","key","AccountInstrumentOption","onClick","AccountInstrumentUseNewButton","isBankAccountInstrument","BankInstrumentMenuItem","AccountInstrumentMenuItem","noop","handleClick","useCallback","externalId","IconPaypal","additionalClassName","size","Medium","TranslatedString","data","accountNumber","id","issuer","memo","renderInput","renderModal","ManageInstrumentsModal","Fieldset","legend","Legend","hidden","ModalTrigger","modal","BasicFormField","length","TranslatedHtml","HostedPaymentMethod","Component","state","isAddingNewInstrument","handleUseNewInstrument","setState","handleSelectInstrument","initializePayment","isInstrumentFeatureAvailable","isInstrumentFeatureAvailableProp","loadInstruments","method","onUnhandledError","gatewayId","gateway","methodId","error","deinitializePayment","description","isInitializing","isLoadingInstruments","isNewAddress","getDefaultInstrument","isLoading","shouldShowInstrumentFieldset","LoadingOverlay","hideContentWhenLoading","StoreInstrumentFieldset","isAccountInstrument","defaultInstrument","connectFormik","withLanguage","withPayment","withCheckout","filterAccountInstruments","memoizeOne","filter","filterTrustedInstruments","trustedShippingAddress","context","checkoutService","checkoutState","getCart","getConfig","getCustomer","getInstruments","isPaymentDataRequired","isPaymentDataSubmitted","statuses","cart","config","customer","currentMethodInstruments","trustedInstruments","paymentMethod"],"sourceRoot":""}