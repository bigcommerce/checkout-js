"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[3380,3948],{25224:(t,e,n)=>{n.d(e,{A:()=>u});var i=n(31635),s=n(69440),a=n(70355),d=n(47109),r=n(48407),o=n(31448);const u=(0,n(19285).A)(t=>{var{checkoutService:e,checkoutState:n,paymentForm:u,method:m,method:{initializationData:{paymentDescriptor:l,paymentToken:h}}}=t,c=(0,i.__rest)(t,["checkoutService","checkoutState","paymentForm","method","method"]);const I=(0,a.useCallback)(t=>e.initializePayment(Object.assign(Object.assign({},t),{amazonpay:{editButtonId:"editButtonId"}})),[e]),p=(0,a.useCallback)(()=>window.location.reload(),[]),{hidePaymentSubmitButton:g,disableSubmit:y,setFieldValue:S,setSubmit:w,setValidationSchema:f}=u,{data:{getCheckout:v,isPaymentDataRequired:b},statuses:{isLoadingInstruments:A}}=n,C=v(),D=n.data.getCustomer(),P=!(null==D?void 0:D.isGuest)&&Boolean(m.config.isVaultingEnabled),k=n.data.getInstruments(m)||[];return a.createElement(d.A,Object.assign({},c,{buttonId:"editButtonId",containerId:"paymentWidget",deinitializePayment:e.deinitializePayment,disableSubmit:y,hidePaymentSubmitButton:g,hideWidget:!0,initializePayment:I,instruments:k,isInstrumentCardCodeRequired:(0,r.A)(n),isInstrumentCardNumberRequired:(0,o.A)(n),isInstrumentFeatureAvailable:P,isLoadingInstruments:A(),isPaymentDataRequired:b(),isSignInRequired:!1,isSignedIn:(0,s.some)(null==C?void 0:C.payments,{providerId:m.id}),loadInstruments:e.loadInstruments,method:m,onSignOut:p,paymentDescriptor:l,setFieldValue:S,setSubmit:w,setValidationSchema:f,shouldShow:!!h,shouldShowDescriptor:!!h,shouldShowEditButton:!!h,signOut:e.signOutCustomer}))},[{id:"amazonpay"}])},47109:(t,e,n)=>{n.d(e,{A:()=>y});var i=n(31635),s=n(3375),a=n.n(s),d=n(69440),r=n(70355),o=n(72769),u=n(52137),m=n(11474),l=n(62677),h=n(40646),c=n(43125),I=n(49655),p=n(91182);class g extends r.Component{constructor(){super(...arguments),this.state={isAddingNewCard:!1},this.handleDeleteInstrument=t=>{const{instruments:e,setFieldValue:n}=this.props,{selectedInstrumentId:i}=this.state;0===e.length?(this.setState({isAddingNewCard:!0,selectedInstrumentId:void 0}),n("instrumentId","")):i===t&&(this.setState({selectedInstrumentId:this.getDefaultInstrumentId()}),n("instrumentId",this.getDefaultInstrumentId()))},this.handleUseNewCard=()=>(0,i.__awaiter)(this,void 0,void 0,function*(){const{deinitializePayment:t,initializePayment:e=d.noop,method:n}=this.props;this.setState({isAddingNewCard:!0,selectedInstrumentId:void 0}),yield t({gatewayId:n.gateway,methodId:n.id}),yield e({gatewayId:n.gateway,methodId:n.id})}),this.handleSelectInstrument=t=>{this.setState({isAddingNewCard:!1,selectedInstrumentId:t})}}componentDidMount(){return(0,i.__awaiter)(this,void 0,void 0,function*(){const{isInstrumentFeatureAvailable:t,loadInstruments:e,method:n,onUnhandledError:i=d.noop,setValidationSchema:s}=this.props;s(n,this.getValidationSchema());try{t&&(yield e()),yield this.initializeMethod()}catch(t){i(t)}})}componentDidUpdate(t,e){return(0,i.__awaiter)(this,void 0,void 0,function*(){const{deinitializePayment:n,instruments:i,method:s,onUnhandledError:a=d.noop,setValidationSchema:r,isPaymentDataRequired:o}=this.props,{selectedInstrumentId:u}=this.state;if(r(s,this.getValidationSchema()),u!==e.selectedInstrumentId||t.instruments.length>0&&0===i.length||t.isPaymentDataRequired!==o)try{yield n({gatewayId:s.gateway,methodId:s.id}),yield this.initializeMethod()}catch(t){a(t)}})}componentWillUnmount(){return(0,i.__awaiter)(this,void 0,void 0,function*(){const{deinitializeCustomer:t=d.noop,deinitializePayment:e,method:n,onUnhandledError:i=d.noop,setSubmit:s,setValidationSchema:a}=this.props;a(n,null),s(n,null);try{yield e({gatewayId:n.gateway,methodId:n.id}),yield t({methodId:n.id})}catch(t){i(t)}})}render(){const{instruments:t,hideWidget:e=!1,isInitializing:n=!1,isAccountInstrument:i,isInstrumentFeatureAvailable:s,isLoadingInstruments:a,shouldHideInstrumentExpiryDate:d=!1,shouldShow:o=!0}=this.props,{isAddingNewCard:c,selectedInstrumentId:I=this.getDefaultInstrumentId()}=this.state;if(!o)return null;const g=t.find(t=>t.bigpayToken===I)||t[0],y=s&&t.length>0,S=!y||c,w=(n||a)&&!e,f=this.getSelectedBankAccountInstrument(c,g),v=t[0]&&(0,u.T)(t[0]);return r.createElement(p.A,{hideContentWhenLoading:!0,isLoading:w},r.createElement("div",{className:"paymentMethod--hosted"},v&&y&&r.createElement(m.A,{instruments:t,onSelectInstrument:this.handleSelectInstrument,onUseNewInstrument:this.handleUseNewCard,selectedInstrument:f}),!v&&y&&r.createElement(l.A,{instruments:t,onDeleteInstrument:this.handleDeleteInstrument,onSelectInstrument:this.handleSelectInstrument,onUseNewInstrument:this.handleUseNewCard,selectedInstrumentId:I,shouldHideExpiryDate:d,validateInstrument:this.getValidateInstrument()}),this.renderPaymentDescriptorIfAvailable(),this.renderContainer(S),s&&r.createElement(h.A,{instrumentId:I,instruments:t,isAccountInstrument:i||v}),this.renderEditButtonIfAvailable()))}getValidateInstrument(){const{hideVerificationFields:t,instruments:e,method:n,isInstrumentCardNumberRequired:i,validateInstrument:s}=this.props,{selectedInstrumentId:a=this.getDefaultInstrumentId()}=this.state,r=(0,d.find)(e,{bigpayToken:a});if(r){(0,c.A)(r);const e=i(r,n);if(t)return;if(s)return s(e,r)}}renderContainer(t){const{containerId:e,hideContentWhenSignedOut:n=!1,hideWidget:i,isSignInRequired:s=!1,isSignedIn:d,method:o,additionalContainerClassName:u,shouldRenderCustomInstrument:m=!1,renderCustomPaymentForm:l}=this.props;return r.createElement("div",{className:a()("widget",`widget--${o.id}`,"payment-widget",m?"":u),id:e,style:{display:n&&s&&!d||!t||i?"none":void 0},tabIndex:-1},m&&l&&l())}getValidationSchema(){const{isInstrumentFeatureAvailable:t,isPaymentDataRequired:e,storedCardValidationSchema:n}=this.props;if(!e)return null;const i=this.getSelectedInstrument();return t&&i&&n||null}getSelectedInstrument(){const{instruments:t}=this.props,{selectedInstrumentId:e=this.getDefaultInstrumentId()}=this.state;return(0,d.find)(t,{bigpayToken:e})}getSelectedBankAccountInstrument(t,e){return!t&&(0,u.T)(e)?e:void 0}renderEditButtonIfAvailable(){const{shouldShowEditButton:t,buttonId:e}=this.props,n=r.createElement(I.A,{id:"remote.select_different_card_action"});if(t)return r.createElement("p",null,r.createElement("a",{className:a()("stepHeader","widget-link-amazonpay"),id:e,onClick:(0,o.A)()},n))}renderPaymentDescriptorIfAvailable(){const{shouldShowDescriptor:t,paymentDescriptor:e}=this.props;if(t&&e)return r.createElement("div",{className:"payment-descriptor"},e)}initializeMethod(){return(0,i.__awaiter)(this,void 0,void 0,function*(){const{isPaymentDataRequired:t,isSignedIn:e,isSignInRequired:n,initializeCustomer:i=d.noop,initializePayment:s=d.noop,instruments:a,method:r,setSubmit:o,signInCustomer:u=d.noop}=this.props,{selectedInstrumentId:m=this.getDefaultInstrumentId(),isAddingNewCard:l}=this.state;let h;return t?n&&!e?(o(r,u),i({methodId:r.id})):(o(r,null),l||(h=a.find(t=>t.bigpayToken===m)||a[0]),s({gatewayId:r.gateway,methodId:r.id},h)):(o(r,null),Promise.resolve())})}getDefaultInstrumentId(){const{isAddingNewCard:t}=this.state;if(t)return;const{instruments:e}=this.props,n=e.find(t=>t.defaultInstrument)||e[0];return n&&n.bigpayToken}}const y=g},67701:(t,e,n)=>{n.r(e),n.d(e,{AmazonPayV2Button:()=>s.A,AmazonPayV2PaymentMethod:()=>i.A});var i=n(25224),s=n(34753)}}]);
//# sourceMappingURL=amazon-pay-v2-button-a5aa29fb.js.map