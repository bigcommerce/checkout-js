"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[6051,9154],{12929:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(70355),i=n(49655),r=n(88186),s=n(30680);const d=({appearFocused:e,id:t,name:n})=>{const d=(0,a.useCallback)((()=>a.createElement(r.A,{appearFocused:e,id:t})),[t,e]);return a.createElement(s.A,{additionalClassName:"form-field--ccExpiry",input:d,labelContent:a.createElement(i.A,{id:"payment.credit_card_expiration_label"}),name:n})}},36659:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(70355),i=n(49655),r=n(88186),s=n(14456),d=n(30680);const o=({appearFocused:e,id:t,name:n})=>{const o=(0,a.useCallback)((()=>a.createElement(a.Fragment,null,a.createElement(r.A,{additionalClassName:"has-icon",appearFocused:e,id:t}),a.createElement(s.A,null))),[t,e]);return a.createElement(d.A,{additionalClassName:"form-field--ccNumber",input:o,labelContent:a.createElement(i.A,{id:"payment.credit_card_number_label"}),name:n})}},39527:(e,t,n)=>{n.d(t,{i:()=>c});var a=n(31635),i=n(69440),r=n(70355),s=n(48407),d=n(31448),o=n(82804),l=n(98363);const c=({checkoutState:e,method:t,language:n,paymentForm:c})=>{const{setFieldTouched:m,setFieldValue:u,setSubmitted:p,submitForm:h}=c,{config:I}=t,{cardCode:y}=I,g=y||null===y,v=(0,s.A)(e),_=(0,d.A)(e),b=(0,r.useCallback)((e=>`${(0,i.compact)([t.gateway,t.id]).join("-")}-${e}`),[t]),[f,C]=(0,r.useState)();return{getHostedStoredCardValidationFieldset:(0,r.useCallback)((e=>{const n=!!e&&_(e,t),a=!!e&&v(e,t);return r.createElement(l.A,{cardCodeId:a?b("ccCvv"):void 0,cardNumberId:n?b("ccNumber"):void 0,focusedFieldType:f})}),[f,b,v,_,t]),getHostedFormOptions:(0,r.useCallback)((e=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const a=["color","fontFamily","fontSize","fontWeight"],r=!!e&&_(e,t),s=!!e&&v(e,t);let d;return e?s?d=b("ccCvv"):r&&(d=b("ccNumber")):d=b("ccNumber"),{fields:e?{cardCodeVerification:s&&e?{accessibilityLabel:n.translate("payment.credit_card_cvv_label"),containerId:b("ccCvv"),instrumentId:e.bigpayToken}:void 0,cardNumberVerification:r&&e?{accessibilityLabel:n.translate("payment.credit_card_number_label"),containerId:b("ccNumber"),instrumentId:e.bigpayToken}:void 0}:{cardCode:g?{accessibilityLabel:n.translate("payment.credit_card_cvv_label"),containerId:b("ccCvv")}:void 0,cardExpiry:{accessibilityLabel:n.translate("payment.credit_card_expiration_label"),containerId:b("ccExpiry"),placeholder:n.translate("payment.credit_card_expiration_placeholder_text")},cardName:{accessibilityLabel:n.translate("payment.credit_card_name_label"),containerId:b("ccName")},cardNumber:{accessibilityLabel:n.translate("payment.credit_card_number_label"),containerId:b("ccNumber")}},styles:d?{default:yield(0,o.A)(d,a),error:yield(0,o.A)(d,a,o.S.Error),focus:yield(0,o.A)(d,a,o.S.Focus)}:{},onBlur:({fieldType:e})=>{f===e&&C(void 0)},onCardTypeChange:({cardType:e})=>{u("hostedForm.cardType",e)},onEnter:()=>{p(!0),h()},onFocus:({fieldType:e})=>{C(e)},onValidate:({errors:e={}})=>{(0,i.forIn)(e,((e=[],t)=>{var n,a;const i=`hostedForm.errors.${t}`;u(i,null!==(a=null===(n=e[0])||void 0===n?void 0:n.type)&&void 0!==a?a:""),e[0]&&m(i)}))}}}))),[f,b,g,v,_,n,t,m,u,p,h])}}},47109:(e,t,n)=>{n.d(t,{A:()=>g});var a=n(31635),i=n(3375),r=n.n(i),s=n(69440),d=n(70355),o=n(72769),l=n(52137),c=n(11474),m=n(62677),u=n(40646),p=n(43125),h=n(49655),I=n(68801);class y extends d.Component{constructor(){super(...arguments),this.state={isAddingNewCard:!1},this.handleDeleteInstrument=e=>{const{instruments:t,setFieldValue:n}=this.props,{selectedInstrumentId:a}=this.state;0===t.length?(this.setState({isAddingNewCard:!0,selectedInstrumentId:void 0}),n("instrumentId","")):a===e&&(this.setState({selectedInstrumentId:this.getDefaultInstrumentId()}),n("instrumentId",this.getDefaultInstrumentId()))},this.handleUseNewCard=()=>(0,a.__awaiter)(this,void 0,void 0,(function*(){const{deinitializePayment:e,initializePayment:t=s.noop,method:n}=this.props;this.setState({isAddingNewCard:!0,selectedInstrumentId:void 0}),yield e({gatewayId:n.gateway,methodId:n.id}),yield t({gatewayId:n.gateway,methodId:n.id})})),this.handleSelectInstrument=e=>{this.setState({isAddingNewCard:!1,selectedInstrumentId:e})}}componentDidMount(){return(0,a.__awaiter)(this,void 0,void 0,(function*(){const{isInstrumentFeatureAvailable:e,loadInstruments:t,method:n,onUnhandledError:a=s.noop,setValidationSchema:i}=this.props;i(n,this.getValidationSchema());try{e&&(yield t()),yield this.initializeMethod()}catch(e){a(e)}}))}componentDidUpdate(e,t){return(0,a.__awaiter)(this,void 0,void 0,(function*(){const{deinitializePayment:n,instruments:a,method:i,onUnhandledError:r=s.noop,setValidationSchema:d,isPaymentDataRequired:o}=this.props,{selectedInstrumentId:l}=this.state;if(d(i,this.getValidationSchema()),l!==t.selectedInstrumentId||e.instruments.length>0&&0===a.length||e.isPaymentDataRequired!==o)try{yield n({gatewayId:i.gateway,methodId:i.id}),yield this.initializeMethod()}catch(e){r(e)}}))}componentWillUnmount(){return(0,a.__awaiter)(this,void 0,void 0,(function*(){const{deinitializeCustomer:e=s.noop,deinitializePayment:t,method:n,onUnhandledError:a=s.noop,setSubmit:i,setValidationSchema:r}=this.props;r(n,null),i(n,null);try{yield t({gatewayId:n.gateway,methodId:n.id}),yield e({methodId:n.id})}catch(e){a(e)}}))}render(){const{instruments:e,hideWidget:t=!1,isInitializing:n=!1,isAccountInstrument:a,isInstrumentFeatureAvailable:i,isLoadingInstruments:r,shouldHideInstrumentExpiryDate:s=!1,shouldShow:o=!0}=this.props,{isAddingNewCard:p,selectedInstrumentId:h=this.getDefaultInstrumentId()}=this.state;if(!o)return null;const y=e.find((e=>e.bigpayToken===h))||e[0],g=i&&e.length>0,v=!g||p,_=(n||r)&&!t,b=this.getSelectedBankAccountInstrument(p,y),f=e[0]&&(0,l.T)(e[0]);return d.createElement(I.A,{hideContentWhenLoading:!0,isLoading:_},d.createElement("div",{className:"paymentMethod--hosted"},f&&g&&d.createElement(c.A,{instruments:e,onSelectInstrument:this.handleSelectInstrument,onUseNewInstrument:this.handleUseNewCard,selectedInstrument:b}),!f&&g&&d.createElement(m.A,{instruments:e,onDeleteInstrument:this.handleDeleteInstrument,onSelectInstrument:this.handleSelectInstrument,onUseNewInstrument:this.handleUseNewCard,selectedInstrumentId:h,shouldHideExpiryDate:s,validateInstrument:this.getValidateInstrument()}),this.renderPaymentDescriptorIfAvailable(),this.renderContainer(v),i&&d.createElement(u.A,{instrumentId:h,instruments:e,isAccountInstrument:a||f}),this.renderEditButtonIfAvailable()))}getValidateInstrument(){const{hideVerificationFields:e,instruments:t,method:n,isInstrumentCardNumberRequired:a,validateInstrument:i}=this.props,{selectedInstrumentId:r=this.getDefaultInstrumentId()}=this.state,d=(0,s.find)(t,{bigpayToken:r});if(d){(0,p.A)(d);const t=a(d,n);if(e)return;if(i)return i(t,d)}}renderContainer(e){const{containerId:t,hideContentWhenSignedOut:n=!1,hideWidget:a,isSignInRequired:i=!1,isSignedIn:s,method:o,additionalContainerClassName:l,shouldRenderCustomInstrument:c=!1,renderCustomPaymentForm:m}=this.props;return d.createElement("div",{className:r()("widget",`widget--${o.id}`,"payment-widget",c?"":l),id:t,style:{display:n&&i&&!s||!e||a?"none":void 0},tabIndex:-1},c&&m&&m())}getValidationSchema(){const{isInstrumentFeatureAvailable:e,isPaymentDataRequired:t,storedCardValidationSchema:n}=this.props;if(!t)return null;const a=this.getSelectedInstrument();return e&&a&&n||null}getSelectedInstrument(){const{instruments:e}=this.props,{selectedInstrumentId:t=this.getDefaultInstrumentId()}=this.state;return(0,s.find)(e,{bigpayToken:t})}getSelectedBankAccountInstrument(e,t){return!e&&(0,l.T)(t)?t:void 0}renderEditButtonIfAvailable(){const{shouldShowEditButton:e,buttonId:t}=this.props,n=d.createElement(h.A,{id:"remote.select_different_card_action"});if(e)return d.createElement("p",null,d.createElement("a",{className:r()("stepHeader","widget-link-amazonpay"),id:t,onClick:(0,o.A)()},n))}renderPaymentDescriptorIfAvailable(){const{shouldShowDescriptor:e,paymentDescriptor:t}=this.props;if(e&&t)return d.createElement("div",{className:"payment-descriptor"},t)}initializeMethod(){return(0,a.__awaiter)(this,void 0,void 0,(function*(){const{isPaymentDataRequired:e,isSignedIn:t,isSignInRequired:n,initializeCustomer:a=s.noop,initializePayment:i=s.noop,instruments:r,method:d,setSubmit:o,signInCustomer:l=s.noop}=this.props,{selectedInstrumentId:c=this.getDefaultInstrumentId(),isAddingNewCard:m}=this.state;let u;return e?n&&!t?(o(d,l),a({methodId:d.id})):(o(d,null),m||(u=r.find((e=>e.bigpayToken===c))||r[0]),i({gatewayId:d.gateway,methodId:d.id},u)):(o(d,null),Promise.resolve())}))}getDefaultInstrumentId(){const{isAddingNewCard:e}=this.state;if(e)return;const{instruments:t}=this.props,n=t.find((e=>e.defaultInstrument))||t[0];return n&&n.bigpayToken}}const g=y},47459:(e,t,n)=>{n.d(t,{A:()=>m});var a=n(70355),i=n(90767),r=n(49655),s=n(88186),d=n(14456),o=n(97429),l=n(2224),c=n(30680);const m=({appearFocused:e,id:t,name:n})=>{const m=(0,a.useCallback)((()=>a.createElement(a.Fragment,null,a.createElement(s.A,{additionalClassName:"has-icon",appearFocused:e,id:t}),a.createElement(d.A,null))),[t,e]),u=(0,a.useMemo)((()=>a.createElement(a.Fragment,null,a.createElement(r.A,{id:"payment.credit_card_cvv_label"}),a.createElement(o.A,{placement:"top-start",tooltip:a.createElement(i.A,null)},a.createElement("span",{className:"has-tip"},a.createElement(l.A,null))))),[]);return a.createElement(c.A,{additionalClassName:"form-ccFields-field--ccCvv",input:m,labelContent:u,name:n})}},66833:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(44218),i=n(94202);const r=(0,a.memoize)((function({language:e,isCardExpiryRequired:t=!1}){return(0,i.Ik)().shape({instrumentId:(0,i.Yj)().required(),hostedForm:(0,i.Ik)().required().shape({errors:(0,i.Ik)().required().shape(Object.assign({cardCodeVerification:(0,i.Yj)().test({message:e.translate("payment.credit_card_cvv_required_error"),test:e=>"required"!==e}).test({message:e.translate("payment.credit_card_cvv_invalid_error"),test:e=>"invalid_card_code"!==e}),cardNumberVerification:(0,i.Yj)().test({message:e.translate("payment.credit_card_number_required_error"),test:e=>"required"!==e}).test({message:e.translate("payment.credit_card_number_invalid_error"),test:e=>"invalid_card_number"!==e}).test({message:e.translate("payment.credit_card_number_mismatch_error"),test:e=>"mismatched_card_number"!==e})},t?{cardExpiryVerification:(0,i.Yj)().test({message:e.translate("payment.credit_card_expiration_required_error"),test:e=>"required"!==e}).test({message:e.translate("payment.credit_card_expiration_invalid_error"),test:e=>"invalid_card_expiry"!==e})}:{}))})})}))},68280:(e,t,n)=>{n.r(t),n.d(t,{MonerisPaymentMethod:()=>m});var a=n(31635),i=n(69440),r=n(70355),s=n(39527),d=n(66833),o=n(47109),l=n(48407),c=n(31448);const m=(0,n(19285).A)((e=>{var{language:t,paymentForm:n,checkoutState:m,checkoutService:u,method:p}=e,h=(0,a.__rest)(e,["language","paymentForm","checkoutState","checkoutService","method"]);const I="moneris-iframe-container",{getHostedStoredCardValidationFieldset:y,getHostedFormOptions:g}=(0,s.i)({checkoutState:m,method:p,language:t,paymentForm:n}),v=(0,d.A)({language:t}),{hidePaymentSubmitButton:_,disableSubmit:b,setFieldValue:f,setSubmit:C,setValidationSchema:E}=n,A=m.data.getInstruments(p)||[],{data:{getCheckout:S,isPaymentDataRequired:F},statuses:{isLoadingInstruments:N}}=m,w=S(),k=m.data.getCustomer(),V=!(null==k?void 0:k.isGuest)&&Boolean(p.config.isVaultingEnabled),D=(0,r.useCallback)(((e,t)=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},e),{moneris:Object.assign({containerId:I},t&&{form:yield g(t)})});return u.initializePayment(n)}))),[I,g,u]);return r.createElement(o.A,Object.assign({containerId:I,deinitializePayment:u.deinitializePayment,disableSubmit:b,hidePaymentSubmitButton:_,initializePayment:D,instruments:A,isInstrumentCardCodeRequired:(0,l.A)(m),isInstrumentCardNumberRequired:(0,c.A)(m),isInstrumentFeatureAvailable:V,isLoadingInstruments:N(),isPaymentDataRequired:F(),isSignedIn:(0,i.some)(null==w?void 0:w.payments,{providerId:p.id}),loadInstruments:u.loadInstruments,method:p,setFieldValue:f,setSubmit:C,setValidationSchema:E,signOut:u.signOutCustomer,storedCardValidationSchema:v,validateInstrument:(e,t)=>y(t)},h))}),[{id:"moneris"}])},82804:(e,t,n)=>{n.d(t,{A:()=>m,S:()=>a});var a,i=n(69440),r=n(70355),s=n(54622),d=n(59713),o=n(9343),l=n(85216),c=n(10156);function m(e,t,n=a.Default){const m=document.createElement("div"),u=document.getElementById(e);if(!u)throw new Error("Unable to retrieve input styles as the provided container ID is not valid.");return u.appendChild(m),new Promise((e=>{s.render(r.createElement(o.Ay.Provider,{value:{isSubmitted:!0,setSubmitted:i.noop}},r.createElement(l.A,{hasError:n===a.Error},r.createElement(c.A,{appearFocused:n===a.Focus,ref:n=>{n&&(e((0,d.A)(n,t)),s.unmountComponentAtNode(m),m.parentElement&&m.parentElement.removeChild(m))}}))),m)}))}!function(e){e.Default="default",e.Error="error",e.Focus="focus"}(a||(a={}))},88186:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(31635),i=n(3375),r=n.n(i),s=n(70355);const d=e=>{var{additionalClassName:t,appearFocused:n,testId:i}=e,d=(0,a.__rest)(e,["additionalClassName","appearFocused","testId"]);return s.createElement("div",Object.assign({},d,{className:r()("form-input","optimizedCheckout-form-input",{"form-input--focus":n},{"optimizedCheckout-form-input--focus":n},t),"data-test":i}))}},98363:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(70355),i=n(49655),r=n(36659),s=n(47459),d=n(12929);const o=({cardCodeId:e,cardNumberId:t,cardExpiryId:n,focusedFieldType:o})=>a.createElement(a.Fragment,null,t&&a.createElement("p",null,a.createElement("strong",null,a.createElement(i.A,{id:"payment.instrument_trusted_shipping_address_title_text"})),a.createElement("br",null),a.createElement(i.A,{id:"payment.instrument_trusted_shipping_address_text"})),a.createElement("div",{className:"form-ccFields"},t&&a.createElement(r.A,{appearFocused:"cardNumber"===o,id:t,name:"hostedForm.errors.cardNumberVerification"}),e&&a.createElement(s.A,{appearFocused:"cardCode"===o,id:e,name:"hostedForm.errors.cardCodeVerification"}),n&&a.createElement(d.A,{appearFocused:"cardExpiry"===o,id:n,name:"hostedForm.errors.cardExpiryVerification"})))}}]);
//# sourceMappingURL=moneris-payment-method-24bc89ec.js.map